/*1332970716,169775557*/

if (window.CavalryLogger) { CavalryLogger.start_js(["1Bv0A"]); }

__d("DataStore",[],function(a,b,c,d,e,f){var g={},h=1;function i(l){if(typeof l=='string'){return 'str_'+l;}else return 'elem_'+(l.__FB_TOKEN||(l.__FB_TOKEN=[h++]))[0];}function j(l){var m=i(l);return g[m]||(g[m]={});}var k={set:function(l,m,n){var o=j(l);o[m]=n;return l;},get:function(l,m,n){var o=j(l),p=o[m];if(typeof p==='undefined'&&l.getAttribute){var q=l.getAttribute('data-'+m);p=(null===q)?undefined:q;}if((n!==undefined)&&(p===undefined))p=o[m]=n;return p;},remove:function(l,m){var n=j(l),o=n[m];delete n[m];return o;},purge:function(l){delete g[i(l)];}};e.exports=k;});
__d("ObjectUtils",["copyProperties","hasArrayNature"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("hasArrayNature"),i={isScalar:function(j){return (/string|number|boolean/).test(typeof j);},getKeys:function(j){var k=[];for(var l in j)k.push(l);return k;},getValues:function(j){var k=[];for(var l in j)k.push(j[l]);return k;},countKeys:function(j){var k=0;for(var l in j)k++;return k;},areEqual:function(j,k){return JSON.stringify(j)==JSON.stringify(k);},merge:function(){var j={};for(var k=0;k<arguments.length;k++)g(j,arguments[k]);return j;},coalesce:function(){for(var j=0;j<arguments.length;++j)if(arguments[j]!=null)return arguments[j];return null;},createFrom:function(j,k){var l={},m=h(k);if(typeof k=='undefined')k=true;for(var n=j.length;n--;)l[j[n]]=m?k[n]:k;return l;}};e.exports=i;});
__d("ua",[],function(a,b,c,d,e,f){var g={ie:function(){return g._populate()||this._ie;},ie64:function(){return g.ie()&&this._win64;},firefox:function(){return g._populate()||this._firefox;},opera:function(){return g._populate()||this._opera;},safari:function(){return g._populate()||this._safari;},chrome:function(){return g._populate()||this._chrome;},windows:function(){return g._populate()||this._windows;},osx:function(){return g._populate()||this._osx;},linux:function(){return g._populate()||this._linux;},iphone:function(){return g._populate()||this._iphone;},_populated:false,_populate:function(){if(g._populated)return;g._populated=true;var h=navigator.userAgent,i=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(h),j=/(Mac OS X)|(Windows)|(Linux)/.exec(h),k=/\b(iPhone|iP[ao]d)/.exec(h);g._win64=!!(/Win64/.exec(h));if(i){g._ie=i[1]?parseFloat(i[1]):NaN;if(g._ie&&document.documentMode)g._ie=document.documentMode;g._firefox=i[2]?parseFloat(i[2]):NaN;g._opera=i[3]?parseFloat(i[3]):NaN;g._safari=i[4]?parseFloat(i[4]):NaN;if(g._safari){i=/(?:Chrome\/(\d+\.\d+))/.exec(h);g._chrome=i&&i[1]?parseFloat(i[1]):NaN;}else g._chrome=NaN;}else g._ie=g._firefox=g._opera=g._chrome=g._safari=NaN;if(j){if(j[1]){var l=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(h);g._osx=l?parseFloat(l[1].replace('_','.')):true;}else g._osx=false;g._windows=!!j[2];g._linux=!!j[3];}else g._osx=g._windows=g._linux=false;g._iphone=k;}};a.ua=e.exports=g;},3);
__d("DOMQuery",["ArrayUtils","css-core","ObjectUtils","ge","ua"],function(a,b,c,d,e,f){var g=b("ArrayUtils"),h=b("css-core"),i=b("ObjectUtils"),j=b("ge"),k=b("ua"),l={find:function(m,n){var o=l.scry(m,n);return o[0];},scry:function(m,n){if(!m||!m.getElementsByTagName)return [];var o=n.split(' '),p=[m],q=!!m.documentElement;for(var r=0;r<o.length;r++){if(p.length===0)break;if(o[r]==='')continue;var s=o[r],t=[],u=false;if(s.charAt(0)=='^')if(r===0){u=true;s=s.slice(1);}else return [];s=s.replace(/\./g,' .');s=s.replace(/\#/g,' #');s=s.replace(/\[/g,' [');var v=s.split(' '),w=v[0]||'*',x=v[1]&&v[1].charAt(0)=='#';if(x){var y=j(v[1].slice(1),true);if(y&&('*'==w||y.tagName.toLowerCase()==w))for(var z=0;z<p.length;z++)if(u&&l.contains(y,p[z])){t=[y];break;}else if(document==p[z]||l.contains(p[z],y)){t=[y];break;}}else{var aa=[],ba=p.length,ca;for(var da=0;da<ba;da++){if(u){ca=[];var ea=p[da].parentNode,fa=w=='*';while(l.isElementNode(ea)){if(fa||ea.tagName.toLowerCase()==w)ca.push(ea);ea=ea.parentNode;}}else ca=p[da].getElementsByTagName(w);var ga=ca.length;for(var ha=0;ha<ga;ha++)aa.push(ca[ha]);}for(var ia=1;ia<v.length;ia++){var ja=v[ia],ka=ja.charAt(0)=='.',la=ja.substring(1);for(da=0;da<aa.length;da++){var ma=aa[da];if(!ma)continue;if(ka){if(!h.hasClass(ma,la))delete aa[da];continue;}else{var na=ja.slice(1,ja.length-1);if(na.indexOf('=')==-1){if(ma.getAttribute(na)===null){delete aa[da];continue;}}else{var oa=na.split('='),pa=oa[0],qa=oa[1];qa=qa.slice(1,qa.length-1);if(ma.getAttribute(pa)!=qa){delete aa[da];continue;}}}}}for(da=0;da<aa.length;da++)if(aa[da]){t.push(aa[da]);if(u)break;}}p=t;}return p;},getText:(function(){var m=document.createElement('div'),n=m.textContent!=null?'textContent':'innerText';return function(o){if(!o){return '';}else if(l.isTextNode(o)){return o.data;}else return o[n];};})(),getSelection:function(){var m=window.getSelection,n=document.selection;if(m){return m()+'';}else if(n)return n.createRange().text;return null;},contains:function(m,n){m=j(m);n=j(n);if(!m||!n){return false;}else if(m===n){return true;}else if(l.isTextNode(m)){return false;}else if(l.isTextNode(n)){return l.contains(m,n.parentNode);}else if(m.contains){return m.contains(n);}else if(m.compareDocumentPosition){return !!(m.compareDocumentPosition(n)&16);}else return false;},getRootElement:function(){var m=null;if(window.Quickling&&Quickling.isActive())m=j('content');return m||document.body;},isNode:function(m){return !!(m&&(typeof Node=='object'?m instanceof Node:typeof m=="object"&&typeof m.nodeType=='number'&&typeof m.nodeName=='string'));},isNodeOfType:function(m,n){var o=g.createFrom(n).join('|').toUpperCase().split('|'),p=i.createFrom(o);return l.isNode(m)&&m.nodeName in p;},isElementNode:function(m){return l.isNode(m)&&m.nodeType==1;},isTextNode:function(m){return l.isNode(m)&&m.nodeType==3;},getDocumentScrollElement:function(m){m=m||document;if(h.hasClass(m.documentElement,'wrapped')){var n=m.getElementById('body');if(n)return n;}return !(k.chrome()||k.safari())&&m.compatMode==='CSS1Compat'?m.documentElement:m.body;},getDocumentBodyElement:function(m){m=m||document;if(h.hasClass(m.documentElement,'wrapped')){var n=m.getElementById('body');if(n)return n;}return m.body;}};e.exports=l;});
__d("event-extensions",["event-form-bubbling","DataStore","DOMQuery","ObjectUtils","Parent","ErrorUtils","ua","$","copyProperties","userAction"],function(a,b,c,d,e,f){b('event-form-bubbling');var g=b('DataStore'),h=b('DOMQuery'),i=b('ObjectUtils'),j=b('Parent'),k=b('ErrorUtils'),l=b('ua'),m=b('$'),n=b('copyProperties'),o=b('userAction');Event.DATASTORE_KEY='Event.listeners';if(!Event.prototype)Event.prototype={};function p(y,z,aa){this.target=y;this.type=z;this.data=aa;}n(p.prototype,{getData:function(){this.data=this.data||{};return this.data;},stop:function(){this.cancelBubble=true;this.stopPropagation&&this.stopPropagation();return this;},prevent:function(){this.returnValue=false;this.preventDefault&&this.preventDefault();return this;},kill:function(){this.stop().prevent();return false;},getTarget:function(){var y=this.target||this.srcElement;return y?m(y):null;}});function q(y){if(y instanceof p)return y;y=y||window.event||{};if(!y._inherits_from_prototype)for(var z in Event.prototype)try{y[z]=Event.prototype[z];}catch(aa){}return y;}n(Event.prototype,{_inherits_from_prototype:true,getRelatedTarget:function(){var y=this.relatedTarget||(this.fromElement===this.srcElement?this.toElement:this.fromElement);return y?m(y):null;},getModifiers:function(){var y={control:!!this.ctrlKey,shift:!!this.shiftKey,alt:!!this.altKey,meta:!!this.metaKey};y.access=l.osx()?y.control:y.alt;y.any=y.control||y.shift||y.alt||y.meta;return y;},isMiddleClick:function(){return this.which&&this.which!=1;}});n(Event.prototype,p.prototype);n(Event,{listen:function(y,z,aa,ba){if(typeof y=='string')y=m(y);if(typeof ba=='undefined')ba=Event.Priority.NORMAL;if(typeof z=='object'){var ca={};for(var da in z)ca[da]=Event.listen(y,da,z[da],ba);return ca;}if(z.match(/^on/i))throw new TypeError("Bad event name `"+event+"': use `click', not `onclick'.");if(y.nodeName=='LABEL'&&z=='click'){var ea=y.getElementsByTagName('input');y=ea.length==1?ea[0]:y;}else if(y===window&&z==='scroll'){var fa=h.getDocumentScrollElement();if(fa!==document.documentElement&&fa!==document.body)y=fa;}var ga=g.get(y,s,{});if(u[z]){var ha=u[z];z=ha.base;aa=ha.wrap(aa);}v(y,z);var ia=ga[z];if(!(ba in ia))ia[ba]=[];var ja=ia[ba].length,ka=new x(aa,ia[ba],ja);ia[ba].push(ka);return ka;},stop:function(y){return q(y).stop();},prevent:function(y){return q(y).prevent();},kill:function(y){return q(y).kill();},getKeyCode:function(event){event=q(event);if(!event)return false;switch(event.keyCode){case 63232:return 38;case 63233:return 40;case 63234:return 37;case 63235:return 39;case 63272:case 63273:case 63275:return null;case 63276:return 33;case 63277:return 34;}if(event.shiftKey)switch(event.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:return null;}return event.keyCode;},getPriorities:function(){if(!r){var y=i.getValues(Event.Priority);y.sort(function(z,aa){return z-aa;});r=y;}return r;},fire:function(y,z,aa){var ba=new p(y,z,aa),ca;do{var da=Event.__getHandler(y,z);if(da)ca=da(ba);y=y.parentNode;}while(y&&ca!==false&&!ba.cancelBubble);return ca!==false;},__fire:function(y,z,event){var aa=Event.__getHandler(y,z);if(aa)return aa(q(event));},__getHandler:function(y,z){return g.get(y,Event.DATASTORE_KEY+z);},getPosition:function(y){y=q(y);var z=h.getDocumentScrollElement(),aa=y.clientX+z.scrollLeft,ba=y.clientY+z.scrollTop;return {x:aa,y:ba};}});var r=null,s=Event.DATASTORE_KEY,t=function(y){return function(z){if(!h.contains(this,z.getRelatedTarget()))return y.call(this,z);};},u={mouseenter:{base:'mouseover',wrap:t},mouseleave:{base:'mouseout',wrap:t}},v=function(y,z){var aa='on'+z,ba=w.bind(y),ca=g.get(y,s);if(z in ca)return;ca[z]={};if(y.addEventListener){y.addEventListener(z,ba,false);}else if(y.attachEvent)y.attachEvent(aa,ba);g.set(y,s+z,ba);if(y[aa]){var da=y===document.documentElement?Event.Priority._BUBBLE:Event.Priority.TRADITIONAL,ea=y[aa];y[aa]=null;Event.listen(y,z,ea,da);}if(y.nodeName==='FORM'&&z==='submit')Event.listen(y,z,Event.__bubbleSubmit.curry(y),Event.Priority._BUBBLE);},w=function(event){event=q(event);var y=event.type;if(!g.get(this,s))throw new Error("Bad listenHandler context.");var z=g.get(this,s)[y];if(!z)throw new Error("No registered handlers for `"+y+"'.");if(y=='click'){var aa=j.byTag(event.getTarget(),'a'),ba=o('click',aa,event).set_namespace('evt_ext');if(window.ArbiterMonitor)ArbiterMonitor.initUA(ba,[aa]);}var ca=Event.getPriorities();for(var da=0;da<ca.length;da++){var ea=ca[da];if(ea in z){var fa=z[ea];for(var ga=0;ga<fa.length;ga++){if(!fa[ga])continue;var ha=fa[ga].fire(this,event);if(ha===false){return event.kill();}else if(event.cancelBubble)event.stop();}}}return event.returnValue;};Event.Priority={URGENT:-20,TRADITIONAL:-10,NORMAL:0,_BUBBLE:1000};function x(y,z,aa){this._handler=y;this._container=z;this._index=aa;}n(x.prototype,{remove:function(){delete this._handler;delete this._container[this._index];},fire:function(y,event){return k.applyWithGuard(this._handler,y,[event],function(z){z.event_type=event.type;z.dom_element=y.name||y.id;z.category='eventhandler';});}});a.$E=f.$E=q;});
__d("css",["DOMQuery","css-core","copyProperties"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('css-core'),i=b('copyProperties');i(h,{shown:function(j){return !h.hasClass(j,'hidden_elem');},toggle:function(j){h.conditionShow(j,!h.shown(j));},setClass:function(j,k){$(j).className=k||'';return j;},setStyle:function(j,k,l){switch(k){case 'opacity':j.style.opacity=l;j.style.filter=l!==''?'alpha(opacity='+l*100+')':'';break;case 'float':j.style.cssFloat=j.style.styleFloat=l;break;default:k=k.replace(/-(.)/g,function(m,n){return n.toUpperCase();});j.style[k]=l;}return j;},getStyle:function(j,k){j=$(j);k=k.replace(/-(.)/g,function(n,o){return o.toUpperCase();});function l(n){return n.replace(/([A-Z])/g,'-$1').toLowerCase();}if(window.getComputedStyle){var m=window.getComputedStyle(j,null);if(m)return m.getPropertyValue(l(k));}if(document.defaultView&&document.defaultView.getComputedStyle){var m=document.defaultView.getComputedStyle(j,null);if(m)return m.getPropertyValue(l(k));if(k=="display")return "none";}if(j.currentStyle)return j.currentStyle[k];return j.style&&j.style[k];},getStyleFloat:function(j,k){return parseFloat(h.getStyle(j,k),10);},getOpacity:function(j){j=$(j);var k=h.getStyle(j,'filter'),l=null;if(k&&(l=/(\d+(?:\.\d+)?)/.exec(k))){return parseFloat(l.pop())/100;}else if(k=h.getStyle(j,'opacity')){return parseFloat(k);}else return 1;},isFixed:function(j){while(j&&j!==document.documentElement){if(h.getStyle(j,'position')==='fixed')return true;j=j.parentNode;}return false;},getScrollParent:(function(){function j(k,l){var m=h.getStyle(k,l);return (m==='auto'||m==='scroll');}return function(k){if(!k)return null;while(k!==document.body){if(j(k,'overflow')||j(k,'overflowY')||j(k,'overflowX'))return k;k=k.parentNode;}return window;};})()});e.exports=h;},3);
__d("string-extensions",[],function(a,b,c,d,e,f){String.prototype.trim=function(){if(this==window)return null;return this.replace(/^\s*|\s*$/g,'');};f.trim=a.trim=function(g){try{return String(g.toString()).trim();}catch(h){return '';}};String.prototype.startsWith=function(g){if(this==window)return null;return this.substring(0,g.length)==g;};String.prototype.endsWith=function(g){if(this==window)return null;return this.length>=g.length&&this.substring(this.length-g.length)==g;};String.prototype.split=(function(g){return function(h,i){var j="";if(h===null||i===null){return [];}else if(typeof h=='string'){return g.call(this,h,i);}else if(h===undefined){return [this.toString()];}else if(h instanceof RegExp){if(!h._2||!h._1){j=h.toString().replace(/^[\S\s]+\//,"");if(!h._1)if(!h.global){h._1=new RegExp(h.source,"g"+j);}else h._1=1;}separator1=h._1===1?h:h._1;var k=(h._2?h._2:h._2=new RegExp("^"+separator1.source+"$",j));if(i===undefined||i<0){i=false;}else{i=Math.floor(i);if(!i)return [];}var l,m=[],n=0,o=0;while((i?o++<=i:true)&&(l=separator1.exec(this))){if((l[0].length===0)&&(separator1.lastIndex>l.index))separator1.lastIndex--;if(separator1.lastIndex>n){if(l.length>1)l[0].replace(k,function(){for(var p=1;p<arguments.length-2;p++)if(arguments[p]===undefined)l[p]=undefined;});m=m.concat(this.substring(n,l.index),(l.index===this.length?[]:l.slice(1)));n=separator1.lastIndex;}if(l[0].length===0)separator1.lastIndex++;}return (n===this.length)?(separator1.test("")?m:m.concat("")):(i?m:m.concat(this.substring(n)));}else return g.call(this,h,i);};})(String.prototype.split);},3);
__d("evalGlobal",[],function(a,b,c,d,e,f){function g(h){if(typeof h!='string')throw new TypeError('JS sent to evalGlobal is not a string. Only strings are permitted.');if(!h)return;var i=document.createElement('script');try{i.appendChild(document.createTextNode(h));}catch(j){i.text=h;}var k=document.getElementsByTagName('head')[0]||document.documentElement;k.appendChild(i);k.removeChild(i);}e.exports=g;});
__d("HTML",["function-extensions","string-extensions","ArrayUtils","ua","copyProperties","evalGlobal"],function(a,b,c,d,e,f){b("function-extensions");b("string-extensions");var g=b("ArrayUtils"),h=b("ua"),i=b("copyProperties"),j=b("evalGlobal");function k(l){if(l&&l.__html)l=l.__html;if(!(this instanceof k)){if(l instanceof k)return l;return new k(l);}this._content=l;this._defer=false;this._extra_action='';this._nodes=null;this._inline_js=bagofholding;this._ie_clone_bug=false;return this;}k.isHTML=function(l){return l&&(l instanceof k||l.__html!==undefined);};k.replaceJSONWrapper=function(l){return l&&l.__html!==undefined?new k(l.__html):l;};i(k.prototype,{toString:function(){var l=this._content||'';if(this._extra_action)l+='<script type="text/javascript">'+this._extra_action+'</scr'+'ipt>';return l;},setAction:function(l){this._extra_action=l;return this;},getAction:function(){this._fillCache();var l=function(){this._inline_js();j(this._extra_action);}.bind(this);if(this.getDeferred()){return l.defer.bind(l);}else return l;},setDeferred:function(l){this._defer=!!l;return this;},getDeferred:function(){return this._defer;},getContent:function(){return this._content;},getNodes:function(){this._fillCache();return this._nodes;},getRootNode:function(){return this.getNodes()[0];},ieCloneBug:function(){this._fillCache();return this._ie_clone_bug;},_fillCache:function(){if(null!==this._nodes)return;var l=this._content;if(!l){this._nodes=[];return;}l=l.replace(/(<(\w+)[^>]*?)\/>/g,function(w,x,y){return y.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?w:x+'></'+y+'>';});var m=l.trim().toLowerCase(),n=document.createElement('div'),o=false,p=(!m.indexOf('<opt')&&[1,'<select multiple="multiple" class="__WRAPPER">','</select>'])||(!m.indexOf('<leg')&&[1,'<fieldset class="__WRAPPER">','</fieldset>'])||(m.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,'<table class="__WRAPPER">','</table>'])||(!m.indexOf('<tr')&&[2,'<table><tbody class="__WRAPPER">','</tbody></table>'])||((!m.indexOf('<td')||!m.indexOf('<th'))&&[3,'<table><tbody><tr class="__WRAPPER">','</tr></tbody></table>'])||(!m.indexOf('<col')&&[2,'<table><tbody></tbody><colgroup class="__WRAPPER">','</colgroup></table>'])||null;if(null===p){n.className='__WRAPPER';if(h.ie()){p=[0,'<span style="display:none">&nbsp;</span>',''];o=true;}else p=[0,'',''];}n.innerHTML=p[1]+l+p[2];while(p[0]--)n=n.lastChild;if(o)n.removeChild(n.firstChild);n.className!='__WRAPPER';if(0!==n.getElementsByTagName('option').length||0!==n.getElementsByTagName('object').length)this._ie_clone_bug=true;if(h.ie()){var q;if(!m.indexOf('<table')&&-1==m.indexOf('<tbody')){q=n.firstChild&&n.firstChild.childNodes;}else if(p[1]=='<table>'&&-1==m.indexOf('<tbody')){q=n.childNodes;}else q=[];for(var r=q.length-1;r>=0;--r)if(q[r].nodeName&&q[r].nodeName.toLowerCase()=='tbody'&&q[r].childNodes.length==0)q[r].parentNode.removeChild(q[r]);}var s=n.getElementsByTagName('script'),t=[];for(var u=0;u<s.length;u++)if(s[u].src){t.push(Bootloader.requestResource.bind(Bootloader,'js',s[u].src));}else t.push(j.bind(null,s[u].innerHTML));for(var u=s.length-1;u>=0;u--)s[u].parentNode.removeChild(s[u]);var v=function(){for(var w=0;w<t.length;w++)t[w]();};this._nodes=g.createFrom(n.childNodes);this._inline_js=v;}});e.exports=k;});
__d("DOM",["array-extensions","event-extensions","ArrayUtils","css-core","DOMQuery","HTML","ObjectUtils","$","copyProperties","tx","ua"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("ArrayUtils"),h=b("css-core"),i=b("DOMQuery"),j=b("HTML"),k=b("ObjectUtils"),l=b("$"),m=b("copyProperties"),n=b("tx"),o=b("ua"),p='js_',q=0,r={};m(r,i);m(r,{create:function(v,w,x){var y=document.createElement(v);if(w)r.setAttributes(y,w);if(x!=null)r.setContent(y,x);return y;},setAttributes:function(v,w){if(w.type)v.type=w.type;for(var x in w){var y=w[x],z=(/^on/i).test(x);if(x=='type'){continue;}else if(x=='style'){if(typeof y=='string'){v.style.cssText=y;}else m(v.style,y);}else if(z){Event.listen(v,x.substr(2),y);}else if(x in v){v[x]=y;}else if(v.setAttribute)v.setAttribute(x,y);}},prependContent:function(v,w){return s(w,v,function(x){v.firstChild?v.insertBefore(x,v.firstChild):v.appendChild(x);});},insertAfter:function(v,w){var x=v.parentNode;return s(w,x,function(y){v.nextSibling?x.insertBefore(y,v.nextSibling):x.appendChild(y);});},insertBefore:function(v,w){var x=v.parentNode;return s(w,x,function(y){x.insertBefore(y,v);});},setContent:function(v,w){r.empty(v);return r.appendContent(v,w);},appendContent:function(v,w){return s(w,v,function(x){v.appendChild(x);});},replace:function(v,w){var x=v.parentNode;return s(w,x,function(y){x.replaceChild(y,v);});},remove:function(v){v=l(v);if(v.parentNode)v.parentNode.removeChild(v);},empty:function(v){v=l(v);while(v.firstChild)r.remove(v.firstChild);},getID:function(v){var w=v.id;if(!w){w=p+q++;v.id=w;}return w;}});function s(v,w,x){v=j.replaceJSONWrapper(v);if(v instanceof j&&''===w.innerHTML&&-1===v.toString().indexOf('<scr'+'ipt')){var y=o.ie();if(!y||(y>7&&!i.isNodeOfType(w,['table','tbody','thead','tfoot','tr','select','fieldset']))){var z=y?'<em style="display:none;">&nbsp;</em>':'';w.innerHTML=z+v;y&&w.removeChild(w.firstChild);return g.createFrom(w.childNodes);}}else if(i.isTextNode(w)){w.data=v;return [v];}var aa=document.createDocumentFragment(),ba,ca=[],da=[];if(!Array.isArray(v))v=[v];for(var ea=0;ea<v.length;ea++){ba=j.replaceJSONWrapper(v[ea]);if(ba instanceof j){da.push(ba.getAction());var fa=ba.getNodes();for(var ga=0;ga<fa.length;ga++){var ha=o.safari()||(o.ie()&&ba.ieCloneBug()),ia=ha?fa[ga]:fa[ga].cloneNode(true);ca.push(ia);aa.appendChild(ia);}}else if(k.isScalar(ba)){var ja=document.createTextNode(ba);ca.push(ja);aa.appendChild(ja);}else if(i.isNode(ba)){ca.push(ba);aa.appendChild(ba);}}x(aa);da.each(function(ka){ka();});return ca;}function t(v){function w(x){return r.create('div',{},x).innerHTML;}return function(x,y){var z={};if(y)for(var aa in y)z[aa]=w(y[aa]);return j(v(x,z));};}r.tx=t(n);r.tx._=r._tx=t(n._);function u(v,w,x){if(typeof w!='object'||i.isNode(w)||Array.isArray(w)||j.isHTML(w)){x=w;w=null;}return r.create(v,w,x);}r.insertBeforeTemp=r.insertBefore;r.$N=u;e.exports=r;});
__d("AsyncDOM",["css","DOM"],function(a,b,c,d,e,f){var g=b("css"),h=b("DOM"),i={invoke:function(j,k){for(var l=0;l<j.length;++l){var m=j[l],n=m[0],o=m[1],p=m[2],q=m[3],r=(p&&k)||null;if(o)r=h.scry(r||document.documentElement,o)[0];switch(n){case 'eval':(new Function(q)).apply(r);break;case 'hide':g.hide(r);break;case 'show':g.show(r);break;case 'setContent':h.setContent(r,q);break;case 'appendContent':h.appendContent(r,q);break;case 'prependContent':h.prependContent(r,q);break;case 'insertAfter':h.insertAfter(r,q);break;case 'insertBefore':h.insertBeforeTemp(r,q);break;case 'remove':h.remove(r);break;case 'replace':h.replace(r,q);break;default:}}}};e.exports=i;});
__d("AsyncResponse",["Bootloader","Env","copyProperties","tx"],function(a,b,c,d,e,f){var g=b("Bootloader"),h=b("Env"),i=b("copyProperties"),j=b("tx");function k(l,m){i(this,{error:0,errorSummary:null,errorDescription:null,onload:null,replay:false,payload:m||null,request:l||null,silentError:false,is_last:true});return this;}i(k,{defaultErrorHandler:function(l){try{if(!l.silentError){k.verboseErrorHandler(l);}else l.logErrorByGroup('silent',10);}catch(m){alert(l);}},verboseErrorHandler:function(l){try{var n=l.getErrorSummary(),o=l.getErrorDescription();l.logErrorByGroup('popup',10);if(l.silentError&&o=='')o="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";g.loadModules(["Dialog"],function(p){new p().setTitle(n).setBody(o).setButtons([p.OK]).setModal(true).setCausalElement(this.relativeTo).show();});}catch(m){alert(l);}}});i(k.prototype,{getRequest:function(){return this.request;},getPayload:function(){return this.payload;},getError:function(){return this.error;},getErrorSummary:function(){return this.errorSummary;},setErrorSummary:function(l){l=(l===undefined?null:l);this.errorSummary=l;return this;},getErrorDescription:function(){return this.errorDescription;},getErrorIsWarning:function(){return this.errorIsWarning;},logError:function(l,m){if(window.send_error_signal){var n={err_code:this.error,vip:(h.vip||'-')};if(m){n.duration=m.duration;n.xfb_ip=m.xfb_ip;}var o=this.request.getURI();n.path=o||'-';n.aid=this.request.userActionID;if(o&&o.indexOf('scribe_endpoint.php')!=-1)l='async_error_double';send_error_signal(l,JSON.stringify(n));}},logErrorByGroup:function(l,m){if(Math.floor(Math.random()*m)==0)if(this.error==1357010||this.error<15000){this.logError('async_error_oops_'+l);}else this.logError('async_error_logic_'+l);}});e.exports=k;});
__d("Cookie",["Env"],function(a,b,c,d,e,f){var g=b("Env"),h={set:function(i,j,k,l,m){if(g.no_cookies&&i!='tpa')return;document.cookie=i+"="+encodeURIComponent(j)+"; "+(k?"expires="+(new Date(Date.now()+k)).toGMTString()+"; ":"")+"path="+(l||'/')+"; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1')+(m?"; secure":"");},clear:function(i){document.cookie=i+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; "+"path=/; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1');},get:function(i){var j=document.cookie.match('(?:^|;\\s*)'+i+'=(.*?)(?:;|$)');return (j?decodeURIComponent(j[1]):j);}};e.exports=h;});
__d("URI",["copyProperties","goURI"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("goURI");function i(j){if(!(this instanceof i))return new i(j||window.location.href);this.parse(j||'');}g(i,{getRequestURI:function(j,k){j=j===undefined||j;if(j&&window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getCurrentURI(!!k).getQualifiedURI();}else return new i(window.location.href);},getMostRecentURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getMostRecentURI().getQualifiedURI();}else return new i(window.location.href);},getNextURI:function(){if(window.PageTransitions&&PageTransitions.isInitialized()){return PageTransitions.getNextURI().getQualifiedURI();}else return new i(window.location.href);},expression:/(((\w+):\/\/)([^\/:]*)(:(\d+))?)?([^#?]*)(\?([^#]*))?(#(.*))?/,arrayQueryExpression:/^(\w+)((?:\[\w*\])+)=?(.*)/,explodeQuery:function(j){if(!j)return {};var k={};j=j.replace(/%5B/ig,'[').replace(/%5D/ig,']');j=j.split('&');for(var l=0,m=j.length;l<m;l++){var n=j[l].match(i.arrayQueryExpression);if(!n){var o=j[l].split('=');k[i.decodeComponent(o[0])]=o[1]===undefined?null:i.decodeComponent(o[1]);}else{var p=n[2].split(/\]\[|\[|\]/).slice(0,-1),q=n[1],r=i.decodeComponent(n[3]||'');p[0]=q;var s=k;for(var t=0;t<p.length-1;t++)if(p[t]){if(s[p[t]]===undefined)if(p[t+1]&&!p[t+1].match(/^\d+$/)){s[p[t]]={};}else s[p[t]]=[];s=s[p[t]];}else{if(p[t+1]&&!p[t+1].match(/^\d+$/)){s.push({});}else s.push([]);s=s[s.length-1];}if(s instanceof Array&&p[p.length-1]===''){s.push(r);}else s[p[p.length-1]]=r;}}return k;},implodeQuery:function(j,k,l){k=k||'';if(l===undefined)l=true;var m=[];if(j===null||j===undefined){m.push(l?i.encodeComponent(k):k);}else if(j instanceof Array){for(var n=0;n<j.length;++n)try{if(j[n]!==undefined)m.push(i.implodeQuery(j[n],k?(k+'['+n+']'):n));}catch(o){}}else if(typeof(j)=='object'){if(('nodeName' in j)&&('nodeType' in j)){m.push('{node}');}else for(var p in j)try{if(j[p]!==undefined)m.push(i.implodeQuery(j[p],k?(k+'['+p+']'):p));}catch(o){}}else if(l){m.push(i.encodeComponent(k)+'='+i.encodeComponent(j));}else m.push(k+'='+j);return m.join('&');},encodeComponent:function(j){return encodeURIComponent(j).replace(/%5D/g,"]").replace(/%5B/g,"[");},decodeComponent:function(j){return decodeURIComponent(j.replace(/\+/g,' '));},INVALID_DOMAIN:'invalid.invalid',sanitizeDomain:function(j){var k=new RegExp('[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f'+'\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF'+'\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]');if(k.test(j)){return i.INVALID_DOMAIN;}else return j;}});g(i.prototype,{parse:function(j){var k=j.toString().match(i.expression);g(this,{protocol:k[3]||'',domain:i.sanitizeDomain(k[4]||''),port:k[6]||'',path:k[7]||'',query_s:k[9]||'',fragment:k[11]||''});return this;},setProtocol:function(j){this.protocol=j;return this;},getProtocol:function(){return this.protocol;},setQueryData:function(j){this.query_s=i.implodeQuery(j);return this;},addQueryData:function(j){return this.setQueryData(g(this.getQueryData(),j));},removeQueryData:function(j){if(!(j instanceof Array))j=[j];var k=this.getQueryData();for(var l=0,m=j.length;l<m;++l)delete k[j[l]];return this.setQueryData(k);},getQueryData:function(){return i.explodeQuery(this.query_s);},setFragment:function(j){this.fragment=j;return this;},getFragment:function(){return this.fragment;},setDomain:function(j){this.domain=i.sanitizeDomain(j);return this;},getDomain:function(){return this.domain;},setPort:function(j){this.port=j;return this;},getPort:function(){return this.port;},setPath:function(j){this.path=j;return this;},getPath:function(){return this.path.replace(/^\/+/,'/');},isEmpty:function(){return !(this.path||this.protocol||this.domain||this.port||this.query_s||this.fragment);},toString:function(){var j='';this.protocol&&(j+=this.protocol+'://');this.domain&&(j+=this.domain);this.port&&(j+=':'+this.port);if(this.domain&&!this.path)j+='/';this.path&&(j+=this.path);this.query_s&&(j+='?'+this.query_s);this.fragment&&(j+='#'+this.fragment);return j;},valueOf:function(){return this.toString();},isFacebookURI:function(){if(!i._facebookURIRegex)i._facebookURIRegex=new RegExp('(^|\\.)facebook\\.com([^.]*)$','i');return (!this.domain||i._facebookURIRegex.test(this.domain));},isQuicklingEnabled:function(){return window.Quickling&&Quickling.isActive()&&Quickling.isPageActive(this);},getRegisteredDomain:function(){if(!this.domain)return '';if(!this.isFacebookURI())return null;var j=this.domain.split('.'),k=j.indexOf('facebook');return j.slice(k).join('.');},getUnqualifiedURI:function(){return new i(this).setProtocol(null).setDomain(null).setPort(null);},getQualifiedURI:function(){var j=new i(this);if(!j.getDomain()){var k=i();j.setProtocol(k.getProtocol()).setDomain(k.getDomain()).setPort(k.getPort());}return j;},isSameOrigin:function(j){var k=j||window.location.href;if(!(k instanceof i))k=new i(k.toString());if(this.getProtocol()&&this.getProtocol()!=k.getProtocol())return false;if(this.getDomain()&&this.getDomain()!=k.getDomain())return false;return true;},go:function(j){h(this,j);},setSubdomain:function(j){var k=new i(this).getQualifiedURI(),l=k.getDomain().split('.');if(l.length<=2){l.unshift(j);}else l[0]=j;return k.setDomain(l.join('.'));},getSubdomain:function(){if(!this.getDomain())return '';var j=this.getDomain().split('.');if(j.length<=2){return '';}else return j[0];},setSecure:function(j){return this.setProtocol(j?'https':'http');},isSecure:function(){return this.getProtocol()=='https';}});e.exports=i;});
__d("AsyncRequest",["array-extensions","event-extensions","json","Arbiter","AsyncDOM","AsyncResponse","Bootloader","Cookie","css-core","Env","JSCC","Parent","Run","ServerJS","URI","Util","bind","copyProperties","evalGlobal","ge","goURI","invokeCallbacks","isEmpty","tx","ua"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");b("json");var g=b("Arbiter"),h=b("AsyncDOM"),i=b("AsyncResponse"),j=b("Bootloader"),k=b("Cookie"),l=b("css-core"),m=b("Env"),n=b("JSCC"),o=b("Parent"),p=b("Run"),q=b("ServerJS"),r=b("URI"),s=b("Util"),t=b("bind"),u=b("copyProperties"),v=b("evalGlobal"),w=b("ge"),x=b("goURI"),y=b("invokeCallbacks"),z=b("isEmpty"),aa=b("tx"),ba=b("ua");function ca(){try{return !window.loaded;}catch(ia){return true;}}function da(ia){return ia.status in {0:1,12029:1,12030:1,12031:1,12152:1};}var ea=2,fa=ea;g.subscribe('page_transition',function(ia,ja){fa=ja.id;});function ga(ia){u(this,{transport:null,method:'POST',uri:'',timeout:null,timer:null,initialHandler:bagofholding,handler:null,errorHandler:null,transportErrorHandler:null,timeoutHandler:null,finallyHandler:bagofholding,serverDialogCancelHandler:null,relativeTo:null,statusElement:null,statusClass:'',data:{},file:null,context:{},readOnly:false,writeRequiredParams:[],remainingRetries:0,userActionID:'-'});this.option={asynchronous:true,suppressErrorHandlerWarning:false,suppressEvaluation:false,suppressErrorAlerts:false,retries:0,jsonp:false,bundle:false,useIframeTransport:false,tfbEndpoint:true,handleErrorAfterUnload:false};this.errorHandler=i.defaultErrorHandler;this.transportErrorHandler=t(this,'errorHandler');if(ia!==undefined)this.setURI(ia);}u(ga,{bootstrap:function(ia,ja,ka){var la='GET',ma=true,na={};if(ka||ja&&(ja.rel=='async-post'||ja.getAttribute&&ja.getAttribute('forcemethod')=='post')){la='POST';ma=false;if(ia){ia=r(ia);na=ia.getQueryData();ia.setQueryData({});}}var oa=o.byClass(ja,'stat_elem')||ja;if(oa&&l.hasClass(oa,'async_saving'))return false;var pa=new ga(ia).setReadOnly(ma).setMethod(la).setData(na).setNectarModuleDataSafe(ja).setRelativeTo(ja).setHandler(function(ra){Event.fire(ja,'success',{response:ra});}).setErrorHandler(function(ra){if(Event.fire(ja,'error',{response:ra})!==false)i.defaultErrorHandler(ra);});if(oa){pa.setStatusElement(oa);var qa=oa.getAttribute('data-status-class');qa&&pa.setStatusClass(qa);}Event.fire(ja,'AsyncRequest/send',{request:pa});pa.send();return false;},post:function(ia,ja){new ga(ia).setReadOnly(false).setMethod('POST').setData(ja).send();return false;},getLastID:function(){return ea;},suppressOnloadToken:{},_inflight:[],_inflightAdd:bagofholding,_inflightPurge:bagofholding,_inflightEnable:function(){if(ba.ie()){u(ga,{_inflightAdd:function(ia){this._inflight.push(ia);},_inflightPurge:function(){ga._inflight=ga._inflight.filter(function(ia){return ia.transport&&ia.transport.readyState<4;});}});p.onUnload(function(){ga._inflight.each(function(ia){if(ia.transport&&ia.transport.readyState<4){ia.transport.abort();delete ia.transport;}});});}}});u(ga.prototype,{_dispatchResponse:function(ia){try{this.clearStatusIndicator();if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}if(this.initialHandler(ia)===false)return;clearTimeout(this.timer);if(ia.jscc_map){var ka=(eval)(ia.jscc_map);n.init(ka);}var la;if(this.handler)try{la=this._shouldSuppressJS(this.handler(ia));}catch(ma){ia.is_last&&this.finallyHandler(ia);throw ma;}if(!la)this._handleJSResponse(ia);ia.is_last&&this.finallyHandler(ia);}catch(ja){}},_shouldSuppressJS:function(ia){return ia===ga.suppressOnloadToken;},_handleJSResponse:function(ia){var ja=this.getRelativeTo(),ka=ia.domops;if(ka)h.invoke(ka,ja);if(ia.jsmods)new q().setRelativeTo(ja).handle(ia.jsmods);ia.jscalls&&y([ia.jscalls]);this._handleJSRegisters(ia,'onload');if(this.lid)g.inform('tti_ajax',{s:this.lid,d:[this._sendTimeStamp||0,(this._sendTimeStamp&&this._responseTime)?(this._responseTime-this._sendTimeStamp):0]},g.BEHAVIOR_EVENT);this._handleJSRegisters(ia,'onafterload');},_handleJSRegisters:function(ia,ja){var ka=ia[ja];if(!ka)return;for(var la=0;la<ka.length;la++)try{(new Function(ka[la])).apply(this);}catch(ma){}},invokeResponseHandler:function(ia){if(typeof(ia.redirect)!=='undefined'){(function(){this.setURI(ia.redirect).send();}).bind(this).defer();return;}if(!this.handler&&!this.errorHandler&&!this.transportErrorHandler)return;if(typeof(ia.asyncResponse)!=='undefined'){if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}var ja=ia.asyncResponse;if(ja.inlinejs)v(ja.inlinejs);if(ja.lid){this._responseTime=Date.now();if(a.CavalryLogger)this.cavalry=a.CavalryLogger.getInstance(ja.lid);this.lid=ja.lid;}j.setResourceMap(ja.resource_map);if(ja.bootloadable)j.enableBootload(ja.bootloadable);var ka;if(ja.getError()&&!ja.getErrorIsWarning()){var la=this.errorHandler.bind(this);ka=this._dispatchErrorResponse.bind(this,ja,la);}else ka=this._dispatchResponse.bind(this,ja);ka=ka.defer.bind(ka);var ma=false;if(this.preBootloadHandler)ma=this.preBootloadHandler(ja);ja.css=ja.css||[];ja.js=ja.js||[];j.loadResources(ja.css.concat(ja.js),ka,ma,this.getURI());}else if(typeof(ia.transportError)!=='undefined'){if(this._xFbServer){this._invokeErrorHandler(1008);}else this._invokeErrorHandler(1012);}else this._invokeErrorHandler(1007);},_invokeErrorHandler:function(ia){if(ca()&&!this.getOption('handleErrorAfterUnload'))return;var ja;if(this.responseText===''){ja=1002;}else if(this._requestAborted){ja=1011;}else{try{ja=ia||this.transport.status||1004;}catch(ka){ja=1005;}if(false===navigator.onLine)ja=1006;}if(!this.transportErrorHandler)return;var la=this.transportErrorHandler.bind(this),ma,na,oa=true;if(ja===1006){na="No Network Connection";ma="Your browser appears to be offline. Please check your internet connection and try again.";}else if(ja>=300&&ja<=399){na="Redirection";ma="Your access to Facebook was redirected or blocked by a third party at this time, please contact your ISP or reload. ";var pa=this.transport.getResponseHeader("Location");if(pa)x(pa,true);oa=true;}else{na="Oops!";ma="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";}!this.getOption('suppressErrorAlerts');var qa=new i(this);u(qa,{error:ja,errorSummary:na,errorDescription:ma,silentError:oa});this._dispatchErrorResponse(qa,la);},_dispatchErrorResponse:function(ia,ja){var ka=ia.getError();try{this.clearStatusIndicator();var ma=this._sendTimeStamp&&{duration:Date.now()-this._sendTimeStamp,xfb_ip:this._xFbServer||'-'};ia.logError('async_error',ma);if(!this._isRelevant()||ka===1010)return;if(ka==1357008||ka==1357007||ka==1442002||ka==1357001){var na=ia.getPayload(),oa=ka==1357008||ka==1357007;this._displayServerDialog(na.__dialog,oa);}else if(this.initialHandler(ia)!==false){clearTimeout(this.timer);try{ja(ia);}catch(pa){this.finallyHandler(ia);throw pa;}this.finallyHandler(ia);}}catch(la){}},_displayServerDialog:function(ia,ja){j.loadModules(["Dialog"],function(ka){var la=new ka(ia);if(ja)la.setHandler(this._displayConfirmationHandler.bind(this,la));la.setCancelHandler(function(){var ma=this.getServerDialogCancelHandler();if(ma)ma.apply(this,arguments);this.finallyHandler.apply(this,arguments);}.bind(this)).setCausalElement(this.relativeTo).setCloseHandler(this.finallyHandler.bind(this)).show();}.bind(this));},_displayConfirmationHandler:function(ia){this.data.confirmed=1;u(this.data,ia.getFormData());this.send();},_handleJSONPResponse:function(ia){this.is_first=(this.is_first===undefined);var ja=this._interpretResponse(ia);ja.asyncResponse.is_first=this.is_first;ja.asyncResponse.is_last=this.transport.hasFinished();this.invokeResponseHandler(ja);if(this.transport.hasFinished())delete this.transport;},_handleXHRResponse:function(ia){var ja;if(this.getOption('suppressEvaluation')){ja={asyncResponse:new i(this,ia)};}else{var ka=ia.responseText,la=null;try{var na=this._unshieldResponseText(ka);try{var oa=(eval)('('+na+')');ja=this._interpretResponse(oa);}catch(ma){la='excep';ja={transportError:'eval() failed on async to '+this.getURI()};}}catch(ma){la='empty';ja={transportError:ma.message};}if(la)a.send_error_signal&&a.send_error_signal('async_xport_resp',[(this._xFbServer?'1008_':'1012_')+la,this._xFbServer||'-',this.getURI(),ka.length,ka.substr(0,1600)].join(':'));}this.invokeResponseHandler(ja);},_unshieldResponseText:function(ia){var ja="for (;;);",ka=ja.length;if(ia.length<=ka)throw new Error('Response too short on async to '+this.getURI());var la=0;while(ia.charAt(la)==" "||ia.charAt(la)=="\n")la++;la&&ia.substring(la,la+ka)==ja;return ia.substring(la+ka);},_interpretResponse:function(ia){if(ia.redirect)return {redirect:ia.redirect};var ja=new i(this);if(ia.__ar!=1){ja.payload=ia;}else u(ja,ia);return {asyncResponse:ja};},_onStateChange:function(){try{if(this.transport.readyState==4){ga._inflightPurge();try{if(typeof(this.transport.getResponseHeader)!=='undefined'&&this.transport.getResponseHeader('X-FB-Debug'))this._xFbServer=this.transport.getResponseHeader('X-FB-Debug');}catch(ja){}if(this.transport.status>=200&&this.transport.status<300){ga.lastSuccessTime=Date.now();this._handleXHRResponse(this.transport);}else if(ba.safari()&&(typeof(this.transport.status)=='undefined')){this._invokeErrorHandler(1002);}else if(m.retry_ajax_on_network_error&&da(this.transport)&&this.remainingRetries>0){this.remainingRetries--;delete this.transport;this.send(true);return;}else this._invokeErrorHandler();if(this.getOption('asynchronous')!==false)delete this.transport;}}catch(ia){if(ca())return;delete this.transport;if(this.remainingRetries>0){this.remainingRetries--;this.send(true);}else{!this.getOption('suppressErrorAlerts');a.send_error_signal&&a.send_error_signal('async_xport_resp',[1007,this._xFbServer||'-',this.getURI(),ia.message].join(':'));this._invokeErrorHandler(1007);}}},_isMultiplexable:function(){if(this.getOption('jsonp')||this.getOption('useIframeTransport'))return false;if(!this.uri.isFacebookURI())return false;if(!this.getOption('asynchronous'))return false;return true;},handleResponse:function(ia){var ja=this._interpretResponse(ia);this.invokeResponseHandler(ja);},setMethod:function(ia){this.method=ia.toString().toUpperCase();return this;},getMethod:function(){return this.method;},setData:function(ia){this.data=ia;return this;},_setDataHash:function(){if(this.method!='POST'||!this.getOption('tfbEndpoint')||this.data.phstamp)return;var ia=r.implodeQuery(this.data).length,ja='';for(var ka=0;ka<this.data.fb_dtsg.length;ka++)ja+=this.data.fb_dtsg.charCodeAt(ka);this.data.phstamp='1'+ja+ia;},setFile:function(ia){this.file=ia;return this;},getData:function(){return this.data;},setContextData:function(ia,ja,ka){ka=ka===undefined?true:ka;if(ka)this.context['_log_'+ia]=ja;return this;},_setUserActionID:function(){var ia=a.ArbiterMonitor&&a.ArbiterMonitor.getUE()||'-';this.userActionID=(a.EagleEye&&a.EagleEye.getSessionID()||'-')+'/'+ia;},setURI:function(ia){var ja=r(ia);if(this.getOption('useIframeTransport')&&!ja.isFacebookURI())return this;if(!this.getOption('jsonp')&&!this.getOption('useIframeTransport')&&!ja.isSameOrigin())return this;this._setUserActionID();if(!ia||ja.isEmpty()){if(a.send_error_signal&&a.get_error_stack){var ka={err_code:1013,vip:'-',duration:0,xfb_ip:'-',path:window.location.href,aid:this.userActionID};a.send_error_signal('async_error',JSON.stringify(ka));a.send_error_signal('async_xport_stack',[1013,window.location.href,null,a.get_error_stack()].join(':'));}return this;}this.uri=ja;return this;},getURI:function(){return this.uri.toString();},setInitialHandler:function(ia){this.initialHandler=ia;return this;},setHandler:function(ia){if(!(typeof(ia)!='function'))this.handler=ia;return this;},getHandler:function(){return this.handler;},setErrorHandler:function(ia){if(!(typeof(ia)!='function'))this.errorHandler=ia;return this;},setTransportErrorHandler:function(ia){this.transportErrorHandler=ia;return this;},getErrorHandler:function(){return this.errorHandler;},getTransportErrorHandler:function(){return this.transportErrorHandler;},setTimeoutHandler:function(ia,ja){if(!(typeof(ja)!='function')){this.timeout=ia;this.timeoutHandler=ja;}return this;},resetTimeout:function(ia){if(!(this.timeoutHandler===null))if(ia===null){this.timeout=null;clearTimeout(this.timer);this.timer=null;}else{var ja=!this._allowCrossPageTransition;this.timeout=ia;clearTimeout(this.timer);this.timer=this._handleTimeout.bind(this).defer(this.timeout,ja);}return this;},_handleTimeout:function(){this.abandon();this.timeoutHandler(this);},setNewSerial:function(){this.id=++ea;return this;},setFinallyHandler:function(ia){this.finallyHandler=ia;return this;},getServerDialogCancelHandler:function(){return this.serverDialogCancelHandler;},setServerDialogCancelHandler:function(ia){this.serverDialogCancelHandler=ia;return this;},setPreBootloadHandler:function(ia){this.preBootloadHandler=ia;return this;},setReadOnly:function(ia){if(!(typeof(ia)!='boolean'))this.readOnly=ia;return this;},setFBMLForm:function(){this.writeRequiredParams=["fb_sig"];return this;},getReadOnly:function(){return this.readOnly;},setRelativeTo:function(ia){this.relativeTo=ia;return this;},getRelativeTo:function(){return this.relativeTo;},setStatusClass:function(ia){this.statusClass=ia;return this;},setStatusElement:function(ia){this.statusElement=ia;return this;},getStatusElement:function(){return w(this.statusElement);},_isRelevant:function(){if(this._allowCrossPageTransition)return true;if(!this.id)return true;return this.id>fa;},clearStatusIndicator:function(){var ia=this.getStatusElement();if(ia){l.removeClass(ia,'async_saving');l.removeClass(ia,this.statusClass);}},addStatusIndicator:function(){var ia=this.getStatusElement();if(ia){l.addClass(ia,'async_saving');l.addClass(ia,this.statusClass);}},specifiesWriteRequiredParams:function(){return this.writeRequiredParams.every(function(ia){this.data[ia]=this.data[ia]||m[ia]||(w(ia)||{}).value;if(this.data[ia]!==undefined)return true;return false;},this);},setOption:function(ia,ja){if(typeof(this.option[ia])!='undefined')this.option[ia]=ja;return this;},getOption:function(ia){typeof(this.option[ia])=='undefined';return this.option[ia];},abort:function(){if(this.transport){var ia=this.getTransportErrorHandler();this.setOption('suppressErrorAlerts',true);this.setTransportErrorHandler(bagofholding);this._requestAborted=true;this.transport.abort();this.setTransportErrorHandler(ia);}},abandon:function(){clearTimeout(this.timer);this.setOption('suppressErrorAlerts',true).setHandler(bagofholding).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding);if(this.transport){this._requestAborted=true;this.transport.abort();}},setNectarData:function(ia){if(ia){if(this.data.nctr===undefined)this.data.nctr={};u(this.data.nctr,ia);}return this;},setNectarModuleDataSafe:function(ia){if(this.setNectarModuleData)this.setNectarModuleData(ia);return this;},setNectarImpressionIdSafe:function(){if(this.setNectarImpressionId)this.setNectarImpressionId();return this;},setAllowCrossPageTransition:function(ia){this._allowCrossPageTransition=!!ia;if(this.timer)this.resetTimeout(this.timeout);return this;},send:function(ia){ia=ia||false;if(!this.uri)return false;!this.errorHandler&&!this.getOption('suppressErrorHandlerWarning');if(this.getOption('jsonp')&&this.method!='GET')this.setMethod('GET');if(this.getOption('useIframeTransport')&&this.method!='GET')this.setMethod('GET');this.timeoutHandler!==null&&(this.getOption('jsonp')||this.getOption('useIframeTransport'));if(!this.getReadOnly()){this.specifiesWriteRequiredParams();if(this.method!='POST')return false;}if(this.method=='POST'&&this.getOption('tfbEndpoint')){this.data.fb_dtsg=m.fb_dtsg;this.data.lsd=k.get('lsd');if(!this.data.lsd)delete this.data.lsd;}if(!z(this.context)&&this.getOption('tfbEndpoint')){u(this.data,this.context);this.data.ajax_log=1;}if(m.force_param)u(this.data,m.force_param);this.data.__user=m.user;this._setUserActionID();if(this.getOption('bundle')&&this._isMultiplexable()){ha.schedule(this);return true;}this.setNewSerial();if(this.getOption('tfbEndpoint')){this.uri.addQueryData({__a:1});if(!this.getOption('asynchronous'))this.uri.addQueryData({__s:1});if(m.fb_isb)this.uri.addQueryData({fb_isb:m.fb_isb});}this.finallyHandler=a.async_callback(this.finallyHandler,'final');var ja,ka;if(this.method=='GET'||this.file){ja=this.uri.addQueryData(this.data).toString();ka='';}else{ja=this.uri.toString();this._setDataHash();ka=r.implodeQuery(this.data);}if(this.transport)return false;if(this.getOption('jsonp')||this.getOption('useIframeTransport')){d(["JSONPTransport"],function(pa){this.transport=new pa(this.getOption('jsonp')?'jsonp':'iframe',this.uri,this._handleJSONPResponse.bind(this));this.transport.send();}.bind(this));return true;}var la=null;try{la=new XMLHttpRequest();}catch(ma){}if(!la)try{la=new ActiveXObject("Msxml2.XMLHTTP");}catch(ma){}if(!la)try{la=new ActiveXObject("Microsoft.XMLHTTP");}catch(ma){}if(!la)return false;la.onreadystatechange=a.async_callback(this._onStateChange.bind(this),'xhr');if(!ia)this.remainingRetries=this.getOption('retries');if(a.send_error_signal||a.ArbiterMonitor)this._sendTimeStamp=this._sendTimeStamp||Date.now();this.transport=la;try{this.transport.open(this.method,ja,this.getOption('asynchronous'));}catch(na){return false;}var oa=m.svn_rev;if(oa)this.transport.setRequestHeader('X-SVN-Rev',String(oa));if(this.method=='POST')this.transport.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.addStatusIndicator();ka=this.file||ka;this.transport.send(ka);if(this.timeout!==null)this.resetTimeout(this.timeout);ga._inflightAdd(this);return true;}});function ha(){this._requests=[];}u(ha,{multiplex:null,schedule:function(ia){if(!ha.multiplex){ha.multiplex=new ha();(function(){ha.multiplex.send();ha.multiplex=null;}).defer();}ha.multiplex.add(ia);}});u(ha.prototype,{add:function(ia){this._requests.push(ia);},send:function(){var ia=this._requests;if(!ia.length)return;var ja;if(ia.length===1){ja=ia[0];}else{var ka=ia.map(function(la){return [la.uri.getPath(),r.implodeQuery(la.data)];});ja=new ga('/ajax/proxy.php').setAllowCrossPageTransition(true).setData({data:ka}).setHandler(this._handler.bind(this)).setTransportErrorHandler(this._transportErrorHandler.bind(this));}ja.setOption('bundle',false).send();},_handler:function(ia){var ja=ia.getPayload().responses;if(ja.length!==this._requests.length)return;for(var ka=0;ka<this._requests.length;ka++){var la=this._requests[ka],ma=la.uri.getPath();la.id=this.id;if(ja[ka][0]!==ma){la.invokeResponseHandler({transportError:'Wrong response order in bundled request to '+ma});continue;}la.handleResponse(ja[ka][1]);}},_transportErrorHandler:function(ia){var ja={transportError:ia.errorDescription},ka=this._requests.map(function(la){la.id=this.id;la.invokeResponseHandler(ja);return la.uri.getPath();});}});e.exports=a.AsyncRequest||ga;});
__d("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c,d){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
__d("legacy:data-store",["DataStore"],function(a,b,c,d){a.DataStore=a.DataStore||b('DataStore');},3);
__d("legacy:dom",["DOM"],function(a,b,c,d){var e=b('DOM');a.DOM=e;a.$N=e.$N;},3);
function EmuController(a,b){this.impression=b;this.containerId=a;DataStore.set($(a),'emuController',this);return this;}copy_properties(EmuController,{fromContainer:function(a){var b=ge(a);if(!b)return null;return DataStore.get(b,'emuController');},getEventClass:function(a){return "emuEvent"+String(a).trim();}});copy_properties(EmuController.prototype,{EVENT_HANDLER_PATH:'/ajax/emu/end.php',CLICK:1,FAN:"fad_fan",event:function(a,b,c,d){var e={eid:this.impression,f:0,ui:this.containerId,en:a,a:1};if(b)e.ed=JSON.stringify(b);if(!d)var d=bagofholding;var f=new AsyncRequest().setURI(this.EVENT_HANDLER_PATH).setData(e).setErrorHandler(d);if(c)f.setHandler(c);f.send();},redirect:function(){var a={eid:this.impression,f:0,ui:this.containerId,en:this.CLICK,a:0,sig:Math.floor(Math.random()*65535)+65536},b=new URI(this.EVENT_HANDLER_PATH);b.setQueryData(a);goURI(b);}});
var ShortClickHandlers={EVENT_NAME_CAME_BACK:'cameback',onclicked:function(a){if(this.onsite)return;if(a.button!==0||a.getModifiers().any)return;this.click_ts=(+new Date());if(this.listeners!==undefined)for(var b in this.listeners)this.listeners[b].remove();this.listeners={focus:Event.listen(window,'focus',ShortClickHandlers.oncameback.bind(this))};},oncameback:function(a){var b=(+new Date())-this.click_ts;this.listeners[a.type].remove();var c={click_ts:this.click_ts,length:b,trigger:a.type};this.sendData(ShortClickHandlers.EVENT_NAME_CAME_BACK,c);}};
__d("legacy:util",["Util"],function(a,b,c,d){a.Util=b('Util');},3);
function EmuTracker(a,b){this.base=EmuController.fromContainer(a);!this.base;this.onsite=b;var c=DOM.scry($(a),"a."+EmuController.getEventClass(EmuTracker.EVENT_CLICK));c.each(function(d){Event.listen(d,'click',ShortClickHandlers.onclicked.bind(this));}.bind(this));return this;}copy_properties(EmuTracker,{EVENT_CLICK:1});copy_properties(EmuTracker.prototype,{sendData:function(a,b){this.base.event(a,b);}});
__d("legacy:event-extensions",["event-extensions"],function(a,b,c,d){b('event-extensions');},3);
function BassWhitespaceListener(a,b){this.link=b;Event.listen(a,'click',this.onclicked.bind(this));}copy_properties(BassWhitespaceListener.prototype,{onclicked:function(a){if(Parent.byTag(a.getTarget(),'A'))return;switch(this.link.getAttribute('rel')){case 'async':Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));break;case 'theater':var b=Parent.byClass(a.getTarget(),'fbPhotoSnowlift');Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));if(b)return false;break;default:goURI(this.link.getAttribute('href'));}}});
__d("Keys",[],function(a,b,c,d,e,f){var g={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188};e.exports=g;});
__d("AjaxRequest",["array-extensions","json","ArrayUtils","copyProperties","ErrorUtils","Keys","URI","Util","ua"],function(a,b,c,d,e,f){b('array-extensions');b('json');var g=b('ArrayUtils'),h=b('copyProperties'),i=b('ErrorUtils'),j=b('Keys'),k=b('URI'),l=b('Util'),m=b('ua');function n(q,r,s){if(window.XMLHttpRequest){this.xhr=new XMLHttpRequest();}else if(window.ActiveXObject)this.xhr=new ActiveXObject('MSXML2.XMLHTTP.3.0');if(!(r instanceof k))r=new k(r);if(s&&q=='GET'){r.setQueryData(s);}else this._params=s;this.method=q;this.uri=r;this.xhr.open(q,r);}n.corsEnabled=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());n.ERROR='ar:error';n.TIMEOUT='ar:timeout';n.PROXY_ERROR='ar:proxy error';n.TRANSPORT_ERROR='ar:transport error';n.SERVER_ERROR='ar:http error';n.PARSE_ERROR='ar:parse error';n._inflight=[];function o(){var q=n._inflight;n._inflight=[];q.each(function(r){r.abort();});}function p(q){q.onJSON=q.onError=q.onSuccess=null;clearTimeout(q._timer);if(q.xhr&&q.xhr.readyState<4){q.xhr.abort();q.xhr=null;}n._inflight=n._inflight.filter(function(r){return r&&r!=q&&r.xhr&&r.xhr.readyState<4;});}h(n.prototype,{timeout:60000,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(q){if(this[q])this[q](this);},_parseStatus:function(){var q;try{this.status=this.xhr.status;q=this.xhr.statusText;}catch(r){if(this.xhr.readyState>=4){this.errorType=n.TRANSPORT_ERROR;this.errorText=r.message;}return;}if(this.status===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=n.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=n.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=n.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=n.SERVER_ERROR;}else if(this.status>=500&&this.status<600){this.errorType=n.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=n.TRANSPORT_ERROR;}else{q='unrecognized status code: '+this.status;this.errorType=n.ERROR;}if(!this.errorText)this.errorText=q;},_parseResponse:function(){var q,r=this.xhr.readyState;try{q=this.xhr.responseText||'';}catch(s){if(r>=4){this.errorType=n.ERROR;this.errorText='responseText not available - '+s.message;}return;}while(this.xhr){var t=this._eol+1,u=q.indexOf('\n',t);if(u<0&&r==4)u=q.length;if(u<=this._eol)break;var v=q.substr(t,u-t).replace(/^\s*|\s*$/g,'');if(t===0&&this.prelude)if(this.prelude.test(v))v=v.replace(this.prelude,'');this._eol=u;if(v){try{this.json=JSON.parse(v);}catch(s){var w=(/(<body[\S\s]+?<\/body>)/i).test(q)&&RegExp.$1,x={message:s.message,'char':t,excerpt:((t===0&&w)||v).substr(512)};this.errorType=n.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(x);return;}i.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var q=this.xhr&&this.xhr.readyState||0;if(this.status==null&&q>=2)this._parseStatus();if(this.status!=null&&q>=3&&!this.errorType)this._parseResponse();if(this.errorType||q==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');p(this);}},send:function(q){this.xhr.onreadystatechange=function(){i.applyWithGuard(this._onReadyState,this,arguments);}.bind(this);var r=this.timeout;if(r)this._timer=setTimeout((function(){this.errorType=n.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');p(this);}).bind(this),r,false);n._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(q?k.implodeQuery(q):'');},abort:function(){p(this);},toString:function(){var q='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)q+=' errorType='+this.errorType+' ('+this.errorText+')';return q+']';},toJSON:function(){var q={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};for(var r in q)if(q[r]==null)delete q[r];return q;}});if(window.addEventListener&&m.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===j.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',o);e.exports=n;});
__d("SystemEvents",["Arbiter","Env","ErrorUtils","ua","Util","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('ua'),k=b('Util'),l=b('copyProperties'),m=new g(),n=[],o=1000;setInterval(function(){for(var x=0;x<n.length;x++)n[x]();},o,false);function p(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var q=h.user,r=navigator.onLine;function s(){if(!r){r=true;m.inform(m.ONLINE,r);}}function t(){if(r){r=false;m.inform(m.ONLINE,r);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=s;document.body.onoffline=t;});}else n.push(function(){(navigator.onLine?s:t)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',s,false);window.addEventListener('offline',t,false);}var u=q;n.push(function(){var x=p();if(u!=x){m.inform(m.USER,x);u=x;}});var v=Date.now();function w(){var x=Date.now(),y=x-v,z=y<0||y>10000;v=x;if(z)m.inform(m.TIME_TRAVEL,y);return z;}n.push(w);n.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});a.SystemEvents=e.exports=l(m,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(x){return (x||p())==q;},isOnline:function(){return j.chrome()||r;},checkTimeTravel:w});},3);
__d("ChannelConstants",[],function(a,b,c,d,e,f){var g='presence/',h={ON_SHUTDOWN:g+'shutdown',ON_INVALID_HISTORY:g+'invalid_history',ON_CONFIG:g+'config',ON_ENTER_STATE:g+'enter_state',ON_EXIT_STATE:g+'exit_state',OK:'ok',ERROR:'error',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_SHUTDOWN:'error_shutdown',ERROR_STALE:'error_stale',SYS_OWNER:'sys_owner',SYS_NONOWNER:'sys_nonowner',SYS_ONLINE:'sys_online',SYS_OFFLINE:'sys_offline',SYS_TIMETRAVEL:'sys_timetravel',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_DISABLED:'shutdown disabled',HINT_INVALID_STATE:'shutdown invalid state',HINT_MAINT:'shutdown maint',HINT_UNSUPPORTED:'shutdown unsupported',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,getArbiterType:function(i){return g+'message:'+i;}};e.exports=h;});
__d("DocRPC",["array-extensions","json"],function(a,b,c,d,e,f){b('array-extensions');b('json');var g={_apis:{},origin:location.origin||(location+'').replace(/([^:\/])\/.*/,'$1'),originFilter:/\.facebook\.com(:\d+)?$/,_init:function(){var h=function(event){event=event||window.event;var i=event.domain||event.origin;if(g.originFilter.test(i))g._dispatch(event.data);};if(window.postMessage)if(window.addEventListener){window.addEventListener('message',h,false);}else window.onmessage=h;this._init=function(){};},_dispatch:function(h){h=JSON.parse(h);var i=JSON.stringify(h.params);if(g._apis.hasOwnProperty(h.api)){var j=g._apis[h.api];if(j[h.method])j[h.method].apply(j,h.params);}},publish:function(h,i){g._init();g._apis[i]=h;},proxy:function(h,i,j,k){g._init();var l={_proxyId:Math.random().toString(36),_seq:0};function m(o){l[o]=function(){var p={api:i,method:o,params:Array.prototype.slice.call(arguments)},q=JSON.stringify(p.params);p=JSON.stringify(p);if(h.postMessage){h.postMessage(p,k);}else if(h.DocRPC)h.DocRPC._dispatch(p);};}for(var n=0;n<j.length;n++)m(j[n]);return l;}};e.exports=a.DocRPC=g;},3);
__d("ChannelTransport",["copyProperties","bind","Util","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('Util'),j=b('AjaxRequest'),k=b('URI'),l=b('JSLogger'),m=b('DocRPC'),n=b('ChannelConstants'),o=l.create('channel'),p=null,q=9000;function r(){return (1048576*Math.random()|0).toString(36);}function s(ba,ca){var da=ba.subdomain;da=da===null?'':(da+'-');var ea=new k(ca).setDomain(da+ba.host+'.facebook.com').setPort(ba.port).setSecure(k().isSecure());return ea;}function t(event,ba){if(window!==window.parent&&/iframe/.test(window.location)){if(!p)p=m.proxy(window.parent,'outerTransport',['_addJsLoggerEntry'],top.DocRPC.origin);p._addJsLoggerEntry(event,ba);}else o.log(event,ba);}function u(ba){var ca={partition:ba.partition,cb:r()},da=s(ba,'/p').setQueryData(ca);t('start_p',{uri:da.toString()});var ea=new j('GET',da);if(j.corsEnabled)ea.xhr.withCredentials=true;var fa=function(ga){t('finish_p',{xhr:ga.toJSON?ga.toJSON():ga});};ea.timeout=ba.P_TIMEOUT||10000;ea.onError=ea.onSuccess=fa;ea.send();}function v(ba,ca,da){var ea=new Image(),fa=0,ga=function(ja){ea.abort();return ja?ca():da();};ea.onload=function(){t('ping_ok',{duration:Date.now()-fa});ga(true);};ea.onerror=function(){u(ba);ga(false);};var ha=setTimeout(ea.onerror,10000,false);ea.abort=function(){if(ha){clearTimeout(ha);ha=null;}ea.onload=ea.onerror=null;};var ia={partition:ba.partition,cb:r()};fa=Date.now();ea.src=s(ba,'/ping').setQueryData(ia);return ea;}function w(ba,ca,da,ea){var fa=(new Date()-ba.userActive)/1000|0,ga={channel:ba.user_channel,seq:ba.seq,partition:ba.partition,clientid:ba.sessionID,cb:r(),idle:fa};if(fa<60)ga.state='active';var ha=s(ba,'/pull').setQueryData(ga),ia=new j('GET',ha);if(j.corsEnabled)ia.xhr.withCredentials=true;ia.timeout=ba.PULL_TIMEOUT||60000;ia.onJSON=ca;ia.onSuccess=da;ia.onError=function(){var ja=(this.status==12002&&this._time>=q)?da:ea;return ja&&ja.apply(this,arguments);};ia.send();return ia;}function x(ba){this.manager=ba;(this.init&&this.init());}function y(ba){x.apply(this,arguments);}g(y.prototype,{logName:'CORS',enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='init')setTimeout(h(this.manager,'exitState',{status:n.OK,stateId:ca.stateId}),3000,false);if(!/pull|ping/.test(ba))return;var da=this.manager;if(ba=='ping'){this._request=v(ca,h(da,'exitState',{status:n.OK,stateId:ca.stateId}),h(da,'exitState',{status:n.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,h(da,'_processTransportData',ca.stateId),h(da,'exitState',{status:n.OK,stateId:ca.stateId}),h(da,'exitState',{status:n.ERROR,stateId:ca.stateId}));}});function z(ba){o.log('iframe_init_constructor');x.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);m.publish(this,'outerTransport');}g(z.prototype,{logName:'iframe',_initIframe:function(ba){o.log('iframe_init_start',ba);window.onchanneliframeready=function(){o.log('iframe_resources');return ba.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(ba){this._iframeURI=s(ba,ba.path);if(ba.bustIframe){var ca={partition:ba.partition,cb:r()};this._iframeURI.setQueryData(ca);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(da){o.error('iframe_uri_set_error',da);this.exitState({status:n.ERROR,stateId:ba.stateId},da+'');}},_addJsLoggerEntry:function(event,ba){o.log(event,ba);},enterState:function(ba,ca){if(ba=='init'){this._initIframe(ca);}else if(/idle|ping|pull/.test(ba)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(ba!='idle')this.exitState({status:n.ERROR,stateId:ca.stateId},'iframe not yet loaded');}else if(ba=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(ba){if(this.manager.state=='init'&&ba.status==n.OK)this._iframeProxy=m.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function aa(){this.init=this.init.bind(this);x.apply(this,arguments);}g(aa.prototype,{logName:'iframe(inner)',init:function(){m.publish(this,'innerTransport');try{var ca=m.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,ca);this.exitState({status:n.OK,stateId:1e+06});}catch(ba){o.error('iframe_inner_init_error',ba);}},enterState:function(ba,ca){if(this._request){this._request.abort();this._request=null;}if(ba=='ping'){this._request=v(ca,h(this,'exitState',{status:n.OK,stateId:ca.stateId}),h(this,'exitState',{status:n.ERROR,stateId:ca.stateId}));}else if(ba=='pull')this._request=w(ca,h(this,'_processTransportData',ca.stateId),h(this,'exitState',{status:n.OK,stateId:ca.stateId}),h(this,'exitState',{status:n.ERROR,stateId:ca.stateId}));}});if(window!==window.parent&&/iframe/.test(window.location))a.transport=new aa();e.exports={getURI:s,Transport:x,CORSTransport:y,IframeTransport:z,IframeInnerTransport:aa};});
__d("FBAjaxRequest",["$","Env","AjaxRequest"],function(a,b,c,d,e,f){var g=b('$'),h=b('Env'),i=b('AjaxRequest');function j(k,l,m){m=m||{};m.__a=1;m.__user=h.user;var n=new i(k,l,m),o=n._call;n._call=function(p){if(p=='onJSON'&&this.json){if(this.json.error){this.errorType=i.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}o.apply(this,arguments);};return n;}e.exports=j;});
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("math-extensions",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=e.exports={rand32:function(){return Math.floor(Math.random()*4294967295);},verifyNumber:function(i){if(typeof i=='undefined'||isNaN(i)||i==Number.POSITIVE_INFINITY||i==Number.NEGATIVE_INFINITY)i=0;return i;},mod:function(i,j){var k=i%j;if(k*j<0)k+=j;return k;},clip:function(i,j,k){return Math.max(j,Math.min(i,k));}};g(a,h);},3);
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("UserActivity",["event-extensions","Arbiter","FunctionUtils"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("FunctionUtils"),i=Date.now(),j={DEFAULT_IDLE_MS:5000,EVENT_INTERVAL_MS:500,subscribeOnce:function(l){var m=j.subscribe(function(){j.unsubscribe(m);l();});},subscribe:function(l){return g.subscribe('useractivity/activity',l);},unsubscribe:function(l){g.unsubscribe(l);},isActive:function(l){return (new Date()-i<(l||j.DEFAULT_IDLE_MS));}},k=h.throttle(function(event){var l=Date.now(),m=l-i;i=l;g.inform('useractivity/activity',{event:event,idleness:m});},j.EVENT_INTERVAL_MS,false);Event.listen(document.documentElement,{mouseover:k,keydown:k,click:k});e.exports=j;});
__d("ChannelManager",["array-extensions","function-extensions","json","AjaxRequest","Arbiter","ArrayUtils","AsyncRequest","ChannelConstants","ChannelTransport","Cookie","Env","FBAjaxRequest","FunctionUtils","JSLogger","MovingStat","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","copyProperties","hasArrayNature","presence-cookie-manager","ua","ChannelInitialData"],function(a,b,c,d,e,f){b('array-extensions');b('function-extensions');b('json');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('ArrayUtils'),j=b('AsyncRequest'),k=b('ChannelConstants'),l=b('ChannelTransport'),m=b('Cookie'),n=b('Env'),o=b('FBAjaxRequest'),p=b('FunctionUtils'),q=b('JSLogger'),r=b('MovingStat'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('Run'),v=b('SystemEvents'),w=b('URI'),x=b('UserActivity'),y=b('copyProperties'),z=b('hasArrayNature'),aa=b('presence-cookie-manager'),ba=b('ua'),ca=c('ChannelInitialData'),da,ea=q.create('channel'),fa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ga=7,ha={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16)},ia=1,ja={},ka=0,la=null;function ma(ya){return ya.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function na(ya){ea.log(ma('arbiter_'+ya));h.inform.apply(h,arguments);}function oa(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function pa(){var ya=m.get('sub')||0;ya=parseInt(ya,10);return isNaN(ya)?0:ya;}function qa(){if(la===null){var ya=pa();for(la=0;la<32;la++)if(!(ya&(1<<la)))break;var za=da.getConfig('max_conn',2)-1;if(la<Math.min(32,ga*za)){ha.subdomain=la%ga;m.set('sub',ya|(1<<la));}else{la=-1;ha.subdomain=null;ea.error('subdomain_overflow',{slot:la,max:za});}}}function ra(){var ya={};if(da.getConfig('host'))ya[da.getConfig('user_channel')]=da.getConfig('seq',0);return ya;}function sa(){var ya=Date.now(),za=Date.now(),ab={total:0},bb='idle',cb=false;v.subscribe([v.USER,v.ONLINE,v.TIME_TRAVEL],function(fb,gb){ua(true);za=null;da.lastPullTime=Date.now();var hb;switch(fb){case v.USER:hb=v.isPageOwner()?k.SYS_OWNER:k.SYS_NONOWNER;break;case v.ONLINE:hb=gb?k.SYS_ONLINE:k.SYS_OFFLINE;break;case v.TIME_TRAVEL:hb=k.SYS_TIMETRAVEL;break;}da.exitState({status:hb,stateId:ia});});var db=function(fb,gb){var hb=Date.now(),ib;if(gb){ya=hb;ib=gb.nextState||gb.state;}else ib=bb;v.checkTimeTravel();if(za){var jb=Math.round((hb-za)/1000);if(jb>0){ab[bb]=(ab[bb]||0)+jb;ab.total+=jb;}}bb=ib;za=hb;if(!fb){ab.lastSuccessTime=oa();ab.online=v.isOnline();ea.log('rollup',ab);}};h.subscribe(k.ON_ENTER_STATE,db);setInterval(db,60000,false);h.subscribe(q.DUMP_EVENT,function(fb,gb){gb.channelRollup=ab;});var eb=function(){if(da.isShutdown()||da.shouldIdle())return;v.checkTimeTravel();var fb=Date.now()-(da.lastPullTime||n.start),gb=da.getConfig('CHANNEL_EXPIRY',180000);if(!cb&&fb>gb){var hb=oa();ea.error('stall',{lastSuccessTime:hb,rollupState:bb});cb=true;}var ib=Date.now()-ya;if(da.state=='pull'&&ib>90000){ya=null;ea.warn('jumpstart',{state:da.state,dormant:ib});da.enterState('init');}};setInterval(eb,10000,false);}function ta(){var ya=Date.now(),za=1;function ab(){setTimeout(ab,za*1000,false);var fb=da.state;if(fb=='idle'&&da.shouldIdle())return;ea.bump('conn_t',za);if(fb=='pull')ea.bump('conn_t_pull',za);}ab();var bb=[15,30,60,120,240],cb=false,db=false;function eb(fb){setTimeout(function(){ea.rate('pullenter_'+fb,cb);ea.rate('pullexit_'+fb,db);},fb*1000,false);}while(bb.length)eb(bb.shift());h.subscribe(k.ON_ENTER_STATE,function(fb,gb){if(gb.state=='pull')cb=true;ya=Date.now();});h.subscribe(k.ON_EXIT_STATE,function(fb,gb){if(gb.state!='pull'||!ya)return;var hb='other';if(gb.status==k.OK){db=true;hb='ok';}else if(gb.xhr&&gb.xhr.errorType){hb=/ar:(\w+)/.test(gb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(gb.status))return;var ib=(Date.now()-ya)/1000;if(ib<0){return;}else if(ib>3600)ib=3600;ea.bump('conn_num');ea.bump('conn_exit',ib);ea.bump('conn_num_'+hb);ea.bump('conn_exit_'+hb,ib);});}function ua(ya){if(ya){ka=0;ja={};}else ka++;}da={state:'idle',nextState:null,lastPullTime:Date.now(),init:function(ya){this.init=function(){};if(typeof(x)!='undefined')x.subscribe(function(){ha.userActive=Date.now();}.bind(this));aa.register('ch',ra);var za=function(){if(la!==null&&la>=0){var bb=pa()&~(1<<la);if(bb){m.set('sub',bb);}else m.clear('sub');}};if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',za);}else u.onUnload(za);this._transportRate=new r(30000);var ab=(g.corsEnabled&&!ha.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new l[ab](this);if(ya)this.enterState.apply(this,arguments);h.subscribe(q.DUMP_EVENT,function(event,bb){bb.transportRate=this._transportRate.tally();bb.transportType=ab;bb.transportVersion=2;}.bind(this));sa();ta();},configure:function(){i.createFrom(arguments).each(y.bind(null,ha));h.inform(k.ON_CONFIG,this);},getConfig:function(ya,za){return ya in ha?ha[ya]:za;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(v.isPageOwner()&&v.isOnline());},_sendIframeError:function(ya){var za=new j().setURI('/ajax/presence/reconnect.php').setData({reason:ya,iframe_loaded:this.iframeEverLoaded,fb_dtsg:n.fb_dtsg}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);za.specifiesWriteRequiredParams()&&za.send();},_getDelay:function(){var ya=da.getConfig('MIN_RETRY_INTERVAL',10000),za=da.getConfig('MAX_RETRY_INTERVAL',60000),ab=Math.min(ya*Math.pow(2,Math.max(0,ka-1)),za);return ab*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ea.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ya){this._inEnterState=false;throw ya;}},_enterState:function(ya){var za=0,ab=null,bb=i.createFrom(arguments);if(this.isShutdown())return;if(ya!='idle!'&&this.shouldIdle())return;ia++;ha.stateId=ia;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ya)){var cb=this._transportRate.tally().timeAverage,db=da.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(cb>=db){if(!this._throttled){this._throttled=true;ea.warn('throttled');}ea.bump('throttle');za=1000/db;}}else if(!(/#$/.test(ya)))za=this._getDelay();ya=ya.replace(/\W*$/,'');if(!fa[ya])throw new Error('invalid state:'+ya);var eb;if(za<=0){eb={state:ya};this._transportRate.add(1);this.state=ya;var fb=this['_enter_'+this.state];if(fb){bb.shift();fb.apply(this,bb);}if(/init|idle|pull|ping/.test(this.state)){qa();this.transport.enterState(this.state,ha);if(this.state=='ping')eb.url=l.getURI(ha).toString();}}else{this.state='idle';this.nextState=ya;eb={state:this.state,delay:za,nextState:ya};bb[0]=ya+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,bb);}).bind(this).defer(za,false);}ea.log('enter_'+this.state,eb);h.inform(k.ON_ENTER_STATE,eb);},exitState:function(ya,za){var ab=ya.stateId,bb=ya.status;if(this.isShutdown()||ab<ia)return;var cb=i.createFrom(arguments),db=this.state;cb[0]=ya.status;var eb={state:db,status:bb};if(this.nextState)eb.nextState=this.nextState;if(za&&za.errorType){eb.xhr=za.toJSON?za.toJSON():za;delete eb.xhr.json;}if(za&&za.json){if(za.json.t)eb.t=za.json.t;if(za.json.reason)eb.reason=za.json.reason;if(za.json.seq)eb.seq=za.json.seq;}ea.log('exit_'+db,eb);h.inform(k.ON_EXIT_STATE,eb);var fb=this['_exit_'+db];if(fb)bb=fb.apply(this,cb)||bb;if(bb!=k.OK){ua();ja[db]=(ja[db]||0)+1;}var gb=fa[this.nextState||db][bb]||fa._all[bb],hb=gb&&gb.replace(/!*$/,'');if(!hb){ea.error('terminal_transition',eb);this._shutdownHint=k.HINT_INVALID_STATE;gb='shutdown!';}this._lastState=db;this._lastStatus=bb;this.enterState(gb);},_processTransportData:function(ya,za){var ab=za.json,bb=ab.t;if('s' in ab){ab.seq=ab.s;delete ab.s;}var cb=ha.seq;if('seq' in ab){ha.seq=ab.seq;s.doSync();}switch(bb){case 'continue':ua(true);this.exitState({status:k.OK,stateId:ya});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(ab.reason||0),stateId:ya},za);break;case 'fullReload':aa.clear();ea.log(ma('arbiter_'+k.ON_INVALID_HISTORY));na(k.ON_INVALID_HISTORY);this.exitState({status:k.ERROR_MISSING,stateId:ya},za);break;case 'msg':var db,eb,fb,gb;ua(true);if(ab.msgs){eb=ab.msgs;var hb=0;for(db=0;db<eb.length;db++)if(eb[db].seq!==-1)hb++;fb=ha.seq-hb;for(db=0;db<eb.length;db++){if(fb>=cb){gb=eb[db].msg;if(gb.type)na(k.getArbiterType(gb.type),{obj:gb});}else ea.warn('seq_regression',{seq:fb,last_seq:cb,non_transient:hb,messages:eb.length});if(eb[db].seq!==-1)fb++;}}else{eb=ab.ms;fb=ha.seq-eb.length;for(db=0;db<eb.length;db++,fb++)if(fb>=cb){gb=eb[db];if(gb.type)na(k.getArbiterType(gb.type),{obj:gb});}else ea.warn('seq_regression',{seq:fb,last_seq:cb,messages:eb.length});}break;default:ea.error('unknown_msg_type',{type:bb});break;}},_enter_init:function(){if(ja.init>=da.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:k.ERROR_MAX,stateId:ia}).defer();this._initTimer=this.exitState.bind(this,{status:k.ERROR,stateId:ia},'timeout').defer(da.getConfig('IFRAME_LOAD_TIMEOUT',30000),false);},_enter_reconnect:function(ya){var za=ia;if(!t.hasUserCookie()){ea.warn('no_user_cookie');(function(){da._shutdownHint=k.HINT_AUTH;da.exitState({status:k.ERROR_SHUTDOWN,stateId:za});}).defer();return;}var ab={reason:ya,iframe_loaded:this.iframeEverLoaded,fb_dtsg:n.fb_dtsg};if(n.fb_isb)ab.fb_isb=n.fb_isb;var bb=new o('GET','/ajax/presence/reconnect.php',ab);bb.onSuccess=(function(){da.configure(null,bb.json);aa.store();this.exitState({status:k.OK,stateId:za});}).bind(this);bb.onError=(function(){var cb=bb.json&&bb.json.error;if(bb.errorType==g.TRANSPORT_ERROR||bb.errorType==g.PROXY_ERROR)this._shutdownHint=k.HINT_CONN;if(cb&&cb==1356007){this._shutdownHint=k.HINT_MAINT;}else if(cb==1357001||cb==1357004||cb==1348009){this._shutdownHint=k.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?k.ERROR_SHUTDOWN:k.ERROR,stateId:za},bb);}).bind(this);bb.send();},_enter_shutdown:function(){na(k.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(ya){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ya==k.OK){this.iframeEverLoaded=true;}else if(ya==k.ERROR_MAX)this._sendIframeError(k.reason_IFrameLoadGiveUp);},_exit_pull:function(ya){if(ya==k.OK)this.lastPullTime=Date.now();},_exit_ping:function(ya){if(ya==k.OK){var za=Date.now()-(this.lastPullTime||n.start);if(za>this.getConfig('CHANNEL_EXPIRY',180000))return k.ERROR_STALE;}}};e.exports=da;if(ca.serverInitialized==null){da.configure(ca.channelConfig);if(/shutdown/.test(ca.state)){da._shutdownHint=k[ca.reason];}else ca.reconnectReason;da.init(ca.state,ca.reason);}if(da.getConfig('streamProbe')&&g.corsEnabled){var va=[],wa=new w('/probe').setDomain(ha.host+'.facebook.com').setPort(ha.port).setSecure(w().isSecure()),xa=new g('GET',wa);xa.onJSON=function(ya,za){va.push(Date.now());};xa.onSuccess=function(ya){if(va.length==2){var za=va[1]-va[0];ea.log('probe_ok',{time:za});}else ea.error('probe_error',{error:'beats.length = '+va.length});};xa.onError=function(ya){ea.error('probe_error',ya);};ea.log('probe_request');xa.send();}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);k.subscribe(k.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});j.onBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__d("Button",["event-extensions","css","DataStore","DOM","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css'),h=b('DataStore'),i=b('DOM'),j=b('Parent'),k=(function(){var l='uiButtonDisabled',m='uiButtonDepressed',n='button:blocker',o='href';function p(s,t){var u=h.get(s,n);if(t){if(u){u.remove();h.remove(s,n);}}else if(!u)h.set(s,n,Event.listen(s,'click',bagof(false),Event.Priority.URGENT));}function q(s){var t=j.byClass(s,'uiButton');if(!t)throw new Error('invalid use case');return t;}function r(s){return i.isNodeOfType(s,'a');}return {getInputElement:function(s){s=q(s);if(r(s))throw new Error('invalid use case');return i.find(s,'input');},isEnabled:function(s){return !g.hasClass(q(s),l);},setEnabled:function(s,t){s=q(s);g.conditionClass(s,l,!t);if(r(s)){var u=s.href,v=h.get(s,o,'#');if(t){if(!u)s.href=v;}else{if(u&&u!==v)h.set(s,o,u);s.removeAttribute('href');}p(s,t);}else{var w=k.getInputElement(s);w.disabled=!t;p(w,t);}},setDepressed:function(s,t){g.conditionClass(q(s),m,t);},isDepressed:function(s){return g.hasClass(q(s),m);},setLabel:function(s,t){s=q(s);if(r(s)){var u=i.find(s,'span.uiButtonText');i.setContent(u,t);}else k.getInputElement(s).value=t;g.conditionClass(s,'uiButtonNoText',!t);},setIcon:function(s,t){if(!i.isNode(t))return;g.addClass(t,'customimg');s=q(s);var u=i.scry(s,'.img')[0];if(u!=t)if(u){i.replace(u,t);}else i.prependContent(s,t);}};})();a.Button=e.exports=k;},3);
__d("DOMControl",["DataStore","$","copyProperties"],function(a,b,c,d,e,f){var g=b("DataStore"),h=b("$"),i=b("copyProperties");function j(k){this.root=h(k);this.updating=false;g.set(k,'DOMControl',this);}i(j.prototype,{getRoot:function(){return this.root;},beginUpdate:function(){if(this.updating)return false;this.updating=true;return true;},endUpdate:function(){this.updating=false;},update:function(k){if(!this.beginUpdate())return this;this.onupdate(k);this.endUpdate();},onupdate:function(k){}});j.getInstance=function(k){return g.get(k,'DOMControl');};e.exports=j;});
__d("Input",["css-core","DOMQuery","DOMControl"],function(a,b,c,d,e,f){var g=b("css-core"),h=b("DOMQuery"),i=b("DOMControl"),j=function(l){var m=l.getAttribute('maxlength');if(m&&m>0)d(["enforceMaxLength"],function(n){n(l,m);});},k={focus:function(l){try{l.focus();}catch(m){}},isEmpty:function(l){return !(/\S/).test(l.value||'')||g.hasClass(l,'DOMControl_placeholder');},getValue:function(l){return k.isEmpty(l)?'':l.value;},setValue:function(l,m){g.removeClass(l,'DOMControl_placeholder');l.value=m||'';j(l);var n=i.getInstance(l);n&&n.resetHeight&&n.resetHeight();},setPlaceholder:function(l,m){l.setAttribute('title',m);l.setAttribute('placeholder',m);if(l==document.activeElement)return;if(k.isEmpty(l)){g.conditionClass(l,'DOMControl_placeholder',m);l.value=m||'';}},reset:function(l){var m=l!==document.activeElement?(l.getAttribute('placeholder')||''):'';l.value=m;g.conditionClass(l,'DOMControl_placeholder',m);l.style.height='';},setSubmitOnEnter:function(l,m){g.conditionClass(l,'enter_submit',m);},getSubmitOnEnter:function(l){return g.hasClass(l,'enter_submit');},setMaxLength:function(l,m){if(m>0){l.setAttribute('maxlength',m);j(l);}else l.removeAttribute('maxlength');}};e.exports=k;});
__d("goOrReplace",["URI"],function(a,b,c,d,e,f){var g=b("URI");function h(i,j,k){var l=new g(j);if(i.pathname=='/'&&l.getPath()!='/'&&l.isQuicklingEnabled()){var m=i.search?{}:{q:''};l=new g().setPath('/').setQueryData(m).setFragment(l.getUnqualifiedURI()).toString();j=l.toString();}if(k&&!(ua.ie()<8)){i.replace(j);}else if(i.href==j){i.reload();}else i.href=j;}e.exports=h;});
__d("AjaxPipeRequest",["Arbiter","AsyncRequest","BigPipe","DOM","Env","JSCC","copyProperties","goOrReplace","ge"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("AsyncRequest"),i=b("BigPipe"),j=b("DOM"),k=b("Env"),l=b("JSCC"),m=b("copyProperties"),n=b("goOrReplace"),o=b("ge");function p(s,t){var u=o(s);if(u){if(!t)u.style.minHeight='600px';for(var v in i.pageletIDs)if(s!==v&&j.contains(u,v)){l.clearForPagelet(v);delete i.pageletIDs[v];}j.empty(u);}}function q(s,t){var u=o(s);if(u)if(!t)u.style.minHeight='100px';}function r(s,t){this._uri=s;this._query_data=t;this._request=new h();this._canvas_id=null;this._allow_cross_page_transition=true;}m(r.prototype,{setCanvasId:function(s){this._canvas_id=s;return this;},setURI:function(s){this._uri=s;return this;},setData:function(s){this._query_data=s;return this;},getData:function(s){return this._query_data;},setAllowCrossPageTransition:function(s){this._allow_cross_page_transition=s;return this;},setAppend:function(s){this._append=s;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(m({ajaxpipe:1,ajaxpipe_token:k.ajaxpipe_token},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);r._current_request=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(s){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,g.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,g.BEHAVIOR_STATE);},_isRelevant:function(s){return this._request==r._current_request||this._jsNonBlock;},_preBootloadHandler:function(s){var t=s.getPayload();if(!t||t.redirect||!this._isRelevant(s))return false;var u=false;if(s.is_first){!this._append&&!this._displayCallback&&p(this._canvas_id,this._constHeight);this._arbiter=new g();u=this._preBootloadFirstResponse(s);this.pipe=new i({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,rrEnabled:s.payload.roadrunner_enabled,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',jsNonBlock:this._jsNonBlock,displayCallback:this._displayCallback});}return u;},_redirect:function(s){if(s.redirect){if(s.force||!this.isPageActive(s.redirect)){var t=['ajaxpipe','ajaxpipe_token'].concat(this.getSanitizedParameters());n(window.location,URI(s.redirect).removeQueryData(t),true);}else PageTransitions.go(s.redirect,true);return true;}else return false;},isPageActive:function(s){return true;},getSanitizedParameters:function(){return [];},_versionCheck:function(s){return true;},_onInitialResponse:function(s){var t=s.getPayload();if(!this._isRelevant(s))return false;if(!t)return true;if(this._redirect(t)||!this._versionCheck(t))return false;return true;},_processFirstResponse:function(s){var t=s.getPayload();if(o(this._canvas_id)&&t.canvas_class!==null)CSS.setClass(this._canvas_id,t.canvas_class);},setFirstResponseCallback:function(s){this._firstResponseCallback=s;return this;},setFirstResponseHandler:function(s){this._processFirstResponse=s;return this;},_onResponse:function(s){var t=s.payload;if(!this._isRelevant(s))return h.suppressOnloadToken;if(s.is_first){this._processFirstResponse(s);this._firstResponseCallback&&this._firstResponseCallback();t.provides=t.provides||[];t.provides.push('uipage_onload');if(this._append)t.append=this._canvas_id;}if(t){if('content' in t.content&&this._canvas_id!==null&&this._canvas_id!='content'){t.content[this._canvas_id]=t.content.content;delete t.content.content;}this.pipe.onPageletArrive(t);}if(s.is_last)q(this._canvas_id,this._constHeight);return h.suppressOnloadToken;},setNectarModuleDataSafe:function(s){this._request.setNectarModuleDataSafe(s);return this;},setFinallyHandler:function(s){this._request.setFinallyHandler(s);return this;},setErrorHandler:function(s){this._request.setErrorHandler(s);return this;},abort:function(){this._request.abort();if(r._current_request==this._request)r._current_request=null;this._request=null;return this;},setJSNonBlock:function(s){this._jsNonBlock=s;return this;},setDisplayCallback:function(s){this._displayCallback=s;return this;},setConstHeight:function(s){this._constHeight=s;return this;},getAsyncRequest:function(){return this._request;}});m(r,{getCurrentRequest:function(){return r._current_request;},setCurrentRequest:function(s){r._current_request=s;}});e.exports=a.AjaxPipeRequest||r;});
__d("Animation",["string-extensions","css","DOM","ua"],function(a,b,c,d,e,f){b("string-extensions");var g=b("css"),h=b("DOM"),i=b("ua");function j(k){if(a==this){return new j(k);}else{this.obj=k;this._reset_state();this.queue=[];this.last_attr=null;}}j.resolution=20;j.offset=0;j.prototype._reset_state=function(){this.state={attrs:{},duration:500};};j.prototype.stop=function(){this._reset_state();this.queue=[];return this;};j.prototype._build_container=function(){if(this.container_div){this._refresh_container();return;}if(this.obj.firstChild&&this.obj.firstChild.__animation_refs){this.container_div=this.obj.firstChild;this.container_div.__animation_refs++;this._refresh_container();return;}var k=document.createElement('div');k.style.padding='0px';k.style.margin='0px';k.style.border='0px';k.__animation_refs=1;var l=this.obj.childNodes;while(l.length)k.appendChild(l[0]);this.obj.appendChild(k);this._orig_overflow=this.obj.style.overflow;this.obj.style.overflow='hidden';this.container_div=k;this._refresh_container();};j.prototype._refresh_container=function(){this.container_div.style.height='auto';this.container_div.style.width='auto';this.container_div.style.height=this.container_div.offsetHeight+'px';this.container_div.style.width=this.container_div.offsetWidth+'px';};j.prototype._destroy_container=function(){if(!this.container_div)return;if(!--this.container_div.__animation_refs){var k=this.container_div.childNodes;while(k.length)this.obj.appendChild(k[0]);this.obj.removeChild(this.container_div);}this.container_div=null;this.obj.style.overflow=this._orig_overflow;};j.ATTR_TO=1;j.ATTR_BY=2;j.ATTR_FROM=3;j.prototype._attr=function(k,l,m){k=k.replace(/-[a-z]/gi,function(o){return o.substring(1).toUpperCase();});var n=false;switch(k){case 'background':this._attr('backgroundColor',l,m);return this;case 'margin':l=j.parse_group(l);this._attr('marginBottom',l[0],m);this._attr('marginLeft',l[1],m);this._attr('marginRight',l[2],m);this._attr('marginTop',l[3],m);return this;case 'padding':l=j.parse_group(l);this._attr('paddingBottom',l[0],m);this._attr('paddingLeft',l[1],m);this._attr('paddingRight',l[2],m);this._attr('paddingTop',l[3],m);return this;case 'backgroundColor':case 'borderColor':case 'color':l=j.parse_color(l);break;case 'opacity':l=parseFloat(l,10);break;case 'height':case 'width':if(l=='auto'){n=true;}else l=parseInt(l,10);break;case 'borderWidth':case 'lineHeight':case 'fontSize':case 'marginBottom':case 'marginLeft':case 'marginRight':case 'marginTop':case 'paddingBottom':case 'paddingLeft':case 'paddingRight':case 'paddingTop':case 'bottom':case 'left':case 'right':case 'top':case 'scrollTop':case 'scrollLeft':l=parseInt(l,10);break;default:throw new Error(k+' is not a supported attribute!');}if(this.state.attrs[k]===undefined)this.state.attrs[k]={};if(n)this.state.attrs[k].auto=true;switch(m){case j.ATTR_FROM:this.state.attrs[k].start=l;break;case j.ATTR_BY:this.state.attrs[k].by=true;case j.ATTR_TO:this.state.attrs[k].value=l;break;}};j._get_box_width=function(k){var l=parseInt(g.getStyle(k,'paddingLeft'),10),m=parseInt(g.getStyle(k,'paddingRight'),10),n=parseInt(g.getStyle(k,'borderLeftWidth'),10),o=parseInt(g.getStyle(k,'borderRightWidth'),10);return k.offsetWidth-(l?l:0)-(m?m:0)-(n?n:0)-(o?o:0);};j._get_box_height=function(k){var l=parseInt(g.getStyle(k,'paddingTop'),10),m=parseInt(g.getStyle(k,'paddingBottom'),10),n=parseInt(g.getStyle(k,'borderTopWidth'),10),o=parseInt(g.getStyle(k,'borderBottomWidth'),10);return k.offsetHeight-(l?l:0)-(m?m:0)-(n?n:0)-(o?o:0);};j.prototype.to=function(k,l){if(l===undefined){this._attr(this.last_attr,k,j.ATTR_TO);}else{this._attr(k,l,j.ATTR_TO);this.last_attr=k;}return this;};j.prototype.by=function(k,l){if(l===undefined){this._attr(this.last_attr,k,j.ATTR_BY);}else{this._attr(k,l,j.ATTR_BY);this.last_attr=k;}return this;};j.prototype.from=function(k,l){if(l===undefined){this._attr(this.last_attr,k,j.ATTR_FROM);}else{this._attr(k,l,j.ATTR_FROM);this.last_attr=k;}return this;};j.prototype.duration=function(k){this.state.duration=k?k:0;return this;};j.prototype.checkpoint=function(k,l){if(k===undefined)k=1;this.state.checkpoint=k;this.queue.push(this.state);this._reset_state();this.state.checkpointcb=l;return this;};j.prototype.blind=function(){this.state.blind=true;return this;};j.prototype.hide=function(){this.state.hide=true;return this;};j.prototype.show=function(){this.state.show=true;return this;};j.prototype.ease=function(k){this.state.ease=k;return this;};j.prototype.go=function(){var k=(new Date()).getTime();this.queue.push(this.state);for(var l=0;l<this.queue.length;l++){this.queue[l].start=k-j.offset;if(this.queue[l].checkpoint)k+=this.queue[l].checkpoint*this.queue[l].duration;}j.push(this);return this;};j.prototype._show=function(){g.show(this.obj);};j.prototype._hide=function(){g.hide(this.obj);};j.prototype._frame=function(k){var l=true,m=false,n=false,o;function p(z){return document.documentElement[z]||document.body[z];}for(var q=0;q<this.queue.length;q++){var r=this.queue[q];if(r.start>k){l=false;continue;}if(r.checkpointcb){this._callback(r.checkpointcb,k-r.start);r.checkpointcb=null;}if(r.started===undefined){if(r.show)this._show();for(var s in r.attrs){if(r.attrs[s].start!==undefined)continue;switch(s){case 'backgroundColor':case 'borderColor':case 'color':o=j.parse_color(g.getStyle(this.obj,s=='borderColor'?'borderLeftColor':s));if(r.attrs[s].by){r.attrs[s].value[0]=Math.min(255,Math.max(0,r.attrs[s].value[0]+o[0]));r.attrs[s].value[1]=Math.min(255,Math.max(0,r.attrs[s].value[1]+o[1]));r.attrs[s].value[2]=Math.min(255,Math.max(0,r.attrs[s].value[2]+o[2]));}break;case 'opacity':o=g.getOpacity(this.obj);if(r.attrs[s].by)r.attrs[s].value=Math.min(1,Math.max(0,r.attrs[s].value+o));break;case 'height':o=j._get_box_height(this.obj);if(r.attrs[s].by)r.attrs[s].value+=o;break;case 'width':o=j._get_box_width(this.obj);if(r.attrs[s].by)r.attrs[s].value+=o;break;case 'scrollLeft':case 'scrollTop':o=(this.obj===document.body)?p(s):this.obj[s];if(r.attrs[s].by)r.attrs[s].value+=o;r['last'+s]=o;break;default:o=parseInt(g.getStyle(this.obj,s),10)||0;if(r.attrs[s].by)r.attrs[s].value+=o;break;}r.attrs[s].start=o;}if((r.attrs.height&&r.attrs.height.auto)||(r.attrs.width&&r.attrs.width.auto)){if(i.firefox()<3)n=true;this._destroy_container();for(var s in {height:1,width:1,fontSize:1,borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderBottomWidth:1,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1})if(r.attrs[s])this.obj.style[s]=r.attrs[s].value+(typeof r.attrs[s].value=='number'?'px':'');if(r.attrs.height&&r.attrs.height.auto)r.attrs.height.value=j._get_box_height(this.obj);if(r.attrs.width&&r.attrs.width.auto)r.attrs.width.value=j._get_box_width(this.obj);}r.started=true;if(r.blind)this._build_container();}var t=(k-r.start)/r.duration;if(t>=1){t=1;if(r.hide)this._hide();}else l=false;var u=r.ease?r.ease(t):t;if(!m&&t!=1&&r.blind)m=true;if(n&&this.obj.parentNode){var v=this.obj.parentNode,w=this.obj.nextSibling;v.removeChild(this.obj);}for(var s in r.attrs)switch(s){case 'backgroundColor':case 'borderColor':case 'color':this.obj.style[s]='rgb('+j.calc_tween(u,r.attrs[s].start[0],r.attrs[s].value[0],true)+','+j.calc_tween(u,r.attrs[s].start[1],r.attrs[s].value[1],true)+','+j.calc_tween(u,r.attrs[s].start[2],r.attrs[s].value[2],true)+')';break;case 'opacity':g.setStyle(this.obj,'opacity',j.calc_tween(u,r.attrs[s].start,r.attrs[s].value));break;case 'height':case 'width':this.obj.style[s]=u==1&&r.attrs[s].auto?'auto':j.calc_tween(u,r.attrs[s].start,r.attrs[s].value,true)+'px';break;case 'scrollLeft':case 'scrollTop':var x=this.obj===document.body;o=x?p(s):this.obj[s];if(r['last'+s]!==o){delete r.attrs[s];}else{var y=j.calc_tween(u,r.attrs[s].start,r.attrs[s].value,true);if(!x){y=this.obj[s]=y;}else{if(s=='scrollLeft'){a.scrollTo(y,p('scrollTop'));}else a.scrollTo(p('scrollLeft'),y);y=p(s);}r['last'+s]=y;}break;default:this.obj.style[s]=j.calc_tween(u,r.attrs[s].start,r.attrs[s].value,true)+'px';break;}if(t==1){this.queue.splice(q--,1);this._callback(r.ondone,k-r.start-r.duration);}}if(n)v[w?'insertBefore':'appendChild'](this.obj,w);if(!m&&this.container_div)this._destroy_container();return !l;};j.prototype.ondone=function(k){this.state.ondone=k;return this;};j.prototype._callback=function(k,l){if(k){j.offset=l;k.call(this);j.offset=0;}};j.calc_tween=function(k,l,m,n){return (n?parseInt:parseFloat)((m-l)*k+l,10);};j.parse_color=function(k){var l=/^#([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2})$/i.exec(k);if(l){return [parseInt(l[1].length==1?l[1]+l[1]:l[1],16),parseInt(l[2].length==1?l[2]+l[2]:l[2],16),parseInt(l[3].length==1?l[3]+l[3]:l[3],16)];}else{var m=/^rgba? *\(([0-9]+), *([0-9]+), *([0-9]+)(?:, *([0-9]+))?\)$/.exec(k);if(m){if(m[4]==='0'){return [255,255,255];}else return [parseInt(m[1],10),parseInt(m[2],10),parseInt(m[3],10)];}else if(k=='transparent'){return [255,255,255];}else throw 'Named color attributes are not supported.';}};j.parse_group=function(k){k=k.trim().split(/ +/);if(k.length==4){return k;}else if(k.length==3){return [k[0],k[1],k[2],k[1]];}else if(k.length==2){return [k[0],k[1],k[0],k[1]];}else return [k[0],k[0],k[0],k[0]];};j.push=function(k){if(!j.active)j.active=[];j.active.push(k);if(j.active.length===1){if(!j.requestAnimationFrame){var l=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;if(l)j.requestAnimationFrame=l.bind(a);}if(j.requestAnimationFrame){j.requestAnimationFrame(j._animate);}else j.timeout=setInterval(j._animate,j.resolution,false);}if(j.requestAnimationFrame)j._updateEndingTimer();j._animate(Date.now(),true);};j._updateEndingTimer=function(){if(!j.requestAnimationFrame)throw new Error('Ending timer only valid with requestAnimationFrame');var k=0;for(var l=0;l<j.active.length;l++){var m=j.active[l];for(var n=0;n<m.queue.length;n++){var o=m.queue[n].start+m.queue[n].duration;if(o>k)k=o;}}if(j.timeout){clearTimeout(j.timeout);delete j.timeout;}var p=Date.now();if(k>p)j.timeout=setTimeout(j._animate.shield(),k-p,false);};j._animate=function(k,l){k=k||Date.now();for(var m=(l===true)?j.active.length-1:0;m<j.active.length;m++)try{if(!j.active[m]._frame(k))j.active.splice(m--,1);}catch(n){j.active.splice(m--,1);}if(j.active.length===0){if(j.timeout){if(j.requestAnimationFrame){clearTimeout(j.timeout);}else clearInterval(j.timeout);delete j.timeout;}}else if(j.requestAnimationFrame)j.requestAnimationFrame(j._animate);};j.ease={};j.ease.begin=function(k){return Math.sin(Math.PI/2*(k-1))+1;};j.ease.end=function(k){return Math.sin(.5*Math.PI*k);};j.ease.both=function(k){return .5*Math.sin(Math.PI*(k-.5))+.5;};j.prependInsert=function(k,l){j.insert(k,l,h.prependContent);};j.appendInsert=function(k,l){j.insert(k,l,h.appendContent);};j.insert=function(k,l,m){g.setStyle(l,'opacity',0);m(k,l);new j(l).from('opacity',0).to('opacity',1).duration(400).go();};e.exports=j;});
__d("css-support",["css-core","copyProperties"],function(a,b,c,d,e,f){var g=b('css-core'),h=b('copyProperties');h(g,{supportsBorderRadius:function(){var i=['KhtmlBorderRadius','OBorderRadius','MozBorderRadius','WebkitBorderRadius','msBorderRadius','borderRadius'],j=false,k=document.createElement('div');for(var l=i.length;l>=0;l--)if(j=k.style[i[l]]!==undefined)break;g.supportsBorderRadius=bagof(j);return j;}});e.exports=g;},3);
__d("DOMPosition",["DOMQuery"],function(a,b,c,d,e,f){var g=b("DOMQuery"),h={getScrollPosition:function(){var i=g.getDocumentScrollElement();return {x:i.scrollLeft,y:i.scrollTop};},getElementPosition:function(i){if(!i)return;if(!('getBoundingClientRect' in i))return {x:0,y:0};var j=i.getBoundingClientRect(),k=document.documentElement,l=Math.round(j.left)-k.clientLeft,m=Math.round(j.top)-k.clientTop;return {x:l,y:m};}};e.exports=h;});
__d("Form",["event-extensions","ArrayUtils","AsyncRequest","AsyncResponse","DOMPosition","DOMQuery","DataStore","Env","Input","Parent","URI","trackReferrer"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ArrayUtils"),h=b("AsyncRequest"),i=b("AsyncResponse"),j=b("DOMPosition"),k=b("DOMQuery"),l=b("DataStore"),m=b("Env"),n=b("Input"),o=b("Parent"),p=b("URI"),q=b("trackReferrer"),r={getInputs:function(s){s=s||document;return [].concat(g.createFrom(k.scry(s,'input')),g.createFrom(k.scry(s,'select')),g.createFrom(k.scry(s,'textarea')),g.createFrom(k.scry(s,'button')));},getSelectValue:function(s){return s.options[s.selectedIndex].value;},setSelectValue:function(s,t){for(var u=0;u<s.options.length;++u)if(s.options[u].value==t){s.selectedIndex=u;break;}},getRadioValue:function(s){for(var t=0;t<s.length;t++)if(s[t].checked)return s[t].value;return null;},getElements:function(s){return g.createFrom(s.tagName=='FORM'?s.elements:r.getInputs(s));},getAttribute:function(s,t){return (s.getAttributeNode(t)||{}).value||null;},setDisabled:function(s,t){r.getElements(s).forEach(function(u){if(u.disabled!=undefined){var v=l.get(u,'origDisabledState');if(t){if(v===undefined)l.set(u,'origDisabledState',u.disabled);u.disabled=t;}else if(v!==true)u.disabled=false;}});},bootstrap:function(s,t){var u=(r.getAttribute(s,'method')||'GET').toUpperCase();t=o.byTag(t,'button')||t;var v=o.byClass(t,'stat_elem')||s;if(CSS.hasClass(v,'async_saving'))return;if(t&&(t.form!==s||(t.nodeName!='INPUT'&&t.nodeName!='BUTTON')||t.type!='submit')){var w=k.scry(s,'.enter_submit_target')[0],x=t;w&&(t=w);}var y=r.serialize(s,t);r.setDisabled(s,true);var z=r.getAttribute(s,'ajaxify')||r.getAttribute(s,'action');q(s,z);var aa=new h(z);aa.setData(y).setNectarModuleDataSafe(s).setReadOnly(u=='GET').setMethod(u).setRelativeTo(s).setStatusElement(v).setInitialHandler(r.setDisabled.curry(s,false)).setHandler(function(ba){Event.fire(s,'success',{response:ba});}).setErrorHandler(function(ba){if(Event.fire(s,'error',{response:ba})!==false)i.defaultErrorHandler(ba);}).setFinallyHandler(r.setDisabled.curry(s,false)).send();},serialize:function(s,t){var u={};r.getElements(s).forEach(function(v){if(v.name&&!v.disabled&&v.type!='submit')if(!v.type||((v.type=='radio'||v.type=='checkbox')&&v.checked)||v.type=='text'||v.type=='password'||v.type=='hidden'||v.tagName=='TEXTAREA'){r._serializeHelper(u,v.name,n.getValue(v));}else if(v.tagName=='SELECT')for(var w=0,x=v.options.length;w<x;++w){var y=v.options[w];if(y.selected)r._serializeHelper(u,v.name,y.value);}});if(t&&t.name&&'submit'==t.type&&k.contains(s,t)&&k.isNodeOfType(t,['input','button']))r._serializeHelper(u,t.name,t.value);return r._serializeFix(u);},_serializeHelper:function(s,t,u){var v=/([^\]]+)\[([^\]]*)\](.*)/.exec(t);if(v){s[v[1]]=s[v[1]]||{};if(v[2]==''){var w=0;while(s[v[1]][w]!=undefined)w++;}else w=v[2];if(v[3]==''){s[v[1]][w]=u;}else r._serializeHelper(s[v[1]],w.concat(v[3]),u);}else s[t]=u;},_serializeFix:function(s){var t=[];for(var u in s){if(s[u] instanceof Object)s[u]=r._serializeFix(s[u]);t.push(u);}if(t.length>0){var v=0,w=true;t.sort().each(function(y){if(y!=v++)w=false;});if(w){var x=[];t.each(function(y){x[y]=s[y];});return x;}}return s;},post:function(s,t,u){var v=document.createElement('form');v.action=s.toString();v.method='POST';v.style.display='none';if(u)v.target=u;t.fb_dtsg=m.fb_dtsg;r.createHiddenInputs(t,v);k.getRootElement().appendChild(v);v.submit();return false;},createHiddenInputs:function(s,t,u,v){u=u||{};var w,x=p.implodeQuery(s,'',false),y=x.split('&');for(var z=0;z<y.length;z++)if(y[z]){var aa=y[z].split('='),ba=aa[0],ca=aa[1];if(ba===undefined||ca===undefined)continue;ca=p.decodeComponent(ca);if(u[ba]&&v){u[ba].value=ca;}else{w=$N('input',{type:'hidden',name:ba,value:ca});u[ba]=w;t.appendChild(w);}}return u;},getFirstElement:function(s,t){t=t||['input[type="text"]','textarea','input[type="password"]','input[type="button"]','input[type="submit"]'];var u=[];for(var v=0;v<t.length;v++){u=k.scry(s,t[v]);for(var w=0;w<u.length;w++){var x=u[w];try{var z=j.getElementPosition(x);if(z.y>0&&z.x>0)return x;}catch(y){}}}return null;},focusFirst:function(s){var t=r.getFirstElement(s);if(t){t.focus();return true;}return false;}};e.exports=r;});
__d("Locale",["css"],function(a,b,c,d,e,f){var g=b("css"),h,i={isRTL:function(){if(h===undefined)h=('rtl'===g.getStyle(document.body,'direction'));return h;}};e.exports=i;});
__d("DOMDimensions",["DOMQuery"],function(a,b,c,d,e,f){var g=b("DOMQuery"),h={getElementDimensions:function(i){return {width:i.offsetWidth||0,height:i.offsetHeight||0};},getViewportDimensions:function(){var i=(window&&window.innerWidth)||(document&&document.documentElement&&document.documentElement.clientWidth)||(document&&document.body&&document.body.clientWidth)||0,j=(window&&window.innerHeight)||(document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0;return {width:i,height:j};},getDocumentDimensions:function(i){i=i||document;var j=g.getDocumentScrollElement(i),k=j.scrollWidth||0,l=j.scrollHeight||0;return {width:k,height:l};}};e.exports=h;});
__d("Vector",["event-extensions","DOMDimensions","DOMPosition","DOMQuery","Util","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("DOMDimensions"),h=b("DOMPosition"),i=b("DOMQuery"),j=b("Util"),k=b("copyProperties");function l(m,n,o){k(this,{x:parseFloat(m),y:parseFloat(n),domain:o||'pure'});}k(l.prototype,{toString:function(){return '('+this.x+', '+this.y+')';},add:function(m,n){if(arguments.length==1){if(m.domain!='pure')m=m.convertTo(this.domain);return this.add(m.x,m.y);}var o=parseFloat(m),p=parseFloat(n);return new l(this.x+o,this.y+p,this.domain);},mul:function(m,n){if(typeof n=="undefined")n=m;return new l(this.x*m,this.y*n,this.domain);},sub:function(m,n){if(arguments.length==1){return this.add(m.mul(-1));}else return this.add(-m,-n);},distanceTo:function(m){return this.sub(m).magnitude();},magnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y));},convertTo:function(m){if(m!='pure'&&m!='viewport'&&m!='document')return new l(0,0);if(m==this.domain)return new l(this.x,this.y,this.domain);if(m=='pure')return new l(this.x,this.y);if(this.domain=='pure')return new l(0,0);var n=l.getScrollPosition('document'),o=this.x,p=this.y;if(this.domain=='document'){o-=n.x;p-=n.y;}else{o+=n.x;p+=n.y;}return new l(o,p,m);},setElementPosition:function(m){var n=this.convertTo('document');m.style.left=parseInt(n.x)+'px';m.style.top=parseInt(n.y)+'px';return this;},setElementDimensions:function(m){return this.setElementWidth(m).setElementHeight(m);},setElementWidth:function(m){m.style.width=parseInt(this.x,10)+'px';return this;},setElementHeight:function(m){m.style.height=parseInt(this.y,10)+'px';return this;},scrollElementBy:function(m){if(m==document.body){window.scrollBy(this.x,this.y);}else{m.scrollLeft+=this.x;m.scrollTop+=this.y;}return this;}});k(l,{getEventPosition:function(m,n){n=n||'document';var o=Event.getPosition(m),p=new l(o.x,o.y,'document');return p.convertTo(n);},getScrollPosition:function(m){m=m||'document';var n=h.getScrollPosition();return new l(n.x,n.y,'document').convertTo(m);},getElementPosition:function(m,n){n=n||'document';var o;if(m!==i.getDocumentBodyElement()||m===document.body){o=h.getElementPosition(m);}else o={x:-m.scrollLeft,y:-m.scrollTop};return new l(o.x,o.y,'viewport').convertTo(n);},getElementDimensions:function(m){var n=g.getElementDimensions(m);return new l(n.width,n.height);},getViewportDimensions:function(){var m=g.getViewportDimensions();return new l(m.width,m.height,'viewport');},getDocumentDimensions:function(m){var n=g.getDocumentDimensions(m);return new l(n.width,n.height,'document');},deserialize:function(m){var n=m.split(',');return new l(n[0],n[1]);}});e.exports=l;});
__d("getOverlayZIndex",["css"],function(a,b,c,d,e,f){var g=b("css");function h(i,j){j=j||document.body;var k=[];while(i&&i!==j){k.push(i);i=i.parentNode;}if(i!==j)return 0;for(var l=k.length-1;l>=0;l--){var m=k[l];if(g.getStyle(m,'position')!='static'){var n=parseInt(g.getStyle(m,'z-index'),10);if(!isNaN(n))return n;}}return 0;}e.exports=h;});
__d("Dialog",["array-extensions","event-extensions","AjaxPipeRequest","Animation","Arbiter","ArrayUtils","AsyncRequest","Bootloader","Button","css-support","DOM","Form","HTML","Input","Keys","Locale","ObjectUtils","Parent","Run","ua","URI","Vector","bind","copyProperties","getOverlayZIndex","tx"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("AjaxPipeRequest"),h=b("Animation"),i=b("Arbiter"),j=b("ArrayUtils"),k=b("AsyncRequest"),l=b("Bootloader"),m=b("Button"),n=b("css-support"),o=b("DOM"),p=b("Form"),q=b("HTML"),r=b("Input"),s=b("Keys"),t=b("Locale"),u=b("ObjectUtils"),v=b("Parent"),w=b("Run"),x=b("ua"),y=b("URI"),z=b("Vector"),aa=b("bind"),ba=b("copyProperties"),ca=b("getOverlayZIndex"),da=b("tx"),ea=function(){var ga=document.body,ha=document.createElement('div'),ia=document.createElement('div');ga.insertBefore(ha,ga.firstChild);ga.insertBefore(ia,ga.firstChild);ha.style.position='fixed';ha.style.top='20px';var ja=ha.offsetTop!==ia.offsetTop;ga.removeChild(ha);ga.removeChild(ia);ea=bagof(ja);return ja;};function fa(ga){this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+fa._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._shim=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(ga)this._setFromModel(ga);fa._init();}ba(fa,{OK:{name:'ok',label:"Okay"},CANCEL:{name:'cancel',label:"Cancel",className:'inputaux'},CLOSE:{name:'close',label:"Close"},NEXT:{name:'next',label:"Next"},SAVE:{name:'save',label:"Save"},SUBMIT:{name:'submit',label:"Submit"},CONFIRM:{name:'confirm',label:"Confirm"},DELETE:{name:'delete',label:"Delete"},_globalCount:0,_bottoms:[0],max_bottom:0,_updateMaxBottom:function(){fa.max_bottom=Math.max.apply(Math,fa._bottoms);}});ba(fa,{OK_AND_CANCEL:[fa.OK,fa.CANCEL],_STANDARD_BUTTONS:[fa.OK,fa.CANCEL,fa.CLOSE,fa.SAVE,fa.SUBMIT,fa.CONFIRM,fa.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[],_isUsingCSSBorders:function(){return n.supportsBorderRadius()||x.ie()<7;},newButton:function(ga,ha,ia,ja){var ka={name:ga,label:ha};if(ia)ka.className=ia;if(ja)ka.handler=ja;return ka;},getCurrent:function(){var ga=fa._stack;return ga.length?ga[ga.length-1]:null;},hideCurrent:function(){var ga=fa.getCurrent();ga&&ga.hide();},bootstrap:function(ga,ha,ia,ja,ka,la){ha=ha||{};var ma=la&&la.rel=='dialog-pipe';ba(ha,new y(ga).getQueryData());ja=ja||(ia?'GET':'POST');var na=v.byClass(la,'stat_elem')||la;if(na&&n.hasClass(na,'async_saving'))return false;var oa;if(ma){oa=new g();}else oa=new k().setReadOnly(!!ia).setMethod(ja).setRelativeTo(la).setStatusElement(na);oa.setURI(ga).setNectarModuleDataSafe(la).setData(ha);var pa=new fa(ka).setCausalElement(la).setAsync(oa,ma);pa.show();return false;},_init:function(){this._init=bagofholding;w.onLeave(fa._tearDown.shield(null,false));i.subscribe('page_transition',fa._tearDown.shield(null,true));Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)==s.ESC&&!event.getModifiers().any){if(fa._escape())event.kill();}else if(Event.getKeyCode(event)==s.RETURN&&!event.getModifiers().any)if(fa._enter())event.kill();});Event.listen(window,'resize',function(event){var ga=fa.getCurrent();ga&&ga._resetDialogObj();});},_findButton:function(ga,ha){if(ga)for(var ia=0;ia<ga.length;++ia)if(ga[ia].name==ha)return ga[ia];return null;},_tearDown:function(ga){var ha=fa._stack.slice();for(var ia=ha.length-1;ia>=0;ia--)if((ga&&!ha[ia]._cross_transition)||(!ga&&!ha[ia]._cross_quickling))ha[ia].hide();},_escape:function(){var ga=fa.getCurrent();if(!ga)return false;var ha=ga._semi_modal,ia=ga._buttons;if(!ia.length&&!ha)return false;if(ha&&!ia.length){ga.hide();return true;}var ja,ka=fa._findButton(ia,'cancel');if(ga._cancelHandler){ga.cancel();return true;}else if(ka){ja=ka;}else if(ia.length==1){ja=ia[0];}else return false;ga._handleButton(ja);return true;},_enter:function(){var ga=fa.getCurrent();if(!ga||!ga._submit_on_enter)return false;if(document.activeElement!=ga._frame)return false;var ha=ga._buttons;if(!ha)return false;ga._handleButton(ha[0]);return true;},call_or_eval:function(ga,ha,ia){if(!ha)return undefined;ia=ia||{};if(typeof ha=='string'){var ja=u.getKeys(ia).join(', ');ha=(eval)('({f: function('+ja+') { '+ha+'}})').f;}return ha.apply(ga,u.getValues(ia));}});ba(fa.prototype,{_cross_quickling:false,_cross_transition:false,_loading:false,_showing:false,show:function(){this._showing=true;if(this._async_request){if(this._show_loading)this.showLoading();}else this._update();return this;},showLoading:function(){this._loading=true;n.addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;},hide:function(){if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&fa._stack.length<=1){this._fadeOut();}else this._hide();return this;},cancel:function(){if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();},getRoot:function(){return this._obj;},getBody:function(){return o.scry(this._obj,'div.dialog_body')[0];},getButtonElement:function(ga){if(typeof ga=='string')ga=fa._findButton(this._buttons,ga);if(!ga||!ga.name)return null;var ha=o.scry(this._popup,'input'),ia=function(ja){return ja.name==ga.name;};return ha.filter(ia)[0]||null;},getContentNode:function(){return o.find(this._content,'div.dialog_content');},getFormData:function(){return p.serialize(this.getContentNode());},setAllowCrossPageTransition:function(ga){this._cross_transition=ga;return this;},setAllowCrossQuicklingNavigation:function(ga){this._cross_quickling=ga;return this;},setShowing:function(){this.show();return this;},setHiding:function(){this.hide();return this;},setTitle:function(ga){var ha=this._nodes.title,ia=this._nodes.title_inner,ja=this._nodes.content;o.setContent(ia,this._format(ga||''));n.conditionShow(ha,!!ga);n.conditionClass(ja,'dialog_content_titleless',!ga);return this;},setBody:function(ga){o.setContent(this._nodes.body,this._format(ga));return this;},setExtraData:function(ga){this._extra_data=ga;return this;},setReturnData:function(ga){this._return_data=ga;return this;},setShowLoading:function(ga){this._show_loading=ga;return this;},setFullBleed:function(ga){this._full_bleed=ga;this._updateWidth();n.conditionClass(this._obj,'full_bleed',ga);return this;},setCausalElement:function(ga){this._causal_elem=ga;return this;},setUserData:function(ga){this._user_data=ga;return this;},getUserData:function(){return this._user_data;},setAutohide:function(ga){if(ga){if(this._showing){this._autohide_timeout=setTimeout(this.hide.shield(this),ga);}else this._autohide=ga;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;},setSummary:function(ga){var ha=this._nodes.summary;o.setContent(ha,this._format(ga||''));n.conditionShow(ha,!!ga);return this;},setButtons:function(ga){var ha,ia;if(!(ga instanceof Array)){ha=j.createFrom(arguments);}else ha=ga;for(var ja=0;ja<ha.length;++ja)if(typeof ha[ja]=='string'){ia=fa._findButton(fa._STANDARD_BUTTONS,ha[ja]);ha[ja]=ia;}this._buttons=ha;var ka=[];if(ha&&ha.length>0)for(var la=0;la<ha.length;la++){ia=ha[la];var ma=o.$N('input',{type:'button',name:ia.name||'',value:ia.label}),na=o.$N('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},ma);if(ia.className){ia.className.split(/\s+/).each(function(pa){n.addClass(na,pa);});if(n.hasClass(na,'inputaux')){n.removeClass(na,'inputaux');n.removeClass(na,'uiButtonConfirm');}if(n.hasClass(na,'uiButtonSpecial'))n.removeClass(na,'uiButtonConfirm');}if(ia.icon)o.prependContent(na,o.$N('img',{src:ia.icon,className:'img mrs'}));if(ia.disabled)m.setEnabled(na,false);Event.listen(ma,'click',this._handleButton.bind(this,ia.name));for(var oa in ia)if(oa.indexOf('data-')===0&&oa.length>5)ma.setAttribute(oa,ia[oa]);ka.push(na);}o.setContent(this._nodes.buttons,ka);this._updateButtonVisibility();return this;},setButtonsMessage:function(ga){o.setContent(this._nodes.button_message,this._format(ga||''));this._has_button_message=!!ga;this._updateButtonVisibility();return this;},_updateButtonVisibility:function(){var ga=this._buttons.length>0||this._has_button_message;n.conditionShow(this._nodes.button_wrapper,ga);n.conditionClass(this._obj,'omitDialogFooter',!ga);},setClickButtonOnEnter:function(ga,ha){this._clickOnEnterTarget=ga;if(!this._clickOnEnterListener)this._clickOnEnterListener=Event.listen(this._nodes.body,'keypress',function(event){var ia=event.getTarget();if(ia&&ia.id===this._clickOnEnterTarget)if(Event.getKeyCode(event)==s.RETURN){this._handleButton(ha);event.kill();}return true;}.bind(this));return this;},setStackable:function(ga,ha){this._is_stackable=ga;this._shown_while_stacked=ga&&ha;return this;},setHandler:function(ga){this._handler=ga;return this;},setCancelHandler:function(ga){this._cancelHandler=fa.call_or_eval.bind(null,this,ga);return this;},setCloseHandler:function(ga){this._close_handler=fa.call_or_eval.bind(null,this,ga);return this;},clearHandler:function(){return this.setHandler(null);},setPostURI:function(ga,ha){if(ha===undefined)ha=true;if(ha){this.setHandler(this._submitForm.bind(this,'POST',ga));}else this.setHandler(function(){p.post(ga,this.getFormData());this.hide();}.bind(this));return this;},setGetURI:function(ga){this.setHandler(this._submitForm.bind(this,'GET',ga));return this;},setModal:function(ga){this._modal=ga;n.conditionClass(this._obj,'generic_dialog_modal',ga);return this;},setSemiModal:function(ga){if(ga){this.setModal(true);this._semiModalListener=Event.listen(this._obj,'click',function(ha){if(!o.contains(this._popup,ha.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=ga;return this;},setWideDialog:function(ga){this._wide_dialog=ga;this._updateWidth();return this;},setContentWidth:function(ga){this._content_width=ga;this._updateWidth();return this;},setTitleLoading:function(ga){if(ga===undefined)ga=true;var ha=o.find(this._popup,'h2.dialog_title');if(ha)n.conditionClass(ha,'loading',ga);return this;},setSecure:function(ga){n.conditionClass(this._nodes.title,'secure',ga);return this;},setClassName:function(ga){ga.split(/\s+/).each(n.addClass.bind(n,this._obj));return this;},setFadeEnabled:function(ga){this._fade_enabled=ga;return this;},setFooter:function(ga){var ha=this._nodes.footer;o.setContent(ha,this._format(ga||''));n.conditionShow(ha,!!ga);return this;},setAutoFocus:function(ga){this._auto_focus=ga;return this;},setTop:function(ga){this._top=ga;this._resetDialogObj();return this;},onloadRegister:function(ga){j.createFrom(ga).forEach(function(ha){if(typeof ha=='string')ha=new Function(ha);this._onload_handlers.push(ha.bind(this));}.bind(this));return this;},setAsyncURL:function(ga){return this.setAsync(new k(ga));},setAsync:function(ga,ha){var ia=function(qa){if(this._async_request!=ga)return;this._async_request=null;var ra=qa.getPayload(),sa=ra,ta=function(){if(this._loading)this._showing=true;if(typeof sa=='string'){this.setBody(sa);}else this._setFromModel(sa);this._update();}.bind(this);if(ha){sa=ra.dialog;l.setResourceMap(ra.resource_map);l.loadResources(ra.css,ta);}else ta();}.bind(this),ja=ga.getData();ja.__d=1;ga.setData(ja);var ka;if(ha){ga.setFirstResponseHandler(ia);ka=ga.getAsyncRequest();}else{var la=ga.getHandler()||bagofholding;ga.setHandler(function(qa){la(qa);ia(qa);});ka=ga;}var ma=ka.getErrorHandler()||bagofholding,na=ka.getTransportErrorHandler()||bagofholding,oa=function(){this._async_request=null;this._loading=false;if(this._showing&&this._shown_while_stacked){this._update();}else this._hide(this._is_stackable);}.bind(this),pa=ka.getServerDialogCancelHandler()||oa;ka.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(qa){oa();ma(qa);}).setTransportErrorHandler(function(qa){oa();na(qa);}).setServerDialogCancelHandler(pa);ga.send();this._async_request=ga;if(this._showing)this.show();return this;},_format:function(ga){if(typeof ga=='string'){ga=q(ga);}else ga=q.replaceJSONWrapper(ga);if(ga instanceof q)ga.setDeferred(true);return ga;},_update:function(){if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(aa(this,'hide'),this._autohide);n.removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;r.focus(this._frame);},_runOnloads:function(){for(var ga=0;ga<this._onload_handlers.length;++ga)try{this._onload_handlers[ga]();}catch(ha){}this._onload_handlers=[];},_updateWidth:function(){var ga=2*fa._BORDER_WIDTH;if(fa._isUsingCSSBorders())ga+=2*fa._HALO_WIDTH;if(this._content_width){ga+=this._content_width;if(!this._full_bleed)ga+=2*fa._PADDING_WIDTH;}else if(this._wide_dialog){ga+=fa.SIZE.WIDE;}else ga+=fa.SIZE.STANDARD;this._popup.style.width=ga+'px';},_updateZIndex:function(){if(!this._hasSetZIndex&&this._causal_elem){var ga=ca(this._causal_elem);this._hasSetZIndex=ga>(this._modal?400:200);n.setStyle(this._obj,'z-index',this._hasSetZIndex?ga:'');}},_renderDialog:function(){this._updateZIndex();this._pushOntoStack();this._obj.style.height=(this._modal&&x.ie()<7)?z.getDocumentDimensions().y+'px':null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);this._submit_on_enter=false;if(this._auto_focus){var ga=p.getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(ga){p.focusFirst.bind(this,this._content).defer();}else this._submit_on_enter=true;}var ha=z.getElementDimensions(this._content).y+z.getElementPosition(this._content).y;fa._bottoms.push(ha);this._bottom=ha;fa._updateMaxBottom();return this;},_buildDialog:function(){this._obj=o.$N('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';o.appendContent(o.getDocumentBodyElement(),this._obj);if(!this._popup)this._popup=o.$N('div',{className:'generic_dialog_popup'});this._obj.appendChild(this._popup);if(x.ie()<7&&!this._shim)l.loadModules(["IframeShim"],function(sa){this._shim=new sa(this._popup);});n.addClass(this._obj,'pop_dialog');if(t.isRTL())n.addClass(this._obj,'pop_dialog_rtl');var ga;if(fa._isUsingCSSBorders()){ga='<div class="pop_container_advanced">'+'<div class="pop_content" id="pop_content"></div>'+'</div>';}else ga='<div class="pop_container">'+'<div class="pop_verticalslab"></div>'+'<div class="pop_horizontalslab"></div>'+'<div class="pop_topleft"></div>'+'<div class="pop_topright"></div>'+'<div class="pop_bottomright"></div>'+'<div class="pop_bottomleft"></div>'+'<div class="pop_content pop_content_old" id="pop_content"></div>'+'</div>';o.setContent(this._popup,q(ga));var ha=o.find(this._popup,'div.pop_content');ha.setAttribute('tabIndex','0');ha.setAttribute('role','alertdialog');this._frame=this._content=ha;var ia=o.$N('div',{className:'dialog_loading'},"Loading..."),ja=o.$N('span'),ka=o.$N('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},ja),la=o.$N('div',{className:'dialog_summary hidden_elem'}),ma=o.$N('div',{className:'dialog_body'}),na=o.$N('div'),oa=o.$N('div',{className:'dialog_buttons_msg'}),pa=o.$N('div',{className:'dialog_buttons clearfix hidden_elem'},[oa,na]),qa=o.$N('div',{className:'dialog_footer hidden_elem'}),ra=o.$N('div',{className:'dialog_content'},[la,ma,pa,qa]);this._nodes={summary:la,body:ma,buttons:na,button_message:oa,button_wrapper:pa,footer:qa,content:ra,title:ka,title_inner:ja};o.setContent(this._frame,[ka,ra,ia]);},_updateShim:function(){return this._shim&&this._shim.show();},_activeResize:function(){if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}},resetDialogPosition:function(){if(!this._popup)return;this._resetDialogObj();this._updateShim();},_resetDialogObj:function(){var ga=2*fa._PAGE_MARGIN,ha=z.getViewportDimensions(),ia=ha.x-ga,ja=ha.y-ga,ka=2*fa._HALO_WIDTH,la=z.getElementDimensions(this._content),ma=la.x+ka,na=la.y+ka,oa=this._top,pa=ia-ma,qa=ja-na;if(qa<0){oa=fa._PAGE_MARGIN;}else if(oa>qa)oa=fa._PAGE_MARGIN+(Math.max(qa,0)/2);var ra=ea();if(!ra)oa+=z.getScrollPosition().y;n.setStyle(this._popup,'marginTop',oa+'px');var sa=ra&&(pa<0||qa<0);n.conditionClass(this._obj,'generic_dialog_fixed_overflow',sa);n.conditionClass(document.documentElement,'generic_dialog_overflow_mode',sa);},_fadeOut:function(ga){if(!this._popup)return;try{new h(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,ga)).go();}catch(ha){this._hide(ga);}},_hide:function(ga){if(this._obj)this._obj.style.display='none';n.removeClass(document.documentElement,'generic_dialog_overflow_mode');this._updateShim();clearInterval(this.active_hiding);if(this._bottom){var ha=fa._bottoms;ha.splice(ha.indexOf(this._bottom),1);fa._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&o.contains(this._obj,document.activeElement))r.focus(this._previous_focus);if(ga)return;this.destroy();},destroy:function(){this._popFromStack();if(this._obj){o.remove(this._obj);this._obj=null;this._shim&&this._shim.hide();this._shim=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});},_handleButton:function(ga){if(typeof ga=='string')ga=fa._findButton(this._buttons,ga);var ha=fa.call_or_eval(ga,ga.handler);if(ha===false)return;if(ga.name=='cancel'){this.cancel();}else if(fa.call_or_eval(this,this._handler,{button:ga})!==false)this.hide();},_submitForm:function(ga,ha,ia){var ja=this.getFormData();if(ia)ja[ia.name]=ia.label;if(this._extra_data)ba(ja,this._extra_data);var ka=new k().setURI(ha).setData(ja).setMethod(ga).setNectarModuleDataSafe(this._causal_elem).setReadOnly(ga=='GET');this.setAsync(ka);return false;},_setFromModel:function(ga){var ha={};ba(ha,ga);for(var ia in ha){if(ia=='onloadRegister'){this.onloadRegister(ha[ia]);continue;}var ja=this['set'+ia.substr(0,1).toUpperCase()+ia.substr(1)];ja.apply(this,j.createFrom(ha[ia]));}},_updateBottom:function(){var ga=z.getElementDimensions(this._content).y+z.getElementPosition(this._content).y;fa._bottoms[fa._bottoms.length-1]=ga;fa._updateMaxBottom();},_pushOntoStack:function(){var ga=fa._stack;if(!ga.length)i.inform('layer_shown',{type:'Dialog'});ga.remove(this);ga.push(this);for(var ha=ga.length-2;ha>=0;ha--){var ia=ga[ha];if(!ia._is_stackable&&!ia._async_request){ia._hide();}else if(!ia._shown_while_stacked)ia._hide(true);}},_popFromStack:function(){var ga=fa._stack,ha=(ga[ga.length-1]===this);ga.remove(this);if(ga.length){if(ha)ga[ga.length-1].show();}else i.inform('layer_hidden',{type:'Dialog'});}});e.exports=fa;});
__d("DOMScroll",["Animation","css","DOM","Vector","ge"],function(a,b,c,d,e,f){var g=b("Animation"),h=b("css"),i=b("DOM"),j=b("Vector"),k=i.$N,l=b("ge"),m={getScrollState:function(){var n=j.getViewportDimensions(),o=j.getDocumentDimensions(),p=(o.x>n.x),q=(o.y>n.y);p+=0;q+=0;return new j(p,q);},_scrollbarSize:null,_initScrollbarSize:function(){var n=k('p');n.style.width='100%';n.style.height='200px';var o=k('div');o.style.position='absolute';o.style.top='0px';o.style.left='0px';o.style.visibility='hidden';o.style.width='200px';o.style.height='150px';o.style.overflow='hidden';o.appendChild(n);document.body.appendChild(o);var p=n.offsetWidth;o.style.overflow='scroll';var q=n.offsetWidth;if(p==q)q=o.clientWidth;document.body.removeChild(o);m._scrollbarSize=p-q;},getScrollbarSize:function(){if(m._scrollbarSize===null)m._initScrollbarSize();return m._scrollbarSize;},scrollTo:function(n,o,p,q,r){if(typeof o=='undefined'||o===true)o=750;if(!(n instanceof j)){var s=j.getScrollPosition().x,t=j.getElementPosition(l(n)).y;n=new j(s,t,'document');if(!q){var u=l('blueBar'),v=l('blueBarHolder');if(u&&h.isFixed(u))n.y-=j.getElementDimensions(v).y/(p?2:1);}}if(p){n.y-=j.getViewportDimensions().y/2;}else if(q){n.y-=j.getViewportDimensions().y;n.y+=q;}n=n.convertTo('document');if(o){var w=i.getDocumentBodyElement();new g(w).to('scrollTop',n.y).to('scrollLeft',n.x).ease(g.ease.end).duration(o).ondone(r).go();}else if(window.scrollTo){window.scrollTo(n.x,n.y);r&&r();}},scrollToTop:function(n){var o=j.getScrollPosition();m.scrollTo(new j(o.x,0,'document'),n!==false);}};e.exports=m;});
__d("HistoryManager",["event-extensions","function-extensions","Cookie","Env","ua","URI","copyProperties","goOrReplace"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("Cookie"),h=b("Env"),i=b("ua"),j=b("URI"),k=b("copyProperties"),l=b("goOrReplace"),m={_IFRAME_BASE_URI:'http://static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(n){n=n.toString();var o=m.history.length-1;m.iframe.src=m._IFRAME_BASE_URI+'?|index='+o+'#'+encodeURIComponent(n);return m;},getIframeSrcFragment:function(){return decodeURIComponent(j(m.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(n,o){if(o){m._setIframeSrcFragment(n);return;}if(n!==undefined){m.iframeQueue.push(n);}else{m.iframeQueue.splice(0,1);m.iframeTimeout=null;m.checkURI();}if(m.iframeQueue.length&&!m.iframeTimeout){var p=m.iframeQueue[0];m.iframeTimeout=setTimeout(function(){m._setIframeSrcFragment(p);},100,false);}},isInitialized:function(){return !!m._initialized;},init:function(){if(!h.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(m._initialized)return m;var n=j(),o=n.getFragment()||'';if(o.charAt(0)==='!'){o=o.substr(1);n.setFragment(o);}if(j.getRequestURI(false).getProtocol().toLowerCase()=='https')m._IFRAME_BASE_URI='https://s-static.ak.facebook.com/common/history_manager.php';k(m,{_initialized:true,fragment:o,orig_fragment:o,history:[n],callbacks:[],lastChanged:Date.now(),canonical:j('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(p){if(p&&p.state&&m.lastURI!=p.state){m.lastURI=p.state;m.lastChanged=Date.now();m.notify(j(p.state).getUnqualifiedURI().toString());}}.bind(m));if(i.safari()<534||i.chrome()<=13){setInterval(m.checkURI,42,false);m._updateRefererURI(this.lastURI);}return m;}m._updateRefererURI(j.getRequestURI(false));if(i.safari()<500||i.firefox()<2){m.enabled=false;return m;}if(i.ie()<8){m.iframe=document.createElement('iframe');k(m.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});m._setIframeSrcFragment(o);document.body.insertBefore(m.iframe,document.body.firstChild);}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){m.checkURI.bind(m).defer();});}else setInterval(m.checkURI,42,false);return m;},registerURIHandler:function(n){m.callbacks.push(n);return m;},setCanonicalLocation:function(n){m.canonical=j(n);return m;},notify:function(n){if(n==m.orig_fragment)n=m.canonical.getFragment();for(var o=0;o<m.callbacks.length;o++)try{if(m.callbacks[o](n))return true;}catch(p){}return false;},checkURI:function(){if(Date.now()-m.lastChanged<400)return;if(window.history&&history.pushState){var n=j(document.URL).removeQueryData('ref').toString(),o=j(m.lastURI).removeQueryData('ref').toString();if(n!=o){m.lastChanged=Date.now();m.lastURI=n;if(i.safari()<534)m._updateRefererURI(n);m.notify(j(n).getUnqualifiedURI().toString());}return;}if(i.ie()<8&&m.iframeQueue.length)return;if(i.safari()&&window.history.length==200){if(!m.warned)m.warned=true;return;}var p=j().getFragment();if(p.charAt(0)=='!')p=p.substr(1);if(i.ie()<8)p=m.getIframeSrcFragment();p=p.replace(/%23/g,'#');if(p!=m.fragment.replace(/%23/g,'#')){m.debug([p,' vs ',m.fragment,'whl: ',window.history.length,'QHL: ',m.history.length].join(' '));for(var q=m.history.length-1;q>=0;--q)if(m.history[q].getFragment().replace(/%23/g,'#')==p)break;++m.user;if(q>=0){m.go(q-m.current);}else m.go('#'+p);--m.user;}},_updateRefererURI:function(n){n=n.toString();if(n.charAt(0)!='/'&&n.indexOf('//')==-1)return;var o=new j(window.location);if(o.isFacebookURI()){var p=o.getPath()+window.location.search;}else var p='';var q=j(n).getQualifiedURI().setFragment(p).toString(),r=2048;if(q.length>r)q=q.substring(0,r)+'...';g.set('x-referer',q);},go:function(n,o,p){if(window.history&&history.pushState){o||typeof(n)=='number';var q=j(n).removeQueryData('ref').toString();m.lastChanged=Date.now();this.lastURI=q;if(p){window.history.replaceState(n,null,q);}else window.history.pushState(n,null,q);if(i.safari()<534)m._updateRefererURI(n);return false;}m.debug('go: '+n);if(o===undefined)o=true;if(!m.enabled)if(!o)return false;if(typeof(n)=='number'){if(!n)return false;var r=n+m.current,s=Math.max(0,Math.min(m.history.length-1,r));m.current=s;r=m.history[s].getFragment()||m.orig_fragment;r=j(r).removeQueryData('ref').getUnqualifiedURI().toString();m.fragment=r;m.lastChanged=Date.now();if(i.ie()<8){if(m.fragmentTimeout)clearTimeout(m.fragmentTimeout);m._temporary_fragment=r;m.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+r;delete m._temporary_fragment;},750,false);if(!m.user)m.nextframe(r,p);}else if(!m.user)l(window.location,window.location.href.split('#')[0]+'#!'+r,p);if(o)m.notify(r);m._updateRefererURI(r);return false;}n=j(n);if(n.getDomain()==j().getDomain())n=j('#'+n.getUnqualifiedURI());var t=m.history[m.current].getFragment(),u=n.getFragment();if(u==t||(t==m.orig_fragment&&u==m.canonical.getFragment())){if(o)m.notify(u);m._updateRefererURI(u);return false;}if(p)m.current--;var v=(m.history.length-m.current)-1;m.history.splice(m.current+1,v);m.history.push(j(n));return m.go(1,o,p);},getCurrentFragment:function(){var n=m._temporary_fragment!==undefined?m._temporary_fragment:j.getRequestURI(false).getFragment();return n==m.orig_fragment?m.canonical.getFragment():n;}};e.exports=m;});
__d("LinkController",["event-extensions","DataStore","Parent","trackReferrer"],function(a,b,c,d,e,f){b("event-extensions");var g=b("DataStore"),h=b("Parent"),i=b("trackReferrer"),j='LinkControllerHandler',k=[],l=[];function m(event){var q=h.byTag(event.getTarget(),'a'),r=q&&q.getAttribute('href',2);if(!r||q.rel||!o(r)||g.get(q,j))return;var s=Event.listen(q,'click',function(t){if(r.charAt(r.length-1)=='#'){t.prevent();return;}i(q,r);n(q,t);});g.set(q,j,s);}function n(q,event){if(q.target||event.getModifiers().any||(event.which&&event.which!=1))return;var r=k.concat(l);for(var s=0,t=r.length;s<t;s++)if(r[s](q,event)===false)return event.kill();}function o(q){var r=q.match(/^(\w+):/);return !r||r[1].match(/^http/i);}var p={registerHandler:function(q){k.push(q);},registerFallbackHandler:function(q){l.push(q);}};if(a.LinkController){e.exports=a.LinkController;}else{Event.listen(document.documentElement,'mousedown',m);Event.listen(document.documentElement,'keydown',m);e.exports=p;}});
__d("computeRelativeURI",["array-extensions","URI","Util","isEmpty"],function(a,b,c,d,e,f){b("array-extensions");var g=b("URI"),h=b("Util"),i=b("isEmpty");function j(l,m){if(!m)return l;if(m.charAt(0)=='/')return m;var n=l.split('/').slice(0,-1);n[0]!=='';m.split('/').forEach(function(o){if(!(o=='.'))if(o=='..'){if(n.length>1)n=n.slice(0,-1);}else n.push(o);});return n.join('/');}function k(l,m){var n=new g(),o=m;l=new g(l);m=new g(m);if(m.getDomain()&&!m.isFacebookURI())return o;var p=l,q=['Protocol','Domain','Port','Path','QueryData','Fragment'];q.forEach(function(r){var s=r=='Path'&&p===l;if(s)n.setPath(j(l.getPath(),m.getPath()));if(!i(m['get'+r]()))p=m;if(!s)n['set'+r](p['get'+r]());});return n;}e.exports=k;});
__d("PageTransitions",["event-extensions","function-extensions","string-extensions","Arbiter","Dialog","DOM","DOMScroll","Env","Form","HistoryManager","JSLogger","LinkController","ObjectUtils","ua","URI","Util","Vector","computeRelativeURI","copyProperties","ge","goOrReplace","userAction","tx"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");b("string-extensions");var g=b("Arbiter"),h=b("Dialog"),i=b("DOM"),j=b("DOMScroll"),k=b("Env"),l=b("Form"),m=b("HistoryManager"),n=b("JSLogger"),o=b("LinkController"),p=b("ObjectUtils"),q=b("ua"),r=b("URI"),s=b("Util"),t=b("Vector"),u=b("computeRelativeURI"),v=b("copyProperties"),w=b("ge"),x=b("goOrReplace"),y=b("userAction"),z=b("tx"),aa={_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!aa._initialized;},_init:function(){if(!k.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(aa._initialized)return aa;aa._initialized=true;var ca=r.getRequestURI(false),da=ca.getUnqualifiedURI(),ea=r(da).setFragment(null),fa=da.getFragment();if(fa.charAt(0)==='!'&&ea.toString()===fa.substr(1))da=ea;v(aa,{_current_uri:da,_most_recent_uri:da,_next_uri:da});var ga;if(ca.getFragment().startsWith('/')){ga=ca.getFragment();}else ga=da;m.init().setCanonicalLocation('#'+ga).registerURIHandler(aa._historyManagerHandler);o.registerFallbackHandler(aa._rewriteHref);o.registerFallbackHandler(aa._onlinkclick);Event.listen(document.documentElement,'submit',aa._onformsubmit);Event.listen(window,'scroll',function(){if(!aa._scroll_locked)aa._scroll_positions[aa._current_uri]=t.getScrollPosition();});return aa;},registerHandler:function(ca,da){aa._init();da=da||5;if(!aa._transition_handlers[da])aa._transition_handlers[da]=[];aa._transition_handlers[da].push(ca);},getCurrentURI:function(ca){if(!aa._current_uri&&!ca)return new r(aa._most_recent_uri);return new r(aa._current_uri);},getMostRecentURI:function(){return new r(aa._most_recent_uri);},getNextURI:function(){return new r(aa._next_uri);},_rewriteHref:function(ca){var da=ca.getAttribute('href'),ea=u(aa._most_recent_uri.getQualifiedURI(),da).toString();if(da!=ea)ca.setAttribute('href',ea);},_onlinkclick:function(ca){ba.lookBusy(ca);aa.go(ca.getAttribute('href'));return false;},_onformsubmit:function(event){var ca=event.getTarget();if(l.getAttribute(ca,'rel')||l.getAttribute(ca,'target'))return;var da=y('form',ca,event).set_namespace('page_transition');if(window.ArbiterMonitor)ArbiterMonitor.initUA(da,[ca]);var ea=new r(l.getAttribute(ca,'action')||''),fa=u(aa._most_recent_uri,ea);ca.setAttribute('action',fa.toString());if((l.getAttribute(ca,'method')||'GET').toUpperCase()==='GET'){aa.go(fa.addQueryData(l.serialize(ca)));event.kill();}},go:function(ca,da){var ea=new r(ca).removeQueryData('quickling').getQualifiedURI(),fa=ea.getUnqualifiedURI();delete aa._scroll_positions[fa];!da&&y('uri',{href:ea.toString()},null,'INDIRECT');ba.lookBusy();aa._loadPage(ea,function(ga){if(ga){m.go(ea.toString(),false,da);}else x(window.location,ea,da);});},_historyManagerHandler:function(ca){if(ca.charAt(0)!='/')return false;y('h',{href:ca},null);aa._loadPage(new r(ca),function(da){if(!da)x(window.location,ca,true);});return true;},_loadPage:function(ca,da){if(r(ca).getFragment()&&p.areEqual(r(ca).setFragment(null).getQualifiedURI(),r(aa._current_uri).setFragment(null).getQualifiedURI())){aa._current_uri=aa._most_recent_uri=ca;aa.restoreScrollPosition();ba.stopLookingBusy();return;}var ea=aa._scroll_positions[aa._current_uri];aa._current_uri=null;aa._next_uri=ca;if(ea)j.scrollTo(ea,false);var fa=function(){aa._scroll_locked=true;var ha=aa._handleTransition(ca);da&&da(ha);},ga=_runHooks('onbeforeleavehooks');if(ga){ba.stopLookingBusy();aa._warnBeforeLeaving(ga,fa);}else fa();},_handleTransition:function(ca){window.onbeforeleavehooks=undefined;ba.lookBusy();if(!ca.isSameOrigin())return false;var da=window.AsyncRequest&&window.AsyncRequest.getLastID();g.inform("pre_page_transition",{from:aa.getMostRecentURI(),to:ca});for(var ea=aa._transition_handlers.length-1;ea>=0;--ea){var fa=aa._transition_handlers[ea];if(!fa)continue;for(var ga=fa.length-1;ga>=0;--ga)if(fa[ga](ca)===true){var ha={sender:this,uri:ca,id:da};try{g.inform("page_transition",ha);}catch(ia){}return true;}else fa.splice(ga,1);}return false;},unifyURI:function(){aa._current_uri=aa._most_recent_uri=aa._next_uri;},transitionComplete:function(ca){aa._executeCompletionCallback();ba.stopLookingBusy();aa.unifyURI();if(!ca)aa.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(da){}},_executeCompletionCallback:function(){if(aa._completionCallback)aa._completionCallback();aa._completionCallback=null;},setCompletionCallback:function(ca){aa._completionCallback=ca;},rewriteCurrentURI:function(ca,da){aa.registerHandler(function(){if(ca==aa.getMostRecentURI().getUnqualifiedURI().toString()){aa.transitionComplete();return true;}});aa.go(da,true);},_warnBeforeLeaving:function(ca,da){new h().setTitle("Are you sure you want to leave this page?").setBody(htmlize(ca)).setButtons([{name:'leave_page',label:"Leave this Page",handler:da},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).setModal(true).show();},restoreScrollPosition:function(){aa._scroll_locked=false;var ca=aa._current_uri,da=aa._scroll_positions[ca];if(da){j.scrollTo(da,false);return;}function ea(ha){return (ha||null)&&(i.scry(document.body,"a[name='"+escape_js_quotes(ha)+"']")[0]||w(ha));}var fa=ea(r(ca).getFragment());if(fa){var ga=t.getElementPosition(fa);ga.x=0;j.scrollTo(ga);}}},ba=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(ca){if(ca)ba._giveProgressCursor(ca);if(ba._looking_busy)return;ba._looking_busy=true;ba._giveProgressCursor(document.documentElement);},stopLookingBusy:function(){if(!ba._looking_busy)return;ba._looking_busy=false;while(ba._original_cursors.length){var ca=ba._original_cursors.pop(),da=ca[0],ea=ca[1];if(da.style)da.style.cursor=ea||'';}},_giveProgressCursor:function(ca){if(!q.safari()){ba._original_cursors.push([ca,ca.style.cursor]);ca.style.cursor='progress';}}};e.exports=aa;});
__d("URLScraper",["event-extensions","ArbiterMixin","Class"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ArbiterMixin"),h=b("Class");function i(ca){this.input=ca;this.enable();}h.mixin(i,g,{reset:function(){this.lastMatch=null;},enable:function(){if(this.events)return;var ca=function(da){setTimeout(this.check.bind(this,da),30);};this.events=Event.listen(this.input,{paste:ca.bind(this,false),keydown:ca.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(ca){var da=this.input.value;if(ca&&i.trigger(da))return;var ea=i.match(da);if(ea&&ea!=this.lastMatch){this.lastMatch=ea;this.inform('match',{url:ea});}}});var j='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',k='\u2000-\u206F\u00ab\u00bb',l='(?:(?:ht|f)tps?)://',m='(?:(?:\\d{1,3}[.]){3}\\d{1,3})',n='(?:\\b)www\\d{0,3}[.]',o='[^\\s'+j+k+']',p='(?:(?:[.:\\-_%@]|'+o+')*'+o+')',q='(?:[.][a-z]{2,4})',r='(?::\\d+){0,1}',s='(?=[\/?#])',t='(?:'+'(?:'+l+p+r+')|'+'(?:'+m+r+')|'+'(?:'+n+p+q+r+')|'+'(?:'+p+q+r+s+')'+')',u='[\/#?]',v='\\([^\\s()<>]+\\)',w='[^\\s()<>]+',x='[^\\s'+j+k+']',y='(?:'+'(?:'+u+')'+'(?:'+'(?:'+v+'|'+w+')*'+'(?:'+v+'|'+x+')'+')*'+')*',z=new RegExp('('+'(?:'+t+')'+'(?:'+y+')'+')','im'),aa=new RegExp('('+'(?:'+l+p+r+')|'+'(?:'+n+p+q+r+')'+')'),ba=/[\s'";]/;i.match=function(ca){var da=(z.exec(ca)||[])[1]||null;if(da&&da.indexOf('@')!=-1){return (aa.exec(da))?da:null;}else return da;};i.trigger=function(ca){return !ba.test(ca.charAt(ca.length-1));};e.exports=i;});
__d("Composer",["function-extensions","json","Arbiter","ArbiterMixin","Button","Class","css","DOM","HTML","Input","PageTransitions","Parent","Run","ServerJS","URI","URLScraper","$","event-extensions","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('function-extensions');b('json');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Button'),j=b('Class'),k=b('css'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('PageTransitions'),p=b('Parent'),q=b('Run'),r=b('ServerJS'),s=b('URI'),t=b('URLScraper'),u=b('$'),v=b('event-extensions').$E,w=b('copyProperties'),x=b('ge'),y=b('tx'),z=1,aa=2,ba={},ca=function(){var ga=l.scry(this.root,'span.linkAttachment')[0];if(!ga&&this.isMetaComposer)ga=l.scry(this.root,'span.attachmentAcceptsLink')[0];if(!ga)return;var ha=p.byTag(ga,'form');this.scraper=new t(this.input);this.scraper.subscribe('match',function(ia,ja){if(this.isMetaComposer){var ka=this.form.xhpc_targetid,la=new s('/ajax/metacomposer/attachment/link/scraper.php');la.addQueryData({scrape_url:encodeURIComponent(ja.url),targetid:ka.value});ha.action=la.toString();}else{k.show(ga);ha.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(ja.url);}ha.xhpc.value=ga.id;ha.xhpc.disabled=false;ha.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},da=function(ga){if(this.inform('submit')===false){ga.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};function ea(ga,ha,ia,ja){ba[ga.id]=this;this.root=ga;this.resetCfg=ha;this.dataSource=ja;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;this.focus=l.find(ga,'div.focus_target');this.form=l.find(ga,'form.attachmentForm');this.content=l.find(ga,'div.attachmentContent');this.isMetaComposer=ia;if(this.isMetaComposer){this.messageBox=l.find(ga,'div.uiMetaComposerMessageBox');this.metaArea=l.find(ga,'div.attachmentMetaArea');this.bottomArea=l.find(ga,'div.attachmentBottomArea');this.barArea=l.find(ga,'div.attachmentBarArea');this.blurb=l.find(ga,'div.uiMetaComposerMessageBox div.textBlurb');this.input=l.find(ga,'div.uiMetaComposerMessageBox textarea.input');this.button=l.find(ga,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=l.find(ga,'div.uiMetaComposerMessageBox li.privacyWidget');}else{this.blurb=l.find(ga,'div.uiComposerMessageBox div.textBlurb');this.input=l.find(ga,'div.uiComposerMessageBox textarea.input');this.button=l.find(ga,'div.uiComposerMessageBox label.submitBtn');this.privacy=l.find(ga,'div.uiComposerMessageBox li.privacyWidget');}Event.listen(this.form,'submit',da.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(p.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}g.inform('xhpc/construct/'+ga.id,this,g.BEHAVIOR_STATE);}j.mixin(ea,h,{init:function(ga){this.mentionsInput=ga;if(this.mentionsInput)this.mentionsInput.subscribe('init',function(){var ha=this.mentionsInput.getTypeahead().getView();ha.subscribe(['reset','render'],function(ia){k.conditionClass(this.root,'uiComposerMention',(ia=='render'));}.bind(this));}.bind(this));ca.call(this);this.inform('init',null,g.BEHAVIOR_PERSISTENT);q.onBeforeUnload(this._handleUnsavedChanges.bind(this));},setBlurb:function(ga){l.setContent(this.blurb,ga);},setEnabled:function(ga){i.setEnabled(this.button,ga);},setLoading:function(ga){k.conditionClass(this.root,'async_saving',!!ga);},setContentVisible:function(ga){k.conditionClass(this.root,'uiComposerHideContent',!ga);},setMessageBoxVisible:function(ga){k.conditionClass(this.root,'uiComposerHideMessageBox',!ga);},setInputVisible:function(ga){k.conditionClass(this.root,'uiComposerHideInput',!ga);},setTopicTaggerVisible:function(ga){k.conditionClass(this.root,'uiTagComposerHidden',!ga);},mutate:function(ga){var ha=x(ga.xhpc);if(ha){var ia=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ga.confirmAugmentation&&ia!==ha)return;ia&&k.removeClass(ia,'uiComposerAttachmentSelected');k.addClass(ha,'uiComposerAttachmentSelected');if(!ga.disableCache)Event.listen(ha,'click',function(ka){v(ka).stop();ga.disableCache=true;this.mutate(ga);}.bind(this));}if(!ga.keepContentAreas){this.setContentVisible(false);l.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}}if(ga.content){l.setContent(this.content,m(ga.content));this.setContentVisible(true);}if(this.isMetaComposer){ga.metaContent&&l.setContent(this.metaArea,m(ga.metaContent));ga.bottomContent&&l.setContent(this.bottomArea,m(ga.bottomContent));ga.barContent&&l.setContent(this.barArea,m(ga.barContent));}this.setMessageBoxVisible(!ga.messageBoxHidden);k.conditionClass(this.root,'uiComposerWhiteMessageBox',!ga.messageBoxHidden&&!ga.inputHidden&&!ga.content);this.setInputVisible(!ga.inputHidden);k.conditionShow(this.privacy,!ga.privacyWidgetHidden);n.setPlaceholder(this.input,ga.placeholder);i.setLabel(this.button,ga.buttonLabel);this.setBlurb(m(ga.blurb));if(ga.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!ga.disabled);this.setTopicTaggerVisible(!ga.hideTopicTagger);this.form.setAttribute('action',ga.endpoint);if(ga.formType==z){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');if(ga.formType==aa){this.form.target=ga.iframeName;this.form.enctype=this.form.encoding='multipart/form-data';}else{this.form.removeAttribute('target');this.form.removeAttribute('enctype');this.form.removeAttribute('encoding');}this.submitHandler=ga.submitHandler;this.lazyEndpoint=ga.lazyEndpoint;k.addClass(this.root,'uiComposerInteracted');k.addClass(this.root,'uiComposerOpen');if(ga.messageBoxFocused){var ja=document.activeElement;if(ja===document.body||p.byClass(ja,'attachmentLink'))this.focusInput.bind(this).defer();}g.inform('composer/mutate',this);},subscribeToMutate:function(ga){return g.subscribe('composer/mutate',function(ha,ia){if(ia===this)ga();}.bind(this));},unsubscribeFromMutate:function(ga){g.unsubscribe(ga);},reset:function(ga,ha){if(!ga){n.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();}if(this.isMetaComposer){l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var ia=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ia)k.removeClass(ia,'uiComposerAttachmentSelected');}k.removeClass(this.root,'uiComposerInteracted');k.setClass(this.focus,'focus_target');this.setLoading(false);if(ha){var ja=l.scry(this.root,'.widget')[0];ja&&l.replace(ja,ha);}g.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var ga=l.find(this.root,'form.attachmentSelectForm'),ha=new s(this.lazyEndpoint);ha.setQueryData({isAugmentation:true});ga.action=ha.toString();var ia=l.scry(this.root,'.uiComposerAttachmentSelected')[0];ga.xhpc.value=ia&&ia.id;ga.xhpc.click();k.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){n.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(ga){if(this.dataSource)this.dataSource.updateToken(ga);},_handleUnsavedChanges:function(){var ga=o.getNextURI();if(ga.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!n.isEmpty(this.input)&&!(a.Dialog&&a.Dialog.getCurrent()))return "You haven't finished your post yet. Do you want to leave without finishing?";}});var fa;w(ea,{setNodeToConfigure:function(ga){fa=ga;},configure:function(ga,ha,ia){var ja=p.byClass(fa,'uiComposer').id,ka=g.subscribe('xhpc/construct/'+ja,function(la,ma){(function(){g.unsubscribe(ka);}).defer();ma.mutate(ga);ma.subscribe('init',function(){new r().handle(ha);new Function(ia)();if(ga.attachmentJS)new Function(ga.attachmentJS).call(ma);});});},publish:function(ga,ha){ha=ha||{};ha.composer=ea.getInstance(u(ga));ha.composer.reset(false,ha.audienceMarkup);ha.audienceMarkup=null;if(ha.streamNode){ha.streamStory=ha.streamNode;}else if(ha.streamMarkup)ha.streamStory=m(ha.streamMarkup).getRootNode();g.inform('composer/publish',ha);},getInstance:function(ga){var ha=p.byClass(u(ga),'uiComposer');return ha?ba[ha.id]:null;}});e.exports=ea;});
__d("legacy:Composer",["Composer"],function(a,b,c,d){a.Composer=b('Composer');},3);
function MetaComposerMessageBox(){}copy_properties(MetaComposerMessageBox.prototype,{init:function(a,b){this.inputContainer=DOM.scry(a,'div.inputContainer')[0];this.textInput=DOM.scry(a,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(a,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(a,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(a,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}});
__d("sprintf",[],function(a,b,c,d,e,f){function g(h,i){i=Array.prototype.slice.call(arguments,1);var j=0;return h.replace(/%s/g,function(k){return i[j++];});}e.exports=g;});
__d("Log",["sprintf"],function(a,b,c,d,e,f){var g=b("sprintf"),h=Array.prototype.slice,i={DEBUG:3,INFO:2,WARNING:1,ERROR:0};function j(l,m,n){var o=g.apply(null,n);if(k.level>=l&&window.console)console[m in console?m:'log'](o);}var k={level:-1,Level:i,debug:function(){j(i.DEBUG,'debug',h.call(arguments));},info:function(){j(i.INFO,'info',h.call(arguments));},warn:function(){j(i.WARNING,'warn',h.call(arguments));},error:function(){j(i.ERROR,'error',h.call(arguments));}};e.exports=k;});
__d("resolveWindow",[],function(a,b,c,d,e,f){function g(h){var i=window,j=h.split('.');try{for(var l=0;l<j.length;l++){var m=j[l],n=/^frames\[['"]?([a-zA-Z0-9\-_]+)['"]?\]$/.exec(m);if(n){i=i.frames[n[1]];}else if(m==='opener'||m==='parent'||m==='top'){i=i[m];}else return null;}}catch(k){return null;}return i;}e.exports=g;});
__d("XD",["function-extensions","Arbiter","Log","URI","copyProperties","resolveWindow","ua"],function(a,b,c,d,e,f){b("function-extensions");var g=b("Arbiter"),h=b("Log"),i=b("URI"),j=b("copyProperties"),k=b("resolveWindow"),l=b("ua"),m='fb_xdm_frame_'+location.protocol.replace(':',''),n={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,newResizeMethod:false,resizeTimeout:100,resizeWidth:false,expectResizeAck:false,resizeAckTimeout:6000},_lastResizeAckId:0,_resizeCount:0,_resizeTimestamp:0,init:function(p){this._opts=j(j({},this._opts),p);if(this._opts.autoResize)this._startResizeMonitor();g.subscribe('Connect.Unsafe.resize.ack',function(q,r){if(!r.id)r.id=this._resizeCount;if(r.id>this._lastResizeAckId)this._lastResizeAckId=r.id;}.bind(this));},send:function(p,q){q=q||this._opts.channelUrl;if(!q)return;if(!(/xd_arbiter\.php/.test(q))){if(q.substr(0,4)!='http')return;var r=q+'&'+i.implodeQuery(p),s='f'+(Math.random()*(1<<30)).toString(16).replace('.',''),t=document.body.appendChild(document.createElement('div')),u=false;t.style.position='absolute';t.style.top='-10000px';t.style.width='1px';t.style.height='1px';n._callbacks[s]=function(){if(u){(function(){t.parentNode.removeChild(t);}).defer(3000);delete n._callbacks[s];}};if(l.ie()){var v,w=document.createElement('div');v='<iframe onload="XD._callbacks.'+s+'()"></iframe>';w.innerHTML=v;w.firstChild.setAttribute('src',r);v=w.innerHTML;t.innerHTML='<iframe src="javascript:false"></iframe>';u=true;(function(){t.innerHTML=v;}).defer();}else{var x=document.createElement('iframe');x.onload=n._callbacks[s];t.appendChild(x);u=true;x.src=r;}return;}var y={},z=new i(q);j(y,p);j(y,i.explodeQuery(z.getFragment()));var aa=new i(y.origin),ba=[aa.getDomain()],ca=k(y.relation.replace(/^parent\./,'')),da=ca.frames[m];da?da.proxyMessage(i.implodeQuery(y),ba):h.warn('No such frame "'+m+'" to proxyMessage to');},_computeSize:function(){return {width:this._opts.resizeWidth?this._calcWidth(n.forced_min_width):0,height:this._calcHeight(this._opts.newResizeMethod)};},_calcHeight:function(p){var q=document.body,r=document.documentElement,s=0;if(p){s=Math.max(Math.max(q.offsetHeight,q.scrollHeight)+q.offsetTop,Math.max(r.offsetHeight,r.scrollHeight)+r.offsetTop);}else{if(l.ie()){s=Math.max(q.offsetHeight,q.scrollHeight)+q.offsetTop;}else s=r.offsetHeight+r.offsetTop;if(window.Dialog)s=Math.max(s,Dialog.max_bottom);}return s;},_calcWidth:function(p){var q=document.body,r=document.documentElement,s=0;if(q.offsetWidth<q.scrollWidth){s=q.scrollWidth+q.offsetLeft;}else{var t=q.childNodes;for(var u=0;u<t.length;u++){var v=t[u],w=v.offsetWidth+v.offsetLeft;if(w>s)s=w;}}if(p)s=Math.max(s,p);if(r.clientLeft>0)s+=(r.clientLeft*2);if(r.clientTop>0)height+=(r.clientTop*2);return s;},_startResizeMonitor:function(){var p,q=document.documentElement;if(this._opts.hideOverflow){q.style.overflow='hidden';document.body.style.overflow='hidden';}setInterval((function(){var r=this._computeSize(),s=Date.now(),t=this._lastResizeAckId<this._resizeCount&&(s-this._resizeTimestamp)>this._opts.resizeAckTimeout;if(!p||(this._opts.expectResizeAck&&t)||(this._opts.allowShrink&&p.width!=r.width)||(!this._opts.allowShrink&&p.width<r.width)||(this._opts.allowShrink&&p.height!=r.height)||(!this._opts.allowShrink&&p.height<r.height)){p=r;this._resizeCount++;this._resizeTimestamp=s;var u={type:'resize',height:r.height,ackData:{id:this._resizeCount}};if(r.width&&r.width!=0)u.width=r.width;try{if(i(document.referrer).isFacebookURI()&&window.parent!=window&&window.name&&window.parent.location&&window.parent.location.toString&&i(window.parent.location).isFacebookURI()){var w=window.parent.document.getElementsByTagName('iframe');for(var x=0;x<w.length;x=x+1)if(w[x].name==window.name){if(this._opts.resizeWidth)w[x].style.width=u.width+'px';w[x].style.height=u.height+'px';}}this.send(u);}catch(v){this.send(u);}}}).bind(this),this._opts.resizeTimeout);}},o=j({},n);e.exports.UnverifiedXD=o;e.exports.XD=n;a.UnverifiedXD=o;a.XD=n;});
__d("legacy:connect-xd",["XD"],function(a,b,c,d){a.UnverifiedXD=b('XD').UnverifiedXD;a.XD=b('XD').XD;},3);
(function(){var a='facebook.desktopplugin';FbDesktopDetect={mimeType:'application/x-facebook-desktop-1',isPluginInstalled:function(){var b=null;if(window.ActiveXObject){try{b=new ActiveXObject(a);if(b)return true;}catch(c){}}else if(navigator.plugins){navigator.plugins.refresh(false);for(var d=0,e=navigator.plugins.length;d<e;d++){b=navigator.plugins[d];if(b.length&&b[0].type===this.mimeType)return true;}}return false;},patchLoginForm:function(){if(this.isPluginInstalled()){new AsyncRequest('/ajax/desktop/loginmessage').send();var b=$('persist_box');if(b)b.checked=true;}},setContextualDialog:function(b){var c=$('persist_box');if(!c.checked)this.toggleWarning(b);var d=function(){c.checked?b.hide():b.show();};Event.listen(c,'click',d);Event.listen(c,'keydown',d);}};})();
__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("AsyncSignal",["Env"],function(a,b,c,d,e,f){var g=b("Env");function h(i,j){this.data=j||{};if(g.tracking_domain&&i.charAt(0)=='/')i=g.tracking_domain+i;this.uri=i;this.handler=null;}h.prototype.setHandler=function(i){this.handler=i;return this;};h.prototype.send=function(){var i=this.handler,j=this.data,k=this.uri,l=[],m=new Image(),n=g.fb_dtsg;j.asyncSignal=Math.floor(Math.random()*10000)+1;if(n)j.fb_dtsg=n;j.__user=g.user;if(g.fb_isb)j.fb_isb=g.fb_isb;for(var o in j)l.push(encodeURIComponent(o)+'='+encodeURIComponent(j[o]));if(k.indexOf('?')==-1)k+='?';k+=l.join('&');if(i)m.onload=m.onerror=(function(p,q){return function(){q((p.height==1));};})(m,i);m.src=k;return this;};e.exports=h;});
__d("legacy:async-signal",["AsyncSignal"],function(a,b,c,d){a.AsyncSignal=b('AsyncSignal');},3);
__d("legacy:uri",["URI"],function(a,b,c,d){a.URI=b('URI');},3);
function detect_broken_proxy_cache(a,b){var c=getCookie(b);if((c!=a)&&(c!=null)&&(a!='0')){var d={c:'si_detect_broken_proxy_cache',m:b+' '+a+' '+c},e=new URI('/common/scribe_endpoint.php').getQualifiedURI().toString();new AsyncSignal(e,d).send();}}
__d("legacy:ajaxpipe",["AjaxPipeRequest"],function(a,b,c,d){a.AjaxPipeRequest=b('AjaxPipeRequest');},3);
__d("legacy:page-transitions",["goOrReplace","computeRelativeURI","HistoryManager","PageTransitions"],function(a,b,c,d){a.go_or_replace=b('goOrReplace');a.computeRelativeURI=b('computeRelativeURI');a.HistoryManager=a.HistoryManager||b('HistoryManager');a.PageTransitions=a.PageTransitions||b('PageTransitions');},3);
__d("NavigationMessage",[],function(a,b,c,d,e,f){var g={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_FIRST_RESPONSE:'NavigationMessage/navigationFirstResponse',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',NAVIGATION_FAVORITE_UPDATE:'NavigationMessage/navigationFavoriteUpdate',NAVIGATION_ITEM_REMOVED:'NavigationMessage/navigationItemRemoved',NAVIGATION_ITEM_HIDDEN:'NavigationMessage/navigationItemHidden',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};e.exports=g;});
__d("legacy:ui-side-nav-message",["NavigationMessage"],function(a,b,c,d){a.NavigationMessage=b('NavigationMessage');},3);
function AsyncLayout(){}copy_properties(AsyncLayout.prototype,{init:function(a){this.canvas_id=a;if(ge('rightCol'))this.auxiliary_id='rightCol';if(ge('headerArea'))this.header_id='headerArea';if(ge('toolbarContainer'))this.toolbar_id='toolbarContainer';this.waitingForAux=false;PageTransitions.registerHandler(this.catchPageTransition.bind(this));this.subscription=Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this.onNavigate.bind(this));return this;},catchPageTransition:function(a){Arbiter.unsubscribe(this.subscription);return false;},getCanvasID:function(a){return this.customCanvasID?this.customCanvasID:(a.sidecol?'contentCol':'contentArea');},onNavigate:function(a,b){var c=b.useAjaxPipe;b=b.params;if(b.endpoint){if(this.request){this.request.setFinallyHandler(bagofholding);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(c){this.request=new AjaxPipeRequest().setURI(b.endpoint).setData(b).setCanvasId(this.getCanvasID(b)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{b.handled=true;this.waitingForAux=b.sidecol;var d=!!b.iframe,e=new AsyncRequest().setOption('useIframeTransport',d).setURI(new URI(b.endpoint)).setReadOnly(true).setMethod('GET').setData(b).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=e;e.send();}}},onSideResponse:function(a){var b=a.getPayload();if(b&&this.auxiliary_id)this.receivedAux(b);},receivedAux:function(a){!this.waitingForAux;this.waitingForAux=false;DOM.setContent($(this.auxiliary_id),HTML(a));},onResponse:function(a){var b=a.getPayload();if(b.redirect){goURI(b.redirect);}else{var c=b.html||b;DOM.setContent($(this.canvas_id),HTML(c));if(b.side_html&&this.auxiliary_id)this.receivedAux(b.side_html);if(this.header_id&&!b.keep_header){var d=$(this.header_id);DOM.setContent(d,HTML(b.header_html||''));CSS.conditionShow(d,b.header_html);}if(b.toolbar_html&&this.toolbar_id)DOM.setContent($(this.toolbar_id),HTML(b.toolbar_html));if(b.js)(new Function(b.js))();CSS.conditionClass('contentCol','hasRightCol',this.auxiliary_id&&!b.noRightSide);var e=ge('rightCol');if(e&&b.noRightSide)DOM.empty(e);}var f=a.getRequest().getData();Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED,f.key);},errorHandler:function(a){AsyncResponse.verboseErrorHandler(a);Arbiter.inform(NavigationMessage.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(a){window.scrollTo(0,0);Arbiter.inform(NavigationMessage.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(a){this.request=null;PageTransitions.transitionComplete(true);Arbiter.inform(NavigationMessage.NAVIGATION_COMPLETED);}});
__d("legacy:dom-form",["Form"],function(a,b,c,d){a.Form=b('Form');},3);
__d("legacy:vector",["Vector"],function(a,b,c,d){a.Vector2=b('Vector');},3);
function FutureSideNav(){FutureSideNav.instance&&FutureSideNav.instance.uninstall();FutureSideNav.instance=this;}FutureSideNav.instance=null;FutureSideNav.getInstance=function(){return FutureSideNav.instance||new FutureSideNav();};copy_properties(FutureSideNav.prototype,{init:function(a,b,c){this.root=a;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=b;this.uri=URI.getRequestURI();this.ajaxPipe=c;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;PageTransitions.registerHandler(function(d){return this._handlePageTransitions&&this.handlePageTransition(d);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAILED,this.navigationFailed.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_SELECT,this.navigationSelect.bind(this)),Arbiter.subscribe(PresenceMessage.getArbiterMessageType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(Selector.subscribe(['open','close'],function(d,e){var f=Parent.byClass(e.selector,'sideNavItem');f&&CSS.conditionClass(f,'editMenuOpened',d==='open');}));onleaveRegister(this.uninstall.bind(this));},_handleResize:(function(){var a;return function(){a&&clearTimeout(a);a=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){CSS.conditionClass(this.root,'uiNarrowSideNav',Vector2.getElementPosition(this.root).x<20);},_ensureHover:function(a){if(ua.ie()<8)Bootloader.loadComponents('explicit-hover',function(){this._explicitHover.push(new ExplicitHover(this.root,a));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(Arbiter.unsubscribe);this._selectorSubscriptions.forEach(Selector.unsubscribe.bind(Selector));this._eventHandlers.forEach(function(a){a.remove();});this._explicitHover.forEach(function(a){a.uninstall();});}},initSection:function(a,b){this._initItems(b);this._initSection(a);},addItem:function(a,b){this._initItem(a,b);},_initItems:function(a){var b=function(c,d){var e=this._initItem(c,d);if(c.children)c.children.forEach(function(f){b(f,e);});}.bind(this);$A(a).forEach(function(c){b(c,null);});},_initItem:function(a,b){var c=this.items[a.id]=this._constructItem(a,b);if(c.equals(this.selected)||a.selected)this.setSelected(c);var d=c.getLinkNode();d&&this._eventHandlers.push(Event.listen(d,'click',function(event){return !this.editing;}.bind(this)));return c;},_initSection:function(a){var b=this.sections[a.id]=this._constructSection(a);this._eventHandlers.push(Event.listen(b.node,'click',this.handleSectionClick.bind(this,b)));DOM.scry(b.node,'div.bookmarksMenuButton').forEach(CSS.show);return b;},_constructItem:function(a,b){return new FutureSideNavItem(a,b);},_constructSection:function(a){return new FutureSideNavSection(a);},handleSectionClick:function(a,event){var b=this._getEventTarget(event,'a'),c=this._getItemForNode(b);if(!b){return;}else if(CSS.hasClass(b.parentNode,'uiMenuItem')){this._handleMenuClick(a,c,b.parentNode,event);}else this._handleLinkClick(a,b,event);},_getEventTarget:function(event,a){var b=event.getTarget();if(b.tagName!==a.toUpperCase()){return Parent.byTag(b,a);}else return b;},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'rearrange'))this.beginEdit(a);},_handleLinkClick:function(a,b,event){if(CSS.hasClass(b,'navEditDone')){this.editing?this.endEdit():this.beginEdit(a);event.kill();}},getItem:function(a){if(this._isCurrentPath(a)){return this._getItemForKey(this._getKey(a.getQueryData())||this.defaultKey);}else return this._getItemForPath(a.getPath());},getNodeForKey:function(a){var b=this._getItemForKey(a);if(b)return b.node;},_isCurrentPath:function(a){return a.getDomain()===this.uri.getDomain()&&a.getPath()===this.uri.getPath();},_getKey:function(a){return a[this.keyParam];},_getItemForNode:function(a){a=Parent.byClass(a,'sideNavItem');return a&&this.items[a.id];},_getItemForKey:function(a){return this._findItem(function(b){return b.matchKey(a);});},_getItemForPath:function(a){return this._findItem(function(b){return b.matchPath(a);});},_findItem:function(a){for(var b in this.items)if(a(this.items[b]))return this.items[b];},removeItem:function(a){if(a&&this.items[a.id]){DOM.remove(a.node);delete this.items[a.id];}},removeItemByKey:function(a){this.removeItem(this._getItemForKey(a));},moveItem:function(a,b,c){var d=DOM.find(a.node,'ul.uiSideNav');(c?DOM.prependContent:DOM.appendContent)(d,b.node);},setLoading:function(a){this.loading&&this.loading.hideLoading();this.loading=a;this.loading&&this.loading.showLoading();},setSelected:function(a){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=a;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(a){var b=this.getItem(a),c=b&&b.endpoint&&this._doPageTransition(b,a);return c;},_doPageTransition:function(a,b){this.setLoading(a);this._sendPageTransition(a.endpoint,copy_properties(this._getTransitionData(a,b),b.getQueryData()));return true;},_sendPageTransition:function(a,b){b.endpoint=a;Arbiter.inform(NavigationMessage.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(a),params:b});},_getTransitionData:function(a,b){var c={};c.sidecol=this.sidecol;c.path=b.getPath();c[this.keyParam]=a.textKey;c.key=a.textKey;return c;},_useAjaxPipe:function(a){return this.ajaxPipe||this.ajaxPipeEndpoints[a];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(a,b){var c=this._getItemForKey(this._getKey(b));if(b.asLoading){this.setLoading(c);}else this.setSelected(c);},navigationCountUpdate:function(a,b){var c=this._getItemForKey(b&&b.key);if(c)if(typeof b.count!=="undefined"){c.setCount(b.count,b.hide);}else if(typeof b.increment!=="undefined")c.incrementCount(b.increment,b.hide);},navigationCountUpdateFromPresence:function(a,b){b=b.obj;if(b)if(!b.class_name||b.class_name&&CSS.hasClass(this.root,b.class_name))if(b.items)for(var c=0;c<b.items.length;c++)this.navigationCountUpdate(a,b.items[c]);},beginEdit:function(a){if(!this.editing){this.editing=true;CSS.addClass(this.root,'editMode');this._updateTrackingData();Bootloader.loadComponents('sortable-side-nav-js',this._initEditor.bind(this,a));}},endEdit:function(){if(this.editing){CSS.removeClass(this.root,'editMode');this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(a){var b=this.root.getAttribute('data-gt')||"{}";try{b=JSON.parse(b);if(this.editing){b.editing=true;}else delete b.editing;this.root.setAttribute('data-gt',JSON.stringify(b));}catch(c){}},_initEditor:function(a){this.editor=a.getEditor();this.editor.beginEdit();}});function FutureSideNavSection(a){this.id=a.id;this.node=this.node||$(a.id);this.editEndpoint=a.editEndpoint;}copy_properties(FutureSideNavSection.prototype,{equals:function(a){return a&&a.id===this.id;},getEditor:function(){return new SortableSideNav(DOM.find(this.node,'ul.uiSideNav'),this.editEndpoint);}});function FutureSideNavItem(a,b){this.id=a.id;this.up=b;this.endpoint=a.endpoint;this.type=a.type;this.node=a.node||$(a.id);this.paths=a.path?$A(a.path):[];this.keys=a.key?$A(a.key):[];var c=this._findKeys(this.keys);this.numericKey=c.numeric||this.keys[0];this.textKey=c.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}copy_properties(FutureSideNavItem.prototype,{equals:function(a){return a&&a.id===this.id;},getLinkNode:function(){return (DOM.scry(this.node,'a.item')[0]||DOM.scry(this.node,'a.subitem')[0]);},matchPath:function(a){return this._matchInput(this._pathPattern,a);},matchKey:function(a){return this._matchInput(this._keyPattern,a);},_matchInput:function(a,b){var c=a&&a.exec(b);return c&&c.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(a){return !this.up;},setCount:function(a,b){return this._updateCount(a,true);},incrementCount:function(a,b){return this._updateCount(a,false);},_updateCount:function(a,b,c){var d=DOM.scry(this.node,'span.count')[0],e=d&&DOM.scry(d,'span.countValue')[0];if(e){var f=b?0:parseInt(DOM.getText(e),10),g=Math.max(0,f+a),h=this.isTop()?'hidden':'hiddenSubitem';DOM.setContent(e,g);c&&CSS.conditionClass(this.node,h,!g);CSS.conditionClass(d,'hidden_elem',!g);if(this.isTop()){var i=DOM.scry(this.node,'div.linkWrap')[0];if(i){CSS.conditionClass(i,'noCount',!g);CSS.conditionClass(i,'hasCount',g);}}}Arbiter.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){CSS.addClass(this.node,'loading');},hideLoading:function(){CSS.removeClass(this.node,'loading');},showSelected:function(){CSS.addClass(this.node,'selectedItem');CSS.hasClass(this.node,'hider')&&CSS.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){CSS.removeClass(this.node,'selectedItem');},showChildren:function(){CSS.addClass(this.node,'open');},hideChildren:function(){CSS.removeClass(this.node,'open');},_getExpanderParent:function(){return Parent.byClass(this.node,'expandableSideNav');},_buildRegex:function(a){if(a.length){var b=a.map(function(c){if(typeof c==="string"){return c.replace(/([^a-z0-9_])/ig,'\\$1');}else if(c&&c.regex)return c.regex;});return new RegExp('^(?:'+b.join('|')+')$');}},_findKeys:function(a){var b=/^(app|group|fl)_/,c={};for(var d=0;d<a.length;d++){var e=b.test(a[d]);if(e&&!c.numeric){c.numeric=a[d];}else if(!e&&!c.text)c.text=a[d];if(c.numeric&&c.text)break;}return c;}});
function FutureProfileSideNav(){this.parent.construct(this);}Class.extend(FutureProfileSideNav,'FutureSideNav');copy_properties(FutureProfileSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.altKeyParam='v';this.sidecol=false;},_constructItem:function(a,b){return new FutureProfileSideNavItem(a,b);},_doPageTransition:function(a,b){if(!this._profileChanged(b)&&!this._scopeChanged(a))return this.parent._doPageTransition(a,b);},_profileChanged:function(a){var b=a.getQueryData(),c=this.uri.getQueryData();return (b.id!==c.id||b.viewas!==c.viewas||b.and!==c.and);},_scopeChanged:function(a){return (!this.selected||a.layoutType!==this.selected.layoutType);},_getKey:function(a){return this.parent._getKey(a)||a[this.altKeyParam];}});function FutureProfileSideNavItem(a,b){this.parent.construct(this,a,b);this.layoutType=a.layouttype;}Class.extend(FutureProfileSideNavItem,'FutureSideNavItem');
__d("Menu",["event-extensions","Arbiter","css","DataStore","DOM","HTML","Keys","Parent","Run","ua","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("css"),i=b("DataStore"),j=b("DOM"),k=b("HTML"),l=b("Keys"),m=b("Parent"),n=b("Run"),o=b("ua"),p=b("copyProperties"),q=null,r='menu:mouseover',s=null;function t(ba){if(h.hasClass(ba,'uiMenuContainer'))return ba;return m.byClass(ba,'uiMenu');}function u(ba){return m.byClass(ba,'uiMenuItem');}function v(ba){if(document.activeElement){var ca=u(document.activeElement);return ba.indexOf(ca);}return -1;}function w(ba){return j.find(ba,'a.itemAnchor');}function x(ba){return h.hasClass(ba,'checked');}function y(ba){return !h.hasClass(ba,'disabled')&&h.getStyle(ba,'display')!=='none';}function z(event){var ba=document.activeElement;if(!ba||!m.byClass(ba,'uiMenu')||!j.isNodeOfType(ba,['input','textarea'])){var ca=u(event.getTarget());ca&&q.focusItem(ca);}}function aa(ba){o.firefox()&&w(ba).blur();q.inform('select',{menu:t(ba),item:ba});}n.onLoad(function(){var ba={};ba.click=function(event){var ca=u(event.getTarget());if(ca&&y(ca)){aa(ca);var da=w(ca),ea=da.href,fa=da.getAttribute('rel');return (fa&&fa!=='ignore')||(ea&&ea.charAt(ea.length-1)!=='#');}};ba.keydown=function(event){var ca=event.getTarget();if(event.getModifiers().any)return;if(!s||j.isNodeOfType(ca,['input','textarea']))return;var da=Event.getKeyCode(event),ea;switch(da){case l.UP:case l.DOWN:var fa=q.getEnabledItems(s);ea=v(fa);q.focusItem(fa[ea+(da===l.UP?-1:1)]);return false;case l.SPACE:var ga=u(ca);if(ga){aa(ga);event.prevent();}break;default:var ha=String.fromCharCode(da).toLowerCase(),ia=q.getEnabledItems(s);ea=v(ia);var ja=ea,ka=ia.length;while((~ea&&(ja=++ja%ka)!==ea)||(!~ea&&++ja<ka)){var la=q.getItemLabel(ia[ja]);if(la&&la.charAt(0).toLowerCase()===ha){q.focusItem(ia[ja]);return false;}}}};Event.listen(document.documentElement,ba);});q=e.exports=p(new g(),{focusItem:function(ba){if(ba&&y(ba)){this._removeSelected(t(ba));h.addClass(ba,'selected');w(ba).focus();}},getEnabledItems:function(ba){return q.getItems(ba).filter(y);},getCheckedItems:function(ba){return q.getItems(ba).filter(x);},getItems:function(ba){return j.scry(ba,'li.uiMenuItem');},getItemLabel:function(ba){return ba.getAttribute('data-label',2)||'';},isItemChecked:function(ba){return h.hasClass(ba,'checked');},register:function(ba,ca){ba=t(ba);if(!i.get(ba,r))i.set(ba,r,Event.listen(ba,'mouseover',z));if(ca!==false)s=ba;},setItemEnabled:function(ba,ca){if(!ca&&!j.scry(ba,'span.disabledAnchor')[0])j.appendContent(ba,j.$N('span',{className:j.find(ba,'a').className+' disabledAnchor'},k(w(ba).innerHTML)));h.conditionClass(ba,'disabled',!ca);},toggleItem:function(ba){var ca=!q.isItemChecked(ba);q.setItemChecked(ba,ca);},setItemChecked:function(ba,ca){h.conditionClass(ba,'checked',ca);w(ba).setAttribute('aria-checked',ca);},unregister:function(ba){ba=t(ba);var ca=i.remove(ba,r);ca&&ca.remove();s=null;this._removeSelected(ba);},_removeSelected:function(ba){q.getItems(ba).filter(function(ca){return h.hasClass(ca,'selected');}).each(function(ca){h.removeClass(ca,'selected');});}});});
__d("SubscriptionLevels",[],function(a,b,c,d,e,f){var g={ALL:'162318810514679',DEFAULT:'271670892858696',TOP:'266156873403755'};e.exports=g;});
__d("EditSubscriptions",["event-extensions","function-extensions","Arbiter","AsyncRequest","css","DOM","ge","Menu","Parent","SubscriptionLevels"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('css'),j=b('DOM'),k=b('ge'),l=b('Menu'),m=b('Parent'),n=b('SubscriptionLevels'),o=13,p=45,q=[n.ALL,n.DEFAULT,n.TOP],r={},s={},t={},u={},v={},w={},x={},y={},z={},aa="/ajax/follow/follow_profile.php",ba="/ajax/follow/unfollow_profile.php";function ca(ua){return q.contains(ua);}function da(ua,va,wa,xa){var ya=m.byClass(xa,'uiMenuItem')||m.byClass(xa,'uiMenuXItem');if(!ya||!j.contains(ua,ya)){return;}else if(i.hasClass(ya,'SubscribeMenuSubscribeCheckbox')){if(t[va]){ga(ua,va);}else fa(ua,va);return false;}else if(i.hasClass(ya,'SubscribeMenuUnsubscribe')){ga(ua,va);return false;}else if(i.hasClass(ya,'SubscribeMenuSettingsItem')){sa(ua,true);return false;}else if(i.hasClass(ya,'SubscriptionMenuGoBack')){sa(ua,false);return false;}else if(i.hasClass(ya,'SubscriptionMenuItem')){ea(ua,va,wa,ya);return false;}}function ea(ua,va,wa,xa){if(i.hasClass(xa,'SubscriptionMenuLevel')){if(l.isItemChecked(xa))return;qa(ua,va,ka(xa),true,wa);}else if(i.hasClass(xa,'SubscriptionMenuCategory'))oa(va,xa,!l.isItemChecked(xa),true,wa);}function fa(ua,va){var wa={profile_id:va};g.inform('FollowingUser',wa);new h().setURI(aa).setMethod('POST').setData({profile_id:va,location:ha(ua)}).setErrorHandler(g.inform.curry('FollowUserFail',wa)).send();}function ga(ua,va){var wa={profile_id:va};g.inform('UnfollowingUser',wa);new h().setURI(ba).setMethod('POST').setData({profile_id:va,location:ha(ua)}).setErrorHandler(g.inform.curry('UnfollowUserFail',wa)).send();}function ha(ua){if(i.hasClass(ua,'followButtonFlyout')){return o;}else return p;}function ia(ua,va,wa){var xa={profile_id:ua,level:w[ua],custom_categories:x[ua],location:wa};new h().setURI('/ajax/follow/manage_subscriptions.php').setData(xa).send();}function ja(ua,va){var wa=x[va]||[],xa=l.getItems(ua);xa.forEach(function(ya){if(i.hasClass(ya,'SubscriptionMenuCategory')){var za=ka(ya);if(wa.contains(za)){ma(ya);}else na(ya);}});qa(ua,va,w[va],false);}function ka(ua){var va=j.scry(ua,'input')[0];return va&&va.value;}function la(ua){return j.find(ua,'a.itemAnchor');}function ma(ua){i.addClass(ua,'checked');la(ua).setAttribute('aria-checked',true);}function na(ua){i.removeClass(ua,'checked');la(ua).setAttribute('aria-checked',false);}function oa(ua,va,wa,xa,ya){if(wa){ma(va);}else na(va);var za=ka(va);if(ca(za)){wa&&pa(ua,za);}else if(wa){if(!x[ua].contains(za))x[ua].push(za);}else{var ab=x[ua].indexOf(za);if(ab!==-1)x[ua].splice(ab,1);}if(xa)ia(ua,za,ya);}function pa(ua,va){w[ua]=va;g.inform('SubscriptionLevelUpdated',{profile_id:ua,level:va});}function qa(ua,va,wa,xa,ya){var za=j.scry(ua,'.SubscriptionMenuLevel'),ab=null;za.forEach(function(bb){if(ka(bb)==wa){ab=bb;}else if(l.isItemChecked(bb))oa(va,bb,false,false);});ab&&oa(va,ab,true,xa,ya);}function ra(ua,va,wa){t[va]=wa;i.conditionClass(ua,'isUnsubscribed',!wa);var xa=j.scry(ua,'li.SubscribeMenuSubscribeCheckbox');if(xa.length!==0){var ya=xa[0];if(wa){ma(ya);}else na(ya);}}function sa(ua,va){i.conditionClass(ua,'subscriptionMenuOpen',va);}g.subscribe('UnfollowUser',function(ua,va){if(y[va.profile_id]){pa(va.profile_id,y[va.profile_id]);x[va.profile_id]=z[va.profile_id].slice();}});g.subscribe('UpdateSubscriptionLevel',function(ua,va){var wa=va.profile_id+'',xa=va.level+'';pa(wa,xa);var ya;for(ya in r)if(r[ya]===wa){var za=k(ya);za&&qa(za,wa,xa,false);}});var ta={init:function(ua,va,wa){var xa=j.getID(ua);if(!r[xa])Event.listen(ua,'click',function(ya){return da(ua,r[xa],wa,ya.getTarget());});if(w[va])ja(ua,va);r[xa]=va;i.conditionClass(ua,'NonFriendSubscriptionMenu',!s[va]);i.conditionClass(ua,'cannotSubscribe',!u[va]);i.conditionClass(ua,'noSubscriptionLevels',v[va]);i.conditionClass(ua,'noSubscribeCheckbox',!s[va]&&!v[va]);ra(ua,va,t[va]);g.subscribe(['FollowUser','FollowingUser','UnfollowUserFail'],function(ya,za){ra(ua,va,true);}.bind(this));g.subscribe(['UnfollowUser','UnfollowingUser','FollowUserFail'],function(ya,za){g.inform('SubMenu/Reset');ra(ua,va,false);}.bind(this));sa(ua,false);},getSubscriptions:function(ua){return {level:w[ua],custom_categories:x[ua]};},setSubscriptions:function(ua,va,wa,xa,ya,za,ab,bb,cb){pa(ua,za+'');s[ua]=va;t[ua]=wa;u[ua]=xa;v[ua]=ya;y[ua]=bb+'';x[ua]=ab.map(String);z[ua]=cb.map(String);}};e.exports=a.EditSubscriptions||ta;});
__d("legacy:EditSubscriptions",["SubscriptionLevels","EditSubscriptions"],function(a,b,c,d){a.SubscriptionLevels=b('SubscriptionLevels');a.EditSubscriptions=b('EditSubscriptions');},3);
__d("SwapButton",["event-extensions","copyProperties","css"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('css');function i(){}g(i.prototype,{_swapperButton:null,_swappeeButton:null,swap:function(){h.hide(this._swapperButton);h.show(this._swappeeButton);},unswap:function(){h.show(this._swapperButton);h.hide(this._swappeeButton);},init:function(j,k){this._swapperButton=j;this._swappeeButton=k;Event.listen(j,'click',this.swap.bind(this));}});e.exports=i;});
__d("legacy:swap-button",["SwapButton"],function(a,b,c,d){a.SwapButton=b('SwapButton');},3);
var SubscribeButton=window.SubscribeButton||(function(){return {init:function(a,b,c,d){Event.listen(b,'click',function(){Arbiter.inform('FollowingUser',{profile_id:d});});Arbiter.subscribe('FollowingUser',function(e,f){if(d===f.profile_id)a.swap();});Arbiter.subscribe('UnfollowingUser',function(e,f){if(d===f.profile_id){a.unswap();c.hideFlyout();Arbiter.inform('SubMenu/Reset');}});},initUnsubscribe:function(a,b){Event.listen(a,'click',function(){Arbiter.inform('UnfollowingUser',{profile_id:b});});}};})();
__d("legacy:animation",["Animation"],function(a,b,c,d){a.animation=b('Animation');},3);
FriendRequestMessage={STATUS:'FriendRequest/change',UNFRIEND:'FriendRequest/unfriend',CANCEL:'FriendRequest/cancel',CANCELLING:'FriendRequest/cancelling',CANCEL_FAIL:'FriendRequest/cancelFail',SENT:'FriendRequest/sent',SENDING:'FriendRequest/sending',SEND_FAIL:'FriendRequest/sendFail',CONFIRM:'FriendRequest/confirm',CONFIRMING:'FriendRequest/confirming',CONFIRM_FAIL:'FriendRequest/confirmFail'};function FriendStatus(a,b,c){this.id=a;this.update(b,c);}copy_properties(FriendStatus.prototype,{update:function(a,b){a&&(this.status=a);if(b){this.lists=$A(b).map(String);this._informListChange();}},isComplete:function(){return !!this.lists;},addToList:function(a){if(this.lists&&!this.lists.contains(a))this.lists.push(a);this._informListChange();},removeFromList:function(a){if(this.lists){var b=this.lists.indexOf(a);b!==-1&&this.lists.splice(b,1);}this._informListChange();},updateList:function(a,b){b?this.addToList(a):this.removeFromList(a);},_informListChange:function(){Arbiter.inform('FriendListMembershipChange',{uid:this.id,lists:this.lists});}});copy_properties(FriendStatus,{ARE_FRIENDS:1,INCOMING_REQUEST:2,OUTGOING_REQUEST:3,CAN_REQUEST:4});(function(){var a={},b={};function c(d,e,f){if(!a[f.uid]){a[f.uid]=new FriendStatus(f.uid,d);}else a[f.uid].update(d);Arbiter.inform(FriendRequestMessage.STATUS,{uid:f.uid,status:d});}onloadRegister_DEPRECATED(function(){Arbiter.subscribe([FriendRequestMessage.CANCEL,FriendRequestMessage.UNFRIEND,FriendRequestMessage.SEND_FAIL],c.curry(FriendStatus.CAN_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM_FAIL],c.curry(FriendStatus.INCOMING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CANCEL_FAIL,FriendRequestMessage.SENT,FriendRequestMessage.SENDING],c.curry(FriendStatus.OUTGOING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM,FriendRequestMessage.CONFIRMING],c.curry(FriendStatus.ARE_FRIENDS));});copy_properties(FriendStatus,{CLOSE_FRIENDS:null,ACQUAINTANCES:null,getFriend:function(d,e){if(a[d]&&a[d].isComplete()){e(a[d]);}else if(b[d]){b[d].push(e);}else{b[d]=[e];new AsyncRequest().setURI("/ajax/friends/status.php").setData({friend:d}).setHandler(function(f){var g=f.getPayload();FriendStatus.initFriend(d,g.status,g.lists);}).send();}},initFriend:function(d,e,f){var g=a[d]||new FriendStatus(d);g.update(g.status||e,g.lists||f);a[d]=g;b[d]&&b[d].forEach(function(h){h(g);});b[d]=null;},setSpecialLists:function(d){FriendStatus.CLOSE_FRIENDS=d.close+'';FriendStatus.ACQUAINTANCES=d.acq+'';}});})();
__d("legacy:dialog",["Dialog"],function(a,b,c,d){var e=b('Dialog');a.Dialog=e;},3);
var DynamicFriendListEducation=(function(){var a,b,c,d,e,f,g=function(){c&&c.hide();d&&d.hide();},h=function(j){b.remove(j);g();e({accept_tag_education:true});},i=function(){g();e({nux_cancel:true});};return {init:function(j,k){a=j;b=$A(k).map(String);PageTransitions.registerHandler(function(){g();a=false;e=undefined;b=[];});},showDialog:function(j,k,l){if(a&&b.contains(j)){g();Arbiter.inform('DynamicFriendListEducation/dialogOpen',{uid:k,flid:j});e=l;c=new Dialog().setAsync(new AsyncRequest('/ajax/friends/lists/smart_list_education.php').setMethod('GET').setData({flid:j,uid:k}).setReadOnly(true)).setHandler(h.bind(this,j)).setCloseHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogClosed',{uid:k,flid:j});}).setCancelHandler(function(){Arbiter.inform('DynamicFriendListEducation/dialogCancel',{uid:k,flid:j});}).show();}else l();},showContextualDialog:function(j,k,l,m){if(a&&b.contains(j)){g();f=l;e=m;new AsyncRequest('/ajax/friends/lists/smart_list_contextual_education.php').setMethod('GET').setData({flid:j,uid:k}).setReadOnly(true).send();}else m();},setContextualDialog:function(j,k,l,m){d=j;d.setContext(f);d.show();Event.listen(k,'click',h.bind(this,m));Event.listen(l,'click',i);}};})();
__d("SimpleDrag",["event-extensions","ArbiterMixin","Class","ua"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('ua');function j(k){Event.listen(k,'mousedown',this._start.bind(this));}h.mixin(j,g,{_start:function(event){var k=this.inform('start',event),l=i.ie()<9?document.documentElement:window,m=Event.listen(l,{selectstart:Event.prevent,mousemove:this.inform.bind(this,'update'),mouseup:function(event){for(var n in m)m[n].remove();this.inform('end',event);}.bind(this)});return !!k;}});e.exports=j;});
__d("ScrollableArea",["array-extensions","event-extensions","Animation","css","DataStore","DOM","Parent","Run","SimpleDrag","ua","Vector","copyProperties"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Animation'),h=b('css'),i=b('DataStore'),j=b('DOM'),k=b('Parent'),l=b('Run'),m=b('SimpleDrag'),n=b('ua'),o=b('Vector'),p=b('copyProperties');function q(){}p(q,{fromNative:function(r,s){if(!h.hasClass(r,'uiScrollableArea')||!h.hasClass(r,'native'))return;s=s||{};h.removeClass(r,'native');var t=j.create('div',{className:'uiScrollableAreaTrack'},j.create('div',{className:'uiScrollableAreaGripper'}));if(s.fade!==false){h.addClass(r,'fade');h.addClass(t,'invisible_elem');}else h.addClass(r,'nofade');j.appendContent(r,t);var u=new q();u.init(r,s);u.resize();return u;},getInstance:function(r){var s=k.byClass(r,'uiScrollableArea');return s?i.get(s,'ScrollableArea'):null;},poke:function(r){var s=q.getInstance(r);s&&s.poke();}});p(q.prototype,{init:function(r,s){s=s||{};this._elem=r;this._wrap=j.find(r,'div.uiScrollableAreaWrap');this._body=j.find(this._wrap,'div.uiScrollableAreaBody');this._track=j.find(r,'div.uiScrollableAreaTrack');this._gripper=j.find(this._track,'div.uiScrollableAreaGripper');this._options=s;this.adjustGripper();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(s.fade!==false)this._listeners.push(Event.listen(r,'mouseenter',this.showScrollbar.shield(this)),Event.listen(r,'mousemove',this._handleMousemove.bind(this)),Event.listen(r,'mouseout',this.hideScrollbar.shield(this)));if(n.safari()||n.chrome())this._listeners.push(Event.listen(r,'mousedown',function(){var t=Event.listen(window,'mouseup',function(){if(r.scrollLeft)r.scrollLeft=0;t.remove();});}));this.initDrag();i.set(this._elem,'ScrollableArea',this);if(!s.persistent)l.onLeave(this.destroy.bind(this));},initDrag:function(){var r=new m(this._gripper);r.subscribe('start',function(s,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var t=o.getEventPosition(event).y,u=this._gripper.offsetTop,v=r.subscribe('update',function(x,event){var y=o.getEventPosition(event).y-t,z=this._elem.clientHeight,aa=this._body.offsetHeight,ba=this._track.offsetHeight,ca=z/aa*ba,da=aa-this._wrap.offsetHeight,ea=u+y,fa=ba-ca;ea=Math.max(Math.min(ea,fa),0);var ga=ea/fa*da;this._wrap.scrollTop=ga;}.bind(this)),w=r.subscribe('end',function(){r.unsubscribe(v);r.unsubscribe(w);});}.bind(this));},adjustGripper:function(){var r=this._elem.clientHeight,s=this._body.offsetHeight,t=this._track.offsetHeight,u=r/s*t;if(u<t){h.setStyle(this._gripper,'height',u+'px');var v=this._wrap.scrollTop/s*t;h.setStyle(this._gripper,'top',v+'px');h.show(this._gripper);}else h.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){h.conditionClass(this._elem,'contentBefore',this._wrap.scrollTop>0);h.conditionClass(this._elem,'contentAfter',!this.isScrolledToBottom());},destroy:function(){this._listeners.forEach(function(r){r.remove();});this._listeners.length=0;},_handleMousemove:function(event){var r=o.getElementPosition(this._track).x,s=o.getElementDimensions(this._track).x;if(Math.abs(r+s/2-o.getEventPosition(event).x)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=(new g(this._track)).from('opacity',1).to('opacity',0).duration(250).ondone(h.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},resize:function(){var r=o.getElementDimensions(this._elem).x;if(!this._options.fade)r-=10;h.setStyle(this._body,'width',r+'px');return this;},showScrollbar:function(r){this.adjustGripper();if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}h.setStyle(this._track,'opacity',1);h.removeClass(this._track,'invisible_elem');if(r!==false)this.hideScrollbar();return this;},isScrolledToBottom:function(){return this._wrap.scrollTop>=this._wrap.scrollHeight-this._wrap.clientHeight;},scrollToBottom:function(r){if(r!==false){(new g(this._wrap)).to('scrollTop',this._wrap.scrollHeight).ease(g.ease.end).go();}else this._wrap.scrollTop=this._wrap.scrollHeight;},poke:function(){var r=this._wrap.scrollTop;this._wrap.scrollTop+=1;this._wrap.scrollTop-=1;this._wrap.scrollTop=r;return this.showScrollbar(false);}});e.exports=q;});
__d("legacy:ScrollableArea",["ScrollableArea"],function(a,b,c,d){a.ScrollableArea=b('ScrollableArea');},3);
var FriendEditLists=(function(){var a=5,b={},c="/ajax/profile/removefriendconfirm.php",d="/friends/ajax/remove_friend.php",e;function f(o,p,q){var r=b[o.id],s=function(t){var u={action:q?'add_list':'del_list',to_friend:r.id,friendlists:[p],source:e};if(t)copy_properties(u,t);r.updateList(p,q);var v;if(q&&p==FriendStatus.CLOSE_FRIENDS){v=i(o,FriendStatus.ACQUAINTANCES);if(Menu.isItemChecked(v)){Menu.toggleItem(v);f(o,FriendStatus.ACQUAINTANCES,false);}}else if(q&&p==FriendStatus.ACQUAINTANCES){v=i(o,FriendStatus.CLOSE_FRIENDS);if(Menu.isItemChecked(v)){Menu.toggleItem(v);f(o,FriendStatus.CLOSE_FRIENDS,false);}}var w={flid:p,uid:r.id},x=q?'FriendListHovercard/add':'FriendListHovercard/remove';Arbiter.inform(x,w);new AsyncRequest().setURI('/ajax/add_friend/action.php').setData(u).send();};if(q){DynamicFriendListEducation.showDialog(p,r.id,s);}else s();}function g(o){var p=DOM.scry(o,'input')[0];return p&&p.value;}function h(o,p,q){var r={uid:p.id};new AsyncRequest().setURI(d).setMethod('POST').setData({friend:p.id}).setHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL,r)).setErrorHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL_FAIL,r)).setStatusElement(q).send();}function i(o,p){var q=Menu.getItems(o);for(var r=0;r<q.length;r++)if(g(q[r])==p)return q[r];return null;}function j(o,p){var q=Menu.getItems(o);q.forEach(function(r){var s=g(r),t=p.lists.contains(s);if(Menu.isItemChecked(r)!==t)Menu.toggleItem(r);});}function k(o){var p=Menu.getItems(o),q=!CSS.hasClass(o,'followButtonFlyout')&&!CSS.hasClass(o,'likeButtonFlyout'),r=[],s=[],t=0,u=0;p.forEach(function(z){if(CSS.hasClass(z,'neverHide')){CSS.removeClass(z,'underShowMore');t++;}else if(Menu.isItemChecked(z)){r.push(z);}else if(CSS.hasClass(z,'neverShow')||CSS.hasClass(z,'FriendListCreateTrigger')||(!q&&CSS.hasClass(z,'friendOptionsOnly'))){CSS.addClass(z,'underShowMore');u++;}else s.push(z);});var v=a-t,w=r.concat(s),x=u;w.forEach(function(z){if(CSS.hasClass(z,'ShowMoreItem')){v--;return;}if(v){CSS.removeClass(z,'underShowMore');v--;}else{CSS.addClass(z,'underShowMore');x=true;}});CSS.conditionClass(o,'hasMoreFriendListItems',x);var y=DOM.scry(o,'.FriendListMenuShowMore');y.forEach(function(z){CSS.removeClass(z,'FriendListMenuShowMore');});}function l(o,p){var q=DOM.scry(o,'.FriendListUnfriend')[0],r=DOM.scry(o,'.FriendListCancel')[0];if(r)CSS.conditionShow(r,p.status==FriendStatus.OUTGOING_REQUEST);if(q){CSS.conditionShow(q,p.status==FriendStatus.ARE_FRIENDS);DOM.find(q,'a').setAttribute('ajaxify',URI(c).addQueryData({uid:p.id}).toString());}}function m(o,p){if(DOM.scry(o,'div.FriendListSubscriptionsMenu').length!==0)EditSubscriptions.init(o,p,45);}var n=function(){n=bagofholding;Arbiter.subscribe(FriendRequestMessage.STATUS,function(o,p){for(var q in b){var r=ge(q),s=b[q];if(r&&s&&s.id==p.uid){j(r,s);l(r,s);k(r);}}});Menu.subscribe('select',function(o,p){if(CSS.hasClass(p.item,'ShowMoreItem')&&CSS.hasClass(p.menu,'FriendListMenu')){CSS.addClass(p.menu,'FriendListMenuShowMore');ScrollableArea.poke(p.item);}});};return {init:function(o,p,q){o=$(o);e=q;n();if(!b[o.id])Menu.subscribe('select',function(r,s){if(DOM.contains(o,s.item))if(Parent.byClass(s.item,'FriendListItem')){Menu.toggleItem(s.item);var t=g(s.item);f(o,t,Menu.isItemChecked(s.item));}else if(Parent.byClass(s.item,'FriendListCancel')){h(o,b[o.id],s.item);}else if(Parent.byClass(s.item,'FriendListUnfriend'))FriendListFlyoutController.hide(false);});CSS.addClass(o,'async_saving');FriendStatus.getFriend(p,function(r){j(o,r);l(o,r);b[o.id]=r;k(o);m(o,p);CSS.removeClass(o,'async_saving');}.bind(this));}};})();
__d("BehaviorsMixin",["copyProperties"],function(a,b,c,d,e,f){var g=b("copyProperties");function h(l){this._behavior=l;this._enabled=false;}g(h.prototype,{enable:function(){if(!this._enabled){this._enabled=true;this._behavior.enable();}},disable:function(){if(this._enabled){this._enabled=false;this._behavior.disable();}}});var i=1;function j(l){if(!l.__BEHAVIOR_ID)l.__BEHAVIOR_ID=i++;return l.__BEHAVIOR_ID;}var k={enableBehavior:function(l){if(!this._behaviors)this._behaviors={};var m=j(l);if(!this._behaviors[m])this._behaviors[m]=new h(new l(this));this._behaviors[m].enable();return this;},disableBehavior:function(l){if(this._behaviors){var m=j(l);if(this._behaviors[m])this._behaviors[m].disable();}return this;},enableBehaviors:function(l){l.forEach(this.enableBehavior.bind(this));return this;},destroyBehaviors:function(){if(this._behaviors){for(var l in this._behaviors)this._behaviors[l].disable();this._behaviors={};}}};e.exports=k;});
__d("KeyEventController",["event-extensions","function-extensions","DOM","Run","Util","copyProperties","isEmpty"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("DOM"),h=b("Run"),i=b("Util"),j=b("event-extensions").$E,k=b("copyProperties"),l=b("isEmpty");function m(){this.handlers={};document.onkeyup=this.onkeyevent.bind(this,'onkeyup');document.onkeydown=this.onkeyevent.bind(this,'onkeydown');document.onkeypress=this.onkeyevent.bind(this,'onkeypress');}k(m,{instance:null,getInstance:function(){return m.instance||(m.instance=new m());},defaultFilter:function(event,n){event=j(event);return m.filterEventTypes(event,n)&&m.filterEventTargets(event,n)&&m.filterEventModifiers(event,n);},filterEventTypes:function(event,n){if(n==='onkeydown')return true;return false;},filterEventTargets:function(event,n){var o=event.getTarget();return !g.isNodeOfType(o,m._interactiveElements)||(o.type in m._uninterestingTypes)||(g.isNodeOfType(o,['input','textarea'])&&o.value.length===0&&event.keyCode in m._controlKeys);},filterEventModifiers:function(event,n){if(event.ctrlKey||event.altKey||event.metaKey||event.repeat)return false;return true;},registerKey:function(n,o,p,q){if(p===undefined)p=m.defaultFilter;var r=m.getInstance(),s=r.mapKey(n);if(l(r.handlers))h.onLeave(r.resetHandlers.bind(r));for(var t=0;t<s.length;t++){n=s[t];if(!r.handlers[n]||q)r.handlers[n]=[];r.handlers[n].push({callback:o,filter:p});}},keyCodeMap:{BACKSPACE:[8],TAB:[9],RETURN:[13],ESCAPE:[27],LEFT:[37,63234],UP:[38,63232],RIGHT:[39,63235],DOWN:[40,63233],DELETE:[46],COMMA:[188],PERIOD:[190],'`':[192],'[':[219],']':[221]},_interactiveElements:['input','select','textarea','object','embed'],_uninterestingTypes:{checkbox:1,radio:1,submit:1},_controlKeys:{8:1,9:1,13:1,27:1,37:1,63234:1,38:1,63232:1,39:1,63235:1,40:1,63233:1,46:1}});k(m.prototype,{mapKey:function(n){if(n>=0&&n<=9){if(typeof(n)!='number')n=n.charCodeAt(0)-48;return [48+n,96+n];}var o=m.keyCodeMap[n.toUpperCase()];if(o)return o;return [n.toUpperCase().charCodeAt(0)];},onkeyevent:function(n,o){o=j(o);var p=this.handlers[o.keyCode],q,r,s;if(p)for(var t=0;t<p.length;t++){q=p[t].callback;r=p[t].filter;try{if(!r||r(o,n)){s=q(o,n);if(s===false)return Event.kill(o);}}catch(u){}}return true;},resetHandlers:function(){this.handlers={};}});e.exports=a.KeyEventController||m;});
__d("Layer",["event-extensions","function-extensions","Animation","Arbiter","ArbiterMixin","BehaviorsMixin","Class","copyProperties","css-core","DataStore","DOM","HTML","KeyEventController"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("Animation"),h=b("Arbiter"),i=b("ArbiterMixin"),j=b("BehaviorsMixin"),k=b("Class"),l=b("copyProperties"),m=b("css-core"),n=b("DataStore"),o=b("DOM"),p=b("HTML"),q=b("KeyEventController"),r=[];function s(t){this._config=t||{};}Function.mixin(s,i);l(s,{init:function(t,u){t.init(u);},initAndShow:function(t,u){t.init(u).show();}});k.mixin(s,i,j,{_initialized:false,_root:null,_shown:false,init:function(t){if(t){var u=o.isNode(t),v=typeof t==='string'||p.isHTML(t);if(v)t=p(t).getRootNode();}this._root=this._buildWrapper(t);n.set(this._root,'layer',this);var w=this._config.addedBehaviors||[];this.enableBehaviors(this._getDefaultBehaviors().concat(w));this._initialized=true;return this;},_getDefaultBehaviors:function(){return [];},getInsertParent:function(){return this._insertParent||o.getDocumentBodyElement();},getRoot:function(){return this._root;},_buildWrapper:function(t){return t;},setInsertParent:function(t){if(t){if(this._shown&&t!==this.getInsertParent()){o.appendContent(t,this._root);this.updatePosition();}this._insertParent=t;}return this;},show:function(){if(this._shown)return this;this.inform('beforeshow');m.setStyle(this._root,'visibility','hidden');m.setStyle(this._root,'overflow','hidden');m.show(this._root);o.appendContent(this.getInsertParent(),this._root);if(this.updatePosition()!==false){r.push(this);this._shown=true;this.inform('show');s.inform('show',this);}else o.remove(this._root);m.setStyle(this._root,'visibility','');m.setStyle(this._root,'overflow','');return this;},hide:function(){if(!this._shown||this.inform('beforehide')===false)return this;if(this.inform('starthide')!==false)this.finishHide();return this;},finishHide:function(){r.remove(this);this._shown=false;o.remove(this._root);this.inform('hide');s.inform('hide',this);},isShown:function(){return this._shown;},updatePosition:function(){return true;},destroy:function(){this.hide();this.destroyBehaviors();this.inform('destroy');s.inform('destroy',this);n.remove(this._root,'layer');this._root=null;}});Event.listen(document.documentElement,'keydown',function(event){if(q.filterEventTargets(event,'keydown'))for(var t=r.length-1;t>=0;t--)if(r[t].inform('key',event)===false)return false;},Event.Priority.URGENT);e.exports=s;});
__d("legacy:layer",["Layer"],function(a,b,c,d){a.Layer=b('Layer');},3);
var FriendListFlyoutController=(function(){var a,b,c=null,d=null,e,f,g,h,i,j,k=1500;function l(){clearTimeout(h);}function m(){if(e){CSS.removeClass(e,'selected');CSS.removeClass(e,'uiButtonHover');if(DataStore.get(e,'flfcloselistener')){var x=e;DataStore.set(e,'flfcloselistenertimeout',w.curry(x).defer(k));}}b=false;o();e=null;}function n(x){if(DOM.isNodeOfType(x,'label')&&CSS.hasClass(x,'uiButton'))x=Button.getInputElement(x);return DataStore.get(x,'profileid');}function o(){f&&f.remove();f=null;i&&Layer.unsubscribe(i);i=null;h&&clearTimeout(h);h=null;}function p(x){var y=n(x),z=DataStore.get(x,'flloc');FriendEditLists.init(c,y,z);CSS.conditionClass(c,'followButtonFlyout',CSS.hasClass(x,'profileFollowButton'));CSS.conditionClass(c,'friendButtonFlyout',CSS.hasClass(x,'FriendRequestFriends')||CSS.hasClass(x,'FriendRequestIncoming')||CSS.hasClass(x,'FriendRequestOutgoing'));CSS.conditionClass(c,'likeButtonFlyout',CSS.hasClass(x,'profileLikeButton'));var aa=DOM.scry(c,'div.uiScrollableArea')[0];aa&&ScrollableArea.poke(aa);}function q(x){if(!a||b)return;a.setContext(x);CSS.addClass(x,'selected');CSS.addClass(x,'uiButtonHover');a.setFixed(CSS.isFixed(x)).show();e=x;b=true;if(c){p(x);}else new AsyncRequest().setURI('/ajax/friends/lists/flyout_content.php').setStatusElement(a.getContent()).send();o();f=Event.listen(x,'mouseleave',s);i=Layer.subscribe('show',u);if(DataStore.get(x,'flfcloselistener'))clearTimeout(DataStore.remove(x,'flfcloselistenertimeout'));var y=n(x);FriendStatus.getFriend(y,function(z){if(!d)return;if(z.status==FriendStatus.OUTGOING_REQUEST){CSS.show(d);AsyncRequest.bootstrap('/ajax/friends/lists/nux_flyout.php',null,true);}else CSS.hide(d);});}function r(x){e=x;g=q.curry(x).defer(350);f=Event.listen(x,'mouseleave',function(){clearTimeout(g);e=null;f&&f.remove();});}function s(){h=u.defer(150);}function t(){var x=Dialog.getCurrent(),y=x&&x.getBody();return !!(y&&DOM.scry(y,'.friendListDialogTourCarousel')[0]);}function u(){if(j||t())return;ua.ie()<8&&document.documentElement.focus();a&&a.hide();}function v(event){var x=Parent.byTag(event.getTarget(),'a');if(x&&CSS.hasClass(x,'FriendListActionItem'))s();}function w(x){var y=DataStore.remove(x,'flfcloselistener');y&&y();}return {init:function(x){FriendListFlyoutController.init=bagofholding;a=x;a.subscribe('mouseenter',l);a.subscribe('mouseleave',s);a.subscribe('hide',m);if(c)DOM.setContent(a.getContent(),[c,d]);Event.listen(document.documentElement,'mouseover',function(y){var z=Parent.byClass(y.getTarget(),'enableFriendListFlyout');if(z)if(e===z){clearTimeout(h);}else{b&&u();r(z);}});Arbiter.subscribe('DynamicFriendListEducation/dialogOpen',function(){j=true;});Arbiter.subscribe('DynamicFriendListEducation/dialogClosed',function(){j=false;s();});},initContent:function(x){var y=x.getRootNode();DOM.appendContent(document.body,y);(function(){if(!c){c=y;a&&DOM.setContent(a.getContent(),[c,d]);CSS.show(c);Event.listen(c,'click',v);b&&p(e);}else{DOM.remove(y);y=null;}}).defer();},initNux:function(x){if(d)return;d=x.getRootNode();a&&DOM.setContent(a.getContent(),[c,d]);},show:function(x){q(x);},hide:function(x){x===false?u():s();},setActiveNode:function(x){b&&u();e=x;f=Event.listen(x,'mouseleave',function(){e=null;f&&f.remove();});},setCloseListener:function(x,y){DataStore.set(x,'flfcloselistener',y);if(e!=x)DataStore.set(x,'flfcloselistenertimeout',w.curry(x).defer(k));},setCloseListenerTimeout:function(x){k=x;}};})();
__d("legacy:dom-collect",["collectDataAttributes"],function(a,b,c,d){a.collect_data_attribs=b('collectDataAttributes');},3);
var AddFriendButton={ERROR_ALREADY_ADDED:1431005,init:function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m=DOM.scry(a,'.addButton')[0],n=DOM.scry(a,'.outgoingButton')[0],o=DOM.scry(a,'.incomingButton')[0],p=DOM.scry(a,'.friendButton')[0];function q(v,w,x){var y=new URI(m.getAttribute('ajaxify'));link_data=collect_data_attribs(a,['ft','gt']);new AsyncRequest().setURI(f).setData({to_friend:b,action:v,how_found:d,ref_param:e,link_data:link_data,outgoing_id:n.id,xids:y.getQueryData().xids,logging_location:g,no_flyout_on_click:h,ego_log_data:i,http_referer:k}).setErrorHandler(w).setServerDialogCancelHandler(x).setRelativeTo(n).send();}function r(v,w){m&&CSS.hide(m);n&&CSS.hide(n);o&&CSS.hide(o);p&&CSS.hide(p);if(v)CSS.show(v);if('Outgoing'==w&&l!=w&&j)animation(v).from('backgroundColor','#FFF8CC').to('backgroundColor','#FFFFFF').from('borderColor','#FFE222').to('borderColor','#FFFFFF').duration(2000).go();l&&CSS.removeClass(a,'fStatus'+l);l=w;CSS.addClass(a,'fStatus'+w);}function s(v){if(CSS.hasClass(v,'enableFriendListFlyout')){FriendListFlyoutController.show(v);}else FriendListFlyoutController.hide();}var t=Arbiter.subscribe(FriendRequestMessage.STATUS,function(v,w){if(w.uid!=b)return;switch(w.status){case FriendStatus.ARE_FRIENDS:return r(p,'Friends');case FriendStatus.INCOMING_REQUEST:return r(o,'Incoming');case FriendStatus.OUTGOING_REQUEST:return r(n,'Outgoing');case FriendStatus.CAN_REQUEST:return r(m,'Requestable');}}),u;if(c)u=Arbiter.subscribe(FriendRequestMessage.CONFIRM,function(v,w){w.uid==b&&goURI(c);});m&&Event.listen(m,'click',function(){Arbiter.inform(FriendRequestMessage.SENDING,{uid:b});if(h){FriendListFlyoutController.setActiveNode(n);}else s(n);q("add_friend",function(v){var w=v.error==AddFriendButton.ERROR_ALREADY_ADDED?FriendRequestMessage.SENT:FriendRequestMessage.SEND_FAIL;Arbiter.inform(w,{uid:b});FriendListFlyoutController.hide();AsyncResponse.defaultErrorHandler(v);},function(v){Arbiter.inform(FriendRequestMessage.SEND_FAIL,{uid:b});FriendListFlyoutController.hide();});});PageTransitions.registerHandler(function(){Arbiter.unsubscribe(t);u&&Arbiter.unsubscribe(u);});}};
var FriendButtonIcon={init:function(a,b,c){var d=DOM.find(b,'.defaultIcon'),e=DOM.find(b,'.closeIcon'),f=DOM.find(b,'.acqIcon');Arbiter.subscribe('FriendListMembershipChange',function(g,h){if(h.uid==c){var i=h.lists.contains(FriendStatus.CLOSE_FRIENDS),j=h.lists.contains(FriendStatus.ACQUAINTANCES);if(i&&!j){Button.setIcon(a,e);}else if(j&&!i){Button.setIcon(a,f);}else Button.setIcon(a,d);}});}};
__d("legacy:menu-legacy",["Menu"],function(a,b,c,d){a.Menu=b('Menu');},3);
var RespondToRequestButton={init:function(a,b,c){Event.listen(a,'click',function(){CSS.addClass(a,'uiButtonConfirm');CSS.addClass(a,'selected');b.show();});b.subscribe('hide',function(){CSS.removeClass(a,'uiButtonConfirm');CSS.removeClass(a,'selected');});Menu.subscribe('select',function(d,e){if(!CSS.hasClass(e.menu,'requestResponseMenu'))return;if(CSS.hasClass(e.item,'reject')){CSS.hide(a);CSS.show(c);}b.hide();});}};
function ContextualHelpLink(){}copy_properties(ContextualHelpLink,{set:function(a){var b=ge('navHelpCenter');if(b!==null)DOM.replace(b,a);}});
__d("legacy:array-utils",["ArrayUtils","hasArrayNature"],function(a,b,c,d){a.$A=b('ArrayUtils').createFrom;a.hasArrayNature=b('hasArrayNature');},3);
function show(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='';}return false;}function hide(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='none';}return false;}function shown(a){a=ge(a);return (a.style.display!='none'&&!(a.style.display==''&&a.offsetWidth==0));}function toggle(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display=CSS.getStyle(b,"display")=='block'?'none':'block';}return false;}function toggleDisplayNone(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);if(shown(b)){hide(b);}else show(b);}return false;}
__d("LayerFadeOnHide",["Animation","copyProperties","css","ua"],function(a,b,c,d,e,f){var g=b("Animation"),h=b("copyProperties"),i=b("css"),j=b("ua");function k(l){this._layer=l;}h(k.prototype,{_subscription:null,enable:function(){if(j.ie()<9)return;this._subscription=this._layer.subscribe('starthide',this._animate.bind(this));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}},_animate:function(){new g(this._layer.getRoot()).from('opacity',1).to('opacity',0).duration(250).ondone(this._finish.bind(this)).go();return false;},_finish:function(){this._layer.finishHide();i.setStyle(this._layer.getRoot(),'opacity','');}});e.exports=k;});
__d("legacy:LayerFadeOnHide",["LayerFadeOnHide"],function(a,b,c,d){a.LayerFadeOnHide=b('LayerFadeOnHide');},3);
__d("ContextualDialogFooterLink",["event-extensions","copyProperties","css-core","DOM"],function(a,b,c,d,e,f){b("event-extensions");var g=b("copyProperties"),h=b("css-core"),i=b("DOM");function j(k){this._layer=k;}g(j.prototype,{_subscriptions:null,enable:function(){var k=this._layer.getRoot(),l=i.scry(k,'.uiContextualDialogFooterLink')[0],m='uiContextualDialogHoverFooterArrow';this._subscriptions=[Event.listen(l,'mouseenter',h.addClass.curry(k,m)),Event.listen(l,'mouseleave',h.removeClass.curry(k,m))];},disable:function(){this._subscriptions.forEach(function(k){k.remove();});this._subscriptions=null;}});e.exports=j;});
__d("ContextualThing",["DOM","ge"],function(a,b,c,d,e,f){var g=b("DOM"),h=b("ge");function i(k){var l;while(k){if(k.getAttribute&&(l=k.getAttribute('data-ownerid')))return h(l);k=k.parentNode;}return null;}var j={register:function(k,l){k.setAttribute('data-ownerid',g.getID(l));},remove:function(k){k.removeAttribute('data-ownerid');},containsIncludingLayers:function(k,l){while(l){if(g.contains(k,l))return true;l=i(l);}return false;}};e.exports=j;});
__d("LayerCancel",["event-extensions","Parent","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Parent"),h=b("copyProperties");function i(j){this._layer=j;}h(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._handleClick.bind(this));},disable:function(){if(this._listener){this._listener.remove();this._listener=null;}},_handleClick:function(j){if(g.byClass(j.getTarget(),'layerCancel')){this._layer.inform('cancel')!==false&&this._layer.hide();j.prevent();}}});e.exports=i;});
__d("LayerDestroyOnHide",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b("function-extensions");var g=b("copyProperties");function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('hide',Function.prototype.defer.shield(this._layer.destroy.bind(this._layer)));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=h;});
__d("LayerFadeOnShow",["Animation","copyProperties","css-core","ua"],function(a,b,c,d,e,f){var g=b("Animation"),h=b("copyProperties"),i=b("css-core"),j=b("ua");function k(l){this._layer=l;}h(k.prototype,{_subscriptions:null,enable:function(){if(j.ie()<9)return;this._subscriptions=[this._layer.subscribe('beforeshow',function(){i.setStyle(this._layer.getRoot(),'opacity',0);}.bind(this)),this._layer.subscribe('show',this._animate.bind(this))];},disable:function(){if(this._subscriptions){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this._subscriptions=null;}},_animate:function(){var l=this._layer.getRoot();new g(l).from('opacity',0).to('opacity',1).duration(100).ondone(i.setStyle.curry(l,'opacity','')).go();}});e.exports=k;});
__d("LayerFormHooks",["event-extensions","Form","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Form"),h=b("copyProperties");function i(j){this._layer=j;}h(i.prototype,{_subscriptions:null,enable:function(){var j=this._layer.getRoot();this._subscriptions=[Event.listen(j,'submit',this._onSubmit.bind(this)),Event.listen(j,'success',this._onSuccess.bind(this)),Event.listen(j,'error',this._onError.bind(this))];},disable:function(){if(this._subscriptions){this._subscriptions.forEach(function(j){j.remove();});this._subscriptions=null;}},_onSubmit:function(j){var k=j.getTarget();if(this._layer.inform('submit')===false){j.kill();return;}var l=(g.getAttribute(k,'rel')==='async');if(!l)return this._onSuccess(j);},_onSuccess:function(j){this._layer.inform('success');},_onError:function(j){var k=j.getData();if(this._layer.inform('error',{response:k.response})===false)j.kill();}});e.exports=i;});
__d("LayerHideOnBlur",["event-extensions","Class","ContextualThing","copyProperties","LayerFadeOnHide"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("ContextualThing"),i=b("copyProperties"),j=b("LayerFadeOnHide");function k(l){this._layer=l;}i(k.prototype,{_listener:null,_layerSubscriptions:null,enable:function(){if(!this._layerSubscriptions){this._layerSubscriptions=[this._layer.subscribe('show',this._attachListener.bind(this)),this._layer.subscribe('hide',this._removeListener.bind(this))];if(this._layer.isShown())this._attachListener();}},disable:function(){this._removeListener();if(this._layerSubscriptions){while(this._layerSubscriptions.length)this._layer.unsubscribe(this._layerSubscriptions.pop());this._layerSubscriptions=null;}},_attachListener:function(){(function(){this._listener=Event.listen(document.documentElement,'click',function(l){if(!h.containsIncludingLayers(this._getNodeToCheck(),l.getTarget()))this._layer.disableBehavior(j).hide();}.bind(this));}).bind(this).defer();},_getNodeToCheck:function(){return this._layer.getRoot();},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}}});e.exports=k;});
__d("LayerHideOnEscape",["event-extensions","copyProperties","Keys"],function(a,b,c,d,e,f){b("event-extensions");var g=b("copyProperties"),h=b("Keys");function i(j){this._layer=j;}g(i.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('key',this._handle.bind(this));},disable:function(){this._layer.unsubscribe(this._subscription);this._subscription=null;},_handle:function(j,event){if(Event.getKeyCode(event)===h.ESC){this._layer.hide();return false;}}});e.exports=i;});
__d("LayerHideOnSuccess",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b("function-extensions");var g=b("copyProperties");function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));},disable:function(){if(this._subscription){this._layer.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=h;});
__d("LayerHideOnTransition",["Arbiter","Class","copyProperties"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("Class"),i=b("copyProperties");function j(k){this._layer=k;}i(j.prototype,{_subscription:null,enable:function(){this._subscription=g.subscribe('page_transition',this._layer.hide.shield(this._layer),g.SUBSCRIBE_NEW);},disable:function(){if(this._subscription){g.unsubscribe(this._subscription);this._subscription=null;}}});e.exports=j;});
__d("TabbableElements",["ArrayUtils","css"],function(a,b,c,d,e,f){var g=b("ArrayUtils"),h=b("css"),i={find:function(j){function k(n){if(n.tabIndex>0)return true;switch(n.tagName){case "A":return n.href&&n.rel!="ignore";case "INPUT":return n.type!="hidden"&&n.type!="file"&&!n.disabled;case "SELECT":return !n.disabled;case "TEXTAREA":return !n.disabled;default:return false;}}function l(n){if(n.offsetHeight===0&&n.offsetWidth===0)return true;var o=n;while(o&&o!=j&&h.getStyle(o,'visibility')!=='hidden')o=o.parentNode;return o!==j;}var m=g.createFrom(j.getElementsByTagName("*"));return m.filter(function(n){return k(n)&&!l(n);});}};e.exports=i;});
__d("LayerTabIsolation",["event-extensions","copyProperties","TabbableElements","Keys","Input"],function(a,b,c,d,e,f){b("event-extensions");var g=b("copyProperties"),h=b("TabbableElements"),i=b("Keys"),j=b("Input");function k(l){this._layer=l;}g(k.prototype,{_tabHandler:null,_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachHandler.bind(this)),this._layer.subscribe('hide',this._detachHandler.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this._detachHandler();},_attachHandler:function(){var l=this._layer.getRoot();this._tabHandler=Event.listen(l,'keydown',function(m){if(Event.getKeyCode(m)==i.TAB){var n=m.getTarget();if(n){var o=h.find(l),p=o[0],q=o[o.length-1],r=m.getModifiers().shift;if(r&&n==p){m.preventDefault();j.focus(q);}else if(!r&&n==q){m.preventDefault();j.focus(p);}}}});},_detachHandler:function(){if(this._tabHandler){this._tabHandler.remove();this._tabHandler=null;}}});e.exports=k;});
__d("LayerMouseHooks",["event-extensions","function-extensions","ContextualThing","DOM","Layer","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("ContextualThing"),h=b("DOM"),i=b("Layer"),j=b("copyProperties");function k(l){this._layer=l;}j(k.prototype,{_mouseSubscriptions:[],_layerSubscriptions:[],enable:function(){var l=this._layer.getRoot();this._mouseSubscriptions=[Event.listen(l,'mouseenter',this._onMouseEnter.bind(this)),Event.listen(l,'mouseleave',this._onMouseLeave.bind(this))];this._layerSubscriptions=[i.subscribe('show',this._onLayerShow.bind(this)),i.subscribe('hide',this._onLayerHide.bind(this))];},disable:function(){this._mouseSubscriptions.each(function(l){l.remove();});this._mouseSubscriptions=[];this._layerSubscriptions.each(function(l){i.unsubscribe(l);});this._layerSubscriptions=[];},_onMouseEnter:function(l){this._fireMouseLeaveOnLayerHide=false;if(!this._spawnedLayer)this._layer.inform('mouseenter');},_onMouseLeave:function(l){if(!this._spawnedLayer)this._layer.inform('mouseleave');this._fireMouseLeaveOnLayerHide=!!this._spawnedLayer;},_onLayerShow:function(l,m){var n=m.getContext&&m.getContext();if(n)if(h.contains(this._layer.getRoot(),n))this._spawnedLayer=m;},_onLayerHide:function(l,m){if(m===this._spawnedLayer){this._spawnedLayer=null;if(this._fireMouseLeaveOnLayerHide)this._onMouseLeave.bind(this).defer();}}});e.exports=k;});
__d("Overlay",["Arbiter","Class","css","DataStore","DOM","Layer","LayerCancel","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerTabIsolation","LayerMouseHooks","$","copyProperties"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("Class"),i=b("css"),j=b("DataStore"),k=b("DOM"),l=b("Layer"),m=b("LayerCancel"),n=b("LayerDestroyOnHide"),o=b("LayerFadeOnHide"),p=b("LayerFadeOnShow"),q=b("LayerFormHooks"),r=b("LayerHideOnBlur"),s=b("LayerHideOnEscape"),t=b("LayerHideOnSuccess"),u=b("LayerHideOnTransition"),v=b("LayerTabIsolation"),w=b("LayerMouseHooks"),x=b("$"),y=k.$N,z=b("copyProperties");function aa(){this.parent.construct(this);}h.extend(aa,l);z(aa.prototype,{_shouldBuildWrapper:true,init:function(ba){this.parent.init(ba);this._overlay=k.scry(this._root,'div.uiOverlay')[0]||this._root;i.hide(this._root);k.appendContent(this.getInsertParent(),this._root);j.set(this._overlay,'overlay',this);var ca=j.get(this._overlay,'width');ca&&this.setWidth(ca);if(this.setFixed)this.setFixed(j.get(this._overlay,'fixed')=='true');this.enableBehaviors([m,q,w,s,u,v]);if(j.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(p);if(j.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(o);if(j.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(t);if(j.get(this._overlay,'hideonblur')=='true')this.enableBehavior(r);if(j.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(n);return this;},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(ba){ba=this.parent._buildWrapper(ba);if(!this._shouldBuildWrapper)return ba;var ca=y('div',{className:'uiOverlayContent'},ba);return y('div',{className:'uiOverlay'},ca);},destroy:function(){j.remove(this._root,'overlay');this.parent.destroy();}});e.exports=aa;});
__d("ContextualDialogX",["event-extensions","Arbiter","Bootloader","Class","ContextualDialogFooterLink","ContextualThing","css","DataStore","DOM","Locale","Overlay","Parent","Vector","$","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("Bootloader"),i=b("Class"),j=b("ContextualDialogFooterLink"),k=b("ContextualThing"),l=b("css"),m=b("DataStore"),n=b("DOM"),o=b("Locale"),p=b("Overlay"),q=b("Parent"),r=b("Vector"),s=b("$"),t=b("copyProperties"),u=b("getOverlayZIndex");function v(){this.parent.construct(this);}i.extend(v,p);t(v,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:8,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(w){var x=m.get(w,'ContextualDialogX');if(!x){var y=q.byClass(w,'uiOverlay');if(y)x=m.get(y,'overlay');}return x;}});t(v.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_hovercardSubscription:null,init:function(w){this.parent.init(w);var x=m.get.curry(this._root);this.setAlignH(x('alignh','left'));this.setOffsetX(x('offsetx',0));this.setOffsetY(x('offsety',0));this.setPosition(x('position','above'));this._hasFooter=x('hasfooter',false);if(this._hasFooter){var y=n.scry(this._root,'.uiContextualDialogFooterLink')[0];y&&this.enableBehavior(j);}var z=x('context');if(z){this.setContext(s(z));}else{z=x('contextselector');if(z)this.setContext(n.find(document,z));}this._content=n.scry(this._root,'.uiContextualDialogContent')[0];var aa=null,ba=null;this._showSubscription=this.subscribe('show',function(){var ca=this.updatePosition.shield(this);aa=Event.listen(window,'resize',ca);ba=g.subscribe('reflow',ca);this._setupScrollListener(this._scrollParent);k.register(this._root,this.context);g.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){aa.remove();g.unsubscribe(ba);this._teardownScrollListener();k.remove(this._root);g.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));this._hovercardSubscription=g.subscribe('Hovercard/hide',function(ca,da){if(a.Hovercard.contains(this.getContext()))this.hide();}.bind(this));return this;},_buildWrapper:function(w){var x=this.parent._buildWrapper(w);if(!this._shouldBuildWrapper)return x;l.addClass(x,'uiContextualDialog');return n.create('div',{className:'uiContextualDialogPositioner'},x);},setWidth:function(w){this._width=Math.floor(w);return this;},setFixed:function(w){w=!!w;l.conditionClass(this._root,'uiContextualDialogFixed',w);this._fixed=w;return this;},setAlignH:function(w){this.alignH=w;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(w){w=s(w);if(this.context&&this.context!=w)m.remove(this.context,'ContextualDialogX');this.context=w;var x=q.byClass(w,'fbPhotoSnowlift');this.setInsertParent(x||n.getDocumentBodyElement());if(this._scrollListener&&this._scrollParent!==x){this._teardownScrollListener();this._setupScrollListener(x);}this._scrollParent=x;var y=u(w,this._insertParent);l.setStyle(this._root,'z-index',y>200?y:'');m.set(this.context,'ContextualDialogX',this);return this;},listen:function(w,x){return Event.listen(this._root,w,x);},setOffsetX:function(w){this.offsetX=parseInt(w,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(w){this.offsetY=parseInt(w,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(w){this.position=w;for(var x in v.POSITION_TO_CLASS)l.conditionClass(this._root,v.POSITION_TO_CLASS[x],w==x);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;if(this._width)l.setStyle(this._overlay,'width',this._width+'px');var w=this._fixed?'viewport':'document',x=r.getElementPosition(this.context,w),y=this._scrollParent;if(y)x=x.sub(r.getElementPosition(y,'document')).add(y.scrollLeft,y.scrollTop);var z=r.getElementDimensions(this.context),aa=this.position=='above'||this.position=='below',ba=o.isRTL();if((this.position=='right'||(aa&&this.alignH=='right'))!=ba)x=x.add(z.x,0);if(this.position=='below')x=x.add(0,z.y);var ca=new r(0,0);if(aa&&this.alignH=='center'){ca=ca.add((z.x-this._width)/2,0);}else{var da=aa?z.x:z.y,ea=2*v.ARROW_INSET;if(da<ea){var fa=da/2-v.ARROW_INSET;ca=ca.add(aa?fa:0,aa?0:fa);}}ca=ca.add(this.offsetX,this.offsetY);if(ba)ca=ca.mul(-1,1);x=x.add(ca);if(this._fixed)x=new r(x.x,x.y,'document');x.setElementPosition(this._root);this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)h.loadModules(["DOMScroll"],function(w){w.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);g.unsubscribe(this._hovercardSubscription);this.context&&m.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){l.setStyle(this._overlay,'top','');return;}var w=r.getElementPosition(this._root,'viewport').y,x=r.getElementDimensions(this._overlay).y,y=r.getViewportDimensions().y,z=v.TOP_MARGIN,aa=Math.min(Math.max(0,w+x+v.BOTTOM_MARGIN-y),Math.max(-z,w-z),x-2*v.ARROW_INSET);l.setStyle(this._overlay,'top',(-1*aa)+'px');l.setStyle(this._arrow,'top',v.ARROW_OFFSET+'px');l.setStyle(this._arrow,'marginTop',aa+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){l.setStyle(this._overlay,'left','');l.setStyle(this._overlay,'right','');return;}var w=r.getElementPosition(this._root,'viewport').x,x=r.getElementDimensions(this._overlay).x,y=r.getViewportDimensions().x,z=o.isRTL(),aa;if(!z){aa=w+x+v.RIGHT_MARGIN-y;}else aa=v.LEFT_MARGIN+x-w;aa=Math.min(Math.max(0,aa),x-2*v.ARROW_INSET);l.setStyle(this._overlay,z?'right':'left',-1*aa+'px');l.setStyle(this._arrow,z?'right':'left',v.ARROW_OFFSET+'px');l.setStyle(this._arrow,z?'marginRight':'marginLeft',aa+'px');},_updateArrow:function(){var w=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':w=50;break;case 'right':w=100;break;}this._renderArrow(v.POSITION_TO_ARROW[this.position],w);},_renderArrow:function(w,x){for(var y in v.ARROW_CLASS)l.conditionClass(this._overlay,v.ARROW_CLASS[y],w==y);l.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',w=='bottom'&&this._hasFooter);if(w=='none')return;if(!this._arrow){this._arrow=n.create('i',{className:'uiContextualDialogArrow'});n.appendContent(this._overlay,this._arrow);}l.setStyle(this._arrow,'top','');l.setStyle(this._arrow,'left','');l.setStyle(this._arrow,'right','');l.setStyle(this._arrow,'margin','');var z=w=='top'||w=='bottom',aa=z?(o.isRTL()?'right':'left'):'top';x=x||0;l.setStyle(this._arrow,aa,x+'%');var ba=v.ARROW_LENGTH+v.ARROW_OFFSET*2;l.setStyle(this._arrow,'margin-'+aa,-(ba*x/100-v.ARROW_OFFSET)+'px');},_updateAlignmentClass:function(){l.conditionClass(this._root,v.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(w){this._scrollListener=Event.listen(w||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){this._scrollListener.remove();this._scrollListener=null;}});e.exports=v;});
__d("Toggler",["array-extensions","event-extensions","Arbiter","ArbiterMixin","ArrayUtils","Class","ContextualDialogX","ContextualThing","css","DataStore","Dialog","DOM","ObjectUtils","copyProperties","ge"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("Arbiter"),h=b("ArbiterMixin"),i=b("ArrayUtils"),j=b("Class"),k=b("ContextualDialogX"),l=b("ContextualThing"),m=b("css"),n=b("DataStore"),o=b("Dialog"),p=b("DOM"),q=b("ObjectUtils"),r=b("copyProperties"),s=b("ge"),t=[],u;function v(){v=bagofholding;Event.listen(document.documentElement,'click',function(event){var z=event.getTarget();t.each(function(aa){aa.active&&!aa.sticky&&!l.containsIncludingLayers(aa.getActive(),z)&&!aa.inTargetFlyout(z)&&aa.inActiveDialog()&&aa.hide();});},Event.Priority.URGENT);}var w=function(){this.active=null;this.togglers={};this.setSticky(false);t.push(this);this.subscribe(['show','hide'],w.inform.bind(w));return v();};j.mixin(w,h,{show:function(z){var aa=x(this,z),ba=aa.active;if(z!==ba){ba&&aa.hide();aa.active=z;m.addClass(z,'openToggler');var ca=p.scry(z,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))m.removeClass(s(ca[0].getAttribute('data-target')),'toggleTargetClosed');p.appendContent(z,aa.getToggler('next'));p.prependContent(z,aa.getToggler('prev'));aa.inform('show',aa);}},hide:function(z){var aa=x(this,z),ba=aa.active;if(ba&&(!z||z===ba)){m.removeClass(ba,'openToggler');var ca=p.scry(ba,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))m.addClass(s(ca[0].getAttribute('data-target')),'toggleTargetClosed');q.getValues(aa.togglers).each(p.remove);aa.inform('hide',aa);aa.active=null;}},toggle:function(z){var aa=x(this,z);if(aa.active===z){aa.hide();}else aa.show(z);},getActive:function(){return x(this).active;},isShown:function(){return x(this).active&&m.hasClass(x(this).active,'openToggler');},inTargetFlyout:function(z){var aa=y(this.getActive());return aa&&l.containsIncludingLayers(aa,z);},inActiveDialog:function(){var z=o.getCurrent();return !z||p.contains(z.getRoot(),this.getActive());},getToggler:function(z){var aa=x(this);if(!aa.togglers[z])aa.togglers[z]=p.create('button',{className:'hideToggler',onfocus:function(){var ba=p.scry(aa.active,'a[rel="toggle"]')[0];ba&&ba.focus();aa.hide();}});return this.togglers[z];},setSticky:function(z){var aa=x(this);z=z!==false;if(z!==aa.sticky){aa.sticky=z;if(z){aa._pt&&g.unsubscribe(aa._pt);}else aa._pt=g.subscribe('page_transition',aa.hide.bind(aa,null));}return aa;}});r(w,w.prototype);r(w,{bootstrap:function(z){var aa=z.parentNode;w.getInstance(aa).toggle(aa);},createInstance:function(z){var aa=new w().setSticky(true);n.set(z,'toggler',aa);return aa;},getInstance:function(z){while(z){var aa=n.get(z,'toggler');if(aa)return aa;if(m.hasClass(z,'uiToggleContext'))return w.createInstance(z);z=z.parentNode;}return (u=u||new w());},listen:function(z,aa,ba){return w.subscribe(i.createFrom(z),function(ca,da){if(da.getActive()===aa)return ba(ca,da);});},subscribe:(function(z){return function(aa,ba){aa=i.createFrom(aa);if(aa.contains('show'))t.each(function(ca){if(ca.getActive())ba.curry('show',ca).defer();});return z(aa,ba);};})(w.subscribe.bind(w))});function x(z,aa){if(z instanceof w)return z;return w.getInstance(aa);}function y(z){var aa=p.scry(z,'a[rel="toggle"]');if(aa.length>0&&aa[0].getAttribute('data-target'))return s(aa[0].getAttribute('data-target'));}e.exports=a.Toggler||w;});
__d("legacy:Toggler",["Toggler"],function(a,b,c,d){a.Toggler=b('Toggler');},3);
__d("InputSelection",["DOM","Input"],function(a,b,c,d,e,f){var g=b("DOM"),h=b("Input"),i={get:function(j){if(!document.selection)return {start:j.selectionStart,end:j.selectionEnd};var k=document.selection.createRange();if(k.parentElement()!==j)return {start:0,end:0};var l=j.value.length;if(g.isNodeOfType(j,'input')){return {start:-k.moveStart('character',-l),end:-k.moveEnd('character',-l)};}else{var m=k.duplicate();m.moveToElementText(j);m.setEndPoint('StartToEnd',k);var n=l-m.text.length;m.setEndPoint('StartToStart',k);return {start:l-m.text.length,end:n};}},set:function(j,k,l){if(typeof l=='undefined')l=k;if(document.selection){if(j.tagName=='TEXTAREA'){var m=(j.value.slice(0,k).match(/\r/g)||[]).length,n=(j.value.slice(k,l).match(/\r/g)||[]).length;k-=m;l-=m+n;}var o=j.createTextRange();o.collapse(true);o.moveStart('character',k);o.moveEnd('character',l-k);o.select();}else{j.selectionStart=k;j.selectionEnd=Math.min(l,j.value.length);h.focus(j);}}};e.exports=i;});
__d("StringEscape",[],function(a,b,c,d,e,f){var g={escapeJSQuotes:function(h){if(typeof h=='undefined'||h==null||!h.valueOf())return '';return h.toString().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/"/g,'\\x22').replace(/'/g,'\\\'').replace(/</g,'\\x3c').replace(/>/g,'\\x3e').replace(/&/g,'\\x26');},htmlSpecialChars:function(h){if(typeof h=='undefined'||h===null||!h.toString)return '';if(h===false){return '0';}else if(h===true)return '1';return h.toString().replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#039;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},htmlize:function(h){return g.htmlSpecialChars(h).replace(/\r\n|[\r\n]/g,'<br />');}};e.exports=g;});
__d("Typeahead",["array-extensions","ArbiterMixin","Class","DOM","DataStore","Parent","ge"],function(a,b,c,d,e,f){b("array-extensions");var g=b("ArbiterMixin"),h=b("Class"),i=b("DOM"),j=b("DataStore"),k=b("Parent"),l=b("ge");function m(n,o,p,q){this.args={data:n,view:o,core:p};j.set(q,'Typeahead',this);this.element=q;if(!l('uiTypeaheadGlobalStatus')){var r=i.create('div',{className:'accessible_elem',id:'uiTypeaheadGlobalStatus'});r.setAttribute('aria-live','polite');r.setAttribute('role','status');i.appendContent(document.body,r);var s=i.create('div',{className:'accessible_elem',id:'uiTypeaheadGlobalReader'});s.setAttribute('aria-live','assertive');s.setAttribute('role','status');i.appendContent(document.body,s);}}m.getInstance=function(n){var o=k.byClass(n,'uiTypeahead');return o?j.get(o,'Typeahead'):null;};h.mixin(m,g,{init:function(n){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(n||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var n=this.args.data;this.data=n;this.data.init();}return this.data;},getView:function(){if(!this.view){var n=this.args.view,o=l(n.node_id);if(!o){o=i.$N('div',{className:'uiTypeaheadView'});i.appendContent(this.element,o);}this.view=new window[n.ctor](o,n.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;},getCore:function(){if(!this.core){var n=this.args.core;this.core=new window[n.ctor](n.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(n){var o=this.core;this.data=this.args.data=n;n.init();if(o){o.data=n;o.initData();o.reset();}n.bootstrap();return n;},proxyEvents:function(){[this.data,this.view,this.core].each(function(n){n.subscribe(n.events,this.inform.bind(this));},this);},initBehaviors:function(n){if(window.TypeaheadBehaviors)n.each(function(o){(TypeaheadBehaviors[o]||bagofholding)(this);},this);}});e.exports=m;});
__d("TypeaheadUtil",["function-extensions","string-extensions"],function(a,b,c,d,e,f){b("function-extensions");b("string-extensions");var g=/[ ]+/g,h=/[^ ]+/g,i=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb\uff1a]/g,j={},k={a:"\u0430 \u00e0 \u00e1 \u00e2 \u00e3 \u00e4 \u00e5",b:"\u0431",c:"\u0446 \u00e7 \u010d",d:"\u0434 \u00f0 \u010f \u0111",e:"\u044d \u0435 \u00e8 \u00e9 \u00ea \u00eb \u011b",f:"\u0444",g:"\u0433 \u011f",h:"\u0445 \u0127",i:"\u0438 \u00ec \u00ed \u00ee \u00ef \u0131",j:"\u0439",k:"\u043a \u0138",l:"\u043b \u013e \u013a \u0140 \u0142",m:"\u043c",n:"\u043d \u00f1 \u0148 \u0149 \u014b",o:"\u043e \u00f8 \u00f6 \u00f5 \u00f4 \u00f3 \u00f2",p:"\u043f",r:"\u0440 \u0159 \u0155",s:"\u0441 \u015f \u0161 \u017f",t:"\u0442 \u0165 \u0167 \u00fe",u:"\u0443 \u044e \u00fc \u00fb \u00fa \u00f9 \u016f",v:"\u0432",y:"\u044b \u00ff \u00fd",z:"\u0437 \u017e",ae:"\u00e6",oe:"\u0153",ts:"\u0446",ch:"\u0447",ij:"\u0133",sh:"\u0448",ss:"\u00df",ya:"\u044f"};for(var l in k){var m=k[l].split(' ');for(var n=0;n<m.length;n++)j[m[n]]=l;}var o={};function p(v){return v?v.replace(i,' '):'';}function q(v){v=(''+v).toLowerCase();var w='',x='';for(var y=v.length;y--;){x=v.charAt(y);w=(j[x]||x)+w;}return w.replace(g,' ');}function r(v){var w=[],x=h.exec(v);while(x){x=x[0];w.push(x);x=h.exec(v);}return w;}function s(v,w){v=''+v;if(!o.hasOwnProperty(v)){var x=q(v),y=p(x);o[v]={value:v,flatValue:x,tokens:r(y),isPrefixQuery:y&&y[y.length-1]!=' '};}if(w&&typeof o[v].sortedTokens=='undefined'){o[v].sortedTokens=o[v].tokens.slice();o[v].sortedTokens.sort(function(z,aa){return aa.length-z.length;});}return o[v];}function t(v,w,x){var y=s(w,v=='prefix'),z=v=='prefix'?y.sortedTokens:y.tokens,aa=s(x).tokens,ba={},ca=y.isPrefixQuery&&v=='query'?z.length-1:null,da=function(ea,fa){for(var ga=0;ga<aa.length;++ga){var ha=aa[ga];if(!ba[ga]&&(ha==ea||((v=='query'&&fa===ca||v=='prefix')&&ha.indexOf(ea)===0)))return (ba[ga]=true);}return false;};return z.length&&z.every(da);}var u={parse:s,isExactMatch:t.curry('exact'),isQueryMatch:t.curry('query'),isPrefixMatch:t.curry('prefix')};e.exports=u;});
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Class","css","DataStore","DOM","HTML","Input","InputSelection","Parent","StringEscape","Typeahead","TypeaheadUtil","ua","MentionsInputMatchers"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('css'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Parent'),q=b('StringEscape'),r=b('Typeahead'),s=b('TypeaheadUtil'),t=b('ua'),u=q.htmlize,v=b('MentionsInputMatchers');function w(x){k.set(x,'MentionsInput',this);this._root=x;}w.getInstance=function(x){var y=p.byClass(x,'uiMentionsInput');return y?k.get(y,'MentionsInput'):null;};i.mixin(w,h,{init:function(x,y,z){this.init=bagofholding;this._initialized=true;this._typeahead=r.getInstance(l.find(this._root,'.mentionsTypeahead'));this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._input=this._typeahead.getCore().getElement();this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=x.max||6;this._metrics=z;if(t.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var aa=this._input.name;this._input.name=aa+'_text';this._hiddenInput.name=aa;}this._initEvents();this._initTypeahead();this.reset(y);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(x){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);j.setStyle(this._typeahead.getElement(),'height','auto');if(x){n.setValue(this._input,x.flattened);for(var y in x.mention_data)this._addToken({uid:y,text:x.mention_data[y],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getRawValue:function(){return n.getValue(this._hiddenInput);},checkValue:function(){var x=this._typeahead.getCore().getValue();if(v.trigger.exec(x)||x==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var x=this._update.bind(this);Event.listen(this._input,{input:x,keyup:x,change:x,focus:this._updateWidth.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(ba,ca){var da=ca.selected;this._addToken({uid:da.uid,text:da.text,type:da.type});this.updateValue();}.bind(this));var x=this._input,y=null,z=function(){if(y===null){y=n.getSubmitOnEnter(x);n.setSubmitOnEnter(x,false);}},aa=function(){if(y!==null){n.setSubmitOnEnter(x,y);y=null;}};this._typeahead.subscribe('render',z);this._typeahead.subscribe('reset',aa);this._typeahead.subscribe('highlight',function(ba,ca){ca.index>=0?z():aa();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().setFilter(this._filterResults.bind(this));},_filterResults:function(x){if(this._filterData===null){var y=o.get(this._input).start||0;for(var z=0;z<this._offsets.length;z++){var aa=this._offsets[z];if(y>aa[0]&&y<=aa[1]){this._filterData={caretIsInsideMention:true};return false;}}var ba=this._typeahead.getCore();this._filterData={value:ba.getValue(),rawValue:ba.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(v.mainMatcher.test(this._filterData.rawValue))return true;if(x.type!='user')return false;if(v.userMatcher.test(this._filterData.value))return true;return s.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(x));},_addToken:function(x){var y=x.uid;if(!this._mentioned.hasOwnProperty(y)){this._mentioned[y]=x;this._orderedUIDs.push(y);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(x){if(this._mentioned.hasOwnProperty(x)){delete this._mentioned[x];this._orderedUIDs.remove(x);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(x,y){var z=y.split(' '),aa=[];for(var ba=0;ba<z.length;ba++)if(x.indexOf(z[ba])!=-1)aa.push(z[ba]);z=aa;for(ba=1;ba<z.length;ba++)for(var ca=1;ca<z[ba-1].length+1;ca++)if(x.indexOf(z[ba-1].substr(0,ca)+z[ba])!=-1)z.splice(ba-1,1);while(x.indexOf(z.join(' '))==-1)z.splice(0,1);return z.join(' ');},_update:function(){var x=n.getValue(this._input);if(x==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var x=n.getValue(this._input),y=false;for(var z=0;z<this._orderedUIDs.length;++z){var aa=this._orderedUIDs[z],ba=this._mentioned[aa],ca=ba.text,da;if(ba.type=='user'&&(da=this._reduceToken(x,ca))!==''){if(da==ca.substring(0,ca.lastIndexOf(' '))&&x==this._value.substring(0,this._value.length-1)){x=x.substring(0,x.lastIndexOf(' '));y=true;}ba.text=da;}else if(!ca||x.indexOf(ca)==-1||typeof ca!=='string')this._removeToken(aa);}this._value=x;if(y)n.setValue(this._input,x);},updateValue:function(){var x=n.getValue(this._input),y=this._orderedUIDs,z=[],aa,ba,ca,da;for(da=0;da<y.length;++da){ba=this._mentioned[y[da]].text;x=x.replace(ba,function(ea,fa){z.push([fa,fa+ba.length]);return ba;});}for(da=0;da<y.length;++da){ca=y[da];ba=this._mentioned[ca].text;x=x.replace(ba,'@['+ca+':]');}aa=u(x);for(da=0;da<y.length;++da){ca=y[da];ba=this._mentioned[ca].text;aa=aa.replace('@['+ca+':]','<b>'+u(ba)+'</b>');ba=ba.replace(/[\\\]:]/g,function(ea){return '\\'+ea;});x=x.replace('@['+ca+':]','@['+ca+':'+ba+']');}if(t.ie()){aa=aa.replace(/ {2}/g,'&nbsp;<wbr />&nbsp;<wbr />');aa=aa.replace(/ (?=[^\/]|\/[^>])/g,'&nbsp;<wbr />');}this._offsets=z;this._hiddenInput.value=x;l.setContent(this._highlighterContent,m(aa));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var x=j.getStyle(this._input,'direction');if(x==this._dir)return;this._dir=x;j.setStyle(this._highlighter,'direction',x);if(x=='rtl'){j.setStyle(this._highlighter,'text-align','right');}else j.setStyle(this._highlighter,'text-align','left');},_updateWidth:function(){var x=j.getStyleFloat.curry(this._input),y=this._input.offsetWidth-x('paddingLeft')-x('paddingRight')-x('borderLeftWidth')-x('borderRightWidth');if(t.firefox())y-=2;if(t.ie()<=7){y-=j.getStyleFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(y,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var x=this._highlighter.offsetHeight,y=this._typeahead.getElement();if(x>y.offsetHeight){j.setStyle(y,'height',x+'px');g.inform('reflow');}}},_updateTypeahead:function(){var x=this._typeahead.getCore(),y=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)y=v.autoMatcher;x.matcher=y;x.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(x){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,x);if(x){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var x=this.getAuxContentRoot();return x&&x.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(x){var y=n.getValue(this._input);n.setValue(this._input,y+" "+x.text);this._addToken(x);this._update();},getMentions:function(){return this._mentioned;}});e.exports=w;});
__d("XHPTemplate",["event-extensions","DataStore","DOM","HTML","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("DataStore"),h=b("DOM"),i=b("HTML"),j=b("copyProperties");function k(m){this._model=m;}j(k.prototype,{render:function(){if(i.isHTML(this._model))this._model=h.setContent(document.createDocumentFragment(),this._model)[0];return this._model.cloneNode(true);},build:function(){return new l(this.render());}});j(k,{getNode:function(m,n){return k.getNodes(m)[n];},getNodes:function(m){var n=g.get(m,'XHPTemplate:nodes');if(!n){n={};var o=h.scry(m,'[data-jsid]');o.push(m);var p=o.length;while(p--){var q=o[p];n[q.getAttribute('data-jsid')]=q;q.removeAttribute('data-jsid');}g.set(m,'XHPTemplate:nodes',n);}return n;}});function l(m){this._root=m;this._populateNodes();}j(l.prototype,{_populateNodes:function(){this._nodes={};this._leaves={};var m=this._root.getElementsByTagName('*');for(var n=0,o=m.length;n<o;n++){var p=m[n],q=p.getAttribute('data-jsid');if(q){p.removeAttribute('data-jsid');this._nodes[q]=p;this._leaves[q]=!p.childNodes.length;}}},getRoot:function(){return this._root;},getNode:function(m){return this._nodes[m];},setNodeProperty:function(m,n,o){this.getNode(m)[n]=o;return this;},setNodeContent:function(m,n){if(!this._leaves[m])throw new Error("Can't setContent on non-leaf node: "+m);h.setContent(this.getNode(m),n);return this;}});e.exports=k;});
__d("OptimisticUFI",["event-extensions","string-extensions","Arbiter","AsyncRequest","AsyncResponse","CommentPrelude","css-core","DOM","Form","HTML","Input","math-extensions","MentionsInput","Parent","StringEscape","XHPTemplate"],function(a,b,c,d,e,f){b('event-extensions');b('string-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('CommentPrelude'),k=b('css-core'),l=b('DOM'),m=b('Form'),n=b('HTML'),o=b('Input'),p=b('math-extensions'),q=b('MentionsInput'),r=b('Parent'),s=b('StringEscape'),t=b('XHPTemplate'),u={COMMENT_SEND_EVENT:'ufi/comment',_commentSeqNo:0,init:function(v){this._commentTemplate=v;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var v=event.getTarget(),w=v.name=='comment'&&v.parentNode&&r.byClass(v,'optimistic_submit');if(!w)return true;var x=v.form,y=l.find(x,'textarea');if(o.isEmpty(y))return true;j.uncollapse(x);var z=this._commentTemplate.render(),aa=t.getNode(z,'text');l.setContent(aa,n(s.htmlize(trim(y.value))));var ba=l.scry(x,'ul.commentList')[0];if(!ba)return true;k.show(ba.parentNode);ba.appendChild(z);var ca=ba.lastChild,da=p.rand32();ca.id='optimistic_comment_'+da+'_'+this._commentSeqNo++;var ea=m.serialize(x);ea.comment_replace=ca.id;ea.comment=1;function fa(){new h(m.getAttribute(x,'action')).setData(ea).setRelativeTo(x).setErrorHandler(function(ha){k.addClass(ca,'uiUfiCommentFailed');i.defaultErrorHandler(ha);}).setServerDialogCancelHandler(function(){l.remove(ca);}).send();}Event.listen(t.getNode(z,'retry_link'),'click',fa);fa();y.value=y.style.height='';y.focus();var ga=q.getInstance(y);ga&&ga.reset();g.inform(u.COMMENT_SEND_EVENT,{form:x});return false;}};e.exports=u;});
__d("legacy:ufi-optimistic",["OptimisticUFI"],function(a,b,c,d){a.UFIOptimistic=b('OptimisticUFI');},3);
__d("legacy:user-activity",["UserActivity"],function(a,b,c,d){a.UserActivity=a.UserActivity||b('UserActivity');},3);
function TickerController(){}!function(){var a=1,b=2,c=3,d=4;copy_properties(TickerController,{_instances:{},_activeInstance:null,_placeholders:{},_logPositionChange:false,getInstance:function(e){var f=Parent.byClass($(e),'fbFeedTicker');return f?TickerController._instances[f.id]:null;},isLoaded:function(e){var f=TickerController._placeholders[e.id];return !f||f.status==c;},show:function(e,f){f=f||bagofholding;for(var g in TickerController._instances){var h=ge(g);if(!h||h.parentNode.id==e.id)continue;TickerController.hide(h.parentNode);}TickerController._doPositionChange(e);CSS.show(e);var i=TickerController._placeholders[e.id];if(i&&i.status==a){TickerController._fetchTickerForPlaceholder(e,f);}else{var j=DOM.scry(e,'.fbFeedTicker')[0],k=j&&TickerController.getInstance(j);TickerController._activeInstance=k;k&&k._poll();TickerController._placeholders[e.id]={status:d,callback:f};f();}},_doPositionChange:function(e){if(!TickerController._logPositionChange||CSS.shown(e))return;new AsyncSignal('/common/ods_endpoint.php',{k:'ticker.render.switch.'+e.id}).send();},hide:function(e){var f=DOM.scry(e,'.fbFeedTicker')[0],g=f&&TickerController.getInstance(f);g&&g.hideActiveStory();CSS.hide(e);},hideStoriesByClass:function(e){for(var f in TickerController._instances)DOM.scry($(f),e).forEach(CSS.hide);},hideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.hideStory(e);},undoHideStory:function(e){var f=e&&TickerController.getInstance(e);f&&f.undoHideStory(e);},_fetchTickerForPlaceholder:function(e,f){var g={handler:function(){TickerController._placeholders[e.id].status=c;f();}};UIPagelet.loadFromEndpoint('TickerPagelet',e.id,TickerController._placeholders[e.id].pageletData,g);TickerController._placeholders[e.id].status=b;},registerStoryDialog:function(e,f){Arbiter.subscribe('ticker/init',function(){var g=ge(e),h=g&&TickerController.getInstance(g);h&&h.registerStoryDialog(g,f);},Arbiter.SUBSCRIBE_ALL);},registerPlaceholder:function(e,f){var g=TickerController._placeholders[e];TickerController._placeholders[e]={status:a,pageletData:f};if(g&&g.status==d){TickerController.show($(e));g.callback();}}});}();copy_properties(TickerController.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_TARGET_HEIGHT_OFFSET:25,init:function(a,b,c){TickerController._instances[a.id]=this;TickerController._activeInstance=this;this._root=a;this._content=DOM.find(a,'.ticker_stream');this._stories=DOM.find(this._root,'.tickerActivityStories');this._scrollableArea=b;this._container=DOM.find(a,'div.uiScrollableAreaWrap');this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._removedStoryIDs=[];this._storiesToRemove=[];var d=Date.now();this._initTime=d;this._lastUpdate=d;this._lastPull=d;this._lastInsert=d;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=DOM.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!Parent.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();this._ua={flyout:user_action('ticker_flyout').set_namespace('ticker').set_ua_id('flyout'),flyout_prefetch:user_action('ticker_flyout_prefetch').set_namespace('ticker').set_ua_id('flyout_prefetch'),flyout_loadtime:user_action('ticker_flyout_loadtime').set_namespace('ticker').set_ua_id('flyout_loadtime'),stream:user_action('ticker_stream').set_namespace('ticker').set_ua_id('stream')};this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var e=$N('div',{className:'storyQueue hidden_elem'});this._storyQueue=e;DOM.appendContent(this._root,e);this._initObjectIDs();this._initPageletCache(c);this._initConfig(c);this._resetMorePager();this._initListeners();this._initSubscriptions(c);Arbiter.inform('ticker/init',this,Arbiter.BEHAVIOR_PERSISTENT);this._poll();if(this._prefetchAfterLoad){this._logUserEvent('stream','prefetch');this._fetchStories(this._getInsertedStories().slice(0,5));}},_loadStoriesWithActions:function(){var a=ge('rightCol');if(!a)return;this._toggleWrapper=DOM.scry(a,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var b=DOM.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var c=0;c<b.length;c++){var d=b[c];this._storiesWithActions[d.getAttribute('data-story-key')]=d;}}},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController(this._root.parentNode.id,this);if(this._cache){copy_properties(a,this._cache.loadData());this._cache.registerCleanup('Ticker/cleanup');}}},_initConfig:function(a){copy_properties(this,{_newest:a.newest,_page_newest:a.newest,_timeout:a.timeout,_heartbeatTimeout:Math.max(15000,a.heartbeatTimeout),_pullTimeout:Math.max(30000,a.pullTimeout),_insertTimeout:a.insertTimeout,_friendCount:a.friendCount,_maxQueueLength:a.maxQueueLength,_heartbeatEndpoint:a.heartbeatEndpoint,_maxCustomQueueLength:a.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,a.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:a.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(a.insertTimeout,a.minForceUpdateInterval),_popupOnHover:a.popupOnHover,_priorityAppId:a.priorityAppId,_prefetchOnHover:a.prefetchStoriesOnHover,_userIdleTimeout:a.userIdleTimeout,_firstCustomStoryDelay:a.firstCustomStoryDelay,_pollOnly:a.pollOnly,_tickerDebug:a.tickerDebug,_tickerSource:a.tickerSource,_prefetchAfterLoad:a.prefetchAfterLoad,_logFlyouts:a.logFlyouts,_userScrollGaurdDelay:a.userScrollGaurdDelay,_rescheduleScrollToTopDelay:a.rescheduleScrollToTopDelay});this._queueCustomStories(a.customStories);},_initListeners:function(){this._listeners=Event.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=Event.listen(this._container,'scroll',throttle(this._handleScroll.bind(this)));this._initInfiniteScrollListener.bind(this).defer();},_initSubscriptions:function(a){onleaveRegister(this._cleanup.bind(this));this._subscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),Arbiter.subscribe(PresenceMessage.getArbiterMessageType('ticker_update'),this._handleTickerPush.bind(this)),Arbiter.subscribe('composer/publish',this._handleComposerPublish.bind(this)),Arbiter.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),Arbiter.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),Arbiter.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),Arbiter.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),Arbiter.subscribe(UFIOptimistic.COMMENT_SEND_EVENT,this._scrollDialogToBottom.bind(this)),Arbiter.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(a.pushChannel)this.setPushChannel(a.pushChannel);},_handleClick:function(event){var a=event.getTarget();if(this._getButtonFromNode(a)){this._logUserAction(a,'click',event);this._handleActionButton(event);return;}var b=this._getStoryFromNode(a),c=Parent.byClass(a,'tickerStoryAllowClick');if(!b||b==this._selectedStory||c)return;if(this._storyIsHidden(b))return;if(b==this._activeStory&&!this._selectedStory)this._selecting=true;this._clearNux();this._logUserEvent('flyout','click');this._logUserEvent('flyout_loadtime','open');if(this._storyCanOpenExternally(b)){var d=b.getAttribute('data-href');if(d&&!a.getAttribute('href')){var e={href:d},f=collect_data_attribs(a,['ft','gt']);user_action('click',e,event,'FORCE',f);}else this._logUserAction(a,'click',event);this._openStoryExternally(b,event);return;}this._logUserAction(a,'flyout',event);this._activateStory(b,'click');this._selectStory(b);},_handleMouseover:function(event){this._setLocked(true);var a=event.getTarget(),b=this._getOpenableStory(a);if(!b)return;event.kill();if(this._prefetchOnHover||this._popupOnHover){if(!(b.id in this._fetchedStories)){this._logUserEvent('flyout_prefetch','prefetch_on_hover');this._uaCurStoryIDPrefetch=b.id;}this._fetchStory(b);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var c=this._storyCanOpenExternally(b)?500:1000,d=this._activeStory?75:c;if(!window.addEventListener&&document.createEventObject)event=document.createEventObject(event);this._hoverShowTimeout=this._setTimeout(function(){this._logUserEvent('flyout','hover',d);this._logUserEvent('flyout_loadtime','open');this._activateStory(b,'hover');this._logUserAction(a,'flyout',event);}.bind(this),d);}},_handleMouseout:function(event){var a=event.getTarget();this._setLocked(false);if(a==this._getStoryFromNode(a)){var b=DOM.scry(a.parentNode,'.openToggler');for(var c=0;c<b.length;c++)Selector.toggle(b[c]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var a=this._activeStory;if(!a)return;var b=Event.getKeyCode(event);switch(b){case KEYS.UP:case KEYS.DOWN:var c=this._getInsertedStories(),d;if(event.getModifiers().any){d=b===KEYS.UP?0:c.length-1;}else d=c.indexOf(a)+(b===KEYS.UP?-1:1);a=c[d];break;case KEYS.ESC:this._deactivateStory(true);return;default:return;}if(!a)return;event.kill();this._activateStory(a,'keypress');this._selectStory(a);},_fadeTopmostStoryButton:function(){var a=0,b=15;if(this._storiesWithActions)for(var c in this._storiesWithActions){var d=this._storiesWithActions[c],e=DOM.scry(d,'.tickerInlineActionButton')[0],f=DOM.scry(e,'.tickerActionIcon')[0],g=Vector2.getElementPosition(e).y-Vector2.getElementPosition(this._toggleWrapper).y;if(g<a){CSS.setStyle(e,'opacity',0);CSS.setStyle(f,'opacity',0);}else if(g>=a&&g<b){var h=(g-a)/(b-a);CSS.setStyle(e,'opacity',h);CSS.setStyle(f,'opacity',h);break;}else{CSS.setStyle(e,'opacity',1);CSS.setStyle(f,'opacity',1);}}},_handleScroll:function(){this._fadeTopmostStoryButton();!this._preventScrollDismiss&&this._deactivateStory(true);this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var a=this._stories.childNodes.length,b=this._stories.getAttribute('data-gt'),c={ticker_scroll:1,number_stories:a,source:b};report_data('scroll',{gt:c});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();this._scrollableArea.adjustGripper();this._logUserEvent('stream','insert');},_handleActionButton:function(event){var a=event.getTarget(),b=this._getButtonFromNode(a),c=this._getOpenableStory(a),d=this._getStoryDialog(c);if(d)var e=d.subscribe('beforehide',function(){d.unsubscribe(e);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(a){animation(this._container).to('scrollTop',0).ease(animation.ease.end).ondone(a).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return DOM.scry(this._root,'div.fbFeedTickerStory');},_getInsertedStories:function(){return this._getAllStories().filter(function(a){return !CSS.hasClass(a,'queuedStory')&&!CSS.hasClass(a,'customStory');});},_getQueuedStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return DOM.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(a){return Parent.byClass(a,'tickerInlineOverlay');},_getStoryFromNode:function(a){return Parent.byClass(a,'fbFeedTickerStory');},_getActionButtonFromStory:function(a){return DOM.scry(a,'.tickerInlineActionButton')[0];},_getOpenableStory:function(a){var b=this._getStoryFromNode(a);return this._storyCanOpenDialog(b)?b:null;},_getStoryDialog:function(a){return window.ContextualDialogX&&ContextualDialogX.getInstance(a)||null;},_getStoryDialogEndpoint:function(a){return a&&a.getAttribute('data-rel')=='async'&&a.getAttribute('data-ajaxify')||null;},_storyCanOpenDialog:function(a){return !!this._getStoryDialogEndpoint(a)&&!this._storyIsHidden(a);},_storyCanOpenExternally:function(a){return !!a.getAttribute('data-href')||!this._storyCanOpenDialog(a);},_storyIsHidden:function(a){return CSS.hasClass(a,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(a){this._deactivateStory();CSS.addClass(a,'tickerStoryHidden');CSS.removeClass(a,'tickerStoryClickable');},undoHideStory:function(a){CSS.addClass(a,'tickerStoryClickable');CSS.removeClass(a,'tickerStoryHidden');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(a){this._scrollTopPromptVisible=a;CSS.conditionShow(this._scrollTopPrompt,a);if(a&&!this._listeners.scrollTop){this._listeners.scrollTop=Event.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!a&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !UserActivity.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){this._debug('poll');if(!this._isTickerVisible()){this._debug('not polling: ticker not visible');return;}if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var a=this._storiesToRemove.pop();this.removeStory(a);}if(this._isUserIdle()){this._debug('not polling: idle');return UserActivity.subscribeOnce(this._poll.bind(this));}var b=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(b);var c=Date.now(),d=c-this._lastInsert;if(d<this._insertTimeout||this._isLocked())return this._schedulePoll();var e=this._getQueuedStories(),f=this._getQueuedCustomStories(),g=e.length>0,h=f.length>0&&(c-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!g&&(c-this._lastCustomStory)>this._customStoryInsertTimeout));if(h){this.insertStory(f.shift());this._lastCustomStory=c;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;this._debug('not polling: should insert custom story');return this._schedulePoll();}if(g){this.insertStory(e.shift());this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;this._debug('not polling: should insert story');return this._schedulePoll();}var i=f.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&UserActivity.isActive(this.ADS_IDLE_MS)&&((c-this._lastUpdate)>this._minForceUpdateInterval),j=false,k=false;if(this._pollOnly){k=c-this._lastUpdate>this._heartbeatTimeout;}else j=(c-this._lastPull>this._pullTimeout);var l=(i&&this._doCustomUpdate)||j||k;if(!l)return this._schedulePoll();if(i)this._doCustomUpdate=false;this._debug('polling for new stories');this.update({pull:j,fullpoll:k,needcustomstory:i});},update:function(a){var b={newest:(a.fullpoll||a.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};copy_properties(b,a);new AsyncRequest().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(b).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(b.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(a,b,c){this._lastInsert=Date.now();window.LiveTimer&&LiveTimer.addTimeStamps(a);CSS.removeClass(a,'queuedStory');CSS.removeClass(a,'customStory');if(b!==false){var d=c?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var e=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(a,e);this._debug("insertStory: scheduled a scroll to top");}else this._scrollToTop(d.bind(this,a));}else DOM.prependContent(this._stories,a);if(this._storiesWithActions&&CSS.hasClass(a,'tickerStoryWithButton'))this._storiesWithActions[a.getAttribute('data-story-key')]=a;this._removeOldStories();},_removeOldStories:function(){var a=this._getInsertedStories();if(a.length<=this._maxStoriesToKeep)return;var b=this._minStoriesToKeep,c=a.slice(b);c.each(DOM.remove);if(this._storiesWithActions)for(var d=0;d<c.length;d++)delete this._storiesWithActions[c[d].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var a=this._getInsertedStories();if(!a||!a.length)return;var b=a[a.length-1].getAttribute('data-ticker-timestamp'),c=DOM.scry(this._root,'.tickerMorePager a')[0];if(!c||!b)return;var d=new URI(c.getAttribute('ajaxify'));d.addQueryData({oldest:b});c.setAttribute('ajaxify',d);},_setLocked:function(a){this._locked=a;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(a,b,c){var d=this._getStoryFromNode(a),e=d.getAttribute('data-story-key');DOM.setContent(d,b);CSS.addClass(d,'highlightedStory');this._setTimeout(this.removeStory.bind(this,e),c||6000);},_getStoryByStoryKey:function(a){var b=this._getAllStories();for(var c=0;c<b.length;c++){var d=b[c];if(d.getAttribute('data-story-key')==a)return d;}return null;},removeStory:function(a){this._removedStoryIDs[a]=true;var b=this._getStoryByStoryKey(a);if(!b)return;if(this._storiesWithActions)delete this._storiesWithActions[a];if(b==this._activeStory)this._deactivateStory();var c=this._getStoryDialog(b);c&&c.destroy();if(CSS.hasClass(b,'queuedStory')){DOM.remove(b);return;}this._animateStoryOut(b);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(a){var b=$N('div',{style:{marginTop:'-1000px'}},a);CSS.setStyle(b,'opacity',0);DOM.prependContent(this._stories,b);var c=Vector2.getElementDimensions(b).y;CSS.setStyle(b,'marginTop','-'+c+'px');this._isInsertingStory=true;animation(b).to('marginTop',0).ease(animation.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){DOM.replace(b,a);this._afterInsert(a);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(a,b){animation(this._stories).to('opacity',.5).ondone(function(){DOM.prependContent(this._stories,a);if(b)b();animation(this._stories).to('opacity',1).ondone(function(){this._afterInsert(a);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(a){var b=$N('div',{style:{overflow:'hidden',position:'relative'}});DOM.insertBeforeTemp(a,b);DOM.appendContent(b,a);animation(b).to('top',20).to('height',0).to('opacity',0).ease(animation.ease.end).ondone(function(){DOM.remove.curry(b);Arbiter.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(a){Arbiter.inform('Ticker/afterInsert');},setPushChannel:function(a){this._pushSubscription&&Arbiter.unsubscribe(this._pushSubscription);this._pushSubscription=Arbiter.subscribe(PresenceMessage.getArbiterMessageType(a),this._handleTickerPush.bind(this));requireLazy(['ChatConfig','ChannelConnection'],function(b,c){if(b.get('channel_disconnect_warning')){this._channelConnection=c;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}}.bind(this));},_checkChannelConnection:function(){CSS.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(a){this._priorityAppId=a;},_handleTickerPush:function(a,b){var c=b.obj;if(c.delete_id){this._storiesToRemove.push(c.delete_id);return;}if(c.noshow){this._debug('discarding story: dark launch');if(c.do_logging)this._logDarkLaunch(c);return;}var d=c.story_xhp;if(!d){this._debug('discarding story: no markup');return;}this._newest=c.story_time;var e=HTML(d).getRootNode();this.queueStory(e,c.flyout_js_cmds);},_handleComposerPublish:function(a,b){b.tickerMarkup&&this.insertStory(b.tickerMarkup);},_clearNux:function(){var a=DOM.scry(document.body,'div.tickerNUXContainer');if(a.length){a.each(function(b){var c=ContextualDialogX.getInstance(b);c&&c.hide();});new AsyncRequest().setURI('/ajax/feed/ticker/nux.php').send();}this._clearNux=bagofholding;},_logDarkLaunch:function(a){data={actor:a.actor,story_time:a.story_time,key:a.story_obj_id,dark:1};new AsyncRequest().setURI('/alite/push/log.php').setData({msg:JSON.stringify(data)}).send();},_logRender:function(){if(this._loggedRender)return;var a=this._tickerInSidebarMode;if(a||Parent.byClass(this._content,'home_right_column')){new AsyncSignal('/ajax/log_ticker_render.php',{sidebar_mode:a}).send();this._loggedRender=true;}},_isTickerVisible:function(){var a=(TickerController._activeInstance==this);a&&this._logRender();return a;},_handleResponse:function(a){var b=a.getPayload();if(b.newest)this._newest=this._page_newest=b.newest;if(b.content)if(b.cache_update&&this._cache){this._cache.insertStory(b.content);}else if(b.content instanceof Array){for(var c=0;c<b.content.length;c++)this.queueStoryMarkup(b.content[c]);}else this.queueStoryMarkup(b.content);if(b.custom_stories&&b.custom_stories.length){this._queueCustomStories(b.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(a){var b=HTML(a).getRootNode();this.queueStory(b);},dedupeStory:function(a){var b=a.getAttribute('data-story-key'),c=b&&(!!this._objectIDs[b]||!!this._removedStoryIDs[b]);if(c)this._debug('discarding story: duplicated object id');b&&(this._objectIDs[b]=true);return c;},queueStory:function(a,b){if(this.dedupeStory(a))return;CSS.addClass(a,'queuedStory');DOM.appendContent(this._storyQueue,a);var c=b&&b.length;if(c)b.each(function(e){new Function(e).apply();});a.setAttribute('id',a.id+'_'+this._root.id);var d=this._getQueuedStories();d.slice(0,-this._maxQueueLength).each(DOM.remove);if(c)this._fetchedStories[a.id]=true;},_queueCustomStories:function(a){while(a.length){var b=a.shift();b=HTML(b).getRootNode();var c=b.getAttribute('data-story-key');if(this.dedupeStory(b))continue;CSS.addClass(b,'customStory');DOM.appendContent(this._storyQueue,b);}var d=this._getQueuedCustomStories();d.slice(0,-this._maxQueueLength).each(DOM.remove);},_cleanup:function(){TickerController._placeholders.pagelet_rhc_ticker=null;if(!Parent.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.each(Arbiter.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&Arbiter.unsubscribe(this._pushSubscription);for(var a in this._listeners)this._listeners[a]&&this._listeners[a].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();Arbiter.inform('Ticker/cleanup');},_onNavHandler:function(a,b){var c=b.params.key;if(c!='lf'&&c!='h')this._cleanup();},registerStoryDialog:function(a,b){if(this._uaCurStoryIDFetch==a.id){this._uaCurStoryIDFetch=null;this._logUserEvent('flyout','fetch_success');}if(this._uaCurStoryIDPrefetch==a.id){this._uaCurStoryIDPrefetch=null;this._logUserEvent('flyout_prefetch','prefetch_success');}this._fetchedStories[a.id]=true;b.setContext(a);b.subscribe('hide',this._deactivateStory.bind(this,true));b.subscribe('success',this._focusStory.bind(this,a));b.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){b.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));b.subscribe('mouseleave',this._scheduleHide.bind(this));b.subscribe('show',function(){this._highlightDialogScrollbar.bind(this,b).defer();var c=Event.listen(b.getContent(),'click',function(){this._selectStory(a);c.remove();}.bind(this));}.bind(this));}if(a==this._activeStory){this._logUserEvent('flyout_loadtime','show_fetched');this._logUserEvent('flyout','show');this._openDialog(b);}},_highlightDialogScrollbar:function(a){var b=DOM.scry(a.getContent(),'.uiScrollableArea')[0];b&&ScrollableArea.poke(b);},_openStoryExternally:function(a,event){var b=a.getAttribute('data-href');if(!b||b=='#')return;var c=a.getAttribute('data-story-rel');switch(c){case 'theater':this._deactivateAndClearStory();Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(b,a);});return;case 'async':this._deactivateAndClearStory();Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(b,a);});return;}var d=a.getAttribute('data-target'),e=(event.which!=1||event.getModifiers().any||d=='_blank');e?window.open(b,'_blank'):goURI(b);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStory:function(a){clearTimeout(this._scrollDismissal);this._preventScrollDismiss=true;this._scrollDismissal=this._setTimeout(function(){this._preventScrollDismiss=false;}.bind(this),100);a.focus();},_selectStory:function(a){this._selectedStory=a;CSS.addClass(a,'tickerStorySelected');CSS.addClass(this._root,'tickerChildSelected');},_activateStory:function(a,b){this._clearHoverTimeouts();if(a==this._activeStory||!this._storyCanOpenDialog(a))return;this._deactivateStory();this._focusStory(a);this._activeStory=a;CSS.addClass(a,'tickerStoryActive');window.Toggler&&Toggler.hide();if(this._logFlyouts){b=b||'unknown';new AsyncSignal('/ajax/feed/ticker/flyout.php',{src:b}).send();}var c=this._getStoryDialog(a);if(c){this._logUserEvent('flyout_loadtime','show_prefetched');this._logUserEvent('flyout','show');this._openDialog(c);return;}if(!(a.id in this._fetchedStories)){this._uaCurStoryIDFetch=a.id;this._logUserEvent('flyout','fetch');}this._fetchStory(a);},_deactivateStory:function(a){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(a===true){this._dialog.enableBehavior(LayerFadeOnHide);}else this._dialog.disableBehavior(LayerFadeOnHide);this._dialog.hide();this._logUserEvent('flyout','close');}if(this._activeStory){CSS.removeClass(this._activeStory,'tickerStoryActive');CSS.removeClass(this._activeStory,'tickerStorySelected');CSS.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;document.activeElement.blur();},_logUserAction:function(a,b,event){user_action(b,a,event,'FORCE',null);},_logUserEvent:function(a,event){if(this._ua[a])this._ua[a].add_event(event);},_fetchStory:function(a){clearTimeout(this._fetchToken);var b=[],c=this._getInsertedStories(),d=c.indexOf(a);[-2,-1,0,1,2].each(function(e){var f=c[d+e];f&&b.push(f);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,b),100);},_fetchStories:function(a){var b=[],c,d=function(e){clearTimeout(c);a.each(function(f){CSS.conditionClass(f,'tickerStoryFetching',e);});};a=a.filter(function(e){if(e.id in this._fetchedStories)return false;this._fetchedStories[e.id]=true;var f=this._getStoryDialogEndpoint(e),g=URI(f).getQueryData();if(!f||!g)return false;g.uniq_id=e.getAttribute('id');g.referrer=this._tickerSource;b.push(g);return true;},this);if(!b.length)return;c=this._setTimeout(d.curry(true),500);new AsyncRequest('/ajax/feed/ticker/multi_story').setFinallyHandler(d.curry(false)).setErrorHandler(bagofholding).setData({stories:b}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_tickerDeClicker:function(event){var a=event.getTarget(),b=Parent.byTag(a,'a'),c=this._getStoryFromNode(a),d=this._getButtonFromNode(a);if(c&&b&&!d&&CSS.hasClass(c,'tickerStoryClickable')&&!CSS.hasClass(b,'tickerStoryAllowClick')&&!this._storyIsHidden(c)){b.setAttribute('rel','ignore');b.removeAttribute('onclick');b.removeAttribute('ajaxify');b.removeAttribute('href');}var e=(event.button==2),f=c&&this._getActionButtonFromStory(c);if(!e&&f)this._setClickedStory(c);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(a){this._clearClickedStory();CSS.addClass(a,'tickerStoryClicked');this._clickedStory=a;},_clearClickedStory:function(){if(this._clickedStory){CSS.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var a=this._getInsertedStories();if(this._storiesWithActions)for(var b=0;b<a.length;b++){var c=a[b];if(CSS.hasClass(c,'tickerStoryWithButton'))this._storiesWithActions[c.getAttribute('data-story-key')]=c;}var d=Math.max(0,a.length-this._autoloadStoryIndex);this._infiniteScrollStory=a[d];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var a=Vector2.getElementPosition(this._infiniteScrollStory).y,b=Vector2.getElementPosition(this._container).y+Vector2.getElementDimensions(this._container).y;if(a<b){var c=DOM.scry(this._root,'.tickerMorePager a')[0];if(c){var d=Parent.byClass(c,'stat_elem')||c,e=new AsyncRequest(c.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(c).setStatusElement(d).setAllowCrossPageTransition(true).send();this._logUserEvent('stream','scroll');}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(a){if(!this._selectedStory)return;var b=this._getStoryDialog(this._selectedStory);if(b){b.setFixed(a);b.updatePosition();}},_setTimeout:function(a,b){return setTimeout(a,b,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0],c=b&&ScrollableArea.getInstance(b);c&&c.scrollToBottom();},_openDialog:function(a){this._dialog=a.show();this._updateDialogPosition();this._writeSwfFrame(a);this._initCommentFocusListener.bind(this).defer();this._initContentResizeListener.bind(this).defer();this._stupidIE7VideoResizeHack(a);},_stupidIE7VideoResizeHack:function(a){if(ua.ie()===7){var b=DOM.scry(a.getContent(),'.uiVideoThumb .img');b.each(function(c){CSS.setStyle(c,'width','');});}},_updateDialogPosition:function(){var a=this._tickerInSidebarMode||!!Parent.byClass(this._root,'fixed_elem');this._dialog.setFixed(a);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(a){var b=this._dialog&&this._dialog.getContent(),c=DOM.scry(b,'.swfObject')[0];if(!c)return;var d=c.getAttribute('data-swfid');if(d&&window[d]){var e=window[d];e.write(c);}},_initCommentFocusListener:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.tickerDialogFooter textarea')[0];if(!b)return;this._listeners.inputFocus=Event.listen(b,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var a=this._dialog&&this._dialog.getContent();if(!a)return;this._listeners.contentResize=Event.listen(a,'click',function(){this._dialog.updatePosition.bind(this._dialog).defer();}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var a=this._dialog&&this._dialog.getContent(),b=a&&DOM.scry(a,'.uiScrollableAreaWrap')[0];if(!b)return;var c=Vector2.getElementDimensions(b),d=Vector2.getElementPosition(b),e=DOM.scry(b,'.uiUfi .uiUfiComment'),f=Vector2.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING,g=Math.min(this.FLYOUT_MAX_HEIGHT,f),h=g-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var i=0;i<e.length;i++){var j=e[i],k=Vector2.getElementPosition(j),l=k.y-d.y;if(Math.abs(l-h)<=this.FLYOUT_OFFSET_THRESHOLD){h=l+this.FLYOUT_COMMENT_OFFSET;break;}}if(c.y>h){CSS.setStyle(b,'height',h+'px');CSS.setStyle(b,'max-height',null);}else{CSS.setStyle(b,'max-height',g+'px');CSS.setStyle(b,'height',null);}},_initObjectIDs:function(){stories=this._getAllStories();for(var a=0;a<stories.length;++a){var b=stories[a].getAttribute('data-story-key');b&&(this._objectIDs[b]=true);}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},_debug:function(a){this._tickerDebug&&console.log('ticker: ',a);},getNewest:function(){return this._newest;}});
__d("legacy:intl-locale",["Locale"],function(a,b,c,d){a.intl_locale_is_rtl=b('Locale').isRTL;},3);
__d("ScrollAwareDOM",["css-core","DOM","DOMPosition","DOMQuery","HTML","Vector"],function(a,b,c,d,e,f){var g=b("css-core"),h=b("DOM"),i=b("DOMPosition"),j=b("DOMQuery"),k=b("HTML"),l=b("Vector");function m(q,r){return function(){p.monitor(arguments[q],r.curry.apply(r,arguments));};}function n(q){if(!(q instanceof Array))q=[q];for(var r=0;r<q.length;r++){var s=k.replaceJSONWrapper(q[r]);if(s instanceof k){return s.getRootNode();}else if(h.isNode(s))return s;}return null;}function o(q){return i.getElementPosition(q).y>=0;}var p={monitor:function(q,r){var s=n(q);if(s){var t=!!s.offsetParent;if(t&&o(s))return r();var u=l.getDocumentDimensions(),v=r();if(t||(s.offsetParent&&!o(s))){var w=l.getDocumentDimensions().sub(u);w.scrollElementBy(j.getDocumentScrollElement());}return v;}else return r();},replace:function(q,r){var s=n(r);if(!s||g.hasClass(s,'hidden_elem'))s=q;return p.monitor(s,function(){h.replace(q,r);});},insertBeforeTemp:m(1,h.insertBefore),prependContent:m(1,h.prependContent),insertAfter:m(1,h.insertAfter),insertBefore:m(1,h.insertBefore),setContent:m(0,h.setContent),appendContent:m(1,h.appendContent),remove:m(0,h.remove),empty:m(0,h.empty)};e.exports=p;});
__d("legacy:ScrollAwareDOM",["ScrollAwareDOM"],function(a,b,c,d){a.ScrollAwareDOM=b('ScrollAwareDOM');},3);
__d("legacy:dom-html",["HTML"],function(a,b,c,d){a.HTML=b('HTML');},3);
__d("legacy:dom-scroll",["DOMScroll"],function(a,b,c,d){a.DOMScroll=b('DOMScroll');},3);
__d("UntrustedLink",["copyProperties","event-extensions","URI","DOM","ua"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("event-extensions"),i=b("URI"),j=b("DOM"),k=b("ua");function l(m,n,o,p){this.dom=m;this.url=m.href;this.hash=n;this.func_get_params=p||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(h.$E(o));}l.bootstrap=function(m,n,o,p){if(m.__untrusted)return;m.__untrusted=true;new l(m,n,o,p);};l.prototype.getRewrittenURI=function(){var m=g({u:this.url,h:this.hash},this.func_get_params(this.dom)),n=new i('/l.php');return n.setQueryData(m).setSubdomain('www').setProtocol('http');};l.prototype.onclick=function(){(function(){this.setHref(this.url);}).bind(this).defer(100);this.setHref(this.getRewrittenURI());};l.prototype.onmousedown=function(m){if(m.button==2)this.setHref(this.getRewrittenURI());};l.prototype.onmouseup=function(){this.setHref(this.getRewrittenURI());};l.prototype.onmouseout=function(){this.setHref(this.url);};l.prototype.setHref=function(m){if(k.ie()<9){var n=j.create('span');j.appendContent(this.dom,n);this.dom.href=m;j.remove(n);}else this.dom.href=m;};e.exports=l;});
__d("legacy:dom-untrusted",["UntrustedLink"],function(a,b,c,d){a.UntrustedLink=b('UntrustedLink');},3);
__d("legacy:key-event-constants",["Keys"],function(a,b,c,d){a.KEYS=b('Keys');},3);
__d("legacy:link-controller",["LinkController"],function(a,b,c,d){a.LinkController=b('LinkController');},3);
__d("legacy:input-methods",["Input","copyProperties"],function(a,b,c,d){var e=b('Input'),f=b('copyProperties');f(a.Input||(a.Input={}),e);},3);
__d("legacy:input-selection",["InputSelection","copyProperties"],function(a,b,c,d){var e=b('InputSelection'),f=b('copyProperties');f(a.Input||(a.Input={}),{getSelection:e.get,setSelection:e.set});},3);
function link_rel_preload(){var a=/async(?:-post)?|dialog(?:-pipe|-post)?|theater|toggle/;document.documentElement.onmousedown=function(b){b=b||window.event;var c=b.target||b.srcElement,d=Parent.byTag(c,'A');if(!d)return;var e=d.getAttribute('ajaxify'),f=d.href,g=e||f;if(e&&f&&!(/#$/).test(f)){var h=b.which&&b.which!=1,i=b.altKey||b.ctrlKey||b.metaKey||b.shiftKey;if(h||i)return;}var j=d.rel&&d.rel.match(a);j=j&&j[0];switch(j){case 'dialog':case 'dialog-post':Bootloader.loadComponents('dialog');break;case 'dialog-pipe':Bootloader.loadComponents(['ajaxpipe','dialog']);break;case 'async':case 'async-post':Bootloader.loadComponents('async');break;case 'theater':Bootloader.loadComponents('PhotoSnowlift',function(){PhotoSnowlift.preload(g,d);});break;case 'toggle':Bootloader.loadComponents('Toggler');break;}return;};}
__d("Rect",["Vector","copyProperties"],function(a,b,c,d,e,f){var g=b("Vector"),h=b("copyProperties");function i(j,k,l,m,n){if(arguments.length===1){if(j instanceof i)return j;if(j instanceof g)return new i(j.y,j.x,j.y,j.x,j.domain);return i.getElementBounds($(j));}h(this,{t:j,r:k,b:l,l:m,domain:n||'pure'});}h(i.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(j){j=new i(j).convertTo(this.domain);var k=this;return (k.l<=j.l&&k.r>=j.r&&k.t<=j.t&&k.b>=j.b);},add:function(j,k){if(arguments.length==1){if(j.domain!='pure')j=j.convertTo(this.domain);return this.add(j.x,j.y);}var l=parseFloat(j),m=parseFloat(k);return new i(this.t+m,this.r+l,this.b+m,this.l+l,this.domain);},sub:function(j,k){if(arguments.length==1){return this.add(j.mul(-1));}else return this.add(-j,-k);},boundWithin:function(j){var k=0,l=0;if(this.l<j.l){k=j.l-this.l;}else if(this.r>j.r)k=j.r-this.r;if(this.t<j.t){l=j.t-this.t;}else if(this.b>j.b)l=j.b-this.b;return this.add(k,l);},getCenter:function(){return new g(this.l+this.w()/2,this.t+this.h()/2,this.domain);},getPositionVector:function(){return new g(this.l,this.t,this.domain);},getDimensionVector:function(){return new g(this.w(),this.h(),'pure');},convertTo:function(j){if(this.domain==j)return this;if(j=='pure')return new i(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new i(0,0,0,0);var k=new g(this.l,this.t,this.domain).convertTo(j);return new i(k.y,k.x+this.w(),k.y+this.h(),k.x,j);}});h(i,{deserialize:function(j){var k=j.split(':');return new i(k[1],k[2],k[3],k[0]);},newFromVectors:function(j,k){return new i(j.y,j.x+k.x,j.y+k.y,j.x,j.domain);},getElementBounds:function(j){return i.newFromVectors(g.getElementPosition(j),g.getElementDimensions(j));},getViewportBounds:function(){return i.newFromVectors(g.getScrollPosition(),g.getViewportDimensions());},minimumBoundingBox:function(j){var k=new i(Math.min(),Math.max(),Math.max(),Math.min()),l;for(var m=0;m<j.length;m++){l=j[m];k.t=Math.min(k.t,l.t);k.r=Math.max(k.r,l.r);k.b=Math.max(k.b,l.b);k.l=Math.min(k.l,l.l);}return k;}});e.exports=i;});
__d("legacy:rect",["Rect"],function(a,b,c,d){a.Rect=b('Rect');},3);
__d("AsyncRequestNectarLogging",["string-extensions","AsyncRequest","Env","copyProperties"],function(a,b,c,d,e,f){b("string-extensions");var g=b("AsyncRequest"),h=b("Env"),i=b("copyProperties");i(g.prototype,{setNectarModuleData:function(j){if(this.method=='POST'){var k=h.module;if(j&&k===undefined){var l={fbpage_fan_confirm:1},m=null;for(var n=j;n&&n!=document.body;n=n.parentNode){if(!n.id||typeof n.id!=='string')continue;if(n.id.startsWith('pagelet_')){k=n.id;break;}if(!m&&l[n.id])m=n.id;}if(k===undefined&&m)k=m;}if(k!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._mod=k;}}},setNectarImpressionId:function(){if(this.method=='POST'){var j=h.impid;if(j!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._impid=j;}}}});});
__d("legacy:async-postlude",["AsyncRequestNectarLogging"],function(a,b,c,d){b('AsyncRequestNectarLogging');},3);
var Base64=(function(){var a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function b(e){e=(e.charCodeAt(0)<<16)|(e.charCodeAt(1)<<8)|e.charCodeAt(2);return String.fromCharCode(a.charCodeAt(e>>>18),a.charCodeAt((e>>>12)&63),a.charCodeAt((e>>>6)&63),a.charCodeAt(e&63));}var c='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function d(e){e=(c.charCodeAt(e.charCodeAt(0)-43)<<18)|(c.charCodeAt(e.charCodeAt(1)-43)<<12)|(c.charCodeAt(e.charCodeAt(2)-43)<<6)|c.charCodeAt(e.charCodeAt(3)-43);return String.fromCharCode(e>>>16,(e>>>8)&255,e&255);}return {encode:function(e){e=unescape(encodeURI(e));var f=(e.length+2)%3;e=(e+'\0\0'.slice(f)).replace(/[\s\S]{3}/g,b);return e.slice(0,e.length+f-2)+'=='.slice(f);},decode:function(e){e=e.replace(/[^A-Za-z0-9+\/]/g,'');var f=(e.length+3)&3;e=(e+'AAA'.slice(f)).replace(/..../g,d);e=e.slice(0,e.length+f-3);try{return decodeURIComponent(escape(e));}catch(g){throw new Error('Not valid UTF-8');}},encodeObject:function(e){return Base64.encode(JSON.stringify(e));},decodeObject:function(e){return JSON.parse(Base64.decode(e));},encodeNums:function(e){return String.fromCharCode.apply(String,e.map(function(f){return a.charCodeAt((f|-(f>63))&-(f>0)&63);}));}};})();
__d("legacy:string-escape",["StringEscape"],function(a,b,c,d){var e=b('StringEscape');a.escape_js_quotes=e.escapeJSQuotes;a.htmlspecialchars=e.htmlSpecialChars;a.htmlize=e.htmlize;},3);
__d("legacy:object-extensions",["ObjectUtils"],function(a,b,c,d){var e=b('ObjectUtils');a.are_equal=e.areEqual;a.coalesce=e.coalesce;a.count=e.countKeys;a.is_scalar=e.isScalar;a.keys=e.getKeys;a.merge=e.merge;a.values=e.getValues;Object.from=e.createFrom;},3);
if(window==window.top)!function(){var a=function(){var b=0;return function(){if(!b){b=1;setTimeout(function(){b=0;var c=Vector2.getViewportDimensions();setCookie('wd',c.x+'x'+c.y);if(window.AsyncSignal&&Math.random()<.01)new AsyncSignal('/ajax/dimension_context.php',{x:c.x,y:c.y}).send();},100);}};}();onloadRegister_DEPRECATED(a);onloadRegister_DEPRECATED(function(){Event.listen(window,'resize',a);});onloadRegister_DEPRECATED(function(){Event.listen(window,'focus',a);});}();
__d("ErrorDialog",["Dialog"],function(a,b,c,d,e,f){var g=b("Dialog"),h={showAsyncError:function(i){try{return h.show(i.getErrorSummary(),i.getErrorDescription());}catch(j){alert(i);}},show:function(i,j,k,l){return (new g()).setTitle(i).setBody(j).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(k||bagofholding).setButtonsMessage(l||'').show();}};e.exports=h;});
__d("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__d("Hovercard",["event-extensions","function-extensions","ClickRef","Arbiter","AsyncRequest","AsyncSignal","ContextualDialogX","DOM","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","Parent","Rect","tx","ua","userAction","Vector"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');b('ClickRef');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncSignal'),j=b('ContextualDialogX'),k=b('DOM'),l=b('LayerDestroyOnHide'),m=b('LayerFadeOnHide'),n=b('LayerFadeOnShow'),o=b('Parent'),p=b('Rect'),q=b('tx'),r=b('ua'),s=b('userAction'),t=b('Vector'),u=297,v=237,w={},x={},y=null,z=null,aa=null,ba=150,ca=700,da=1000,ea=250,fa=null,ga=null,ha=null,ia=null;function ja(){if(r.ie()<7)return;Event.listen(document.documentElement,'mouseover',ka);Event.listen(window,'scroll',function(){ab.hide(true);});g.subscribe('page_transition',function(){qa();ab.dirtyAll();},g.SUBSCRIBE_NEW);g.subscribe('layer_shown',function(bb,cb){if(cb.type!='Hovercard'&&cb.type!='ContextualDialog')qa();},g.SUBSCRIBE_NEW);}function ka(event){var bb=o.byTag(event.getTarget(),'a');if(bb&&la(bb)){oa(bb);event.stop();}}function la(bb){z=bb;if(!ma(bb)){var cb;if(!bb||!(cb=na(bb))){x.moveToken&&x.moveToken.remove();x={};return false;}if(x.node!=bb){x.moveToken&&x.moveToken.remove();x={node:bb,endpoint:cb,pos:null};}}return true;}function ma(bb){return bb&&y&&x.node==bb;}function na(bb){return bb.getAttribute('data-hovercard');}function oa(bb){var cb=Event.listen(bb,'mouseout',function(){clearTimeout(fa);clearTimeout(ga);cb.remove();z=null;ab.hide();});if(!x.moveToken)x.moveToken=Event.listen(bb,'mousemove',function(event){x.pos=t.getEventPosition(event);});clearTimeout(fa);clearTimeout(ga);clearTimeout(ia);var db=ba,eb=y?ea:ca;if(bb.getAttribute('data-hovercard-instant'))db=eb=50;fa=setTimeout(wa.curry(bb),db);ga=setTimeout(pa.curry(bb),eb);}function pa(bb,cb){if(x.node!=bb)return;var db=w[na(bb)];if(db){ra(db);}else if(cb){ra(ya());}else{var eb=y?ea:ca;ha=setTimeout(pa.curry(bb,true),da-eb);}}function qa(){ab.hide(true);clearTimeout(ga);}function ra(bb){var cb=x.node,db=y,eb=db!=cb;if(y){var fb=j.getInstance(y);fb&&fb.hide();}if(!k.contains(document.body,cb)){ab.hide(true);return;}y=cb;aa=bb;sa();bb.setContext(cb).show();if(eb){(function(){new i('/ajax/hovercard/shown.php').send();s('himp',y,null,'FORCE',{ft:{evt:39}});}).defer();if(db){g.inform('Hovercard/hide',{node:db});}else g.inform('layer_shown',{type:'Hovercard'});g.inform('Hovercard/show',{node:cb});}}function sa(){var bb=t.getViewportDimensions(),cb=t.getElementPosition(y,'viewport'),db=cb.convertTo('document'),eb=va(y),fb='above',gb='left',hb=ua(db,eb,'above');if(cb.y+hb<=v){var ib=ua(db,eb,'below');if(cb.y+ib+y.offsetHeight+v<bb.y){fb='below';hb=ib;}}var jb=bb.x;if(a.ChatSidebar)jb-=a.ChatSidebar.getVisibleWidth();var kb=ta(db,eb,'left');if(cb.x+kb+u>=jb){var lb=ta(db,eb,'right');if(cb.x+lb+y.offsetWidth>u){gb='right';kb=lb;}}aa.setPosition(fb).setAlignH(gb).setOffsetX(kb).setOffsetY(hb);}function ta(bb,cb,db){if(db=='left')return cb.l-bb.x;return cb.r-(bb.x+y.offsetWidth);}function ua(bb,cb,db){if(db=='above')return cb.t-bb.y;return cb.b-(bb.y+y.offsetHeight);}function va(bb){var cb=x.pos,db=bb.getClientRects();if(!cb||db.length===0)return p.getElementBounds(bb);var eb,fb=false;for(var gb=0;gb<db.length;gb++){var hb=new p(Math.round(db[gb].top),Math.round(db[gb].right),Math.round(db[gb].bottom),Math.round(db[gb].left),'viewport').convertTo('document'),ib=hb.getPositionVector(),jb=ib.add(hb.getDimensionVector());if(!eb||(ib.x<=eb.l&&ib.y>eb.t)){if(fb)break;eb=new p(ib.y,jb.x,jb.y,ib.x,'document');}else{eb.t=Math.min(eb.t,ib.y);eb.b=Math.max(eb.b,jb.y);eb.r=jb.x;}if(hb.contains(cb))fb=true;}return eb;}function wa(bb){if(bb.id&&w[bb.id]!=null)return;var cb=na(bb);if(w[cb]!=null)return;xa(cb);var db=function(){ab.dirty(cb);qa();};new h(cb).setData({endpoint:cb}).setMethod('GET').setReadOnly(true).setErrorHandler(db).setTransportErrorHandler(db).send();}function xa(bb){w[bb]=false;}var ya=function(){var bb=new j();bb.init(k.create('div',{className:'HovercardLoading'},"Loading...")).disableBehavior(l).disableBehavior(n).disableBehavior(m);za(bb);ya=bagof(bb);return bb;};function za(bb){bb.subscribe('mouseenter',function(){clearTimeout(ia);z=x.node;});bb.subscribe('mouseleave',function(){ab.hide(false);z=null;});}var ab={hide:function(bb){if(!y)return;if(bb){if(aa){g.inform('layer_hidden',{type:'Hovercard'});g.inform('Hovercard/hide',{node:y});aa.hide();}z=null;y=null;aa=null;}else ia=setTimeout(ab.hide.curry(true),ea);},setDialog:function(bb,cb){w[bb]=cb;za(cb);if(x.endpoint==bb&&z==x.node)ra(cb);},contains:function(bb){if(aa)return k.contains(aa.getRoot(),bb);return false;},dirty:function(bb){var cb=w[bb];if(cb){cb.destroy();delete w[bb];}},dirtyAll:function(){for(var bb in w){var cb=w[bb];cb&&ab.dirty(bb);}}};if(!a.Hovercard){ja();}else ab=a.Hovercard;e.exports=ab;a.Hovercard=e.exports;});
__d("StickyController",["event-extensions","css","Vector","FunctionUtils","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css'),h=b('Vector'),i=b('FunctionUtils'),j=b('copyProperties');function k(l,m,n,o){this._element=l;this._marginTop=m;this._onchange=n;this._proxy=o||l.parentNode;}j(k.prototype,{handleScroll:function(){var l=h.getElementPosition(this._proxy,'viewport').y<=this._marginTop;if(this.isFixed()!==l){g.setStyle(this._element,'top',l?this._marginTop+'px':'');g.conditionClass(this._element,'fixed_elem',l);this._onchange&&this._onchange(l);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',i.throttle(this.handleScroll.bind(this),100));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return g.hasClass(this._element,'fixed_elem');}});a.StickyController=e.exports=k;},3);
__d("DocumentTitle",["array-extensions","Arbiter"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=document.title,i=null,j=1500,k=[],l=0,m=null,n=false;function o(){if(k.length>0){if(!n){p(k[l].title);l=++l%k.length;}else q();}else{clearInterval(m);m=null;q();}}function p(s){document.title=s;n=true;}function q(){r.set(i||h,true);n=false;}var r={get:function(){return h;},set:function(s,t){document.title=s;if(!t){h=s;i=null;g.inform('update_title',s);}else i=s;},blink:function(s){var t={title:s};k.push(t);if(m===null)m=setInterval(o,j);return {stop:function(){var u=k.indexOf(t);if(u>=0){k.splice(u,1);if(l>u){l--;}else if(l==u&&l==k.length)l=0;}}};}};a.DocumentTitle=e.exports=r;},3);
__d("Poller",["AsyncRequest","Cookie","copyProperties","Env","Util"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Cookie'),i=b('copyProperties'),j=b('Env'),k=b('Util');function l(m,n,o){this._clearOnQuicklingEvent=!o;this._requestCallback=n;this.setTimePeriod(m);}l.MIN_TIME_PERIOD=2000;i(l.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(m){m=m||null;if(m&&(isNaN(m)||m<l.MIN_TIME_PERIOD))return;if(m&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(m,this._clearOnQuicklingEvents);this._timePeriod=m;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var m=new g(),n=true;m.setInitialHandler(function(){return n;});this._cancelRequest=function(){n=false;};m.setFinallyHandler(this.scheduleRequest.bind(this));m.setInitialHandler=bagofholding;m.setFinallyHandler=bagofholding;this._requestCallback(m);if(n)m.send();},_isLoadUser:function(){return j.user==getCookie('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});a.Poller=e.exports=l;},3);
__d("legacy:env",["Env"],function(a,b,c,d){var e=b('Env');a.Env=e;},3);
__d("legacy:eval-global",["evalGlobal"],function(a,b,c,d){a.eval_global=b('evalGlobal');},3);
__d("PlaceholderOnsubmitFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('placeholder')&&g.isEmpty(i[j]))g.setValue(i[j],'');});});
__d("RequiredFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('required')&&g.isEmpty(i[j])){i[j].focus();return false;}},Event.Priority.URGENT);});
__d("legacy:onkeypress-flip-direction",["event-extensions","css","DOM","Input"],function(a,b,c,d){b('event-extensions');var e=b('css'),f=b('DOM'),g=b('Input');Event.listen(document.documentElement,'keyup',function(event){var h=event.getTarget();if(!f.isNodeOfType(h,['input','textarea']))return;if(f.isNodeOfType(h,'input')&&h.type=='password')return;if(h.getAttribute('data-prevent-auto-flip'))return;var i=g.getValue(h),j=(h.style&&h.style.direction);if(!j){var k=0,l=true;for(var m=0;m<i.length;m++){var n=i.charCodeAt(m);if(n>=48){if(l){l=false;k++;}if(n>=1470&&n<=1920){e.setStyle(h,'direction','rtl');return;}if(k==5){e.setStyle(h,'direction','ltr');return;}}else l=true;}}else if(i.length===0)e.setStyle(h,'direction','');});},3);
__d("LiveTimer",["css","DOM","ua"],function(a,b,c,d,e,f){var g=b("css"),h=b("DOM"),i=b("ua"),j={restart:function(k){this.serverTime=k;this.localStartTime=Date.now()/1000;this.updateTimeStamps();},updateTimeStamps:function(){j.timestamps=h.scry(document.body,'abbr.livetimestamp');j.startLoop(20000);},addTimeStamps:function(k){if(!k)return;j.timestamps=j.timestamps||[];if(h.isNodeOfType(k,'abbr')&&g.hasClass(k,'livetimestamp')){j.timestamps.push(k);}else{var l=h.scry(k,'abbr.livetimestamp');for(var m=0;m<l.length;++m)j.timestamps.push(l[m]);}j.startLoop(0);},startLoop:function(k){this.stop();this.timeout=setTimeout(function(){j.loop();},k);},stop:function(){clearTimeout(this.timeout);},updateNode:function(k,l){j.updateNode=(i.ie()<7)?function(m,n){m.nextSibling.nodeValue=n;}:function(m,n){m.firstChild.nodeValue=n;};j.updateNode(k,l);},loop:function(k){if(k)j.updateTimeStamps();var l=Math.floor(Date.now()/1000-j.localStartTime),m=-1;j.timestamps&&j.timestamps.each(function(o){var p=o.getAttribute('data-utime'),q=j.renderRelativeTime(j.serverTime+l,p);if(q.text)j.updateNode(o,q.text);if(q.next!=-1&&(q.next<m||m==-1))m=q.next;});if(m!=-1){var n=Math.max(20000,m*1000);j.timeout=setTimeout(function(){j.loop();},n);}},renderRelativeTime:function(k,l){var m={text:"",next:-1};if(k-l>(12*3600)||(new Date(k*1000).getDay()!=new Date(l*1000).getDay()))return m;var n=k-l,o=Math.floor(n/60),p=Math.floor(o/60);if(o<1){m.text="a few seconds ago";m.next=60-n%60;return m;}if(p<1){if(o==1){m.text="about a minute ago";}else m.text=tx._("{number} minutes ago",{number:o});m.next=60-n%60;return m;}if(p!=11)m.next=3600-n%3600;if(p==1){m.text="about an hour ago";return m;}m.text=tx._("{number} hours ago",{number:p});return m;}};e.exports=j;});
__d("legacy:live-timer",["LiveTimer"],function(a,b,c,d){a.LiveTimer=b('LiveTimer');},3);
var MegaphoneHelper={hideStory:function(a,b,c,d,e){var f={mp_id:a,location:b,context:d};new AsyncRequest().setURI('/ajax/megaphone/megaphone_hide.php').setMethod('POST').setData(f).setHandler(function(h){e&&e(h);}).send();var g=ge(c);if(g)animation(g).to('height',0).duration(500).hide().go();},createModalStory:function(a,b,c,d){var e;if(!a.buttons||!a.buttons.length){a.buttons=Dialog.CLOSE;e=this.hideStory.bind(this,b,c,d,null);}var f=new Dialog(a);if(e)f.setHandler(e);f.show();},buttonOnClick:function(a,b,c,d,e,f){var g=function(){if(e){new AsyncRequest().setURI(d).send();}else document.location.href=d;};if(f){this.hideStory(a,b,'',c,function(){g();});}else g();}};
__d("CallbackManagerController",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=function(i,j){this._pending=[];this._callbackArgHandler=i;this._unavailableResourcesHandler=j;};g(h.prototype,{executeOrEnqueue:function(i,j,k){k=k||{};var l=this._attemptCallback(j,i,k);if(l)return [];this._pending.push({fn:j,request:i,options:k});return this._unavailableResourcesHandler(i,k);},runPossibleCallbacks:function(){var i=this._pending;this._pending=[];var j=[];i.forEach(function(k){if(this._callbackArgHandler(k.request,k.options)){j.push(k);}else this._pending.push(k);}.bind(this));j.forEach(function(k){this._attemptCallback(k.fn,k.request,k.options);}.bind(this));},_attemptCallback:function(i,j,k){var l=this._callbackArgHandler(j,k);l&&i(l);return !!l;}});e.exports=h;});
__d("KeyedCallbackManager",["CallbackManagerController","copyProperties"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=function(){this._resources={};this._controller=new g(this._constructCallbackArg.bind(this),this._getUnavailableResources.bind(this));};h(i.prototype,{executeOrEnqueue:function(j,k){if(!(j instanceof Array)){var l=j,m=k;j=[j];k=function(n){m(n[l]);};}return this._controller.executeOrEnqueue(j,k);},addResourcesAndExecute:function(j){h(this._resources,j);this._controller.runPossibleCallbacks();},setResource:function(j,k){this._resources[j]=k;this._controller.runPossibleCallbacks();},getResource:function(j){return this._resources[j];},getAllResources:function(){return this._resources;},dumpResources:function(){var j={};for(var k in this._resources){var l=this._resources[k];if(typeof l==='object')l=h({},l);j[k]=l;}return j;},_constructCallbackArg:function(j){var k={};for(var l=0;l<j.length;l++){var m=j[l],n=this._resources[m];if(typeof n=='undefined')return false;k[m]=n;}return k;},_getUnavailableResources:function(j){return j.filter(function(k){return !this._resources[k];}.bind(this));}});e.exports=i;});
__d("VideoCallRecordMessageDialog",["Dialog","URI"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('URI'),i={get:function(j,k){return new g().setTitle(tx._("{firstname} is Unavailable",{firstname:k})).setBody("Would you like to leave a video message?").setButtons([{name:'record-message',label:"Record Message"},g.CANCEL]).setHandler(function(){var l=h('/ajax/messaging/composer.php').setQueryData({ids:[j],autoloadvideo:true}).toString();g.bootstrap(l);});}};e.exports=i;});
__d("VideoCallCore",["Arbiter","AsyncRequest","Bootloader","ChannelConstants","Cookie","Dialog","ua","AvailableList","AvailableListConstants","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Bootloader'),j=b('ChannelConstants'),k=b('Cookie'),l=b('Dialog'),m=b('ua'),n=[],o={isSupported:function(){if(m.windows()){return (m.ie()>=7&&!m.ie64())||m.firefox()>=3.6||m.chrome()>=5;}else if(m.osx()>10.4)return m.firefox()>=3.6||m.chrome()>=5||m.safari()>=500;return false;},isInstalled:function(){var t=false;if(this.isSupported())if(q()){var u=null;try{u=new ActiveXObject('SkypeLimited.SkypeWebPlugin');t=!!u;}catch(v){}u=null;}else t=r();return t;},mightReloadPostInstall:function(){return m.windows();},onVideoMessage:function(t){n.push(t);i.loadModules(['VideoCallController'],bagofholding);},setMessageHandler:function(t){this.onVideoMessage=t;if(t)while(n.length)t(n.shift());},onProfileButtonClick:function(t){o.startCallOrLeaveMessage(t,'profile_button_click');},startCallOrLeaveMessage:function(t,u){var v=b('AvailableList'),w=b('AvailableListConstants'),x=v.get(t);if(x==w.ACTIVE||x==w.IDLE){o.showOutgoingCallDialog(t,u);}else b('ShortProfiles').get(t,function(y){b('VideoCallRecordMessageDialog').get(t,y.firstName).show();});},showOutgoingCallDialog:function(t,u){var v=u||'unknown';p(t,v);var w=o.isInstalled()?'outgoing_dialog.php':'intro.php',x='/ajax/chat/video/'+w+'?idTarget='+t;new l().setAllowCrossPageTransition(true).setAsync(new h(x)).show();}};function p(t,u){new h().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:t,clickSource:u}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();}function q(){return m.ie()&&m.windows()&&!m.opera();}function r(){if(!navigator)return null;navigator.plugins.refresh(false);var t=navigator.mimeTypes['application/skypesdk-plugin'];return t&&t.enabledPlugin;}function s(){if(!o.mightReloadPostInstall())return;var t=k.get('vcpwn');if(t){k.clear('vcpwn');var u=k.get('vctid');if(u){k.clear('vctid');if(k.get('vctid'))return;if(u&&o.isInstalled()){var v='/ajax/chat/video/outgoing_dialog.php?idTarget='+u;new l().setAllowCrossPageTransition(true).setAsync(new h(v)).show();}}}}g.subscribe(j.getArbiterType('video'),function(t,u){o.onVideoMessage(u.obj);});g.subscribe(j.getArbiterType('chat_event'),function(t,u){if(u.obj.event_name=="missed-call")i.loadModules(['VideoCallController'],function(v){v.onMissedCallEvent(u.obj);});});s();e.exports=o;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('copyProperties'),k=c('MercuryConstants').ChatNotificationConstants,l=h.getWebChatNotification(),m=false,n=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return l!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return m;}});function o(){n.inform(n.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var p=l,q=h.getWebChatNotification();l=q;if(p!=q)o();});g.subscribe('chat/set_does_page_occlude_tabs',function(p,q){m=!!q;o();});e.exports=n;});
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(h){return typeof h==='string'&&h.indexOf(':')!==-1;}e.exports={isValid:function(h){if(!h)return false;return g(h);},tokenize:function(h){if(!this.isValid(h))throw 'bad_id_format';var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};}};});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("MercuryServerDispatcher",["copyProperties","AsyncRequest","FunctionUtils","JSLogger","ObjectUtils","URI","Dialog"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('FunctionUtils'),j=b('JSLogger'),k=b('ObjectUtils'),l=b('URI'),m={},n=j.create('mercury_server_dispatcher'),o=false,p={IMMEDIATE:'immediate',IDEMPOTENT:'idempotent',BATCH_SUCCESSIVE:'batch-successive',BATCH_SUCCESSIVE_UNIQUE:'batch-successive-unique',BATCH_DEFERRED_MULTI:'batch-deferred-multi',registerEndpoints:function(r){for(var s in r){var t=r[s];m[s]=new q(s,t);}},trySend:function(r,s){m[r].trySend(s);}};function q(r,s){var t=s.mode||p.IMMEDIATE;switch(t){case p.IMMEDIATE:case p.IDEMPOTENT:case p.BATCH_SUCCESSIVE:case p.BATCH_SUCCESSIVE_UNIQUE:case p.BATCH_DEFERRED_MULTI:break;default:throw new Error('Invalid MercuryServerDispatcher mode '+t);}this._endpoint=r;this._mode=t;this._combineData=s.batch_function;this._handler=s.handler;this._errorHandler=s.error_handler;this._deferredSend=i.debounce(this._batchSend.bind(this),0,false);}g(q.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_combineData:null,_pendingRequestData:null,trySend:function(r){if(o)return;if(typeof r=='undefined')r=null;var s=this._mode;if(s==p.IMMEDIATE){this._send(r);}else if(s==p.IDEMPOTENT){if(!this._inFlight)this._send(r);}else if(s==p.BATCH_SUCCESSIVE||s==p.BATCH_SUCCESSIVE_UNIQUE){if(!this._inFlight){this._send(r);}else this._batchData(r);}else if(s==p.BATCH_DEFERRED_MULTI){this._batchData(r);this._deferredSend();}},_send:function(r){this._inFlight++;this._pendingRequestData=g({},r);n.log('send',{endpoint:this._endpoint,data:r,inflight_count:this._inFlight});new h(this._endpoint).setData(r).setHandler(this._handleResponse.bind(this)).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleError.bind(this)).setAllowCrossPageTransition(true).send();},_batchData:function(r){if(this._mode==p.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData&&k.areEqual(r,this._pendingRequestData)){return;}else if(typeof this._batchedData=='undefined'){this._batchedData=r;}else this._batchedData=this._combineData(this._batchedData,r);},_batchSend:function(){if(typeof this._batchedData!='undefined'){this._send(this._batchedData);delete this._batchedData;}},_handleResponse:function(r){this._inFlight--;this._pendingRequestData=null;n.log('response',{endpoint:this._endpoint,inflight_count:this._inFlight});var s=r.getPayload();o=s.kill_chat;if(o)n.log('killswitch_enabled',{endpoint:this._endpoint,inflight_count:this._inFlight});if(s&&s.error_payload){if(this._errorHandler)this._errorHandler(r);}else this._handler&&this._handler(s);if(this._mode==p.BATCH_SUCCESSIVE||this._mode==p.BATCH_SUCCESSIVE_UNIQUE)this._batchSend();},_handleError:function(r){n.error('error',{endpoint:this._endpoint,inflight_count:this._inFlight-1});this._errorHandler&&this._errorHandler(r);this._inFlight--;this._pendingRequestData=null;}});e.exports=p;});
__d("MercuryThreadInformer",["Arbiter","copyProperties","ObjectUtils","MercuryAssert"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ObjectUtils'),j=b('MercuryAssert'),k={},l={},m={},n=false,o=false,p=false,q={},r={},s=0;function t(){if(!s){var v=k,w=l,x=m,y=n,z=o,aa=p,ba=q,ca=r;k={};l={};m={};n=false;o=false;p=false;q={};r={};var da=i.getKeys(w);if(da.length||y)u.inform('threadlist-updated',da);if(da.length)u.inform('threads-updated',w);for(var ea in x){u.inform('thread-read-changed',x);break;}for(var ea in v){u.inform('threads-deleted',v);break;}if(z)u.inform('unseen-updated',null);if(aa)u.inform('unread-updated',null);for(ea in ba){u.inform('messages-received',ba);break;}for(ea in ca){u.inform('messages-reordered',ca);break;}}}var u=h(new g(),{updatedThread:function(v){l[v]=true;t();},deletedThread:function(v){k[v]=true;t();},updatedThreadlist:function(){n=true;t();},updatedUnseenState:function(){o=true;t();},updatedUnreadState:function(){p=true;t();},changedThreadReadState:function(v,w,x){if(!m[v]||m[v].timestamp<x)m[v]={mark_as_read:w,timestamp:x};t();},receivedMessage:function(v){j.isThreadID(v.thread_id);var w=v.thread_id;if(!q[w])q[w]=[];q[w].push(v);this.updatedThread(w);},reorderedMessages:function(v){r[v]=true;t();},synchronizeInforms:function(v){s++;try{v();}catch(w){throw w;}finally{s--;t();}},listen:function(v,w){return this.subscribe('threads-updated',function(x,y){if(y[v])w(v);});}});e.exports=u;});
__d("MercuryServerRequests",["Arbiter","KeyedCallbackManager","TimestampConverter","copyProperties","Env","JSLogger","MercuryAssert","ObjectUtils","MercuryServerDispatcher","MercuryThreadInformer","MercuryIDs","hasArrayNature","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('KeyedCallbackManager'),i=b('TimestampConverter'),j=b('copyProperties'),k=b('Env'),l=b('JSLogger'),m=b('MercuryAssert'),n=b('ObjectUtils'),o=b('MercuryServerDispatcher'),p=b('MercuryThreadInformer'),q=b('MercuryIDs'),r=b('hasArrayNature'),s=c('MercuryConstants'),t=0,u=l.create('mercury_server'),v=new h(),w=new h(),x=[],y={},z={};function aa(pa){if(pa)t=i.maxValidActionID(t,pa);}function ba(pa){var qa=pa.thread_id,ra=v.getResource(qa);if(!ra){if(pa.is_canonical_user){var sa=pa.participants;if(sa.length==1){ra='user:'+k.user;}else sa.forEach(function(ta){var ua=q.tokenize(ta);if(ua.type=='fbid'&&ua.value!=k.user)ra='user:'+ua.value;});}else if(pa.is_canonical_group){ra='group:'+pa.group_id;}else if(pa.is_canonical_live_listen){ra='live_listen:'+pa.live_listen_id;}else if(pa.root_message_threading_id)ra='root:'+pa.root_message_threading_id;ra=ra||'thread:'+qa;ca(qa,ra);}pa.thread_id=ra;}function ca(pa,qa){v.setResource(pa,qa);w.setResource(qa,pa);z[pa]=qa;}function da(pa,qa){var ra=w.executeOrEnqueue(pa,qa),sa=ma.tokenizeThreadID(pa);if(ra.length&&sa.type!='root')ma.fetchThreadData(ra);}function ea(pa){return w.getResource(pa);}function fa(pa){return !!v.getResource(pa);}function ga(pa){var qa=v.getResource(pa);if(typeof qa=='undefined')u.warn('no_client_thread_id',{server_id:pa});return qa;}function ha(pa){if(pa.message_counts)aa(pa.message_counts.last_action_id);(pa.threads||[]).forEach(function(ta){ba(ta);delete y[ta.thread_id];delete y[ea(ta.thread_id)];aa(ta.last_action_id);});(pa.ordered_threadlists||[]).forEach(function(ta){ta.thread_ids=ta.thread_ids.map(ga);});pa.actions=pa.actions||[];pa.actions.forEach(function(ta){if(ta.status&&ta.status!=s.MercuryActionStatus.SUCCESS&&!ta.thread_id){ta.thread_id=ta.client_thread_id;return;}if(ta.action_type==s.MercuryActionType.SEND_MESSAGE&&ta.client_thread_id)ca(ta.thread_id,ta.client_thread_id);ta.server_thread_id=ta.thread_id;ta.thread_id=fa(ta.thread_id)?ga(ta.thread_id):null;aa(ta.action_id);});if(pa.end_of_history){var qa=[];for(var ra=0;ra<pa.end_of_history.length;ra++){var sa=pa.end_of_history[ra];if(sa.type=='user'){qa.push('user:'+sa.id);}else if(sa.type=='thread'&&fa(sa.id))qa.push(ga(sa.id));}pa.end_of_history=qa;}}function ia(){if(x&&x.length){var pa=x[0];x=x.slice(1);ma.handleUpdate(pa);}}function ja(pa,qa){var ra=j({},pa),sa;if(qa.threads){if(!ra.threads)ra.threads={};for(sa in qa.threads)ra.threads[sa]=n.getKeys(n.createFrom((ra.threads[sa]||[]).concat(qa.threads[sa])));}if(qa.messages){if(!ra.messages)ra.messages={};for(sa in qa.messages){if(!ra.messages[sa])ra.messages[sa]={};for(var ta in qa.messages[sa]){var ua=ra.messages[sa][ta];if(!ua||ua<qa.messages[sa][ta])ra.messages[sa][ta]=qa.messages[sa][ta];}}}return ra;}function ka(pa,qa){var ra=pa.offset<qa.offset?pa.offset:qa.offset,sa=pa.offset+pa.limit,ta=qa.offset+qa.limit,ua=(sa>ta)?sa:ta,va=ua-ra;return {offset:ra,limit:va};}function la(pa,qa){var ra={ids:{}};j(ra.ids,pa.ids);j(ra.ids,qa.ids);return ra;}var ma=j(new g(),{tokenizeThreadID:function(pa){m.isThreadID(pa);return q.tokenize(pa);},getServerThreadID:function(pa,qa){m.isThreadID(pa);da(pa,qa);},getClientThreadIDNow:function(pa){return ga(pa);},convertThreadIDIfAvailable:function(pa){var qa=v.getResource(pa);if(qa===undefined){return pa;}else return qa;},canLinkExternally:function(pa){m.isThreadID(pa);var qa=ma.tokenizeThreadID(pa);return (qa.type=='user')||!!ea(pa);},fetchThreadlistInfo:function(pa,qa,ra){o.trySend('/ajax/mercury/threadlist_info.php',{limit:qa,offset:pa,folder:ra});},fetchUnseenThreadIDs:function(pa){this.fetchThreadlistInfo(s.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,s.MercuryThreadlistConstants.JEWEL_THREAD_COUNT,pa);},fetchUnreadThreadIDs:function(pa){o.trySend('/ajax/mercury/unread_threads.php',{folder:pa});},fetchMissedMessages:function(pa){o.trySend('/ajax/mercury/thread_sync.php',{last_action_id:t,folder:pa});},fetchThreadData:function(pa){m.allThreadID(pa);var qa={threads:{}},ra=[],sa=[],ta=[],ua=[];pa.forEach(function(wa){if(y[wa])return;y[wa]=true;var xa=ma.tokenizeThreadID(wa);if(xa.type=='user'){ra.push(xa.value);qa.threads.user_ids=ra;}else if(xa.type=='group'){ta.push(xa.value);qa.threads.group_ids=ta;}else if(xa.type=='live_listen'){ua.push(xa.value);qa.threads.live_listen_ids=ua;}else if(xa.type=='thread'){sa.push(xa.value);qa.threads.thread_ids=sa;}else if(xa.type!='root')throw new Error('Unknown thread type',xa);});for(var va in qa.threads){o.trySend('/ajax/mercury/thread_info.php',qa);break;}},ensureThreadIsFetched:function(pa){if(!v.getResource(pa)&&!y[pa]){y[pa]=true;o.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[pa]}});}},fetchThreadMessages:function(pa,qa){m.isThreadID(pa);var ra=ma.tokenizeThreadID(pa),sa;switch(ra.type){case 'user':sa='user_ids';break;case 'group':sa='group_ids';break;case 'live_listen':sa='live_listen_ids';break;case 'thread':sa='thread_ids';break;}var ta={messages:{}};if(sa){ta.messages[sa]={};ta.messages[sa][ra.value]=qa;o.trySend('/ajax/mercury/thread_info.php',ta);}else da(pa,function(ua){ta.messages.thread_ids={};ta.messages.thread_ids[ua]=qa;o.trySend('/ajax/mercury/thread_info.php',ta);});},handleThreadInfoError:function(pa){var qa=pa.getRequest().getData(),ra=[];if(qa.messages){for(var sa in qa.messages.thread_ids)ra.push(na(ga(sa)));for(var ta in qa.messages.user_ids)ra.push(na('user:'+ta));for(var ua in qa.messages.group_ids)ra.push(na('group:'+ua));}if(ra.length)ma.handleUpdate({actions:ra,from_client:true,payload_source:s.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});if(qa.threads&&(qa.threads.user_ids||qa.threads.group_ids||qa.threads.live_listen_ids||qa.threads.thread_ids)&&!qa.is_retry){if(qa.messages)delete qa.messages;u.log('retry_thread',qa);qa.is_retry=true;o.trySend('/ajax/mercury/thread_info.php',qa);}},changeThreadReadStatus:function(pa,qa){m.isThreadID(pa);da(pa,function(sa){var ta={ids:{}};ta.ids[sa]=qa;o.trySend('/ajax/mercury/change_read_status.php',ta);});var ra=[{action_type:s.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:pa,mark_as_read:qa}];this.handleUpdate({actions:ra,from_client:true,payload_source:s.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(pa,qa){m.isThreadID(pa);da(pa,function(ta){var ua={ids:{}};ua.ids[ta]=qa;o.trySend('/ajax/mercury/change_archived_status.php',ua);});var ra={action_type:s.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:pa,archived:qa},sa={actions:[ra],from_client:true,payload_source:s.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS};this.handleUpdate(sa);},clearChat:function(pa,qa,ra){m.isThreadID(pa);o.trySend('/ajax/chat/settings.php',{clear_history_id:qa});var sa=[{action_type:s.MercuryActionType.CLEAR_CHAT,action_id:null,thread_id:pa,clear_time:ra}];this.handleUpdate({actions:sa,from_client:true,payload_source:s.MercuryPayloadSource.CLIENT_CLEAR_CHAT});},_batchThreadRead:function(pa,qa){var ra={};j(ra,pa.ids);j(ra,qa.ids);return {ids:ra};},sendNewMessage:function(pa){var qa=ma.tokenizeThreadID(pa.thread_id),ra=j({},pa);if((qa.type=='root'&&qa.value==ra.message_id)||(qa.type=='user'&&!ea(pa.thread_id))){ra.client_thread_id=ra.thread_id;ra.thread_id=null;this._sendNewMessageToServer(ra);}else da(ra.thread_id,function(ta){ra.thread_id=ta;ma._sendNewMessageToServer(ra);});var sa={actions:[j({},pa)],from_client:true,payload_source:s.MercuryPayloadSource.CLIENT_SEND_MESSAGE};ma.handleUpdate(sa);},_sendNewMessageToServer:function(pa){o.trySend('/ajax/mercury/send_messages.php',{message_batch:[pa]});},_batchMessageSend:function(pa,qa){return {message_batch:pa.message_batch.concat(qa.message_batch)};},requestMessageConfirmation:function(pa){var qa={},ra={};for(var sa in pa){var ta=ea(sa);if(ta){qa[ta]=pa[sa];}else{var ua=pa[sa];for(var va=0;va<ua.length;va++)ra[ua[va]]=sa;}}var wa=n.getKeys(qa),xa=n.getKeys(ra);if(wa.length||xa.length)o.trySend('/ajax/mercury/confirm_messages.php',{thread_message_map:qa,local_messages:ra});},handleMessageConfirmError:function(pa){var qa=pa.getRequest().getData().thread_message_map,ra=pa.getRequest().getData().local_messages;if(!qa&&!ra)return;var sa=[];for(var ta in qa){var ua=qa[ta];ua.forEach(function(xa){sa.push({action_type:s.MercuryActionType.SEND_MESSAGE,client_message_id:xa,message_id:xa,client_thread_id:null,thread_id:ta,status:s.MercuryActionStatus.UNABLE_TO_CONFIRM});});}for(var va in ra){var wa=ra[va];sa.push({action_type:s.MercuryActionType.SEND_MESSAGE,client_message_id:va,message_id:va,client_thread_id:wa,thread_id:null,status:s.MercuryActionStatus.UNABLE_TO_CONFIRM});}if(sa.length)this.handleUpdate({actions:sa,payload_source:s.MercuryPayloadSource.CLIENT_HANDLE_ERROR});},markSeen:function(){var pa=i.convertActionIDToTimestamp(t);o.trySend('/ajax/mercury/mark_seen.php',{seen_timestamp:pa});},_batchMarkSeen:function(pa,qa){return qa;},handleRoger:function(pa){var qa=pa.tid?v.getResource(pa.tid):('user:'+pa.reader);if(qa)this.inform('update-roger',{thread_id:qa,participant:'fbid:'+pa.reader,time:pa.time});},handleActionWaitForThread:function(pa,qa){var ra={actions:[j({},pa)],payload_source:qa},sa;if(qa==s.MercuryPayloadSource.CLIENT_LIVE_LISTEN){var ta=pa.thread_id;ra.from_client=true;sa=w.getResource(ta);if(sa){ma.handleUpdate(ra);return;}w.executeOrEnqueue(ta,function(){x.push(ra);});this.fetchThreadData([pa.thread_id]);}else{var ua=pa.thread_id;sa=v.getResource(ua);if(sa){ma.handleUpdate(ra);return;}v.executeOrEnqueue(ua,function(){x.push(ra);});if(!y[ua]){y[ua]=true;o.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[ua]}});}}},handleUpdate:function(pa){u.debug('handle_update',{payload:pa,from_client:pa.from_client});for(var qa in pa){p.synchronizeInforms(function(){if(!pa.from_client)ha(pa);this.inform('update-thread-ids',z);z={};this.inform('update-unread',pa);this.inform('update-participants',pa);this.inform('update-threads',pa);this.inform('update-threadlist',pa);this.inform('update-messages',pa);this.inform('update-unseen',pa);this.inform('update-typing-state',pa);this.inform('model-update-completed',null);ia();}.bind(this));break;}},handleSendMessageError:function(pa){var qa=pa.getPayload(),ra=pa.getRequest().getData(),sa=ra.message_batch;if(!sa)return;var ta;if(qa&&qa.error_payload){ta=s.MercuryActionStatus.UNCONFIRMED;}else ta=s.MercuryActionStatus.REQUEST_ERROR;var ua=sa.map(function(wa){return {action_type:s.MercuryActionType.SEND_MESSAGE,client_message_id:wa.message_id,message_id:wa.message_id,client_thread_id:wa.client_thread_id,thread_id:wa.thread_id,status:ta};}),va={actions:ua,payload_source:s.MercuryPayloadSource.CLIENT_HANDLE_ERROR};this.handleUpdate(va);},getLastActionID:function(){return t;}});function na(pa){return {action_type:s.MercuryActionType.LOG_MESSAGE,thread_id:pa,message_id:pa,timestamp:1,timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:s.MercurySourceType.UNKNOWN,log_message_type:s.MercuryLogMessageType.SERVER_ERROR,log_message_data:{}};}var oa=ma.handleUpdate.bind(ma);o.registerEndpoints({'/ajax/mercury/thread_sync.php':{mode:o.IDEMPOTENT,handler:oa},'/ajax/mercury/thread_info.php':{mode:o.BATCH_DEFERRED_MULTI,batch_function:ja,handler:oa,error_handler:ma.handleThreadInfoError.bind(ma)},'/ajax/mercury/change_read_status.php':{mode:o.BATCH_SUCCESSIVE,batch_function:ma._batchThreadRead,handler:oa},'/ajax/mercury/send_messages.php':{mode:o.BATCH_SUCCESSIVE,batch_function:ma._batchMessageSend,handler:oa,error_handler:ma.handleSendMessageError.bind(ma)},'/ajax/mercury/mark_seen.php':{mode:o.BATCH_SUCCESSIVE,batch_function:ma._batchMarkSeen,handler:oa},'/ajax/mercury/confirm_messages.php':{mode:o.IMMEDIATE,handler:oa,error_handler:ma.handleMessageConfirmError.bind(ma)},'/ajax/mercury/threadlist_info.php':{mode:o.BATCH_SUCCESSIVE_UNIQUE,batch_function:ka,handler:oa},'/ajax/mercury/unread_threads.php':{mode:o.IDEMPOTENT,handler:oa},'/ajax/chat/settings.php':{mode:o.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{mode:o.BATCH_SUCCESSIVE,batch_function:la,handler:oa}});e.exports=ma;});
__d("MercuryTimestampTracker",["MercuryServerRequests","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryServerRequests'),h=c('MercuryConstants'),i=0;e.exports={getLastUserMessageTimestamp:function(){return i;}};g.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;var l=h.MercuryPayloadSource;if(k.payload_source==l.CLIENT_SEND_MESSAGE||k.payload_source==l.UNKNOWN)return;for(var m=0;m<k.actions.length;m++){var n=k.actions[m],o=n.action_type;if(o==h.MercuryActionType.USER_GENERATED_MESSAGE&&n.thread_id&&n.timestamp>i)i=n.timestamp;}});});
__d("MercuryParticipants",["Env","JSLogger","MercuryAssert","ObjectUtils","ShortProfiles","MercuryServerRequests","MercuryIDs","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Env'),h=b('JSLogger'),i=b('MercuryAssert'),j=b('ObjectUtils'),k=b('ShortProfiles'),l=b('MercuryServerRequests'),m=b('MercuryIDs'),n=b('copyProperties'),o=c('MercuryConstants'),p='fbid:'+g.user,q={},r=h.create('mercury_participants'),s=function(v){if(!q[v.id])q[v.id]=n({},v);};function t(v){i.isEmailParticipantID(v);var w=m.tokenize(v),x=w.value;return {gender:o.MercuryParticipantsConstants.UNKNOWN_GENDER,href:null,id:v,image_src:o.MercuryParticipantsConstants.EMAIL_IMAGE,name:x,short_name:x};}var u={user:p,get:function(v,w){i.isParticipantID(v);this.getMulti([v],function(x){w(x[v]);});},getMulti:function(v,w){i.allParticipantIDs(v);var x={},y={};v.forEach(function(aa){if(q[aa]){x[aa]=n({},q[aa]);}else{var ba=m.tokenize(aa);if(ba.type=='fbid'){var ca=ba.value;y[aa]=ca;}else if(ba.type=='email')x[aa]=t(aa);}});var z=j.getValues(y);if(z.length){k.getMulti(z,function(aa){for(var ba in y){var ca=y[ba],da=aa[ca];x[ba]={gender:da.gender,href:da.uri,id:ba,image_src:da.thumbSrc,name:da.name,short_name:da.firstName};}w(x);});}else w(x);},getUserID:function(v){if(!m.isValid(v))return null;var w=m.tokenize(v);if(w.type!='fbid')return null;return w.value;},addParticipants:function(v){v.forEach(s);}};l.subscribe('update-participants',function(v,w){u.addParticipants(w.participants||[]);});e.exports=u;});
__d("MercuryThreads",["Arbiter","copyProperties","JSLogger","ObjectUtils","KeyedCallbackManager","TimestampConverter","MercuryAssert","MercuryServerRequests","MercuryThreadInformer","MercuryTimestampTracker","MercuryParticipants","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('JSLogger'),j=b('ObjectUtils'),k=b('KeyedCallbackManager'),l=b('TimestampConverter'),m=b('MercuryAssert'),n=b('MercuryServerRequests'),o=b('MercuryThreadInformer'),p=b('MercuryTimestampTracker'),q=b('MercuryParticipants'),r=c('MercuryConstants'),s=i.create('mercury_threads'),t=new k();function u(ea,fa){var ga=j.createFrom(ea.participants,true),ha=q.user;fa.forEach(function(ia){if(ga[ia]!==true){ea.participants.push(ia);if(ia===ha)ea.is_subscribed=true;}});}function v(ea,fa){ea.participants.remove(fa);if(fa===q.user)ea.is_subscribed=false;}function w(ea,fa){if(ea.participants[0]!=fa){ea.participants.remove(fa);ea.participants.unshift(fa);}}function x(ea,fa){var ga=fa.body,ha=fa.subject,ia='';if(ha){ha=ha.toLowerCase();if(ga.slice(0,ha.length).toLowerCase()==ha){ia=ga;}else if(ga){ia=ha+' \u00B7 '+ga;}else ia=ha;}else ia=ga;ea.snippet=ia;ea.snippet_has_attachment=fa.has_attachment;ea.snippet_attachments=fa.attachments;ea.is_forwarded_snippet=!!fa.forward_count;}function y(ea,fa){if(!ea)return false;var ga=!ea.unread_count;if(fa==ga)return false;ea.unread_count=fa?0:1;t.setResource(ea.thread_id,ea);o.updatedThread(ea.thread_id);return true;}function z(ea){var fa=t.getAllResources();for(var ga in fa){var ha=fa[ga];ha.unread_count=0;t.setResource(ga,ha);o.updatedThread(ga);}}function aa(ea,fa){if(!ea||ea.chat_clear_time===fa)return false;ea.chat_clear_time=fa;t.setResource(ea.thread_id,ea);o.reorderedMessages(ea.thread_id);return true;}function ba(ea,fa){var ga=fa.action_type;if(ga==r.MercuryActionType.USER_GENERATED_MESSAGE||ga==r.MercuryActionType.LOG_MESSAGE){fa.is_unread&&ea.unread_count++;ea.is_archived=false;}switch(ga){case r.MercuryActionType.USER_GENERATED_MESSAGE:w(ea,fa.author);break;case r.MercuryActionType.LOG_MESSAGE:var ha=fa.log_message_type;if(ha==r.MercuryLogMessageType.SUBSCRIBE){u(ea,fa.log_message_data.added_participants);}else if(ha==r.MercuryLogMessageType.UNSUBSCRIBE){v(ea,fa.author);}else if(ha==r.MercuryLogMessageType.THREAD_IMAGE){ea.image_src=fa.log_message_data.image?fa.log_message_data.image.preview_url:null;}else if(ha==r.MercuryLogMessageType.THREAD_NAME)ea.name=fa.log_message_data.name;break;case r.MercuryActionType.CHANGE_READ_STATUS:if(fa.timestamp)o.changedThreadReadState(ea.thread_id,fa.mark_as_read,fa.timestamp);y(ea,fa.mark_as_read);break;case r.MercuryActionType.CLEAR_CHAT:aa(ea,fa.clear_time);break;case r.MercuryActionType.CHANGE_ARCHIVED_STATUS:ea.is_archived=fa.archived;break;case r.MercuryActionType.CHANGE_FOLDER:ea.folder=fa.new_folder;break;}if(fa.action_id)ea.last_action_id=l.maxValidActionID(fa.action_id,ea.last_action_id);}function ca(ea){var fa=n.tokenizeThreadID(ea.thread_id);if(fa.type=='group'||fa.type=='live_listen'){s.error('invalid_new_thread_message',ea);return undefined;}var ga={thread_id:ea.thread_id,last_action_id:ea.action_id,participants:ea.specific_to_list,name:null,snippet:ea.body,snippet_has_attachment:false,snippet_attachments:[],unread_count:0,image_src:null,timestamp_absolute:ea.timestamp_absolute,timestamp_relative:ea.timestamp_relative,timestamp:ea.timestamp,is_canonical_user:fa.type=='user',is_subscribed:true,is_canonical_group:false,is_chatlogger_thread:false,group_id:null,is_canonical_live_listen:false,live_listen_id:null,root_message_threading_id:ea.message_id,folder:r.MessagingTag.INBOX,is_archived:false,mode:r.MercuryThreadMode.TITAN_ORIGINATED};t.setResource(ga.thread_id,ga);return ga;}g.subscribe(i.DUMP_EVENT,function(ea,fa){fa.messaging=fa.messaging||{};fa.messaging.threads=t.dumpResources();});var da={getThreadMetaNow:function(ea){m.isThreadID(ea);return t.getResource(ea);},getThreadMeta:function(ea,fa){m.isThreadID(ea);var ga=t.executeOrEnqueue(ea,fa);if(!ga.length)return;var ha=n.tokenizeThreadID(ea);if(ha.type=='user'){this.getCanonicalThreadToUser(ha.value);}else n.fetchThreadData(ga);},changeThreadReadStatus:function(ea,fa){m.isThreadID(ea);var ga=t.getResource(ea);if(y(ga,fa))n.changeThreadReadStatus(ea,fa);},changeThreadArchivedStatus:function(ea,fa){m.isThreadID(ea);var ga=t.getResource(ea);if(ga.is_archived!=fa){ga.is_archived=fa;o.updatedThread(ga.thread_id);n.changeThreadArchivedStatus(ea,fa);}},updateThreads:function(ea){if(!ea||!ea.length)return;var fa={};ea.forEach(function(ga){fa[ga.thread_id]=ga;});t.addResourcesAndExecute(fa);},updateMetadataByActions:function(ea){if(!ea||!ea.length)return;var fa={},ga={},ha={};for(var ia=0;ia<ea.length;ia++){var ja=ea[ia],ka=ja.action_type,la=ja.thread_id;m.isThreadID(la);var ma=this.getThreadMetaNow(la);if(ka==r.MercuryActionType.LOG_MESSAGE&&ja.log_message_type==r.MercuryLogMessageType.SERVER_ERROR)continue;if(!ma&&!ja.action_id&&ka==r.MercuryActionType.USER_GENERATED_MESSAGE)ma=ca(ja);if(ma){if(ja.timestamp<=ma.timestamp&&ja.action_id)continue;if(ka==r.MercuryActionType.DELETE_THREAD){o.deletedThread(la);continue;}if(!ha[la])ha[la]=h({},ma);ba(ha[la],ja);if(ka==r.MercuryActionType.USER_GENERATED_MESSAGE)fa[la]=ja;if(ka==r.MercuryActionType.USER_GENERATED_MESSAGE||ka==r.MercuryActionType.LOG_MESSAGE||ka==r.MercuryActionType.SEND_MESSAGE)if(ja&&ja.timestamp&&(!ga[la]||ja.timestamp>ga[la].timestamp))ga[la]=ja;}}for(var na in ha){var oa=ha[na],pa=fa[na];if(pa)x(oa,pa);var qa=ga[na];if(qa)oa=h(oa,{timestamp_absolute:qa.timestamp_absolute,timestamp_relative:qa.timestamp_relative,timestamp:qa.timestamp});t.setResource(na,oa);}},getCanonicalThreadToGroup:function(ea,fa){var ga='group:'+ea;this.getThreadMeta(ga,fa);},getCanonicalThreadToLiveListen:function(ea,fa){var ga='live_listen:'+ea;this.getThreadMeta(ga,fa);},getCanonicalThreadToUser:function(ea,fa){var ga=this.getThreadIdForUser(ea),ha=t.getResource(ga);if(typeof ha=='undefined'){ha=da.createNewLocalThread(ga,[q.user,'fbid:'+ea],fa);n.fetchThreadData([ga]);}return ha;},getThreadIdForUser:function(ea){return 'user:'+ea;},createNewLocalThread:function(ea,fa,ga){var ha=t.getResource(ea);if(!ha){var ia=n.tokenizeThreadID(ea);ha={thread_id:ea,last_action_id:null,participants:fa,name:null,snippet:'',snippet_has_attachment:false,unread_count:ga?ga:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,is_canonical_user:ia.type=='user',is_subscribed:true,is_canonical_group:ia.type=='group',group_id:(ia.type=='group'?ia.value:null),is_canonical_live_listen:ia.type=='live_listen',live_listen_id:(ia.type=='live_listen'?ia.value:null),root_message_threading_id:null,folder:r.MessagingTag.INBOX,is_archived:false,mode:r.MercuryThreadMode.TITAN_ORIGINATED};ha.is_chatlogger_thread=ha.is_canonical_group||ha.is_canonical_live_listen;t.setResource(ea,ha);}return ha;},addParticipantsToThreadLocally:function(ea,fa){var ga=t.getResource(ea);if(ga){u(ga,fa);o.updatedThread(ga.thread_id);}},getCanonicalUserInThread:function(ea){var fa=n.tokenizeThreadID(ea);return fa.type=='user'?fa.value:null;},getCanonicalGroupInThread:function(ea){var fa=n.tokenizeThreadID(ea);return fa.type=='group'?fa.value:null;},getCanonicalLiveListenInThread:function(ea){var fa=n.tokenizeThreadID(ea);return fa.type=='live_listen'?fa.value:null;},isEmptyLocalThread:function(ea){var fa=t.getResource(ea);if(!fa)return false;var ga=n.tokenizeThreadID(ea);return ga.type=='root'&&!fa.timestamp;},isMultichatThread:function(ea){var fa=n.tokenizeThreadID(ea).type;return fa!='user'&&fa!='group'&&fa!='live_listen';},isLiveListenThread:function(ea){return this.getCanonicalLiveListenInThread(ea)!==null;}};n.subscribe('update-threads',function(ea,fa){var ga=(fa.actions||[]).filter(function(ka){return ka.thread_id;});da.updateThreads(fa.threads);da.updateMetadataByActions(ga);(fa.threads||[]).each(function(ka){o.updatedThread(ka.thread_id);});var ha=fa.global_actions||[];for(var ia=0;ia<ha.length;ia++){var ja=ha[ia];if(ja.action_type==r.MercuryGlobalActionType.MARK_ALL_READ)z(ja.action_id);}});e.exports=da;});
__d("ChatTabModel",["Arbiter","ArbiterMixin","ArrayUtils","ChatBehavior","ChatConfig","copyProperties","JSLogger","function-extensions","json","math-extensions","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceState","PresenceUtil","ObjectUtils","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ArrayUtils'),j=b('ChatBehavior'),k=b('ChatConfig'),l=b('copyProperties'),m=b('JSLogger');b('function-extensions');b('json');var n=b('math-extensions'),o=b('MercuryAssert'),p=b('MercuryServerRequests'),q=b('MercuryThreads'),r=b('MercuryTimestampTracker'),s=c('PresenceInitialData'),t=b('PresenceState'),u=b('PresenceUtil'),v=b('ObjectUtils'),w=[],x=null,y=null,z=null,aa=null;function ba(){return parseInt(s.serverTime,10);}var ca=k.get('tab_max_load_age')||3600000,da=ba()-ca,ea=0,fa=20,ga=m.create('chat_tab_model'),ha=false;function ia(za){var ab=n.verifyNumber(za.uct2);if(!ab||typeof ab!=='number'){ga.warn('bad_cookie_version',za.uct2);return null;}if(ab<=ea||ab<da)return null;return ab;}function ja(za){var ab=ia(za);if(!ab){var bb={};bb.old_tabs=za&&za.t2&&JSON.stringify(za.t2);bb.old_promoted=za&&za.lm2;bb.old_time=za&&za.uct2;bb.old_reason=za&&za.tr;bb.old_window=za&&za.tw;var cb;if(y&&za.t2)for(var db=0;db<za.t2.length;db++){var eb=za.t2[db];if(eb.i===y)cb=eb.r;}var fb=[];w.forEach(function(gb){if(!gb.fragile){var hb={i:gb.id,si:gb.server_id};if(gb.raised||(gb.id===y&&cb))hb.r=1;fb.push(hb);}});za.t2=fb;za.uct2=ea;za.lm2=x;za.tr=aa;za.tw=u.getSessionID();bb.new_tabs=JSON.stringify(za.t2);bb.new_promoted=za.lm2;bb.new_time=za.uct2;bb.new_reason=za.tr;bb.new_window=za.tw;ga.debug('store',bb);}return za;}function ka(za){if(za){var ab=ia(za);if(ab){var bb={};bb.old_tabs=JSON.stringify(w);bb.old_promoted=x;bb.old_time=ea;bb.old_reason=aa;bb.window_id=u.getSessionID();bb.cookie_tabs=za&&za.t2&&JSON.stringify(za.t2);bb.cookie_promoted=za&&za.lm2;bb.cookie_time=za&&za.uct2;bb.cookie_reason=za&&za.tr;bb.cookie_window=za&&za.tw;ea=ab;aa='load';var cb=la(za.t2,za.lm2||null);bb.load_result=cb;bb.new_tabs=JSON.stringify(w);bb.new_promoted=x;bb.new_time=ea;bb.new_reason=aa;var event='load';if(!ha)event+='_init';ga.log(event,bb);return cb;}}return false;}function la(za,ab){if(ma(za,ab)){var bb=w.filter(function(eb){return eb.fragile;}),cb={};x=null;w=za.map(function(eb){var fb={id:eb.i,server_id:eb.si};if(fb.id==ab)x=fb.id;if(y==eb.i){var gb=ra(y);if(gb!=-1){fb.raised=w[gb].raised;return fb;}else return null;}if(eb.r)fb.raised=true;cb[fb.id]=fb;return fb;});w=w.filter(function(eb){return eb!=null;});if(z)for(var db in z)if(!cb[db]||!cb[db].raised)delete z[db];bb=bb.filter(function(eb){return !cb[eb.id];});w=w.concat(bb);qa();return true;}return false;}function ma(za,ab){if(ab!=x)return true;var bb=w.filter(function(eb){return !eb.fragile;});if(za.length!=bb.length)return true;for(var cb=0,db=za.length;cb<db;cb++){if(za[cb].id===y)continue;if(!v.areEqual(za[cb],bb[cb]))return true;}return false;}function na(za,ab,bb){var cb=ka(t.get());if(ab===undefined||ab>ea){if(za()){cb=true;aa=bb||null;pa(ab);}}else ga.error('rejected',{change_time:ab,state_time:ea});cb&&oa();}function oa(){if(ha)xa.inform('chat/tabs-changed',xa.get());}function pa(za){if(za===undefined)za=Math.max(r.getLastUserMessageTimestamp()||1,ea+1);ea=za;t.doSync();}function qa(){var za=w.length-fa;if(za>0)w=w.filter(function(ab){return ab.raised||za--<=0;});}function ra(za){for(var ab=0;ab<w.length;ab++)if(w[ab].id==za)return ab;return -1;}function sa(za){var ab=q.getThreadMetaNow(za);if(!ab)return false;if(ab.is_canonical_user||ab.is_canonical_group||ab.is_canonical_live_listen){return ua(za);}else{var bb=ta(za);if(bb)p.getServerThreadID(za,function(cb){if(va(za,cb)){pa();oa();}});return bb;}}function ta(za){if(ra(za)===-1){w.push({id:za,fragile:true});ga.log('open_fragile_tab',{tabs:JSON.stringify(w),opened:za,window_id:u.getSessionID()});return true;}return false;}function ua(za){var ab=ra(za);if(ab!=-1)if(w[ab].fragile){w.splice(ab,1);}else return false;for(var bb=0;bb<=w.length;bb++)if(bb==w.length||w[bb].fragile){w.splice(bb,0,{id:za});qa();ga.log('open_tab',{tabs:JSON.stringify(w),opened:za,window_id:u.getSessionID()});return true;}}function va(za,ab){var bb=ra(za);if(bb!=-1&&w[bb].fragile){var cb=w[bb];cb.fragile=false;cb.server_id=ab;var db=[];w.forEach(function(eb){if(eb.id!=za){if(cb&&eb.fragile){db.push(cb);cb=null;}db.push(eb);}});if(cb)db.push(cb);w=db;ga.log('make_permanent',{tabs:JSON.stringify(w),tab_id:za,window_id:u.getSessionID()});return true;}return false;}function wa(za){var ab=ra(za);if(za==x)x=null;if(ab!=-1){w.splice(ab,1);ga.log('close_tab',{tabs:JSON.stringify(w),closed:za,window_id:u.getSessionID()});return true;}return false;}t.registerStateStorer(ja);t.registerStateLoader(function(za){if(ka(za))oa();});function xa(){}Function.mixin(xa,h,{indexOf:function(za){return ra(za);},getTab:function(za){o.isThreadID(za);var ab=this.indexOf(za);if(ab>-1){var bb=w[ab];return l({},bb);}return null;},closeAllTabs:function(){if(w.length){ga.log('close_all_tabs',{closed_tabs:JSON.stringify(w),window_id:u.getSessionID()});w=[];x=null;if(z)z={};pa();oa();}},closeFragileTabs:function(){var za=[];for(var ab=0;ab<w.length;ab++)if(w[ab].fragile){za.push(w[ab]);w.splice(ab);oa();break;}ga.log('close_fragile_tabs',{tabs:JSON.stringify(w),fragile_closed:za,window_id:u.getSessionID()});},closeTab:function(za,ab){o.isThreadID(za);var bb=false;if(z){delete z[za];bb=true;}na(function(){if(wa(za))bb=true;return bb;},undefined,ab);},closeTabAndDemote:function(za,ab,bb){o.isThreadID(za);var cb=false;if(z){delete z[za];cb=true;}na(function(){if(wa(za)){if(x){var db=ra(x);if(db>ab){var eb=w.splice(db,1)[0];w.splice(ab,0,eb);x=null;}}cb=true;}return cb;},undefined,bb);},raiseTab:function(za,ab){o.isThreadID(za);var bb=false;if(z&&ab){z[za]=true;bb=true;}if(!ab&&za===y){bb&&oa();return;}na(function(){if(sa(za))bb=true;var cb=ra(za);if(cb!=-1&&!w[cb].raised){w[cb].raised=true;bb=true;ga.log('raise_tab',{tabs:JSON.stringify(w),raised:za,window_id:u.getSessionID()});}return bb;});},get:function(){var za=w.map(function(ab){var bb=l({},ab);delete bb.fragile;if(z)bb.raised=z[bb.id];return bb;});return {tabs:za,promoted:x};},openFragileTab:function(za){o.isThreadID(za);if(ta(za))oa();},openTab:function(za){o.isThreadID(za);na(sa.curry(za));},lowerTab:function(za){o.isThreadID(za);var ab=false;if(z){delete z[za];ab=true;}na(function(){var bb=ra(za);if(bb!=-1&&w[bb].raised){delete w[bb].raised;ga.log('lower_tab',{tabs:JSON.stringify(w),lowered:za,window_id:u.getSessionID()});ab=true;}return ab;});},raiseAndPromoteTab:function(za,ab,bb,cb){o.isThreadID(za);var db=false;if(z&&ab){z[za]=true;db=true;}if(!ab&&za===y){db&&oa();return;}na(function(){if(sa(za))db=true;var eb=ra(za);if(eb!=-1&&(!w[eb].raised||x!=za)){w[eb].raised=true;x=za;db=true;ga.log('raise_and_promote_tab',{tabs:JSON.stringify(w),promoted:za,window_id:u.getSessionID()});}return db;},bb,cb);},squelchTab:function(za){o.isThreadID(za);y=za;this.lowerTab(za);ga.log('squelch_tab',{squelched:za,tabs:JSON.stringify(w),window_id:u.getSessionID()});},clearSquelchedTab:function(){if(y)ga.log('unsquelch_tab',{squelched:y,tabs:JSON.stringify(w),window_id:u.getSessionID()});y=null;}});g.subscribe(m.DUMP_EVENT,function(za,ab){ab.chat_tabs={promoted:x,tabs:w.map(function(bb){return l({},bb);}),time:ea,max_load_age:ca};});function ya(){var za=j.ignoresRemoteTabRaise();if(za&&!z){ga.log('start_ignore_remote_raise');z={};oa();}else if(!za&&z){ga.log('stop_ignore_remote_raise');z=null;oa();}}j.subscribe(j.ON_CHANGED,ya);ya();ka(t.getInitial(),true);if(ea===0)ea=ba()-600000;ha=true;e.exports=xa;});
__d("ChatController",["ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatTabModel'),h=b('MercuryThreads'),i={closeGroupTab:function(j,k){var l='group:'+j;g.closeTab(l,k||'chat_controller');},raiseFragileGroupTab:function(j){this.openFragileGroupTab(j);},openFragileGroupTab:function(j){h.getCanonicalThreadToGroup(j,function(k){if(k.is_subscribed)g.openFragileTab(k.thread_id);});},raiseGroupTab:function(j){h.getCanonicalThreadToGroup(j,function(k){if(k.is_subscribed)g.raiseAndPromoteTab(k.thread_id);});}};e.exports=i;});
__d("ARIA",["DOM"],function(a,b,c,d,e,f){var g=b("DOM"),h={owns:function(i,j){i.setAttribute('aria-owns',g.getID(j));}};e.exports=h;});
__d("ContextualLayer",["array-extensions","event-extensions","Arbiter","Class","ContextualThing","css","DataStore","DOM","Layer","LayerHideOnTransition","Locale","Parent","Vector","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("Arbiter"),h=b("Class"),i=b("ContextualThing"),j=b("css"),k=b("DataStore"),l=b("DOM"),m=b("Layer"),n=b("LayerHideOnTransition"),o=b("Locale"),p=b("Parent"),q=b("Vector"),r=l.$N,s=b("copyProperties"),t=b("getOverlayZIndex");function u(y){return y.getPosition()==='left'||(y.isVertical()&&y.getAlignment()==='right');}function v(){this.parent.construct(this);}var w=[];g.subscribe('reflow',function(){w.forEach(function(y){if(y.updatePosition()===false)y.hide();});});h.extend(v,m);s(v.prototype,{_contentWrapper:null,_content:null,_context:null,_parentLayer:null,_parentSubscription:null,_orientation:null,_orientationClass:null,init:function(y){this._content=y;this.parent.init(this._content);this.enableBehavior(n);return this;},_buildWrapper:function(y){this._contentWrapper=r('div',{className:'uiContextualLayer'},y);return r('div',{className:'uiContextualLayerPositioner'},this._contentWrapper);},getInsertParent:function(){var y=this._insertParent;if(!y&&this._context)y=p.byClass(this._context,'uiContextualLayerParent');return y||this.parent.getInsertParent();},setContent:function(y){this._content=y;l.setContent(this._contentWrapper,this._content);this._shown&&this.updatePosition();return this;},setContext:function(y){this._context=y;this._contextScrollParent=null;if(this._shown){i.register(this._root,this._context);this.updatePosition();}this._setParentSubscription();return this;},_setParentSubscription:function(){var y=this._context,z=null;while(y!==null){z=k.get(y,'layer');if(z)break;y=y.parentNode;}if(z===this._parentLayer)return;if(this._parentLayer&&this._parentSubscription){this._parentLayer.unsubscribe(this._parentSubscription);this._parentSubscription=null;}if(z)this._parentSubscription=z.subscribe('hide',this.hide.bind(this));this._parentLayer=z;},setPosition:function(y){this._getOrientation().setDefaultPosition(y);this._shown&&this.updatePosition();return this;},setAlignment:function(y){this._getOrientation().setDefaultAlignment(y);this._shown&&this.updatePosition();return this;},setOffsetX:function(y){this._getOrientation().setDefaultOffsetX(y);this._shown&&this.updatePosition();return this;},setOffsetY:function(y){this._getOrientation().setDefaultOffsetY(y);this._shown&&this.updatePosition();return this;},_getOrientation:function(){if(!this._orientation)this._orientation=new x();return this._orientation;},getContent:function(){return this._content;},getContext:function(){return this._context;},getContextScrollParent:function(){if(!this._contextScrollParent)this._contextScrollParent=j.getScrollParent(this._context);return this._contextScrollParent;},setInsertParent:function(y){this._insertScrollParent=null;return this.parent.setInsertParent(y);},getInsertScrollParent:function(){if(!this._insertScrollParent)this._insertScrollParent=j.getScrollParent(this.getInsertParent());return this._insertScrollParent;},show:function(){this.parent.show();if(this._shown){i.register(this._root,this._context);w.push(this);this._resizeListener=this._resizeListener||Event.listen(window,'resize',this.updatePosition.bind(this));}return this;},hide:function(){i.remove(this._root);w.remove(this);this._resizeListener&&this._resizeListener.remove();this._resizeListener=null;return this.parent.hide();},updatePosition:function(){if(!this._context||!this._context.offsetParent)return false;var y=this._getOrientation();this.inform('adjust',y.reset());if(!y.isValid())return false;this._updateWrapperPosition(y);this._updateWrapperClass(y);var z=j.isFixed(this._context)&&!j.isFixed(this.getInsertParent());j.conditionClass(this._root,'uiContextualLayerPositionerFixed',z);var aa,ba,ca;if(z){aa='viewport';ba=new q(0,0);ca=document.body.offsetWidth;}else{aa='document';var da=this._root.offsetParent;if(!da)return false;ba=q.getElementPosition(da,aa);ca=da.offsetWidth;if(da!==l.getDocumentBodyElement())ba=ba.sub(new q(da.scrollLeft,da.scrollTop));}var ea=q.getElementPosition(this._context,aa),fa=ea.x-ba.x,ga=ea.y-ba.y,ha=o.isRTL();if(y.getPosition()==='below')ga+=this._context.offsetHeight;if((y.getPosition()==='right'||(y.isVertical()&&y.getAlignment()==='right'))!=ha)fa+=this._context.offsetWidth;var ia=y.getOffsetX();if(y.isVertical()&&y.getAlignment()==='center')ia+=(this._context.offsetWidth-this._content.offsetWidth)/2;if(ha)ia*=-1;var ja='left',ka=fa+ia;if(u(y)!==ha){ja='right';ka=ca-ka;}j.setStyle(this._root,ja,ka+'px');j.setStyle(this._root,ja==='left'?'right':'left','');var la=this.getInsertScrollParent(),ma;if(la!==window){ma=la.clientWidth;}else ma=document.documentElement.clientWidth;var na=q.getElementPosition(this._root).x;if(ja==='left'){j.setStyle(this._root,'width',(ma-na)+'px');}else j.setStyle(this._root,'width',na+this._root.offsetWidth+'px');j.setStyle(this._root,'top',(ga+y.getOffsetY())+'px');var oa=t(this._context,this.getInsertParent());j.setStyle(this._root,'z-index',oa>200?oa:'');return true;},_updateWrapperPosition:function(y){var z=y.getPosition()==='above';j.setStyle(this._contentWrapper,'bottom',z?'0':null);var aa=o.isRTL()?'left':'right',ba=u(y);j.setStyle(this._contentWrapper,aa,ba?'0':null);},_updateWrapperClass:function(y){var z=y.getClassName();if(z===this._orientationClass)return;if(this._orientationClass)j.removeClass(this._contentWrapper,this._orientationClass);this._orientationClass=z;j.addClass(this._contentWrapper,z);},destroy:function(){this.parent.destroy();this._contentWrapper=null;this._content=null;return this;}});function x(){this._default={_position:'above',_alignment:'left',_offsetX:0,_offsetY:0,_valid:true};this.reset();}x.OPPOSITE={above:'below',below:'above',left:'right',right:'left'};s(x.prototype,{setPosition:function(y){this._position=y;return this;},setAlignment:function(y){this._alignment=y;return this;},getOppositePosition:function(){return x.OPPOSITE[this.getPosition()];},invalidate:function(){this._valid=false;return this;},getPosition:function(){return this._position||'above';},getAlignment:function(){return this._alignment||'left';},getOffsetX:function(){var y=this._offsetX||0;if(!this.isVertical()){if(this._default._position!==this._position)y*=-1;}else if(this._default._alignment!==this._alignment)y*=-1;return y;},getOffsetY:function(){var y=this._offsetY||0;if(this.isVertical()&&this._default._position!==this._position)y*=-1;return y;},getClassName:function(){if(this.isVertical())return this.getPosition()+this.getAlignment();return this.getPosition();},isValid:function(){return this._valid;},isVertical:function(){return this.getPosition()==='above'||this.getPosition()==='below';},reset:function(y,z){s(this,this._default);return this;},setDefaultPosition:function(y){this._default._position=y;return this;},setDefaultAlignment:function(y){this._default._alignment=y;return this;},setDefaultOffsetX:function(y){this._default._offsetX=y;return this;},setDefaultOffsetY:function(y){this._default._offsetY=y;return this;}});e.exports=v;});
__d("KeyStatus",["event-extensions"],function(a,b,c,d,e,f){b("event-extensions");var g=null,h=null;function i(){if(!h)h=Event.listen(window,'blur',function(){g=null;j();});}function j(){if(h){h.remove();h=null;}}Event.listen(document.documentElement,'keydown',function(l){g=Event.getKeyCode(l);i();},Event.Priority.URGENT);Event.listen(document.documentElement,'keyup',function(l){g=null;j();},Event.Priority.URGENT);var k={isKeyDown:function(){return !!g;},getKeyDownCode:function(){return g;}};e.exports=k;});
__d("ContextualLayerAutoFlip",["array-extensions","event-extensions","DOM","Locale","Rect","Vector","copyProperties","ge","getOverlayZIndex"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("DOM"),h=b("Locale"),i=b("Rect"),j=b("Vector"),k=b("copyProperties"),l=b("ge"),m=b("getOverlayZIndex");function n(q){this._layer=q;}var o=function(){var q=l('blueBar'),r=q?q.offsetHeight:0;o=bagof(r);return r;};function p(){return (window.ChatSidebar&&window.ChatSidebar.getVisibleWidth())||0;}k(n.prototype,{enable:function(){this._subscription=this._layer.subscribe('adjust',this._adjustOrientation.bind(this));if(this._layer.isShown())this._layer.updatePosition();},disable:function(){this._layer.unsubscribe(this._subscription);this._subscription=null;if(this._layer.isShown())this._layer.updatePosition();},_adjustOrientation:function(q,r){var s=this._getValidPositions(r);if(!s.length){r.invalidate();return;}var t=this._getViewportRect(),u=j.getElementDimensions(this._layer.getContent()),v=this._getValidAlignments(r);for(var w=0;w<v.length;w++){r.setAlignment(v[w]);for(var x=0;x<s.length;x++){r.setPosition(s[x]);var y=this._getLayerRect(r,u);if(t.contains(y))return;}}r.setPosition(s[0]).setAlignment(v[0]);},_getViewportRect:function(){var q=l('globalContainer'),r=this._layer.getContext(),s=(q&&g.contains(q,r))||m(r)<300,t=i.getViewportBounds();if(s){t.t+=o();if(h.isRTL()){t.l+=p();}else t.r-=p();}return t;},_getLayerRect:function(q,r){var s=this._layer.getContext(),t=j.getElementPosition(s,'viewport'),u=t.y+q.getOffsetY();if(q.getPosition()==='above'){u-=r.y;}else if(q.getPosition()==='below')u+=s.offsetHeight;var v=t.x+q.getOffsetX();if(q.isVertical()){var w=q.getAlignment();if(w==='center'){v+=(s.offsetWidth-r.x)/2;}else if((w==='right')!==h.isRTL())v+=s.offsetWidth-r.x;}else if((q.getPosition()==='right')!==h.isRTL()){v+=s.offsetWidth;}else v-=r.x;return new i(u,v+r.x,u+r.y,v,'viewport');},_getValidPositions:function(q){var r=[q.getPosition(),q.getOppositePosition()],s=this._layer.getContextScrollParent();if(s===window||s===g.getDocumentScrollElement())return r;var t=this._layer.getContext(),u=j.getElementPosition(s,'viewport').y,v=j.getElementPosition(t,'viewport').y;if(q.isVertical()){return r.filter(function(x){if(x==='above'){return v>=u;}else{var y=u+s.offsetHeight,z=v+t.offsetHeight;return z<=y;}});}else{var w=u+s.offsetHeight;if(v>=u&&v+t.offsetHeight<=w){return r;}else return [];}},_getValidAlignments:function(q){var r=['left','center','right'],s=q.getAlignment(),t=r.indexOf(s);if(t>0){r.splice(t,1);r.unshift(s);}return r;}});e.exports=n;});
__d("Tooltip",["event-extensions","AsyncRequest","copyProperties","ContextualLayer","ContextualLayerAutoFlip","css","DataStore","DOM","HTML","StringEscape"],function(a,b,c,d,e,f){b("event-extensions");var g=b("AsyncRequest"),h=b("copyProperties"),i=b("ContextualLayer"),j=b("ContextualLayerAutoFlip"),k=b("css"),l=b("DataStore"),m=b("DOM"),n=b("HTML"),o=b("StringEscape"),p=null,q=null,r=null,s=[];function t(){if(!q){r=m.create('div',{className:'tooltipContent'});var w=m.create('i',{className:'arrow'}),x=m.create('div',{className:'uiTooltipX'},[r,w]);q=new i();q.init(x).enableBehavior(j);}}function u(w){return h({position:w.getAttribute('tooltip-position')||'above',alignH:w.getAttribute('tooltip-alignh')||'left'},l.get(w,'tooltip'));}var v={process:function(w,x){if(!m.contains(w,x))return;if(w!==p){var y=w.getAttribute('tooltip-uri');if(y){w.removeAttribute('tooltip-uri');new g(y).setHandler(function(ba){v.set(w,ba.getPayload());}).setErrorHandler(bagofholding).send();}var z=w.getAttribute('title');if(z){w.setAttribute('title','');var aa=u(w);!aa.content&&v.set(w,z);}v.show(w);}},remove:function(w){l.remove(w,'tooltip');w.removeAttribute('data-hover');w.removeAttribute('tooltip-position');w.removeAttribute('tooltip-alignh');w===p&&v.hide();},hide:function(){if(p){q.hide();p=null;while(s.length)s.pop().remove();}},set:function(w,x,y,z){var aa=u(w);l.set(w,'tooltip',h(aa,{content:x,position:y||aa.position,alignH:z||aa.alignH}));w.setAttribute('data-hover','tooltip');w===p&&v.show(w);},show:function(w){t();v.hide();var x=u(w);if(!x.content)return;var y=0,z=0;if(x.position==='left'||x.position==='right'){z=(w.offsetHeight-20)/2;}else if(x.alignH!=='center'){var aa=w.offsetWidth;if(aa<18)y=(aa-18)/2*(x.alignH==='right'?-1:1);}q.setContext(w).setOffsetX(y).setOffsetY(z).setPosition(x.position).setAlignment(x.alignH);if(typeof x.content==='string'){k.addClass(q,'invisible_elem');var ba=m.create('span',{},n(o.htmlize(x.content))),ca=m.create('div',{className:'tooltipText'},ba);m.setContent(r,ca);q.show();if(ca.offsetWidth<ba.offsetWidth){k.addClass(ca,'tooltipWrap');q.updatePosition();}k.removeClass(q,'invisible_elem');}else{m.setContent(r,x.content);q.show();}s.push(Event.listen(document.documentElement,'mouseover',function(ea){if(!m.contains(p,ea.getTarget()))v.hide();}));var da=k.getScrollParent(w);if(da!==window)s.push(Event.listen(da,'scroll',v.hide));s.push(Event.listen(w,'click',v.hide));p=w;}};Event.listen(window,'scroll',v.hide);e.exports=a.Tooltip||v;});
__d("Selector",["event-extensions","Arbiter","Button","ContextualLayer","copyProperties","css","DataStore","DOM","HTML","Input","Keys","KeyStatus","Menu","Parent","Toggler","Tooltip","Vector"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("Button"),i=b("ContextualLayer"),j=b("copyProperties"),k=b("css"),l=b("DataStore"),m=b("DOM"),n=b("HTML"),o=b("Input"),p=b("Keys"),q=b("KeyStatus"),r=b("Menu"),s=b("Parent"),t=b("Toggler"),u=b("Tooltip"),v=b("Vector"),w,x,y=[],z;function aa(la){return s.byClass(la,'uiSelector');}function ba(la){return s.byClass(la,'uiSelectorButton');}function ca(){if(!x)x=new i().init().setPosition('below');return x;}function da(la){return m.scry(la,'select')[0];}function ea(la){return m.find(la,'div.uiSelectorMenuWrapper');}function fa(){fa=bagofholding;r.subscribe('select',function(la,ma){if(!w||!ma||ma.menu!==ka.getSelectorMenu(w))return;var na=ga(w),oa=ha(ma.item);if(oa){var pa=w,qa=ka.isOptionSelected(ma.item),ra=ka.inform('select',{selector:pa,option:ma.item});if(ra===false)return;if(na||!qa){ka.setSelected(pa,ka.getOptionValue(ma.item),!qa);ka.inform('toggle',{selector:pa,option:ma.item});ka.inform('change',{selector:pa});g.inform('Form/change',{node:pa});if(ia(pa))l.set(pa,'dirty',true);}}if(!na||!oa)w&&ka.toggle(w);});}function ga(la){return !!la.getAttribute('data-multiple');}function ha(la){return k.hasClass(la,'uiSelectorOption');}function ia(la){return !!la.getAttribute('data-autosubmit');}var ja={keydown:function(event){var la=event.getTarget();if(m.isNodeOfType(la,['input','textarea']))return;switch(Event.getKeyCode(event)){case p.DOWN:case p.SPACE:case p.UP:if(ba(la)){var ma=aa(la);ka.toggle(ma);return false;}break;case p.ESC:if(w){ka.toggle(w);return false;}break;}},mouseover:function(event){var la=s.byAttribute(event.getTarget(),'ajaxify');if(la&&k.hasClass(la,'uiSelectorButton'))ka.loadMenu(aa(la));}};Event.listen(document.documentElement,ja);t.subscribe(['show','hide'],function(la,ma){var na=aa(ma.getActive());if(na){fa();var oa=ka.getSelectorButton(na),pa=ka.getSelectorMenu(na),qa=la==='show';if(qa){w=na;if(k.hasClass(oa,'uiButtonDisabled')){ka.setEnabled(na,false);return false;}pa=pa||ka.loadMenu(na);var ra=k.getScrollParent(na),sa=ra!==window&&ra!==m.getDocumentScrollElement();if(sa||k.hasClass(na,'uiSelectorUseLayer')){if(sa)y.push(Event.listen(ra,'scroll',function(){ma.hide();}));z=m.create('div',{className:na.className});k.addClass(z,'invisible_elem');v.getElementDimensions(na).setElementDimensions(z);m.replace(na,z);var ta=k.hasClass(na,'uiSelectorRight'),ua=k.hasClass(na,'uiSelectorBottomUp');ca().setContext(z).setContent(na).setPosition(ua?'above':'below').setAlignment(ta?'right':'left').show();}r.register(pa);if(q.isKeyDown()){var va=r.getCheckedItems(pa);if(!va.length)va=r.getEnabledItems(pa);r.focusItem(va[0]);}}else{w=null;if(z){while(y.length)y.pop().remove();m.replace(z,na);ca().hide();z=null;}pa&&r.unregister(pa);if(q.isKeyDown())o.focus(oa);if(ia(na)&&l.get(na,'dirty')){var wa=m.scry(na,'input.submitButton')[0];wa&&wa.click();l.remove(na,'dirty');}}k.conditionClass(ka.getSelectorButton(na),'selected',qa);ka.inform(qa?'open':'close',{selector:na,clone:z});}});var ka=j(new g(),{attachMenu:function(la,ma,na){la=aa(la);if(la){w&&r.unregister(ka.getSelectorMenu(w));m.setContent(ea(la),ma);w&&r.register(ka.getSelectorMenu(la));z&&ca().updatePosition();if(na){var oa=la.getAttribute('data-name');oa&&na.setAttribute('name',oa);if(!ga(la))na.setAttribute('multiple',false);var pa=da(la);if(pa){m.replace(pa,na);}else m.insertAfter(la.firstChild,na);}return true;}},enableLazyLoad:function(){},getOption:function(la,ma){var na=ka.getOptions(la),oa=na.length;while(oa--)if(ma===ka.getOptionValue(na[oa]))return na[oa];return null;},getOptions:function(la){var ma=r.getItems(ka.getSelectorMenu(la));return ma.filter(ha);},getEnabledOptions:function(la){var ma=r.getEnabledItems(ka.getSelectorMenu(la));return ma.filter(ha);},getSelectedOptions:function(la){return r.getCheckedItems(ka.getSelectorMenu(la));},getOptionText:function(la){return r.getItemLabel(la);},getOptionValue:function(la){var ma=aa(la),na=da(ma),oa=ka.getOptions(ma).indexOf(la);return oa>=0?na.options[oa+1].value:'';},getSelectorButton:function(la){return m.find(la,'a.uiSelectorButton');},getSelectorMenu:function(la){return m.scry(la,'div.uiSelectorMenu')[0];},getValue:function(la){var ma=da(la);if(!ma)return null;if(!ga(la))return ma.value;var na=[],oa=ma.options;for(var pa=1,qa=oa.length;pa<qa;pa++)if(oa[pa].selected)na.push(oa[pa].value);return na;},isOptionSelected:function(la){return r.isItemChecked(la);},listen:function(la,ma,na){return this.subscribe(ma,function(oa,pa){if(pa.selector===la)return na(pa,oa);});},loadMenu:function(la){var ma=ka.getSelectorMenu(la);if(!ma){var na=ka.getSelectorButton(la),oa=na.getAttribute('ajaxify');if(oa){d(["AsyncRequest"],function(qa){qa.bootstrap(oa,na);});var pa=n('<div class="uiSelectorMenuWrapper uiToggleFlyout">'+'<div class="uiMenu uiSelectorMenu loading">'+'<ul class="uiMenuInner">'+'<li><span></span></li>'+'</ul>'+'</div>'+'</div>');m.appendContent(na.parentNode,pa);ma=ka.getSelectorMenu(la);na.removeAttribute('onmouseover');}}return ma;},setButtonLabel:function(la,ma){var na=ka.getSelectorButton(la),oa=parseInt(na.getAttribute('data-length'),10);ma=ma||na.getAttribute('data-label')||'';h.setLabel(na,ma);if(typeof ma==='string'){k.conditionClass(na,'uiSelectorBigButtonLabel',ma.length>oa);if(oa&&ma.length>oa){na.setAttribute('title',ma);}else na.removeAttribute('title');}},setButtonTooltip:function(la,ma){var na=ka.getSelectorButton(la),oa=s.byTag(na,'a');oa&&u.set(s.byTag(na,'a'),ma||na.getAttribute('data-tooltip')||'');},setEnabled:function(la,ma){if(!ma&&w&&aa(la)===w)ka.toggle(la);h.setEnabled(ka.getSelectorButton(la),ma);},setOptionEnabled:function(la,ma){r.setItemEnabled(la,ma);},setSelected:function(la,ma,na){na=na!==false;var oa=ka.getOption(la,ma);if(!oa)return;var pa=ka.isOptionSelected(oa);if(na!==pa){if(!ga(la)&&!pa){var qa=ka.getSelectedOptions(la)[0];qa&&r.toggleItem(qa);}r.toggleItem(oa);ka.updateSelector(la);}},toggle:function(la){t.toggle(m.scry(aa(la),'div.wrap')[0]);},updateSelector:function(la){var ma=ka.getOptions(la),na=ka.getSelectedOptions(la),oa=da(la).options,pa=[],qa=[];for(var ra=0,sa=ma.length;ra<sa;ra++){var ta=na.contains(ma[ra]);oa[ra+1].selected=ta;if(ta){var ua=ka.getOptionText(ma[ra]);pa.push(ua);qa.push(ma[ra].getAttribute('data-tooltip')||ua);}}oa[0].selected=!na.length;var va=k.hasClass(la,'uiSelectorDynamicLabel'),wa=k.hasClass(la,'uiSelectorDynamicTooltip');if(va||wa){var xa='';if(ga(la)){var ya=ka.getSelectorButton(la);xa=ya.getAttribute('data-delimiter')||', ';}pa=pa.join(xa);qa=qa.join(xa);va&&ka.setButtonLabel(la,pa);wa&&ka.setButtonTooltip(la,qa);}}});e.exports=a.Selector||ka;});
__d("DynamicIconSelector",["Button","css","DOM","Selector"],function(a,b,c,d,e,f){var g=b("Button"),h=b("css"),i=b("DOM"),j=b("Selector"),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("PrivacyConst",["copyProperties"],function(a,b,c,d,e,f){var g=b("copyProperties"),h={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},i={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},j={ONLY_CORP_NETWORK:200,COLLEGE_NETWORK_FRIENDS_OF_FRIENDS:201,COLLEGE_NETWORK_FRIENDS:202},k={TYPE_COLLEGE:1,TYPE_HS:2,TYPE_CORP:3,TYPE_GEO:4,TYPE_MANAGED:14,TYPE_TEST:50},l=1;g(h,j);var m={BaseValue:h,FriendsValue:i,NetworksAll:l,NetworkTypes:k,SpecialPreset:j};e.exports=m;});
__d("AudienceSelector",["Arbiter","css","DOM","DynamicIconSelector","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("css"),i=b("DOM"),j=b("DynamicIconSelector"),k=b("PrivacyConst"),l=b("Selector");l.subscribe('select',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;var o=l.getOptionValue(n.option);g.inform('AudienceSelector/changed',n);if(o==k.BaseValue.CUSTOM){l.toggle(n.selector);return false;}if(h.hasClass(n.selector,'dataTooltip')){var p=i.find(n.option,'.itemAnchor').getAttribute('data-tooltip');l.setButtonTooltip(n.selector,p||null);}if(!h.hasClass(n.option,'specialOption'))return;var q=i.find(n.option,'a').getAttribute('data-type');if(h.hasClass(n.option,'moreOption')){h.addClass(n.selector,q);h.addClass(n.selector,'showSecondaryOptions');return false;}else if(h.hasClass(n.option,'returnOption')){h.removeClass(n.selector,'showSecondaryOptions');h.removeClass(n.selector,'friendList');return false;}});g.subscribe('CustomPrivacyOption/update',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;l.setSelected(n.selector,l.getOptionValue(n.option));j.swapIcon(n.selector);l.setButtonTooltip(n.selector,n.tooltip);g.inform('AudienceSelector/update',n.selector);});});
__d("ContextualLayerHideOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("copyProperties");function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('contextchange',this._handleContextChange.bind(this)),this._layer.subscribe('show',this.attach.bind(this)),this._layer.subscribe('hide',this.detach.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this.detach();},attach:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();if(j===window)return;this._listener=Event.listen(j,'scroll',this._layer.hide.bind(this._layer));},detach:function(){this._listener&&this._listener.remove();this._listener=null;},_handleContextChange:function(){this.detach();if(this._layer.isShown())this.attach();}});e.exports=i;});
__d("ContextualLayerUpdateOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("copyProperties");function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachScrollListener.bind(this)),this._layer.subscribe('hide',this._removeScrollListener.bind(this))];},disable:function(){while(this._subscriptions.length)this._layer.unsubscribe(this._subscriptions.pop());this.detach();},_attachScrollListener:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();this._listener=Event.listen(j,'scroll',this._layer.updatePosition.bind(this._layer));},_removeScrollListener:function(){this._listener&&this._listener.remove();this._listener=null;}});e.exports=i;});
__d("TypeaheadView",["event-extensions","ArbiterMixin","Class","css","DOM","Parent","Util","copyProperties","ge","tx"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ArbiterMixin"),h=b("Class"),i=b("css"),j=b("DOM"),k=b("Parent"),l=b("Util"),m=b("copyProperties"),n=b("ge"),o=b("tx");function p(q,r){this.element=this.content=$(q);m(this,r);}h.mixin(p,g,{events:['highlight','render','reset','select'],renderer:'basic',autoSelect:false,accessibleResultsText:"Autocomplete results are available. Use the up and down arrow keys to navigate the results.",accessibleEmptyText:"No autocomplete results are available.",init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},setTypeahead:function(q){this.typeahead=q;},setAccessibilityText:function(q){var r=n('uiTypeaheadGlobalStatus');r&&j.setContent(r,q);},setAccessibilityItem:function(q){var r=n('uiTypeaheadGlobalReader');r&&j.setContent(r,q);},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.visible)this.highlight(this.getIndex(event));},reset:function(q){if(!q)this.disableAutoSelect=false;this.justRendered=false;this.justShown=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(k.byTag(event.getTarget(),'li'));},getSelection:function(){var q=this.results[this.index]||null;return this.visible?q:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){i.show(this.element);if(this.results&&this.results.length)if(this.autoSelect){this.setAccessibilityText(o._("{name} is auto-selected. Use the up and down arrow keys to navigate more results.",{name:this.getItemText(this.selected)}));}else this.setAccessibilityText(this.accessibleResultsText);this.typeahead&&this.element.setAttribute('aria-expanded','true');this.visible=true;return this;},hide:function(){i.hide(this.element);this.setAccessibilityText('');this.typeahead&&this.typeahead.setAttribute('aria-expanded','false');this.visible=false;return this;},render:function(q,r,s){this.value=q;if(!r.length){if(this.results.length&&q)this.setAccessibilityText(this.accessibleEmptyText);this.reset(true);return;}this.justRendered=true;if(!this.results.length){this.justShown=true;if(!this.autoSelect&&this.isVisible()&&r.length)this.setAccessibilityText(this.accessibleResultsText);}var t={results:r,value:q};this.inform('beforeRender',t);r=t.results;var u=this.getDefaultIndex(r);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var v=this.results[this.index];for(var w=0,x=r.length;w<x;++w)if(v.uid==r[w].uid){u=w;break;}}this.results=r;j.setContent(this.content,this.buildResults(r));this.items=this.getItems();this.highlight(u,false);this.inform('render',r);},getItems:function(){return j.scry(this.content,'li');},buildResults:function(q){var r,s=null;if(typeof this.renderer=='function'){r=this.renderer;}else{r=TypeaheadRenderers[this.renderer];s=this.renderer;}r=r.bind(this);var t=q.map(function(v,w){return v.node||r(v,w);}),u=j.create('ul',{className:s,id:'typeahead_list_'+(this.typeahead?j.getID(this.typeahead):j.getID(this.element))},t);u.setAttribute('role','listbox');return u;},getDefaultIndex:function(q){var r=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!r?-1:0;},next:function(){this.highlight(this.index+1);},prev:function(){this.highlight(this.index-1);},getItemText:function(q){var r='';if(q){r=q.getAttribute('aria-label');if(!r){r=j.getText(q);q.setAttribute('aria-label',r);}}return r;},setIsViewingSelectedItems:function(q){this.viewingSelected=q;return this;},getIsViewingSelectedItems:function(){return this.viewingSelected;},highlight:function(q,r){var s=true;this.selected&&i.removeClass(this.selected,'selected');if(q>this.items.length-1){q=-1;}else if(q<-1)q=this.items.length-1;if(q>=0&&q<this.items.length){if(this.selected&&this.getItemText(this.items[q])===this.getItemText(this.selected))s=false;this.selected=this.items[q];i.addClass(this.selected,'selected');}this.index=q;this.disableAutoSelect=(q==-1);var t=(q!==-1),u=this.getItemText(this.selected);if(q!==-1&&this.isVisible()&&u&&this.autoSelect)if(this.justShown){this.setAccessibilityText(o._("{name} is auto-selected. Use the up and down arrow keys to navigate more results.",{name:u}));this.justRendered=false;this.justShown=false;t=false;}else if(s&&this.justRendered){this.setAccessibilityText(o._("{name} is auto-selected.",{name:u}));this.justRendered=false;t=false;}if(s&&t)this.setAccessibilityItem(u);if(r!==false)this.inform('highlight',{index:q,selected:this.results[q],element:this.selected});},select:function(q){var r=this.index,s=this.results[r];if(s){this.inform('select',{index:r,clicked:!!q,selected:s});this.inform('afterSelect');}}});e.exports=p;});
__d("ContextualTypeaheadView",["event-extensions","Class","ContextualLayer","ContextualLayerAutoFlip","ContextualLayerHideOnScroll","css","DOM","TypeaheadView","Vector","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Class"),h=b("ContextualLayer"),i=b("ContextualLayerAutoFlip"),j=b("ContextualLayerHideOnScroll"),k=b("css"),l=b("DOM"),m=b("TypeaheadView"),n=b("Vector"),o=b("copyProperties");function p(q,r){this.parent.construct(this,q,r);}g.extend(p,m);o(p.prototype,{init:function(){this.initializeLayer();this.parent.init();},initializeLayer:function(){this.context=this.element.parentNode;this.wrapper=l.$N('div');l.appendContent(this.wrapper,this.element);this.layer=new h().init(this.wrapper).enableBehavior(j).setContext(this.context).setPosition('below');if(k.isFixed(this.context))this.layer.enableBehavior(i);this.subscribe('render',this.renderLayer.bind(this));},show:function(){this.layer.show();n.getElementDimensions(this.context).setElementWidth(this.wrapper);return this.parent.show();},hide:function(){this.layer.hide();return this.parent.hide();},renderLayer:function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();}});e.exports=p;});
__d("CustomPrivacyOption",["event-extensions","AsyncRequest","Dialog","DOM","Form","Parent","Selector","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("AsyncRequest"),h=b("Dialog"),i=b("DOM"),j=b("Form"),k=b("Parent"),l=b("Selector"),m=b("copyProperties");function n(){}m(n,{_instances:{},update:function(o,p,q,r){var s=n._instances[o];s._update(p,q)._updateOption(q,r);Arbiter.inform('Form/change',{node:s._container});},getData:function(o){return n._instances[o]._privacyData;}});m(n.prototype,{init:function(o,p,q,r,s){(function(){var t=this.initCustomState(o,p);if(!t)return;Event.listen(t,'click',function(event){this.openCustomDialog(event,o,q,s);}.bind(this));this._initSelector(t,r);}).bind(this).defer();},_initSelector:function(o,p){this._selector=k.byClass(o,'uiSelector');l.listen(this._selector,'select',function(q){if(q.option._id!=this._id)this.clearCustomState();}.bind(this));if(p)l.setButtonTooltip(this._selector,p);},_updateOption:function(o,p){var q=l.getOption(this._selector,o)||l.getOption(this._selector,PrivacyBaseValue.CUSTOM+'');Arbiter.inform('CustomPrivacyOption/update',{selector:this._selector,option:q,tooltip:p});return this;},_update:function(o,p){var q=p==PrivacyBaseValue.CUSTOM||!l.getOption(this._selector,p),r=this._selector.getAttribute('data-name');this.updateCustomState(o,q,r);return this;},initCustomState:function(o,p){var q=ge(o);if(!q)return q;n._instances[o]=this;this._container=i.find(q,'.customPrivacyInputs');this._id=p;this._privacyData={};var r=j.serialize(this._container);if(r.audience)this._privacyData=r.audience[p];return q;},openCustomDialog:function(event,o,p,q){var r=new g('/ajax/privacy/custom_dialog/').setData({option_id:o,id:this._id,privacy_data:this._privacyData,explain_tags:p,autosave:q});new h().setAsync(r).setModal(true).setCausalElement(event.getTarget()).show();},updateCustomState:function(o,p,q){this.clearCustomState();this._privacyData=m({},o);if(p)if(q){q=q.slice(0,-'[value]'.length);var r={};r[q]=o;j.createHiddenInputs(r,this._container,null,true);}},clearCustomState:function(){this._privacyData={};i.empty(this._container);}});e.exports=a.CustomPrivacyOption||n;});
__d("DataSource",["array-extensions","ArbiterMixin","ArrayUtils","AsyncRequest","Class","ObjectUtils","TypeaheadUtil","copyProperties"],function(a,b,c,d,e,f){b("array-extensions");var g=b("ArbiterMixin"),h=b("ArrayUtils"),i=b("AsyncRequest"),j=b("Class"),k=b("ObjectUtils"),l=b("TypeaheadUtil"),m=b("copyProperties");function n(o){this._maxResults=o.maxResults||10;this.token=o.token;this.queryData=o.queryData||{};this.queryEndpoint=o.queryEndpoint||'';this.bootstrapData=o.bootstrapData||{};this.bootstrapEndpoint=o.bootstrapEndpoint||'';this._exclusions=o.exclusions||[];this._indexedFields=o.indexedFields||['text','tokens'];this._alwaysPrefixMatch=o.alwaysPrefixMatch||false;this._deduplicationKey=o.deduplicationKey||null;this._minExactMatchLength=4;}j.mixin(n,g,{events:['activity','bootstrap','query','respond'],init:function(){this.init=bagofholding;this._fields=k.createFrom(this._indexedFields);this._activeQueries=0;this.dirty();},dirty:function(){this.value='';this._bootstrapped=false;this._bootstrapping=false;this._data={};this.localCache={};this.queryCache={};this.inform('dirty',{});},bootstrap:function(){if(this._bootstrapped)return;this.bootstrapWithoutToken();this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},bootstrapWithoutToken:function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:true,token:this.token});},bootstrapWithToken:function(){var o=m({},this.bootstrapData);o.token=this.token;this.fetch(this.bootstrapEndpoint,o,{bootstrap:true,replaceCache:true});},query:function(o,p,q){this.inform('beforeQuery',{value:o});var r=this.buildUids(o,[],q),s=this.respond(o,r);this.value=o;this.inform('query',{value:o,results:s});var t=l.parse(o).flatValue;if(p||!t||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(t)||!this.shouldFetchMoreResults(s))return false;this.inform('queryEndpoint',{value:o});this.fetch(this.queryEndpoint,this.getQueryData(o,r),{value:o,exclusions:q});return true;},shouldFetchMoreResults:function(o){return o.length<this._maxResults;},getQueryData:function(o,p){var q=m({value:o},this.queryData||{});p=p||[];if(p.length)q.existing_ids=p.join(',');if(this._bootstrapping)q.bsp=true;return q;},setQueryData:function(o,p){if(p)this.queryData={};m(this.queryData,o);return this;},setBootstrapData:function(o,p){if(p)this.bootstrapData={};m(this.bootstrapData,o);return this;},getExclusions:function(){return h.createFrom(this._exclusions);},setExclusions:function(o){this._exclusions=o||[];},setFilter:function(o){this.filter=o;},respond:function(o,p,q){var r=this.buildData(p);this.inform('respond',{value:o,results:r,isAsync:!!q});return r;},asyncErrorHandler:bagofholding,fetch:function(o,p,q){if(!o)return;var r=new i().setURI(o).setData(p).setMethod('GET').setReadOnly(true).setHandler(function(s){this.fetchHandler(s,q||{});}.bind(this));if(o===this.queryEndpoint)r.setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));r.setErrorHandler(this.asyncErrorHandler);this.inform('beforeFetch',{request:r,fetch_context:q});r.send();if(o===this.queryEndpoint){if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;}},fetchHandler:function(o,p){var q=p.value,r=p.exclusions;if(!q&&p.replaceCache)this.localCache={};this.addEntries(o.getPayload().entries,q);this.inform('fetchComplete',{response:o,value:q,fetch_context:p});var s=(!q&&this.value)?this.value:q;this.respond(s,this.buildUids(s,[],r),true);if(!q){if(this._bootstrapping){this._bootstrapping=false;this.inform('bootstrap',{bootstrapping:false});}if(p.token&&o.getPayload().token!==p.token)this.bootstrapWithToken();}},addEntries:function(o,p){var q=this.processEntries(h.createFrom(o||[]),p),r=this.buildUids(p,q);if(p){var s=this.getQueryCache();s[l.parse(p).flatValue]=r;}else this.fillCache(r);},processEntries:function(o,p){return o.map(function(q,r){var s=(q.uid=q.uid+''),t=this.getEntry(s);if(!t){t=q;t.query=p;this.setEntry(s,t);}else m(t,q);t.index===undefined&&(t.index=r);return s;},this);},getAllEntries:function(){return this._data||{};},getEntry:function(o){return this._data[o]||null;},setEntry:function(o,p){this._data[o]=p;},fillCache:function(o){var p=this.localCache;o.each(function(q){var r=this.getEntry(q);if(!r)return;r.bootstrapped=true;var s=l.parse(this.getTextToIndex(r)).tokens;for(var t=0,u=s.length;t<u;++t){var v=s[t];if(!p.hasOwnProperty(v))p[v]={};p[v][q]=true;}},this);},getTextToIndex:function(o){if(o.textToIndex)return o.textToIndex;var p=[];for(var q in this._fields){var r=o[q];if(r)p.push(r.join?r.join(' '):r);}return (o.textToIndex=p.join(' '));},mergeUids:function(o,p,q,r){var s=function(t,u){var v=this.getEntry(t),w=this.getEntry(u);if(v.extended_match!==w.extended_match)return v.extended_match?1:-1;if(v.index!==w.index)return v.index-w.index;if(v.text.length!==w.text.length)return v.text.length-w.text.length;return v.uid<w.uid;}.bind(this);this._checkExtendedMatch(r,o);return this._deduplicateByKey(o.sort(s).concat(p,q));},_checkExtendedMatch:function(o,p){var q=this._alwaysPrefixMatch?l.isPrefixMatch:l.isQueryMatch;for(var r=0;r<p.length;++r){var s=this.getEntry(p[r]);s.extended_match=s.tokens?!q(o,s.text):false;}},buildUids:function(o,p,q){if(!p)p=[];if(!o)return p;if(!q)q=[];var r=this.buildCacheResults(o,this.localCache),s=this.buildQueryResults(o),t=this.mergeUids(r,s,p,o),u=k.createFrom(q.concat(this._exclusions)),v=t.filter(function(w){if(u.hasOwnProperty(w)||!this.getEntry(w))return false;if(this.filter&&!this.filter(this.getEntry(w)))return false;return (u[w]=true);},this);return this.uidsIncludingExact(o,v,u);},uidsIncludingExact:function(o,p,q){var r=p.length;if(o.length<this._minExactMatchLength||r<=this._maxResults)return p;for(var s=0;s<r;++s){var t=this.getEntry(p[s]);t.text_lower||(t.text_lower=t.text.toLowerCase());if(t.text_lower===l.parse(o).flatValue){if(s>=this._maxResults){var u=p.splice(s,1);p.splice(this._maxResults-1,0,u);}break;}}return p;},buildData:function(o){var p=[],q=Math.min(o.length,this._maxResults);for(var r=0;r<q;++r)p.push(this.getEntry(o[r]));return p;},findQueryCache:function(o){var p=0,q=null,r=this.getQueryCache();for(var s in r)if(o.indexOf(s)===0&&s.length>p){p=s.length;q=s;}return r[q]||[];},buildQueryResults:function(o){var p=l.parse(o).flatValue,q=this.findQueryCache(p);if(this.getQueryCache().hasOwnProperty(p))return q;return this.filterQueryResults(o,q);},filterQueryResults:function(o,p){var q=this._alwaysPrefixMatch?l.isPrefixMatch:l.isQueryMatch;return p.filter(function(r){return q(o,this.getTextToIndex(this.getEntry(r)));},this);},buildCacheResults:function(o,p){var q=l.parse(o,this._alwaysPrefixMatch),r=this._alwaysPrefixMatch?q.sortedTokens:q.tokens,s=r.length,t=q.isPrefixQuery?s-1:null,u={},v={},w={},x=[],y=false,z={},aa=0;for(var ba=0;ba<s;++ba){var ca=r[ba];if(!z.hasOwnProperty(ca)){aa++;z[ca]=true;}else continue;for(var da in p)if((!u.hasOwnProperty(da)&&da===ca)||((this._alwaysPrefixMatch||t===ba)&&da.indexOf(ca)===0)){if(da===ca){if(v.hasOwnProperty(da))y=true;u[da]=true;}else{if(u.hasOwnProperty(da)||v.hasOwnProperty(da))y=true;v[da]=true;}for(var ea in p[da])if(ba===0||(w.hasOwnProperty(ea)&&w[ea]==aa-1))w[ea]=aa;}}for(var fa in w)if(w[fa]==aa)x.push(fa);if(y||aa<s)x=this.filterQueryResults(o,x);return x;},_deduplicateByKey:function(o){if(!this._deduplicationKey)return o;var p=k.createFrom(o.map(this._getDeduplicationKey.bind(this)),o);return o.filter(function(q){return p[this._getDeduplicationKey(q)]==q;}.bind(this));},_getDeduplicationKey:function(o){var p=this.getEntry(o);return p[this._deduplicationKey]||'__'+o+'__';},getQueryCache:function(){return this.queryCache;},setMaxResults:function(o){this._maxResults=o;this.value&&this.respond(this.value,this.buildUids(this.value));},updateToken:function(o){this.token=o;this.dirty();return this;}});e.exports=n;});
__d("FullScreen",["event-extensions","Arbiter","css-core","FunctionUtils","ua","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("css-core"),i=b("FunctionUtils"),j=b("ua"),k=b("copyProperties"),l=k(new g(),{listenForEvent:function(m){var n=i.throttle(this.onChange.bind(this),0);Event.listen(m,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});Event.listen(document,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});},enableFullScreen:function(m){this.listenForEvent(m);if(m.webkitRequestFullScreen){if(j.chrome()){m.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);}else m.webkitRequestFullScreen();}else if(m.mozRequestFullScreen){m.mozRequestFullScreen();}else if(m.requestFullScreen){m.requestFullScreen();}else return false;return true;},disableFullScreen:function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.exitFullScreen){document.exitFullScreen();}else return false;return true;},isFullScreen:function(){return (document.webkitIsFullScreen||document.fullScreen||document.mozFullScreen);},toggleFullScreen:function(m){if(this.isFullScreen()){this.disableFullScreen();return false;}else return this.enableFullScreen(m);return false;},onChange:function(){var m=this.isFullScreen();h.conditionClass(document.body,'fullScreen',m);this.inform('changed');},isSupported:function(){return (document.webkitCancelFullScreen&&j.chrome())||document.mozCancelFullScreen||document.cancelFullScreen||document.exitFullScreen;}});e.exports=l;});
__d("ImageUtils",["ua"],function(a,b,c,d,e,f){var g=b("ua"),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.safari()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__d("JSONPTransport",["DOM","URI","copyProperties","ua"],function(a,b,c,d,e,f){var g=b("DOM"),h=b("URI"),i=b("copyProperties"),j=b("ua"),k={},l=2,m='jsonp',n='iframe';function o(p,q,r){this._type=p;this._uri=q;this._handler=r;k[this.getID()]=this;}i(o,{respond:function(p,q,r){var s=k[p];if(s){if(!r)delete k[p];a.async_callback(s.handleResponse.bind(s),'json')(q);}else if(a.logJSError&&!r)a.logJSError('ajax',{error:'UnexpectedJsonResponse',extra:{id:p,uri:(q.payload&&q.payload.uri)||''}});}});i(o.prototype,{getID:function(){return this._id||(this._id=l++);},hasFinished:function(){return !(this.getID() in k);},send:function(){var p=h(this._uri).addQueryData({__adt:this.getID()}).toString();if(this._type===m){(function(){document.body.appendChild(g.create('script',{src:p,type:'text/javascript'}));}).defer();}else{this._iframe=g.create('iframe',{src:"javascript:''",style:{height:'80px',position:'absolute',top:'-9999999px',width:'80px'}});document.body.appendChild(this._iframe);this._iframe.src=p;}},handleResponse:function(p){if(!this._aborted){if(this._type===n)if(j.ie()>=9&&a.JSON)p=a.JSON.parse(a.JSON.stringify(p));this._handler(p);}if(this.hasFinished())if(this._iframe){g.remove.curry(this._iframe).defer();this._iframe=null;}},abort:function(){this._aborted=true;}});e.exports=o;});
__d("OnVisible",["event-extensions","function-extensions","DOM","FunctionUtils","ObjectUtils","Run","Vector","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("DOM"),h=b("FunctionUtils"),i=b("ObjectUtils"),j=b("Run"),k=b("Vector"),l=b("copyProperties");function m(n,o,p,q,r){this.element=n;this.handler=o;this.strict=p;this.buffer=i.coalesce(q,300);this.options=r||{};this.lastY=k.getScrollPosition().y;this.lastTime=Date.now();this.reset();j.onLeave(this.remove.bind(this));}l(m.prototype,{reset:function(){if(this.scrollListener)return;this.removed=false;var n=h.throttle(function(){var o=k.getElementPosition(this.element);if(!o||this.removed){this.remove();return;}this.targetY=o.y;var p=k.getScrollPosition().y,q=k.getViewportDimensions().y,r=p+q+this.buffer;if(r>this.targetY){var s=!this.strict||(p-this.buffer<(this.targetY+k.getElementDimensions(this.element).y));if(s){this.remove();if(this.options.detect_speed){var t=(p-this.lastY),u=t/(Date.now()-this.lastTime+1);if((u>q/100)||(r>=k.getDocumentDimensions().y&&t>1000))return true;}this.handler();}}if(this.options.detect_speed){this.lastY=p;this.lastTime=Date.now();}return true;}.bind(this),100);this.scrollListener=Event.listen(window,'scroll',n);this.resizeListener=Event.listen(window,'resize',n);n();},remove:function(){this.removed=true;if(this.scrollListener){this.scrollListener.remove();this.resizeListener.remove();this.scrollListener=this.resizeListener=null;}}});e.exports=m;});
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","Class","ContextualLayer","css","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler"],function(a,b,c,d,e,f){b("event-extensions");var g=b("Arbiter"),h=b("ArbiterMixin"),i=b("Class"),j=b("ContextualLayer"),k=b("css"),l=b("DataStore"),m=b("DOM"),n=b("Input"),o=b("KeyStatus"),p=b("LayerHideOnEscape"),q=b("Toggler");q.subscribe(['show','hide'],function(s,t){var u=l.get(t.getActive(),'Popover');if(u)if(s==='show'){u.showLayer();}else u.hideLayer();});function r(s,t,u,v){this._root=s;this._triggerElem=t;this._behaviors=u;this._config=v;if(!(t.nodeName==='A'&&t.rel==='toggle'))Event.listen(t,'click',function(){q.bootstrap(t);});l.set(s,'Popover',this);}i.mixin(r,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();q.show(this._root);k.addClass(this._root,'selected');this.inform('show');},hideLayer:function(){this._layer.hide();},isShown:function(){return this._layer.isShown();},setLayerContent:function(s){this.ensureInit();this._layer.setContent(s);},_init:function(){var s=new j().init(m.$N('div')).setContext(this._triggerElem).enableBehavior(p).setPosition('below');q.createInstance(s.getRoot()).setSticky(false);s.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&s.enableBehaviors(this._behaviors);this._layer=s;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){q.hide(this._root);k.removeClass(this._root,'selected');this.inform('hide');if(o.isKeyDown())n.focus(this._triggerElem);}});e.exports=r;});
__d("PopoverMenu",["ARIA","Arbiter","ArbiterMixin","BehaviorsMixin","Class","copyProperties","Input","Keys","KeyStatus"],function(a,b,c,d,e,f){var g=b("ARIA"),h=b("Arbiter"),i=b("ArbiterMixin"),j=b("BehaviorsMixin"),k=b("Class"),l=b("copyProperties"),m=b("Input"),n=b("Keys"),o=b("KeyStatus");function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}k.mixin(p,i,j);l(p.prototype,{_keydownListener:null,_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();g.owns(this._triggerElem,r);this.inform('setMenu',null,h.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(o.isKeyDown())this._menu.focusAnItem();this._keydownListener=Event.listen(document.documentElement,'keydown',this._handleKeydown.bind(this));}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();if(this._keydownListener){this._keydownListener.remove();this._keydownListener=null;}this._popoverShown=false;},_handleKeydown:function(q){if(q.getModifiers().any)return;var r=Event.getKeyCode(q);switch(r){case n.RETURN:return;case n.UP:case n.DOWN:this._menu.handleKeydown(r);break;default:if(this._menu.handleKeydown(r)===false){this._menu.blur();this._menu.handleKeydown(r);}break;}q.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(o.isKeyDown())m.focus(this._triggerElem);}});e.exports=p;});
__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class"],function(a,b,c,d,e,f){var g=b("Arbiter"),h=b("ArbiterMixin"),i=b("Class");function j(){}i.mixin(j,h,{getRoot:bagofholding,onShow:bagofholding,onHide:bagofholding,focusAnItem:bagof(false),blur:bagofholding,handleKeydown:bagof(false),done:function(){this.inform('done');}});e.exports=j;});
__d("PopupWindow",["copyProperties","ua","DOMQuery","DOMDimensions"],function(a,b,c,d,e,f){var g=b("copyProperties"),h=b("ua"),i=b("DOMQuery"),j=b("DOMDimensions"),k={_opts:{allowShrink:true,strategy:'vector',timeout:100,widthElement:null},init:function(l){g(k._opts,l);setInterval(k._resizeCheck,k._opts.timeout);},_resizeCheck:function(){var l=j.getViewportDimensions(),m=k._getDocumentSize(),n=m.height-l.height,o=m.width-l.width;if(o<0&&!k._opts.widthElement)o=0;if(!k._opts.allowShrink&&n<0)n=0;if(n||o)try{if(window.console&&window.console.firebug)console.log('Resizing will not work in firefox with firebug enabled. '+'See https://bugzilla.mozilla.org/show_bug.cgi?id=691693');window.resizeBy(o,n);if(o)window.moveBy(o/-2,0);}catch(p){}},_getDocumentSize:function(){var l=j.getDocumentDimensions();if(k._opts.strategy==='offsetHeight')l.height=document.body.offsetHeight;if(k._opts.widthElement){var m=i.scry(document.body,k._opts.widthElement)[0];if(m)l.width=j.getElementDimensions(m).width;}if(window.Dialog&&Dialog.max_bottom&&Dialog.max_bottom>l.height)l.height=Dialog.max_bottom;return l;},open:function(l,m,n){var o=typeof window.screenX!='undefined'?window.screenX:window.screenLeft,p=typeof window.screenY!='undefined'?window.screenY:window.screenTop,q=typeof window.outerWidth!='undefined'?window.outerWidth:document.body.clientWidth,r=typeof window.outerHeight!='undefined'?window.outerHeight:(document.body.clientHeight-22),s=parseInt(o+((q-n)/2),10),t=parseInt(p+((r-m)/2.5),10),u=('width='+n+',height='+m+',left='+s+',top='+t);return window.open(l,'_blank',u);}};e.exports=k;});
__d("PrivacyModel",["PrivacyConst","copyProperties"],function(a,b,c,d,e,f){var g=b("PrivacyConst"),h=b("copyProperties");function i(){this.value=g.BaseValue.ALL_FRIENDS;this.friends=g.FriendsValue.NO_FRIENDS;this.networks=[];this.objects=[];this.lists=[];this.lists_x=[];this.list_anon=0;this.ids_anon=[];this.list_x_anon=0;this.ids_x_anon=[];this.tdata={};return this;}h(i.prototype,{init:function(j,k,l,m,n,o,p,q,r,s,t){this.value=j;this.friends=k;this.networks=l.slice();this.objects=m.slice();this.lists=n.slice();this.lists_x=o.slice();this.list_anon=p;this.ids_anon=q.slice();this.list_x_anon=r;this.ids_x_anon=s.slice();t=t||{};h(this.tdata,t);},clone:function(){var j=new i();j.init(this.value,this.friends,this.networks,this.objects,this.lists,this.lists_x,this.list_anon,this.ids_anon,this.list_x_anon,this.ids_x_anon,this.tdata);return j;},getData:function(){var j=['value','friends','networks','objects','lists','lists_x','list_anon','ids_anon','list_x_anon','ids_x_anon'],k={};for(var l=0;l<j.length;++l){var m=j[l];k[m]=this[m];}return k;}});e.exports=i;});
__d("highlight",["Animation","css-core"],function(a,b,c,d,e,f){var g=b("Animation"),h=b("css-core");function i(j,k,l){new g(j).from('background','#fff9d7').to('background',l||'#fff').ease(g.ease.both).duration(2000).ondone(function(){h.setStyle(j,'background','');k&&k();}).go();}e.exports=i;});
__d("ScrollHighlight",["DOMScroll","highlight","css-core"],function(a,b,c,d,e,f){var g=b("DOMScroll"),h=b("highlight"),i=b("css-core"),j={actOn:function(k){g.scrollTo(k);h(k,null,'#EDEFF4');i.removeClass(k,'highlightComment');}};e.exports=j;});
__d("TypeaheadCore",["event-extensions","ArbiterMixin","Class","css","DOM","Input","InputSelection","Keys","ua","copyProperties"],function(a,b,c,d,e,f){b("event-extensions");var g=b("ArbiterMixin"),h=b("Class"),i=b("css"),j=b("DOM"),k=b("Input"),l=b("InputSelection"),m=b("Keys"),n=b("ua"),o=b("copyProperties");function p(q){o(this,q);}h.mixin(p,g,{events:['blur','focus','unselect'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(q,r,s){this.init=bagofholding;this.data=q;this.view=r;this.root=s;this.initInput();this.inputWrap=j.find(s,'div.wrap');this.hiddenInput=j.find(s,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&i.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=j.find(this.root,'.textInput');var q=j.scry(this.element,'input')[0];if(q)this.element=q;},initView:function(){this.view.subscribe('highlight',function(q,r){this.element.focus();this.element.setAttribute('aria-activedescendant',(r.index!==-1)?j.getID(r.element):'');}.bind(this));this.view.subscribe('select',function(q,r){this.select(r.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(q,r){if(r.forceDisplay||r.value==this.getValue()&&!this.element.disabled)this.view.render(r.value,r.results,r.isAsync);}.bind(this));this.data.subscribe('activity',function(q,r){this.fetching=r.activity;if(!this.fetching)this.nextQuery&&this.performQuery();}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var q={blur:bind(this,'blur'),focus:bind(this,'focus'),click:bind(this,'click'),keyup:bind(this,'keyup'),keydown:bind(this,'keydown')};if(n.firefox())q.text=q.keyup;if(n.firefox()<4){q.keypress=q.keydown;delete q.keydown;}Event.listen(this.element,q);Event.listen(this.element,'keypress',bind(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var q=l.get(this.element);if(q.start==q.end)this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case m.TAB:this.handleTab(event);return;case m.UP:this.view.prev();break;case m.DOWN:this.view.next();break;case m.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==m.RETURN){this.view.select();event.kill();}},handleTab:function(event){this.view.select();this.preventFocusChangeOnTab&&event.kill();},select:function(q){if(q&&this.setValueOnSelect){this.setValue(q.text);this.setHiddenValue(q.uid);this.selectedText=q.text;i.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?this.element.focus():this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;i.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(q){var r=q===false;this.element.disabled=r;i.conditionClass(this.root,'uiTypeaheadDisabled',r);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&k.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(q){this._exclusions=q;},getExclusions:function(){return this._exclusions;},setValue:function(q){this.value=this.nextQuery=q||'';k.setValue(this.element,this.value);},setHiddenValue:function(q){this.hiddenInput.value=(q||q===0)?q:'';Arbiter.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return k.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var q=this.getValue();if(q==this.value)return;if(this.selectedText&&this.selectedText!=q)this.unselect();var r=Date.now(),s=r-this.time;this.time=r;this.value=this.nextQuery=q;this.performQuery(s);},performQuery:function(q){if(this.selectedText)return;q=q||0;if(this.fetching&&q<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});e.exports=p;});
__d("enforceMaxLength",["event-extensions","function-extensions","DOM","Input","InputSelection"],function(a,b,c,d,e,f){b("event-extensions");b("function-extensions");var g=b("DOM"),h=b("Input"),i=b("InputSelection"),j=function(l,m){var n=h.getValue(l),o=n.length,p=o-m;if(p>0){var q,r;try{q=i.get(l);r=q.end;}catch(s){q=null;r=0;}if(r>=p)o=r;var t=o-p;if(t&&(n.charCodeAt(t-1)&64512)===55296)t--;r=Math.min(r,t);h.setValue(l,n.slice(0,t)+n.slice(o));if(q)i.set(l,Math.min(q.start,r),r);}},k=function(event){var l=event.getTarget(),m=l.getAttribute&&parseInt(l.getAttribute('maxlength'),10);if(m>0&&g.isNodeOfType(l,['input','textarea']))j.bind(null,l,m).defer();};Event.listen(document.documentElement,{keydown:k,paste:k});e.exports=j;});
__d("legacy:onvisible",["OnVisible"],function(a,b,c,d){a.OnVisible=b('OnVisible');},3);
function fbpage_set_fan_status(a,b,c,d,e,f,g){e=e?e:function(j){_fbpage_show_change_status_feedback(a,j.getPayload());};var h={fbpage_id:b,add:c,reload:d};if(g!=null)copy_properties(h,g);var i=new AsyncRequest().setURI('/ajax/pages/fan_status.php').setData(h).setNectarModuleDataSafe(a).setHandler(e);if(f)i.setErrorHandler(f);i.send();return false;}function fbpage_set_favorite_status(a,b,c){var d=function(){_fbpage_show_change_status_feedback(a,this.getUserData());},e={fbpage_id:b,add:c},f=new AsyncRequest().setMethod('POST').setURI('/ajax/pages/favorite_status.php').setData(e);new Dialog().setAsync(f).setCloseHandler(d).show();return false;}function _fbpage_show_change_status_feedback(a,b){if(!b||!a)return;if(b.reload){fbpage_reload_on_fan_status_changed(b.preserve_tab);}else fbpage_redraw_on_fan_status_changed(a,b.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a){var c=FutureSideNav.getInstance().selected.textKey;if(!b.getQueryData().sk&&c)b.addQueryData({sk:c});}window.location.href=b;}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;if(Parent.byClass(a,'fbTimelineEscapeSectionItem'))a=Parent.byClass(a,'fan_status_inactive')||a;var c=DOM.create('span',{className:'fan_status_inactive'},b);a.parentNode.replaceChild(c,a);var d=function(){if(data.can_repeat_action)c.parentNode.replaceChild(a,c);};animation(c).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(d).go();}function fbpage_toggle_like_on_fan_status_changed(a,b){var c=$('liked_pages_like_action_'+a),d=$('liked_pages_undo_action_'+a);CSS.conditionClass(c,'hidden_elem',b);CSS.conditionClass(d,'hidden_elem',!b);}
var PageLikeButton=window.PageLikeButton||(function(){function a(b,c,d,e,f){fbpage_set_fan_status(b,c,d,false,function(){Arbiter.inform(PageLikeButton.LIKED_SUCCESS,{profile_id:c});},e,{fan_origin:f});}return {LIKED:'liked',UNLIKED:'unliked',LIKED_SUCCESS:'liked_success',init:function(b,c,d,e,f,g){Arbiter.subscribe(PageLikeButton.LIKED,function(h,i){if(e===i.profile_id)b.swap();});Arbiter.subscribe(PageLikeButton.UNLIKED,function(h,i){if(e===i.profile_id){b.unswap();d.hideFlyout();}});Event.listen(c,'click',function(event){a(event.getTarget(),e,true,function(){Arbiter.inform(PageLikeButton.UNLIKED,{profile_id:e});},f);Arbiter.inform(PageLikeButton.LIKED,{profile_id:e});if(g)Arbiter.subscribe(PageLikeButton.LIKED_SUCCESS,function(h,i){app_data=URI.getRequestURI().getQueryData().app_data;if(i.profile_id==e)new AsyncRequest().setURI('/ajax/pages/fetch_app_column.php').setData({profile_id:e,tab_key:g,app_data:app_data}).send();});});},initUnlike:function(b,c,d){Event.listen(b,'click',function(event){a(event.getTarget(),c,false,function(){Arbiter.inform(PageLikeButton.LIKED,{profile_id:c});},d);Arbiter.inform(PageLikeButton.UNLIKED,{profile_id:c});});}};})();
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,BULK_EDITOR:3,FLASH_UPLOADER:4,SIZE_NORMAL:'n'};e.exports=g;});
__d("legacy:photos-constants",["PhotosConst"],function(a,b,c,d){a.PhotosConst=b('PhotosConst');},3);
__d("PhotoSessionLog",["AsyncRequest","ObjectUtils","Run","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('ObjectUtils'),i=b('Run'),j=b('Vector'),k=b('copyProperties');function l(){}k(l,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,buttonLikes:0,pagingAction:'',initLogging:function(m){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=m;this.buttonLikes=0;this.pagingAction='';if(m===l.SNOWLIFT){var n=j.getViewportDimensions();this.width=n.x;this.height=n.y;}},setLogFbids:function(m){this.logIds=m;},setPhotoSet:function(m){this.set=m;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(m){this.pagingAction=m;},addPhotoView:function(m,n,o){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(m)this.fbidList.push([m.fbid,m.owner,Date.now()]);if(n)this.hiResLoads++;if(o)this.fullScreenViews[m.fbid]=true;},logEnterFullScreen:function(m){this.fullScreenViews[m]=true;},addDetailData:function(m,n){if(!this.details[m])this.details[m]={t:n.num_tags,l:n.has_location,c:n.has_caption,cm:n.comment_count,lk:n.like_count,w:n.width,h:n.height,ad:'{}',p:this.pagingAction};},updateAdData:function(m,n){if(this.details[m])this.details[m].ad=JSON.stringify(n);},logPhotoViews:function(m){if((!this.views)||(this.version===l.SNOWLIFT&&m==l.LEAVE))return;if(m!=this.AGGREGATE)this.last=true;var n={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:m?m:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version};if(this.version===l.SNOWLIFT){var o=j.getViewportDimensions();n.width=o.x||this.width;n.height=o.y||this.height;if(this.hiResLoads>0)n.hires_loads=this.hiResLoads;if(this.last){var p=h.countKeys(this.fullScreenViews);if(p>0)n.fullscreen=p;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(m!=l.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(n).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});i.onUnload(function(){l.logPhotoViews(l.UNLOAD);});i.onLeave(function(){l.logPhotoViews(l.LEAVE);});e.exports=l;});
__d("PhotosUtils",["Rect"],function(a,b,c,d,e,f){var g=b('Rect');function h(){}h.getNearestBox=function(i,j,k,l,m,n){var o=i.sub(j),p=k.magnitude(),q=null;for(var r in n){var s=n[r],t=new g(s.t/100*k.y*l,s.r/100*k.x*l,s.b/100*k.y*l,s.l/100*k.x*l),u=t.getCenter().sub(o);if(Math.abs(u.x)<=m&&Math.abs(u.y)<=m&&u.magnitude()<=p){p=u.magnitude();q=r;if(0===p)break;}}return q;};e.exports=h;});
__d("UIPagelet",["json","DOM","AjaxPipeRequest","AsyncRequest","copyProperties","HTML"],function(a,b,c,d,e,f){b('json');var g=b('DOM'),h=b('AjaxPipeRequest'),i=b('AsyncRequest'),j=b('copyProperties'),k=b('HTML');function l(m,n,o,p){this._id=m||null;this._element=ge(m||g.$N('div'));this._src=n||null;this._context_data=o||{};this._data=p||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}l.loadFromEndpoint=function(m,n,o,p){p=p||{};var q='/ajax/pagelet/generic.php/';if(p.intern)q='/intern'+q;var r=(q+m).replace(/\/+/g,'/');if(p.subdomain)r=URI(r).setSubdomain(p.subdomain);var s=new l(n,r,o).setUseAjaxPipe(p.usePipe).setBundleOption(m.substring(0,8)!='/intern/'&&p.bundle!==false).setAppend(p.append).setJSNonBlock(p.jsNonblock).setDisplayCallback(p.displayCallback).setConstHeight(p.constHeight).setAllowCrossPageTransition(p.crossPage);p.handler&&s.setHandler(p.handler);s.go();return s;};j(l.prototype,{getElement:function(m){m=m||false;if(m)this._element=ge(this._id);return this._element;},setHandler:function(m){this._handler=m;return this;},go:function(m,n){if(arguments.length>=2||typeof m=='string'){this._src=m;this._data=n||{};}else if(arguments.length==1)this._data=m;this.refresh();return this;},setAllowCrossPageTransition:function(m){this._allow_cross_page_transition=m;return this;},setBundleOption:function(m){this._is_bundle=m;return this;},refresh:function(m){var n=function(q){this._request=null;if(m&&this._id)this._element=ge(this._id);var r=k(q.getPayload());if(this._append){g.appendContent(this._element,r);}else g.setContent(this._element,r);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new h();this._request.setCanvasId(this._id).setAppend(this._append).setConstHeight(this._constHeight).setJSNonBlock(this._jsNonblock).setDisplayCallback(this._displayCallback);}else{var o=this._displayCallback;this._request=new i().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(function(q){if(o){o(n.curry(q));}else n(q);});}var p={};j(p,this._context_data);j(p,this._data);this._request.setURI(this._src).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(p)}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(m){this._use_ajaxpipe=!!m;return this;},setAppend:function(m){this._append=!!m;return this;},setJSNonBlock:function(m){this._jsNonblock=!!m;return this;},setDisplayCallback:function(m){this._displayCallback=m;return this;},setConstHeight:function(m){this._constHeight=!!m;return this;}});a.UIPagelet=e.exports=l;},3);
__d("PhotoStreamCache",["ArrayUtils","HTML","PhotosConst","Rect","UIPagelet","URI","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('ArrayUtils'),h=b('HTML'),i=b('PhotosConst'),j=b('Rect'),k=b('UIPagelet'),l=b('URI'),m=b('Vector'),n=b('copyProperties');function o(){}n(o,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1});n(o.prototype,{init:function(p){this.version=p;this.bufferSize=o.BUFFER_SIZE;this.fullBucketSize=o.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.leftLock=false;this.rightLock=false;this.reset();},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(this.totalCount!==null)return this.totalCount>1;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getPhotoSetQuery:function(){return this.photoSetQuery;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getImageData:function(p){return this.getCacheContent(p,o.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),o.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),o.EXTRA);},getCacheContent:function(p,q){if(!p||p===o.ERROR_ID)return null;return this.cache[q][p];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(p){return this.permalinkMap[p];},calculatePositionForMovement:function(p){var q=this.position+p;if(this.allLoaded){var r=this.getLength();q=(r+q%r)%r;}return q;},isValidMovement:function(p){if(!this.isLoaded()||!this.canPage())return false;var q=this.calculatePositionForMovement(p);return this.getCursor()>0||(q>=0&&q<this.getLength());},moveCursor:function(p){if(!this.isValidMovement(p))return;this.position=this.calculatePositionForMovement(p);if(p!==0)this.loadMoreIfNeccessary(p>0);},checkErrorAt:function(p){if(!this.isLoaded())return false;if(p===o.ERROR_ID)return true;return false;},getRelativeMovement:function(p){for(var q=0;q<this.getLength();q++)if(this.fbidList[q]==p)return q-this.position;return null;},preloadImages:function(p){var q,r,s=this.getLength(),t=this.cache.image,u=o.BUFFER_SIZE;if(s>u*2){q=(this.position+s-u%s)%s;r=(this.position+u)%s;}else{q=0;r=s-1;}while(q!=r){var v=this.fbidList[q];if(t[v]&&t[v].url)if(p&&!t[v].resource){t[v].resource=new Image();t[v].resource.src=t[v].url;}else if(!p&&!t[v].small){t[v].small=new Image();t[v].small.src=t[v].smallurl||t[v].url;}q=(q+1)%s;}},loadMoreIfNeccessary:function(p){if(this.allLoaded||(p&&this.rightLock)||(!p&&this.leftLock))return;var q=p?1:-1,r=this.position+this.bufferSize*q;if(r<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(r>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(p){return p?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(p,q,r){if(!this.totalCount)return null;var s=this.fbidList.indexOf(q),t=this.fbidList.indexOf(r);if(s===-1||t===-1)return null;var u=t-s;return (p+u+this.totalCount)%this.totalCount;},fetch:function(p,q){var r=this.getEndCursor(q),s=n({cursor:r,version:this.version,end:this.getEndCursor(!q),fetchSize:q?p:-1*p},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){s.total=this.totalCount;s.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,r);}k.loadFromEndpoint('PhotoViewerPagelet',null,s,{usePipe:true,jsNonblock:true,crossPage:true});},storeToCache:function(p){var q={};if(!this.isActive)return q;if('error' in p){this.processErrorResult(p.error);q.error=true;return q;}if('init' in p){this.processInitResult(p.init);q.init={logids:p.init.logids,fbid:p.init.fbid,loggedin:p.init.loggedin,fromad:p.init.fromad};}if('image' in p){this.processImageResult(p.image);q.image=true;}if('data' in p){this.processDataResult(p.data);q.data=true;}return q;},processInitResult:function(p){if(this.loaded)return;this.loaded=true;this.photoSetQuery=p.query;if(p.bufferSize)this.bufferSize=p.bufferSize;if(p.fullBucketSize)this.fullBucketSize=p.fullBucketSize;this.fbidList.push(p.fbid);this.firstCursor=p.fbid;if('initIndex' in p&&'totalCount' in p){this.firstCursorIndex=p.initIndex;this.totalCount=p.totalCount;}this.rightLock=true;if(this.version==i.VIEWER_PERMALINK)this.fetch(o.INIT_BUCKET_SIZE,true);},processImageResult:function(p){for(var q in p){this.cache.image[q]=p[q];if(p[q].dimensions)this.cache.image[q].dimensions=m.deserialize(p[q].dimensions);if(p[q].smalldims)this.cache.image[q].smalldims=m.deserialize(p[q].smalldims);this.permalinkMap[l(p[q].info.permalink).getUnqualifiedURI().toString()]=q;}},attachToFbidsList:function(p,q,r){if(this.allLoaded)return;if(q===-1){for(var s=p.length-1;s>=0;s--){this.fbidList.unshift(p[s]);this.position++;}this.leftLock=false;}else{for(var t=0;t<p.length;t++)this.fbidList.push(p[t]);this.rightLock=false;}if(r)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(p){for(var q in p){if(!this.cache.html[q])this.cache.html[q]={};for(var r in p[q].html){var s=h(p[q].html[r]).getRootNode();this.cache.html[q][r]=g.createFrom(s.childNodes);}if(!('extra' in p[q])){this.cache.extra[q]=null;continue;}this.cache.extra[q]={tagRects:{}};if(p[q].extra.tagRects)for(var t in p[q].extra.tagRects)if(p[q].extra.tagRects[t])this.cache.extra[q].tagRects[t]=j.deserialize(p[q].extra.tagRects[t]);}},processErrorResult:function(p){if(!this.isLoaded()){this.initError=true;return;}var q=p.side,r=[o.ERROR_ID];this.attachToFbidsList(r,q);},setTotalCount:function(p){this.totalCount=p;},setFirstCursorIndex:function(p){this.firstCursorIndex=p;}});e.exports=o;});
__d("PhotoSnowliftAds",["array-extensions","event-extensions","copyProperties","css","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('copyProperties'),h=b('css'),i=b('DataStore'),j=b('DOM'),k=b('PhotoSessionLog'),l=b('UIPagelet'),m=b('URI'),n=b('Vector'),o=j.$N,p={DEFAULT_UNITS_REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,showSmallerAd:false,egoEnabled:false,refreshUnitsRate:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(q,r){if(r)this.adsStatus=q;var s=Date.now();this.adsEvents[q+'_'+s]=s;},init:function(q,r,s){this.reset();this.root=q;this.snowlift=r;this.showSmallerAd=s.showsmallerad;this.egoEnabled=s.ego_enabled;this.minAds=s.min_ads;this.addEvent('init',true);this.refreshUnitsRate=p.DEFAULT_UNITS_REFRESH_RATE;if(s.refresh_fast)this.refreshUnitsRate=s.refresh_rate;},reset:function(){this.lastLoadTime=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(q){this.availableDimensions=q;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(q,r){var s={};q.forEach(function(t){var u=t.root.firstChild.offsetHeight;t.units.forEach(function(w){if(!h.hasClass(w,'hidden')){var x=this.getHeight(w.firstChild,r);u-=x;}}.bind(this));var v={height:u,visible:false};t.units.forEach(function(w){var x=this.getIsAds(w),y=this.getHeight(w.firstChild,r),z=this.getUnitId(w);s[z]={height:y,visible:false,priority:0,is_ads:x,section_ref:v};}.bind(this));}.bind(this));return s;},calculateVisibleUnits:function(q,r,s){var t=0,u=this.getUnitPriority(r);u.forEach(function(v){if(r.hasOwnProperty(v)){var w=r[v],x=w.height;if(!w.section_ref.visible)x+=w.section_ref.height;w.height_below=s-x;w.visible=w.height_below>=0&&x>0;if(w.visible){w.section_ref.visible=true;s-=x;t++;}}}.bind(this));return r;},displayUnits:function(q,r){q.forEach(function(s){var t=false;s.units.forEach(function(u){var v=this.getUnitId(u),w=r[v],x=w.visible,y=w.height_below,z=w.is_ads;h.conditionClass(u,'hidden',!x);t=t||x;this.calcUnitStats(this.units[z][v],x,y);}.bind(this));h.conditionClass(s.root,'hidden',!t);}.bind(this));},getUnitPriority:function(q){var r=[],s=0,t=0;for(var u in q){var v=q[u];r.push(u);var w=this.minAds+s+t;if(v.is_ads){if(t<this.minAds)w=t;t++;}else s++;v.priority=w;}r=r.sort(function(x,y){var z=q[x],aa=q[y];return z.priority-aa.priority;}.bind(this));return r;},updateUnitsStatus:function(){var q=this.availableDimensions.x,r=this.availableDimensions.y,s=this.calculateUnitSizes(this.sections,q);s=this.calculateVisibleUnits(this.sections,s,r);this.displayUnits(this.sections,s);},calcUnitStats:function(q,r,s){var t=Date.now();if(q.visible)q.totalTime+=t-q.lastShowTime;if(q.trackingCode!==null&&q.totalTime>=this.UNITS_REGISTER_DELAY){var u=q.trackingCode;q.trackingCode=null;this.registerImpression(u,q.registerUrl);}q.visible=r;q.heightBelow=s;q.lastShowTime=t;},prepareResize:function(){var q=function(r){var s=o('div',{className:'inner'}),t=o('div',{className:'wrapper'},s);j.replace(r,t);j.setContent(s,r);return t;};this.sections=j.scry(this.root,'div.ego_section').map(function(r){return {root:q(r),units:j.scry(r,'div.ego_unit').map(q)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var q=this.nextRegisterTime();if(q!==Infinity)this.processResize.bind(this).defer(q,true);},setIsLogAdData:function(q){this.isLogAdData=q;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var q=this.snowlift.getImageId();if(this.isLogAdData&&q){var r=n.getElementDimensions(this.snowlift.getImage()),s=n.getElementDimensions(this.snowlift.getRHCHeader()),t=n.getElementDimensions(this.snowlift.getRHCBody()),u=n.getElementDimensions(this.snowlift.getRHCFooter()),v={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:r.x,image_y:r.y,header_x:s.x,header_y:s.y,body_x:t.x,body_y:t.y,footer_x:u.x,footer_y:u.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents};k.updateAdData(q,v);}},getAdsBelowSpace:function(){var q=[],r=this.units[1];for(var s in r)if(r.hasOwnProperty(s))q.push(r[s].heightBelow);return q;},getIsAds:function(q){var r=j.scry(q,'div.fbAdUnit');return r.length;},getUnitId:function(q){if(this.getIsAds(q)){return this.getAdId(q);}else return this.getEgoId(q);},getEgoId:function(q){var r=j.find(q,'div.fbEgoUnit'),s=r.getAttribute('data-ego'),t=JSON.parse(s).egoid;return t;},getAdId:function(q){var r=j.find(q,'div.fbAdUnit'),s=r.getAttribute('data-ad'),t=JSON.parse(s).adid;return t;},nextRegisterTime:function(){var q=Infinity,r=g(this.units[0],this.units[1]);for(var s in r)if(r.hasOwnProperty(s)){var t=r[s];if(t.trackingCode!==null&&t.visible)q=Math.min(q,this.UNITS_REGISTER_DELAY-t.totalTime);}return q;},getHeight:function(q,r){var s=i.get(q,'height');if(s&&s.x===r)return s.y;return this.cacheHeight(q,r);},cacheHeight:function(q,r){var s={x:r,y:q.offsetHeight};i.set(q,'height',s);return s.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);l.loadFromEndpoint('WebEgoPane',this.root.id,{pid:34,data:[this.loadQuery.set,true,this.egoEnabled]},{crossPage:true,bundle:false});},unitsLoaded:function(q,r){var s;if(r){s='ai.php';this.addEvent('adsLoaded',true);}else{s='ajax/ei.php';this.addEvent('egoLoaded',true);}var t={};for(var u in q)if(q.hasOwnProperty(u))t[u]={trackingCode:q[u],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:s};this.units[r]=t;if(r)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();h.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var q=Date.now(),r=this.refreshUnitsRate;if(!this.isLoading&&q-this.lastLoadTime>r){h.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(q,r){var s=o('iframe',{src:m(r).addQueryData({aed:q}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});s.setAttribute('aria-hidden','true');j.appendContent(this.root,s);},waitForImages:function(q){var r=j.scry(this.root,'img.img'),s=r.length,t=s;if(t===0)q();var u=function(){t--;if(t===0)q.defer();};for(var v=0;v<s;v++){var w=r[v];if(w.complete){u();}else Event.listen(w,{load:u,error:u,abort:u});}}};e.exports=a.PhotoSnowliftAds||p;});
__d("PhotoViewer",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){this.image=null;this.position=null;this.root=null;}g(h.prototype,{bootstrap:bagofholding,getEventPrefix:bagof(null),getEventString:function(i){var j=this.getEventPrefix();if(j)return j+'.'+i;return null;},getImage:function(){return this.image;},getPosition:function(){return this.position;},getRoot:function(){return this.root;},getSourceString:bagof(null),getVersionConst:bagof(null)});e.exports=h;});
__d("PhotoSnowlift",["array-extensions","event-extensions","Arbiter","ArrayUtils","AsyncRequest","Bootloader","css","Class","ContextualThing","Dialog","DOM","DOMControl","DOMScroll","FullScreen","HTML","ImageUtils","Locale","KeyEventController","Keys","LinkController","OptimisticUFI","PageTransitions","Parent","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotoViewer","PhotosConst","PhotosUtils","Rect","ScrollableArea","Selector","Toggler","tx","UIPagelet","URI","ua","Vector","$","computeRelativeURI","copyProperties","ge","goURI","userAction"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArrayUtils'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('css'),l=b('Class'),m=b('ContextualThing'),n=b('Dialog'),o=b('DOM'),p=b('DOMControl'),q=b('DOMScroll'),r=b('FullScreen'),s=b('HTML'),t=b('ImageUtils'),u=b('Locale'),v=b('KeyEventController'),w=b('Keys'),x=b('LinkController'),y=b('OptimisticUFI'),z=b('PageTransitions'),aa=b('Parent'),ba=b('PhotoSessionLog'),ca=b('PhotoSnowliftAds'),da=b('PhotoStreamCache'),ea=b('PhotoViewer'),fa=b('PhotosConst'),ga=b('PhotosUtils'),ha=b('Rect'),ia=b('ScrollableArea'),ja=b('Selector'),ka=b('Toggler'),la=b('tx'),ma=b('UIPagelet'),na=b('URI'),oa=b('ua'),pa=b('Vector'),qa=b('$'),ra=b('event-extensions').$E,sa=b('computeRelativeURI'),ta=b('copyProperties'),ua=b('ge'),va=b('goURI'),wa=b('userAction');function xa(){this.parent.construct(this);}ta(xa,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_HIRES_MAX:{x:2048,y:2048},STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:340,SIDEBAR_SIZE_MIN:285,STAGE_CHROME:{x:102,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,_instance:null,getInstance:function(){if(!xa._instance)xa._instance=new xa();return xa._instance;},addPhotoFbids:function(ya,za,ab){xa.getInstance().addPhotoFbids(ya,za,ab);},preload:function(ya,za){xa.getInstance().preload(ya,za);},bootstrap:function(ya,za){xa.getInstance().bootstrap(ya,za);},closeRefresh:function(){xa.getInstance().closeRefresh();},deletePhoto:function(ya){xa.getInstance().deletePhoto(ya);},getImage:function(){return xa.getInstance().getImage();},getImageId:function(){return xa.getInstance().getImageId();},getLoadQuery:function(){return xa.getInstance().getLoadQuery();},getRHCBody:function(){return xa.getInstance().getRHCBody();},getRHCFooter:function(){return xa.getInstance().getRHCFooter();},getRHCHeader:function(){return xa.getInstance().getRHCHeader();},getRoot:function(){return xa.getInstance().getRoot();},saveTagsFromPayload:function(ya){xa.getInstance().saveTagsFromPayload(ya);},setErrorBoxContent:function(ya){xa.getInstance().setErrorBoxContent(ya);},storeFromData:function(ya){xa.getInstance().storeFromData(ya);},swapData:function(){xa.getInstance().swapData();},updateTotalCount:function(ya,za,ab){xa.getInstance().updateTotalCount(ya,za,ab);}});l.extend(xa,ea);ta(xa.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:xa.STAGE_NORMAL_MAX,stagePagerPrev:null,ua:null,showHiRes:false,preload:function(ya,za){j.loadModules(['fb-photos-snowlift-css','Live','PhotoTagApproval','PhotoTagger','PhotoTags','PhotoViewerSubscribe','TagTokenizer','fb-photos-snowlift-fullscreen-css'],bagofholding);var ab=this.getImageSrc(na(ya).getQueryData());if(ab)(new Image()).src=ab;},bootstrap:function(ya,za){this.preload(ya,za);ca.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=wa('snowlift',za,null).set_namespace('snowlift').set_ua_id('open');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(za){k.addClass((this.loading=za),'loading');this.getThumbAndSize(za);}else this.loading=null;g.inform('PhotoSnowlift.GO',ya,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getEventPrefix:function(){return 'PhotoSnowlift';},getRoot:function(){return this.root;},getSourceString:function(){return 'snowlift';},getVersionConst:function(){return fa.VIEWER_SNOWLIFT;},getImage:function(){return this.image;},getImageId:function(){return this.stream.getCursor();},getRHCHeader:function(){return this.rhcHeader;},getRHCBody:function(){return this.ufiForm;},getRHCFooter:function(){return this.rhcFooter;},getLoadQuery:function(){return this.loadQuery;},getOwnerId:function(){var ya=this.stream.getCurrentImageData();if(ya)return ya.info.owner;return null;},getThumbAndSize:function(ya){this.currentImageSize=null;this.thumbSrc=null;var za=na(ya.getAttribute('ajaxify')).getQueryData();if(!za.size)return;var ab=pa.deserialize(za.size);if(!ab.x||!ab.y)return;this.currentImageSize=ab;if(!k.hasClass(ya,'uiMediaThumb')&&!k.hasClass(ya,'uiPhotoThumb')&&!k.hasClass(ya,'uiScaledThumb')&&!k.hasClass(ya,'coverWrap'))return;var bb=o.scry(ya,'img')[0],cb=o.scry(ya,'i')[0],db=aa.byAttribute(ya,'data-size');this.shouldStretch=db&&this.currentImageSize&&bb&&db.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=xa.TIMELINE_STRETCH_WIDTH&&bb.offsetWidth===xa.TIMELINE_STRETCH_WIDTH;var eb;if(bb){eb=bb.src;}else if(cb){eb=k.getStyle(cb,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=eb;},loadFrameIfUninitialized:function(){if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(ya,za){this.showHiRes=za.hires;this.fullscreen=za.swap&&za.hires&&r.isSupported();this.upscale=za.upscale&&za.upscaling_config;this.upscaleConfig=za.upscaling_config;this.stageMax=this.showHiRes?xa.STAGE_HIRES_MAX:xa.STAGE_NORMAL_MAX;var ab=ua('fbPhotoSnowlift');if(!ab){ab=o.appendContent(o.getDocumentBodyElement(),ya)[0];this.initialLoad=false;}if(this.root==ab)return;this.initializeNodes(ab);ca.init(this.sideAdUnit,this,za);if(!this.subscription){x.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(bb,cb){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(cb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;z.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)r.subscribe('changed',this.onFullScreenChange.bind(this));},onFullScreenChange:function(){if(r.isFullScreen()){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var ya=this.stream.getCurrentImageData();if(ya&&ya.url&&this.image.src!==ya.url)this.switchImage(ya.url);this.adjustForResize();}else this.uncollapseRHC();ka.hide();},initializeNodes:function(ya){this.root=ya;this.container=o.find(ya,'div.fbPhotoSnowliftContainer');this.popup=o.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=o.find(this.popup,'div.rhc');this.rhcHeader=o.find(this.rhc,'div.rhcHeader');this.rhcFooter=o.find(this.rhc,'div.rhcFooter');this.ufiForm=o.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=qa('fbPhotoSnowliftFeedbackInput');this.scroller=o.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=o.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=o.find(this.popup,'div.stageWrapper');this.errorBox=o.find(this.stageWrapper,'div.stageError');this.image=o.find(this.stageWrapper,'img.spotlight');this.stage=o.find(this.stageWrapper,'div.stage');this.videoStage=o.find(this.stageWrapper,'div.videoStage');this.prevPager=o.find(this.root,'a.snowliftPager.prev');this.nextPager=o.find(this.root,'a.snowliftPager.next');this.stageActions=o.find(ya,'div.stageActions');this.buttonActions=o.find(this.stageActions,'div.fbPhotosPhotoButtons');this.sideAdUnit=qa('fbPhotoSnowliftAdsSide');k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);if(this.fullscreen)Event.listen(this.container,'click',(function(event){var za=event.getTarget();if(aa.byClass(za,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(aa.byClass(za,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}).bind(this));},initializeScroller:function(){this.initializeScroller=bagofholding;this.scrollableArea=ia.fromNative(this.scroller,{fade:true,persistent:true});var ya=function(event){var za=ra(event).getTarget();if(o.contains(this.ufiInputContainer,za)){var ab=p.getInstance(za);if(ab){this.scrollableArea.scrollToBottom();var bb=ab.subscribe('resize',function(){var db=this.scrollableArea.isScrolledToBottom();this.adjustScroller();db&&this.scrollableArea.scrollToBottom();}.bind(this)),cb=Event.listen(za,'blur',function(){ab.unsubscribe(bb);cb.remove();});}}}.bind(this);g.subscribe(y.COMMENT_SEND_EVENT,function(za,ab){if(this.ufiForm===ab.form){this.adjustScrollerIfNecessary();this.scrollableArea.scrollToBottom();}}.bind(this));Event.listen(this.rhc,'click',function(event){var za=event.getTarget();if(aa.byTag(za,'a')||aa.byTag(za,'button')||o.isNodeOfType(za,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('reflow',function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));if(this.ufiForm.attachEvent){this.ufiForm.attachEvent('onfocusin',ya);}else this.ufiForm.addEventListener('focus',ya,true);},openHandler:function(ya){if(this.isOpen||ya.getPath()!='/photo.php'||this.returningToStart||ya.getQueryData().closeTheater||ya.getQueryData().permPage||ya.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(ya);this._uriStack.push(na(ya).getQualifiedURI().toString());z.transitionComplete();return true;},getImageSrc:function(ya){if(ya.smallsrc){if(!ya.size)return ya.smallsrc;var za=pa.deserialize(ya.size),ab=this.getStageSize(za);if(ab.x<=xa.STAGE_NORMAL_MAX.x&&ab.y<=xa.STAGE_NORMAL_MAX.y)return ya.smallsrc;}return ya.src;},open:function(ya){var za=na(ya).getQueryData(),ab=this.getImageSrc(za);if(ab){delete za.src;delete za.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){za.firstLoad=true;this.initialLoad=true;}this.loadQuery=za;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.stream=new da();this.stream.init(fa.VIEWER_SNOWLIFT);this.fetchInitialData();this.setLoadingState(xa.STATE_HTML,true);this.rhcCollapsed=false;v.registerKey('ESCAPE',this.closeListener.bind(this));j.loadModules(['fb-photos-snowlift-css'],this._open.bind(this,ya,ab));},_open:function(ya,za){this.createLoader(za);k.show(this.root);(function(){var cb=pa.getScrollPosition();if(!k.hasClass(document.documentElement,'wrapped')){k.addClass(document.documentElement,'theaterMode');var db=q.getScrollbarSize();if(db===0){this.extraClass='zeroScrollbar';}else if(db===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';k.addClass(document.body,this.extraClass);}q.scrollTo(cb,0);}).defer();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.stageWrapper,'mouseleave',this.hidePagers.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hilitePagerOnMouseMove.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this))];var ab=ua('fbPhotoSnowliftFeedback');if(ab)this.stageHandlers.push(Event.listen(ab,'click',function(event){if(aa.byClass(event.getTarget(),'like_link')){var cb=o.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(cb){k.toggleClass(cb,'viewerLikesThis');k.removeClass(cb,'viewerAlreadyLikedThis');}}}.bind(this)));var bb=ua('fbPhotoSnowliftOnProfile');if(bb)this.stageHandlers.push(Event.listen(bb,'click',function(event){if(aa.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=na.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!za)this.setLoadingState(xa.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){z.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ba.initLogging(ba.SNOWLIFT);if(oa.firefox()&&!k.hasClass(document.documentElement,'wrapped'))this.turnFlashAutoplayOff.defer();(function(){this.root.focus();}).bind(this).defer();},toggleFullScreen:function(){var ya=r.toggleFullScreen(document.documentElement);if(ya){var za=this.stream.getCurrentImageData();if(za&&za.url&&this.image.src!==za.url)(new Image()).src=za.url;ba.logEnterFullScreen(this.stream.getCursor());}},getStream:function(){return this.stream;},fetchInitialData:function(){this.ua&&this.ua.add_event('init_data');ma.loadFromEndpoint('PhotoViewerInitPagelet',null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){o.scry(document,'div.swfObject').forEach(function(ya){var za=ya.getAttribute('data-swfid');if(za&&window[za]){var ab=window[za];ab.addParam('autostart','false');ab.addParam('autoplay','false');ab.addParam('play','false');ab.addVariable('video_autoplay','0');ab.addVariable('autoplay','0');ab.addVariable('play','0');var bb=na(ab.getAttribute('swf'));bb.addQueryData({autoplay:'0'});bb.setPath(bb.getPath().replace('autoplay=1','autoplay=0'));ab.setAttribute('swf',bb.toString());ab.write(ya);}});},toggleCollapse:function(){if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();},collapseRHC:function(){this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();},uncollapseRHC:function(){this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();},closeHandler:function(){if(!this.isOpen)return;if(na.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(ya,za){if(!ya)if(za){this.squashNextTransition(va.curry(za));}else this.squashNextTransition();this.returningToStart=true;var ab=g.subscribe('page_transition',function(){this.returningToStart=false;g.unsubscribe(ab);}),bb=ya||isNaN(oa.opera()),cb=this._uriStack.length;if(bb&&cb<window.history.length){window.history.go(-cb);}else{var db=this.startingURI,eb=new na(db).removeQueryData('closeTheater');if(db.getQueryData().sk=='approve'&&db.getPath()=='/profile.php'){eb.removeQueryData('highlight');eb.removeQueryData('notif_t');}va(eb);}},squashNextTransition:function(ya){this.squashNext=true;z.registerHandler(function _squash(){if(this.squashNext){this.squashNext=false;if(ya)ya.defer();z.transitionComplete();return true;}return false;}.bind(this));},handleNavigateAway:function(ya){var za=sa(z._most_recent_uri.getQualifiedURI(),ya.getAttribute('href'));if(this.isOpen&&(za instanceof na)&&za.getUnqualifiedURI().toString()!=this.startingURI.toString()&&za.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ba.NAVIGATE;this.close();this.returnToStartingURI(false,za);return false;}return true;},closeListener:function(event){if(this.isOpen&&!n.getCurrent()){if(Event.getKeyCode(event)==w.ESC){if(!k.hasClass(this.root,'taggingMode')&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.closingAction=ba.ESC;Event.kill(event);this.closeHandler();}return;}var ya=event.getTarget(),za=aa.byClass(ya,'closeTheater'),ab=za||ya==this.root||ya==o.find(this.root,'div.fbPhotoSnowliftOuter')||ya==o.find(this.root,'div.fbPhotoSnowliftInner');if(ab){if(r.isFullScreen()){if(za)r.toggleFullScreen();return;}if(za){this.closingAction=ba.X;}else this.closingAction=ba.OUTSIDE;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;if(this.fullscreen)r.disableFullScreen();k.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){var ya=pa.getScrollPosition();if(!k.hasClass(document.documentElement,'wrapped')){k.removeClass(document.documentElement,'theaterMode');k.removeClass(document.body,this.extraClass);}k.removeClass(this.root,'dataLoaded');q.scrollTo(ya,0);v.getInstance().resetHandlers();ba.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;k.removeClass(this.stageWrapper,'showVideo');o.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();o.empty(this.sideAdUnit);this.stream.destroy();var za=this.closingAction===ba.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){z.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',za);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(ya){if(this.currentImageSize===null){this.adjustStageSize(xa.STAGE_MIN);}else{var za=this.getStageSize(this.currentImageSize);za=new pa(Math.max(za.x,xa.STAGE_MIN.x),Math.max(za.y,xa.STAGE_MIN.y));var ab=this.getImageSizeInStage(this.currentImageSize,za);if(this.thumbSrc===null){this.adjustStageSize(ab);}else this.useImage(o.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:ab.x+'px',height:ab.y+'px'}}),ab,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(ya)(function(){var bb=new Image();bb.onload=a.async_callback(function(){if(this.isOpen)if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(ya,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(xa.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater');bb.src=ya;}).bind(this).defer();k.hide(this.stageActions);this.setStagePagersState('disabled');},initDataFetched:function(ya){ba.setPhotoSet(this.stream.getPhotoSet());ba.setLogFbids(ya.logids);var za=this.stream.getCurrentImageData();ba.addPhotoView(za.info,this.shouldShowHiRes(za),this.fullscreen&&r.isFullScreen());this.position=this.stream.getCursor();if(!this.pageHandlers){this.pageHandlers=[Event.listen(this.root,'click',this.pageListener.bind(this)),Event.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];v.registerKey('LEFT',this.pageListener.bind(this));v.registerKey('RIGHT',this.pageListener.bind(this));v.registerKey('L',this.likePhoto.bind(this),function(event,ab){event=ra(event);return (ab=='onkeyup'&&v.filterEventTargets(event,ab)&&v.filterEventModifiers(event,ab));});}k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=ya.loggedin;this.disableAds=!this.isLoggedInViewer||ya.fromad;this.loadAds();},adjustScrollerIfNecessary:function(){clearTimeout(this.scrollerTimeout);this.scrollerTimeout=this.adjustScroller.bind(this).defer();},adjustScroller:function(){clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var ya=pa.getElementDimensions(this.rhc),za=ya.y;za-=pa.getElementDimensions(this.rhcHeader).y;za-=pa.getElementDimensions(this.ufiInputContainer).y;var ab=pa.getElementDimensions(this.scrollerBody).y;if(ab>=za){k.setStyle(this.scroller,'height',za+'px');k.addClass(this.rhc,'pinnedUfi');za=0;}else{k.setStyle(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');za-=ab;}var bb=pa.getElementDimensions(this.ufiInputContainer).y;k.setStyle(this.ufiForm,'padding-bottom',bb+'px');ca.resize(new pa(ya.x,za));this.scrollableArea.adjustGripper();},adjustForResize:function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();},shouldShowHiRes:function(ya){if(!this.showHiRes||!ya||!ya.smallurl)return false;var za=this.getStageSize(ya.dimensions);return (za.x>xa.STAGE_NORMAL_MAX.x||za.y>xa.STAGE_NORMAL_MAX.y);},getImageURL:function(ya){if(ya.video){return null;}else if(ya.smallurl&&!this.shouldShowHiRes(ya))return ya.smallurl;return ya.url;},getImageDimensions:function(ya){if(ya.smalldims&&(!this.shouldShowHiRes(ya)||this.image.src===ya.smallurl))return ya.smalldims;return ya.dimensions;},getStageSize:function(ya,za){var ab=pa.getViewportDimensions(),bb=new pa(ya.x,ya.y);if(za)bb=new Vector2(Math.max(ya.x,za.x),Math.max(ya.y,za.y));var cb,db;if(this.fullscreen&&r.isFullScreen()){return new pa((this.rhcCollapsed?ab.x:ab.x-xa.SIDEBAR_SIZE_MAX),ab.y-xa.FULL_SCREEN_PADDING*2);}else{if(this.upscale&&bb.x<this.upscaleConfig.threshold.x&&bb.y<this.upscaleConfig.threshold.y){bb.x*=this.upscaleConfig.factor;bb.y*=this.upscaleConfig.factor;}cb=Math.min(bb.x,this.stageMax.x,(ab.x-xa.SIDEBAR_SIZE_MAX-xa.STAGE_CHROME.x));db=Math.min(bb.y,this.stageMax.y,ab.y-xa.STAGE_CHROME.y);}if(cb===0&&db===0)return new pa(0,0);var eb=cb/db,fb=bb.x/bb.y;if(eb<fb)return new pa(cb,Math.ceil(cb/fb));return new pa(Math.ceil(db*fb),db);},getImageSizeInStage:function(ya,za){var ab=ya.x,bb=ya.y;if(this.upscale&&ab<this.upscaleConfig.threshold.x&&bb<this.upscaleConfig.threshold.y){ab*=this.upscaleConfig.factor;bb*=this.upscaleConfig.factor;}if(ab>=za.x||bb>=za.y){var cb=za.x/za.y,db=ab/bb;if(cb<db){ab=za.x;bb=Math.ceil(ab/db);}else if(cb>db){bb=za.y;ab=Math.ceil(bb*db);}else{ab=za.x;bb=za.y;}}return new pa(ab,bb);},adjustStageSize:function(ya){var za=this.currentImageSize;if(ya){za=ya;}else{var ab=this.stream&&this.stream.getCurrentImageData();if(ab)za=this.getImageDimensions(ab);}if(!za)return;this.currentImageSize=za;var bb=0;if(this.shouldStretch&&!this.getVideoOnStage()&&za.x>za.y&&za.x<=xa.TIMELINE_STRETCH_WIDTH&&za.x>=xa.TIMELINE_STRETCH_MIN){za.y=Math.round(za.y*xa.TIMELINE_STRETCH_WIDTH/za.x);za.x=xa.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage()){bb=xa.VIDEO_BOTTOM_BAR_SPACE*2;za.y+=bb;}var cb=this.getStageSize(za,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new Vector2(0,0);this.currentMinSize=new Vector2(Math.max(cb.x,xa.STAGE_MIN.x,this.currentMinSize.x),Math.max(cb.y,xa.STAGE_MIN.y,this.currentMinSize.y));var db=this.currentMinSize.x+xa.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)db=this.currentMinSize.x;this.popup.style.cssText='width:'+db+'px;'+'height:'+this.currentMinSize.y+'px;';var eb=this.currentMinSize.y-bb+'px';if(oa.firefox()||oa.ie()<8){var fb=k.getStyle(this.stageWrapper,'font-size');if(oa.ie()&&fb.indexOf('px')<0){var gb=o.create('div');gb.style.fontSize=fb;gb.style.height='1em';fb=gb.style.pixelHeight;}eb=((this.currentMinSize.y-bb)/parseFloat(fb))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+eb+';';if(oa.ie()<8){k.setStyle(this.root,'height',pa.getViewportDimensions().y+'px');k.setStyle(this.container,'min-height',(this.currentMinSize.y+xa.STAGE_CHROME.y)+'px');}var hb=this.getImageSizeInStage(za,this.currentMinSize);this.image.style.cssText='width:'+hb.x+'px;'+'height:'+hb.y+'px;';this.adjustScrollerIfNecessary();},adjustForNewData:function(){if(!this.image)return;var ya=o.scry(this.stage,'div.tagsWrapper')[0],za=pa.getElementDimensions(this.image);if(ya){k.setStyle(ya,'width',za.x+'px');k.setStyle(ya,'height',za.y+'px');if(oa.ie()<=7){var ab=o.scry(this.root,'div.tagContainer')[0];if(ab)k.conditionClass(ya,'ie7VerticalFix',pa.getElementDimensions(ab).y>za.y);}}},setLoadingState:function(ya,za){switch(ya){case xa.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',za);break;case xa.STATE_IMAGE_DATA:this.loadingStates[ya]=za;k.conditionClass(this.root,'imageLoading',za);break;case xa.STATE_HTML:this.loadingStates[ya]=za;k.conditionClass(this.root,'dataLoading',za);this.rhc.setAttribute('aria-busy',za?'true':'false');break;}},destroy:function(){this.stageHandlers.forEach(function(ya){ya.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(ya){ya.remove();});this.pageHandlers=null;}},checkState:function(ya){if(ya!=xa.STATE_ERROR&&!this.loadingStates[ya])return;switch(ya){case xa.STATE_IMAGE_DATA:var za=this.stream.getCurrentImageData();if(za){var ab=this.getImageURL(za);if(ab){this.switchImage(ab,null,true);}else if(za.video)this.switchVideo(za.video,true);this.setLoadingState(ya,false);}break;case xa.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(ya,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}},buttonListener:function(event){var ya=event.getTarget(),za=Date.now();if(aa.byClass(ya,'fbPhotoTagApprovalBox'))return;if(za-this.lastPage<350)return;if(aa.byClass(ya,'fbPhotosPhotoLike')){this.likePhoto();}else if(aa.byClass(ya,'tagApproveIgnore'))this.updateTagBox(event,ya);},likePhoto:function(){ba.addButtonLike();o.find(qa('fbPhotoSnowliftFeedback'),'button.like_link').click();},rotateListener:function(event){var ya=event.getTarget();if(aa.byClass(ya,'rotateRight')){this.rotate('right');}else if(aa.byClass(ya,'rotateLeft'))this.rotate('left');},updateTagBox:function(ya,za){this.unhiliteAllTags();var ab=ua(ya);if(!ab)return;k.addClass(ab,'tagBox');k.addClass(ab,'tagBoxPendingResponse');k.removeClass(ab,'tagBoxPending');k.hide(o.find(ab,'span.tagForm'));if(za){k.show(o.find(ab,'span.tagApproved'));}else k.show(o.find(ab,'span.tagIgnored'));},rotate:function(ya){var za=this.stream.getCursor();if(this.getVideoOnStage()){var ab=(ya=='left')?270:90;j.loadModules(['VideoRotate'],function(cb){new cb(za).motionRotate(ab);});return;}var bb=ta({fbid:za,cs_ver:fa.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());bb[ya]=1;this.setLoadingState(xa.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(bb).setErrorHandler(this.rotationError.bind(this,za)).setHandler(this.rotationComplete.bind(this,za)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(ya,za){this.storeFromResponse(za);if(ya==this.stream.getCursor()){this.setLoadingState(xa.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}},rotationError:function(ya,za){if(ya==this.stream.getCursor()){this.setLoadingState(xa.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(['AsyncResponse'],function(ab){ab.defaultErrorHandler(za);});}},saveTagComplete:function(ya){if(!this.isOpen)return;this.saveTagsFromPayload(ya.getPayload());},saveTagsFromPayload:function(ya){this.storeFromData(ya);if('data' in ya&&this.stream.getCursor() in ya.data)this.swapData();},saveEdit:function(){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(['PhotoInlineEditor','Form'],function(ya,za){var ab=ya.getInstance(this.getViewerConst());ab&&za.bootstrap(ab.getForm().controller);}.bind(this));},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},hilitePagerOnMouseMove:function(event){var ya=pa.getEventPosition(event),za=pa.getElementPosition(this.stage);if(u.isRTL()){var ab=pa.getElementDimensions(this.stage);this.stagePagerPrev=ab.x-(ya.x-za.x)<xa.GOPREV_AREA;}else this.stagePagerPrev=ya.x-za.x<xa.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var bb,cb=event.getTarget();if(!aa.byClass(cb,'snowliftOverlay')&&!aa.byClass(cb,'bottomBarActions')&&!aa.byClass(cb,'snowliftPager'))bb=xa.PAGER_FADE;this.showPagers(bb);},showPagers:function(ya){clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof ya!=='undefined')this.fadePagerTimer=this.hidePagers.bind(this).defer(ya);},hidePagers:function(){if(this.actionMenuOn(true))return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');},actionMenuOn:function(ya){var za=ua('fbPhotoSnowliftDropdownButton');if(za&&aa.byClass(za,'openToggler'))return !ya||aa.byClass(za,'bottomBarActions');return false;},unhiliteAllTags:function(){o.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(ya){k.removeClass(ya,'hover');});this.hilitedTag=null;},switchHilitedTags:function(ya,za){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var ab=ua(ya);if(ab){this.hilitedTag=ya;k.addClass(ab,'hover');if(k.hasClass(ab,'tagBoxPending')&&!k.hasClass(ab,'showPendingTagName')&&za===true){o.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(bb){k.removeClass(bb,'showPendingTagName');});k.addClass(ab,'showPendingTagName');}}},reHilitePendingTag:function(){var ya=ua(this.hilitedTag);if(ya&&k.hasClass(ya,'showPendingTagName'))return;var za=o.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(za)this.switchHilitedTags(za.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var ya=event.getTarget();if(aa.byClass(ya,'fbPhotoSnowliftTagApproval'))return;var za=aa.byClass(ya,'tagBoxPending'),ab=(this.hilitedTag&&k.hasClass(qa(this.hilitedTag),'tagBoxPending')),bb=((!this.hilitedTag&&za)||(!ab&&za));if(bb){this.switchHilitedTags(za.id);return;}if(za&&(za.id==this.hilitedTag))return;var cb=250,db=pa.getEventPosition(event),eb=pa.getElementPosition(this.image),fb=pa.getElementDimensions(this.image),gb=this.getImageDimensions(this.stream.getCurrentImageData()),hb=fb.x/gb.x,ib=ga.getNearestBox(db,eb,gb,hb,xa.MIN_TAG_DISTANCE*hb,this.stream.getCurrentExtraData().tagRects);if(!ib){if(!ab){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var jb=null;if(ab){var kb={};kb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];jb=ga.getNearestBox(db,eb,gb,hb,xa.MIN_TAG_DISTANCE*hb,kb);}if(jb!==null&&ab)return;if(this.hilitedTag!=ib)if(ab){this.switchTimer=this.switchHilitedTags.bind(this,ib).defer(cb);}else this.switchHilitedTags(ib);},getVideoOnStage:function(){var ya=this.stream&&this.stream.getCurrentImageData();return ya&&ya.video;},shouldPageOnAction:function(ya,za){var ab=o.isNode(za)&&(aa.byClass(za,'snowliftPager')||aa.byClass(za,'stagePagers')),bb=o.isNode(za)&&aa.byClass(za,'stage'),cb=((bb&&k.hasClass(this.root,'taggingMode'))||aa.byClass(za,'tagBoxPending')||aa.byClass(za,'tagBoxPendingResponse')||aa.byClass(za,'fbPhotoTagApprovalBox'));if(cb)return false;return ya==w.LEFT||ya==w.RIGHT||ab||bb;},pageListener:function(event){var ya=Event.getKeyCode(event),za=event.getTarget();if(!this.shouldPageOnAction(ya,za))return;var ab=0;if(ya==w.RIGHT){ab=1;ba.setPagingAction('key_right');}else if(ya==w.LEFT){ab=-1;ba.setPagingAction('key_left');}else if(aa.byClass(za,'next')){ab=1;ba.setPagingAction('click_next');}else if(aa.byClass(za,'prev')){ab=-1;ba.setPagingAction('click_prev');}else if(!this.stagePagerPrev){ab=1;ba.setPagingAction('click_stage');}else{ab=-1;ba.setPagingAction('click_stage_back');}if(k.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(ab);}else{this.page(ab);wa('a',za,event);}},warnLeavePage:function(ya){new n().setTitle("Are you sure you want to leave this page?").setBody("You have unsaved changes that will be lost if you leave the page.").setButtons([{name:'leave_page',label:"Leave this Page",handler:this.page.bind(this,ya)},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).show();},page:function(ya,za){if(!this.stream.isValidMovement(ya)){this.showPagers(xa.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();var ab=this.getVideoOnStage();if(ab)this.switchVideo(ab,false);g.inform('PhotoSnowlift.PAGE');ka.hide();this.recacheData();this.stream.moveCursor(ya);k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(xa.STATE_HTML,true);k.show(this.errorBox);return;}var bb=this.stream.getCurrentImageData();if(bb){var cb=this.getImageURL(bb);if(cb){this.switchImage(cb,null,true);}else if(bb.video)this.switchVideo(bb.video,true);if(!za){this.replaceUrl=true;va(bb.info.permalink);}}else{this.setLoadingState(xa.STATE_IMAGE_PIXELS,true);this.setLoadingState(xa.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(xa.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();},logImpressionDetailsForPhoto:function(){var ya=[].concat(o.scry(qa('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),o.scry(qa('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(ya.length===0)return;var za={};for(var ab=0;ab<ya.length;ab++)za[ya[ab].name]=ya[ab].value;if(this.getVideoOnStage()){za.width=0;za.height=0;}else{var bb=this.getImageDimensions(this.stream.getCurrentImageData());za.width=bb.x;za.height=bb.y;}ba.addDetailData(this.stream.getCursor(),za);ca.setIsLogAdData(true);},loadAds:function(){if(this.disableAds)return;ca.loadAdsFromUserActivity();},transitionHandler:function(ya){if(ya.getQueryData().closeTheater||ya.getQueryData().permPage||ya.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(ya.getQualifiedURI().toString());z.transitionComplete();return true;}var za=this._uriStack.length;if(za>=2&&this._uriStack[za-2]==ya.getQualifiedURI().toString())this._uriStack.pop();var ab=this.stream.getCursorForURI(ya.getUnqualifiedURI().toString());if(ab){var bb=this.stream.getRelativeMovement(ab);this.page(bb,true);z.transitionComplete();return true;}if(this.isOpen){this.close();z.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var ya=this.stream.getCurrentHtml();for(var za in ya){ya[za]=h.createFrom(qa(za).childNodes);o.empty(qa(za));}}},reloadIfTimeout:function(){if(!t.hasLoaded(this.image)){var ya=this.makeNewImage(this.image.src,true);Event.listen(ya,'load',this.useImage.bind(this,ya,null,true));}},useImage:function(ya,za,ab){if(ab&&t.hasLoaded(this.image))return;o.replace(this.image,ya);this.image=ya;this.adjustStageSize(za);},makeNewImage:function(ya,za){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!za)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),xa.LOADING_TIMEOUT);var ab=o.create('img',{className:'spotlight',alt:''});ab.setAttribute('aria-describedby','fbPhotosSnowliftCaption');ab.setAttribute('aria-busy','true');Event.listen(ab,'load',a.async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this).defer();}.bind(this),'photo_theater'));ab.src=ya;return ab;},switchImage:function(ya,za,ab){k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var bb=this.stream&&this.stream.getCurrentImageData();if(bb)ba.addPhotoView(bb.info,this.shouldShowHiRes(bb),this.fullscreen&&r.isFullScreen());this.useImage(this.makeNewImage(ya,false),za,false);if(ab)this.stream.preloadImages(this.shouldShowHiRes(bb));},switchVideo:function(ya,za){var ab='swf_'+ya;if(za){k.addClass(this.stageWrapper,'showVideo');var bb=o.create('div',{className:'videoStageContainer'});o.appendContent(this.videoStage,bb);bb.id=ya;if(window[ab]&&!ua(ab))window[ab].write(ya);this.adjustStageSizeForVideo.bind(this,ab).defer();}else{window[ab]&&window[ab].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);o.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}},checkVideoStatus:function(ya){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var za=this.getVideoOnStage();if(!za){return;}else{var ab='swf_'+za;if(ya!==ab)return;this.adjustStageSizeForVideo(ya);}},adjustStageSizeForVideo:function(ya){var za=ua(ya);if(!za){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,ya),200);}else this.adjustStageSize(new pa(za.width,za.height));},setErrorBoxContent:function(ya){o.setContent(this.errorBox,ya);},swapData:function(){var ya,za=this.stream.getCurrentHtml();if(za){this.setLoadingState(xa.STATE_HTML,false);for(var ab in za){ya=ua(ab);ya&&o.setContent(ya,za[ab]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);this.position=this.stream.getCursor();}this.showPagers(xa.PAGER_FADE);this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(ya,za,ab){var bb=qa('fbPhotoSnowliftPositionAndCount'),cb=s(ab).getRootNode();o.replace(bb,cb);bb=cb;k.show(bb);var db=this.stream.getCurrentHtml();if(db){var eb='fbPhotoSnowliftPositionAndCount';db[eb]=h.createFrom(bb.childNodes);this.stream.setTotalCount(ya);this.stream.setFirstCursorIndex(za);}},addPhotoFbids:function(ya,za,ab){var bb=this.stream.getCursor()===null;this.stream.attachToFbidsList(ya,za,ab);if(ab&&bb)this.page(0,true);if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');},storeFromResponse:function(ya){a.ArbiterMonitor&&a.ArbiterMonitor.stopTtiMeasurement();this.storeFromData(ya.getPayload());},storeFromData:function(ya){if(!this.isOpen)return;var za=this.stream.storeToCache(ya);if('error' in za){this.checkState(xa.STATE_ERROR);return;}if('init' in za){this.initDataFetched(za.init);if(this.openExplicitly){this.replaceUrl=true;va(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.ua&&this.ua.add_event('ufi');}if('image' in za)this.checkState(xa.STATE_IMAGE_DATA);if('data' in za)this.checkState(xa.STATE_HTML);},setStagePagersState:function(ya){switch(ya){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}},deletePhoto:function(ya){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(ya,za){if(za.version!=fa.VIEWER_SNOWLIFT)return;var ab=za.tag;if(ab){this.switchHilitedTags(ab,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(ya,za){if(za.version==fa.VIEWER_SNOWLIFT)this.updateTagBox(za.id,za.approve);}});e.exports=a.PhotoSnowlift||xa;});
__d("legacy:PhotoSnowlift",["PhotoSnowlift"],function(a,b,c,d){a.PhotoSnowlift=b('PhotoSnowlift');},3);
var PlaceActionLink={start_claim_link:function(a){var b=new AsyncRequest().setMethod('POST').setURI('/ajax/places/claim/start_claim.php').setData({id:a});new Dialog().setAsync(b).show();return false;},refer_claim_link:function(a){var b=new AsyncRequest().setMethod('POST').setURI('/ajax/places/claim/refer_claim.php').setData({id:a});new Dialog().setAsync(b).show();return false;}};
__d("legacy:popup-resizer",["PopupWindow"],function(a,b,c,d){a.PopupResizer=b('PopupWindow');},3);
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("legacy:CustomPrivacyOption",["CustomPrivacyOption"],function(a,b,c,d){a.CustomPrivacyOption=b('CustomPrivacyOption');},3);
__d("legacy:Selector",["Selector"],function(a,b,c,d){a.Selector=b('Selector');},3);
var FriendListPrivacyOptions=(function(){var a=false,b=false,c=null,d={},e=function(f){if(is_empty(d))PageTransitions.registerHandler(function(){d={};a=false;b=false;});var g=f.getAttribute('data-name');d[g]=f;Selector.listen(f,'select',function(h){var i=h.option,j=DOM.find(i,'a.itemAnchor'),k=j.getAttribute('data-flid');if(!k)return;var l=j.getAttribute('data-dynamic');if(l&&a){FriendListPrivacyOptions.showSmartListNux(i,k);}else if(!l&&b)FriendListPrivacyOptions.showDumbListNux([k]);});};return {listen:function(f,g,h){var i=ge(f);if(!i)return;var j=Parent.byClass(i,'audienceSelector');if(j){e(j);a=g;b=h;}},showSmartListNux:function(f,g){new AsyncRequest('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:f.id,flid:g}).send();a=false;},setContextualDialog:function(f,g){var h=Parent.byClass(g,'audienceSelector');if(h){f.setContext(h);f.show();var i=Arbiter.subscribe('composer/publish',function(){f.hide();});f.subscribe('hide',function(){Arbiter.unsubscribe(i);});}},showDumbListNux:function(f){new AsyncRequest('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:f}).send();b=false;},showBothListsNux:function(f,g){c=f;FriendListPrivacyOptions.showDumbListNux(g);},setDialog:function(){if(!c)return;var f=Dialog.getCurrent();if(f)f.setCloseHandler(function(){FriendListPrivacyOptions.showSmartListNux(c);c=null;});}};})();
__d("legacy:privacy-common",["PrivacyConst","PrivacyModel"],function(a,b,c,d){var e=b('PrivacyConst');a.PrivacyModel=b('PrivacyModel');a.PrivacyBaseValue=e.BaseValue;a.PrivacyFriendsValue=e.FriendsValue;a.PrivacyNetworksAll=e.NetworksAll;a.PrivacyNetworkTypes=e.NetworkTypes;a.PrivacySpecialPreset=e.SpecialPreset;},3);
function OnlyMePrivacyOption(){}copy_properties(OnlyMePrivacyOption.prototype,{init:function(a){this._selector=Parent.byClass(a,'composerAudienceSelector');if(!this._selector)return;this._elem=a;this._taggedIDs=[];this._tags=[];this._recalculateTooltipAndLabel();this._updateSelector();Arbiter.subscribe('Composer/changedtags',function(b,c){this._tags=c.withTags.map(function(e){return e.getText();});this._taggedIDs=c.withTags.map(function(e){return e.getValue();});for(var d in c.mention)if(c.mention[d].type=='user'&&c.mention[d].uid!=Env.user){this._tags.push(c.mention[d].text);this._taggedIDs.push(c.mention[d].uid);}if(this._recalculateTooltipAndLabel()&&this._updateSelector())Arbiter.inform('SelectedPrivacyOption/changed',this._getChangedData());}.bind(this));Selector.listen(this._selector,'change',this._updateSelector.bind(this));},_getChangedData:function(){return {tags:this._taggedIDs,privacy:PrivacyFriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var a=this._tooltip,b=this._label;if(this._taggedIDs.length){this._tooltip="Anyone tagged";this._label="Custom";}else{this._tooltip="Only you";this._label="Only Me";}return (a!=this._tooltip)||(b!=this._label);},_updateSelector:function(){if(!Selector.isOptionSelected(this._elem))return false;Selector.setButtonLabel(this._selector,this._label);Selector.setButtonTooltip(this._selector,this._tooltip);return true;}});
__d("legacy:ContextualTypeaheadView",["ContextualTypeaheadView"],function(a,b,c,d){a.ContextualTypeaheadView=b('ContextualTypeaheadView');},3);
function HubsTypeaheadView(a,b){this.parent.construct(this,a,b);}Class.extend(HubsTypeaheadView,'ContextualTypeaheadView');copy_properties(HubsTypeaheadView.prototype,{render:function(a,b,c){if(this.alwaysRender&&a!==''){var d=a.toLowerCase().trim(),e=false;for(var f=0;f<b.length;f++)if(d==b[f].text.toLowerCase()){e=true;break;}if(!e)b.push({text:a,type:'calltoaction'});}return this.parent.render(a,b,c);}});
function ScrollingPager(a,b,c,d){this.scroll_loader_id=a;this.pagelet_src=b;this.data=c;this.options=d||{};if(this.options.target_id){this.target_id=this.options.target_id;this.options.append=true;}else this.target_id=a;this.handler=null;}copy_properties(ScrollingPager,{_instances:{},getInstance:function(a){return ScrollingPager._instances[a];}});copy_properties(ScrollingPager.prototype,{register:function(){this.onvisible=new OnVisible($(this.scroll_loader_id),this.getHandler(),false,this.options.buffer,this.options);ScrollingPager._instances[this.scroll_loader_id]=this;},getInstance:function(a){return ScrollingPager._instances[a];},getHandler:function(){if(this.handler)return this.handler;function a(){var b=ge(this.scroll_loader_id);if(!b){this.onvisible.remove();return;}CSS.addClass(b.firstChild,'async_saving');var c=this.options.handler;this.options.handler=function(){Arbiter.inform('ScrollingPager/loadingComplete');c&&c.apply(null,arguments);};UIPagelet.loadFromEndpoint(this.pagelet_src,this.target_id,this.data,this.options);}return a.bind(this);},setHandler:function(a){this.handler=a;},removeOnVisible:function(){this.onvisible.remove();}});
__d("legacy:TypeaheadUtil",["TypeaheadUtil"],function(a,b,c,d){a.TypeaheadUtil=b('TypeaheadUtil');},3);
add_properties('TypeaheadBehaviors',{buildBestAvailableNames:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,d){var e=d.value;for(var f=0;f<d.results.length;++f){var g=d.results[f];if(g.alternate_names==null)continue;if(TypeaheadUtil.isQueryMatch(e,g.default_name)){g.text=g.default_name;return;}for(var h=0;h<g.alternate_names.length;h++)if(TypeaheadUtil.isQueryMatch(e,g.alternate_names[h])){g.text=g.alternate_names[h];return;}g.text=g.default_name;}});}});
function StreamProfileComposer(){}copy_properties(StreamProfileComposer.prototype,{init:function(a){var b=$(a);Arbiter.subscribe('composer/publish',function(event,c){if(c.streamStory)animation.prependInsert(b,c.streamStory);});}});
function tz_calculate(a){var b=new Date(),c=b.getTimezoneOffset()/30,d=b.getTime()/1000,e=Math.round((a-d)/1800),f=Math.round(c+e)%48;if(f==0){return 0;}else if(f>24){f-=Math.ceil(f/48)*48;}else if(f<-28)f+=Math.ceil(f/-48)*48;return f*30;}function tz_autoset(a,b){if(!a||undefined==b)return;if(window.tz_autoset.calculated)return;window.tz_autoset.calculated=true;var c=-tz_calculate(a);if(c!=b){var d='/ajax/autoset_timezone_ajax.php';new AsyncRequest().setURI(d).setData({gmt_off:c}).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding).setOption('suppressErrorAlerts',true).send();}}
function ufi_add_ft_hidden_node(a){if(a.link_data)return;var b=collect_data_attribs(a,['ft']).ft;if(count(b)){var c=$N('input',{type:'hidden',name:'link_data',value:JSON.stringify(b)});a.appendChild(c);}}function ufi_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.commentable_item').forEach(ufi_add_ft_hidden_node);});}function question_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.fbEigenpollForm').forEach(ufi_add_ft_hidden_node);DOM.scry(document.body,'form.fbQuestionPollForm').forEach(ufi_add_ft_hidden_node);});}
__d("Scrollable",["event-extensions","Parent","ua"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Parent'),h=b('ua'),i=function(event){var k=g.byClass(event.getTarget(),'scrollable');if(!k)return;if((typeof event.axis!=='undefined'&&event.axis===event.HORIZONTAL_AXIS)||(event.wheelDeltaX&&!event.wheelDeltaY)){event.prevent();return;}var l=event.wheelDelta?event.wheelDelta:-event.detail,m=k.scrollHeight,n=k.clientHeight;if(m>n){var o=k.scrollTop;if((l>0&&o===0)||(l<0&&o>=m-n)){event.prevent();}else if(h.ie()<9)if(k.currentStyle){var p=k.currentStyle.fontSize;if(p.indexOf('px')<0){var q=document.createElement('div');q.style.fontSize=p;q.style.height='1em';p=q.style.pixelHeight;}else p=parseInt(p,10);k.scrollTop=o-Math.round(l/120*p);event.prevent();}}},j=document.documentElement;if(h.firefox()){j.addEventListener('DOMMouseScroll',i,false);}else Event.listen(j,'mousewheel',i);});
__d("TinyViewport",["event-extensions","css-core","DOM","FunctionUtils"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css-core'),h=b('DOM'),i=b('FunctionUtils'),j=i.debounce(function(){var k=document.documentElement,l=h.getDocumentScrollElement(),m=k.clientHeight<400||l.clientWidth<l.scrollWidth;g.conditionClass(k,'tinyViewport',m);g.conditionClass(k,'canHaveFixedElements',!m);});j();Event.listen(window,'resize',j);});
__d("ButtonGroup",["function-extensions","ArrayUtils","copyProperties","css","DataStore","Parent","Util"],function(a,b,c,d,e,f){b('function-extensions');var g=b('ArrayUtils').createFrom,h=b('copyProperties'),i=b('css'),j=b('DataStore'),k=b('Parent'),l=b('Util'),m='firstItem',n='lastItem';function o(t,u){var v=k.byClass(t,u);if(!v)throw new Error('invalid use case');return v;}function p(t){return i.shown(t)&&g(t.childNodes).some(i.shown);}function q(t){var u,v,w;g(t.childNodes).each(function(x){w=p(x);i.removeClass(x,m);i.removeClass(x,n);i.conditionShow(x,w);if(w){u=u||x;v=x;}});u&&i.addClass(u,m);v&&i.addClass(v,n);i.conditionShow(t,u);}function r(t,u){var v=o(u,'uiButtonGroupItem');t(v);q(v.parentNode);}function s(t){this._root=o(t,'uiButtonGroup');j.set(this._root,'ButtonGroup',this);q(this._root);}s.getInstance=function(t){var u=o(t,'uiButtonGroup'),v=j.get(u,'ButtonGroup');return v||new s(u);};h(s.prototype,{hideItem:r.curry(i.hide),showItem:r.curry(i.show),toggleItem:r.curry(i.toggle)});e.exports=s;});
__d("HoverFlyout",["ArbiterMixin","Class","DataStore","event-extensions","LayerDestroyOnHide"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Class'),i=b('DataStore');b('event-extensions');var j=b('LayerDestroyOnHide');function k(){}h.mixin(k,g,{init:function(l){this._flyout=l;this._showDelay=0;this._hideDelay=100;this._showTimeout=null;this._hideTimeout=null;this._flyoutSubscriptions=[this._flyout.subscribe('mouseenter',this._onFlyoutMouseEnter.bind(this)),this._flyout.subscribe('mouseleave',this.hideFlyout.shield(this))];this._nodes=[];this._dataStoreUnique='HoverFlyout_'+Date.now()+'_listeners';this._flyout.disableBehavior(j);return this;},initNode:function(l){if(this._nodes.contains(l))return this;this._nodes.push(l);i.set(l,this._dataStoreUnique,[Event.listen(l,'mouseenter',this._onNodeMouseEnter.bind(this,l)),Event.listen(l,'mouseleave',this.hideFlyout.shield(this))]);return this;},deactivateNode:function(l){var m=i.get(l,this._dataStoreUnique);if(m)while(m.length)m.pop().remove();this._nodes.remove(l);},setShowDelay:function(l){this._showDelay=l;return this;},setHideDelay:function(l){this._hideDelay=l;return this;},showFlyout:function(l,m){this.setActiveNode(l);if(m){this._flyout.setContext(l).show();this.inform('show',l);}else this._showTimeout=this.showFlyout.bind(this,l,true).defer(this._showDelay);return this;},hideFlyout:function(l){clearTimeout(this._showTimeout);if(l){this._flyout.hide();this.inform('hide',this._activeNode);this._activeNode=null;}else this._hideTimeout=this.hideFlyout.bind(this,true).defer(this._hideDelay);},hideFlyoutDelayed:function(l){clearTimeout(this._showTimeout);clearTimeout(this._hideTimeout);this._hideTimeout=this.hideFlyout.bind(this,true).defer(l);},getActiveNode:function(){return this._activeNode;},setActiveNode:function(l){clearTimeout(this._hideTimeout);if(this._activeNode&&this._activeNode!==l)this.hideFlyout(true);this._activeNode=l;return this;},clearNodes:function(){for(var l=this._nodes.length;l>0;l--)this.deactivateNode(this._nodes[l-1]);},destroy:function(){while(this._flyoutSubscriptions.length)this._flyout.unsubscribe(this._flyoutSubscriptions.pop());this.clearNodes();},_onNodeMouseEnter:function(l){if(this._activeNode===l){clearTimeout(this._hideTimeout);}else this.showFlyout(l);},_onFlyoutMouseEnter:function(){clearTimeout(this._hideTimeout);}});e.exports=a.HoverFlyout||k;});
__d("legacy:HoverFlyout",["HoverFlyout"],function(a,b,c,d){a.HoverFlyout=b('HoverFlyout');},3);
function HoverButton(){}copy_properties(HoverButton.prototype,{_button:null,_flyout:null,_flyoutAjaxify:null,_flyoutContent:null,init:function(a,b,c,d){this._button=a;this._flyout=b;this._flyoutAjaxify=d;this._flyoutContent=c;b.subscribe('show',this._onShow.bind(this));b.subscribe('hide',this._onHide.bind(this));},showFlyoutBriefly:function(){this.showFlyout();this._flyout.hideFlyoutDelayed(5000);},showFlyout:function(){this._flyout.showFlyout(this._button,true);this._flyout.inform('show',this._button);},hideFlyout:function(){this._flyout.hideFlyout(true);this._flyout.inform('hide',this._button);},_onShow:function(a,b){CSS.addClass(b,'uiHoverButtonSelected');CSS.addClass(b,'selected');if(this._flyoutAjaxify){CSS.addClass(this._flyoutContent,'async_saving');new AsyncRequest().setURI(new URI(this._flyoutAjaxify)).setHandler(function(c){CSS.removeClass(this._flyoutContent,'async_saving');DOM.setContent(this._flyoutContent,c.payload);}.bind(this)).send();this._flyoutAjaxify=null;}},_onHide:function(a,b){CSS.removeClass(b,'uiHoverButtonSelected');CSS.removeClass(b,'selected');},destroy:function(){this.hideFlyout();this._flyout.destroy();}});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("legacy:Tooltip",["Tooltip"],function(a,b,c,d){a.Tooltip=b('Tooltip');},3);
var TooltipLink={setTooltipText:function(a,b){a=Parent.byTag(a,'a');a&&Tooltip.set(a,b);}};
__d("SubMenu",["event-extensions","function-extensions","Arbiter","copyProperties","css"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('copyProperties'),i=b('css');function j(){}h(j.prototype,{_subMenu:null,_mainMenu:null,_forward:null,_backward:null,init:function(k,l,m,n){this._subMenu=k;this._mainMenu=l;this._forward=m;this._backward=n;g.subscribe('SubMenu/Reset',this._goToMainMenu.bind(this));Event.listen(m,'click',this._goToSubMenu.bind(this));Event.listen(n,'click',this._goToMainMenu.bind(this));},initAsyncChildMenu:function(k){Event.listen(this._forward,'click',function(){this._goToSubMenu();k.load();}.bind(this));},_goToMainMenu:function(){i.hide(this._subMenu);i.show(this._mainMenu);},_goToSubMenu:function(){i.hide(this._mainMenu);i.show(this._subMenu);}});e.exports=j;});
__d("legacy:ui-submenu",["SubMenu"],function(a,b,c,d){a.SubMenu=b('SubMenu');},3);
function AsyncMenu(){}copy_properties(AsyncMenu.prototype,{_uri:null,_elem:null,init:function(a,b){this._uri=a;this._elem=b;},load:function(){this.load=bagofholding;AsyncRequest.bootstrap(this._uri,this._elem);}});
__d("legacy:ContextualDialogX",["ContextualDialogX"],function(a,b,c,d){a.ContextualDialogX=b('ContextualDialogX');},3);
__d("legacy:DataSource",["DataSource"],function(a,b,c,d){a.DataSource=b('DataSource');},3);
__d("legacy:Typeahead",["Typeahead"],function(a,b,c,d){a.Typeahead=b('Typeahead');},3);
__d("legacy:TypeaheadCore",["TypeaheadCore"],function(a,b,c,d){a.TypeaheadCore=b('TypeaheadCore');},3);
function TypeaheadAreaCore(a){this.parent.construct(this,a);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}Class.extend(TypeaheadAreaCore,'TypeaheadCore');copy_properties(TypeaheadAreaCore.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(a){this.parent.select(a);var b=this.element.value,c=this.prefix+a.text+this.suffix;this.expandBounds(b,c);var d=b.substring(0,this.start),e=b.substring(this.end);this.element.value=d+c+e;Input.setSelection(this.element,d.length+c.length);},expandBounds:function(a,b){a=a.toLowerCase().trim();b=b.toLowerCase();var c,d,e,f,g=/\s/;d=a.substring(this.start,this.end);e=b.indexOf(d);c=this.start;while(c>=0&&e>=0){f=a.charAt(c-1);if(!f||g.test(f))this.start=c;d=f+d;e=b.indexOf(d);c--;}d=a.substring(this.start,this.end);e=b.indexOf(d);c=this.end;while(c<=a.length&&e>=0){f=a.charAt(c);if(!f||g.test(f))this.end=c;d=d+f;e=b.indexOf(d);c++;}},getRawValue:function(){var a=Input.getSelection(this.element).start||0;return this.parent.getValue().substring(0,a);},getValue:function(){var a=this.matcher&&this.matcher.exec(this.getRawValue());if(!a)return '';var b=a[0],c=a.index+b.length;b=b.replace(/^\s/,'');var d=b.length;b=b.replace(/\s$/,'');var e=d-b.length;this.start=c-d;this.end=c+e;return a[1]||a[0];}});
function TypeaheadMetrics(a){this.extraData={};copy_properties(this,a);}copy_properties(TypeaheadMetrics.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(a){this.init=bagofholding;this.core=a.getCore();this.view=a.getView();this.data=a.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(a){var b=a.selected;if(b.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',b.uid);this.recordStat('selected_type',b.type);this.recordStat('selected_position',a.index);this.recordStat('selected_with_mouse',a.clicked?1:0);this._sessionEnd();},bindSessionStart:function(a,event,b){if(b)for(var c=0;c<this._sessionStartEvents.length;++c){var d=this._sessionStartEvents[c];d.obj.unsubscribe(d.token);}this._sessionStartEvents.push({obj:a,token:a.subscribe(event,function(e,f){this._sessionStart();}.bind(this))});},bindSessionEnd:function(a,event,b){if(b)for(var c=0;c<this._sessionEndEvents.length;++c){var d=this._sessionEndEvents[c];d.obj.unsubscribe(d.token);}this._sessionEndEvents.push({obj:a,token:a.subscribe(event,function(e,f){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(a,b){this.recordSelect(b);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(a,b){this.results=b;}.bind(this));this.data.subscribe('beforeQuery',function(a,b){if(!b.value)return;this.query=b.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(a,b){if(b.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else b.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(a,b){if(b.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);bootstrap_result={};b.response.payload.entries.each(function(c){if(!bootstrap_result[c.type]){bootstrap_result[c.type]=1;}else bootstrap_result[c.type]++;});this.recordStat('bootstrap_response_types',bootstrap_result);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-b.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(a,b){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(a,b){this.stats[a]=b;},recordCountStat:function(a){var b=this.stats[a];this.stats[a]=b?b+1:1;},recordAvgStat:function(a,b){if(this.avgStats[a]){this.avgStats[a][0]+=b;++this.avgStats[a][1];}else this.avgStats[a]=[b,1];},submit:function(){if(count(this.stats)>0){copy_properties(this.stats,this.extraData);if(this.results){var a=(this.results).map(function(d,e){return d.uid;});this.recordStat('candidate_results',JSON.stringify(a));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var b in this.avgStats){var c=this.avgStats[b];this.stats[b]=c[0]/c[1];}new AsyncRequest().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});
__d("legacy:TypeaheadView",["TypeaheadView"],function(a,b,c,d){a.TypeaheadView=b('TypeaheadView');},3);
add_properties('TypeaheadBehaviors',{hoistFriends:function(a){var b=a.getView();b.subscribe('beforeRender',function(c,d){var e=[],f=[];for(var g=0;g<d.results.length;++g){var h=d.results[g];if(h.type=='user'&&h.bootstrapped){f.push(h);}else e.push(h);}d.results=f.concat(e);});}});
add_properties('TypeaheadBehaviors',{setPhotoOnSelect:function(a){var b=DOM.scry(a.getElement(),'.photo')[0];if(b){if(!DOM.isNodeOfType(b,'img')){var c=DOM.create('img',{className:b.className});DOM.replace(b,c);b=c;}var d=CSS.hide.curry(b),e=CSS.show.curry(b);Event.listen(b,{load:e,error:d,abort:d});a.subscribe('select',function(f,g){var h=g.selected.photo||a.view.fallbackPhoto;h?b.setAttribute('src',h):d();});}}});
add_properties('TypeaheadBehaviors',{showLoadingIndicator:function(a){a.subscribe('activity',function(b,c){CSS.conditionClass(a.getElement(),'typeaheadLoading',c.activity);CSS.conditionClass(a.getView().getElement(),'typeaheadViewLoading',c.activity);});}});
add_properties('TypeaheadRenderers',{basic:function(a,b){var c=[];if(a.icon)c.push($N('img',{alt:'',src:a.icon}));if(a.text)c.push($N('span',{className:'text'},[a.text]));if(a.subtext)c.push($N('span',{className:'subtext'},[a.subtext]));var d=$N('li',{className:a.type||''},c);d.setAttribute('role','option');if(a.text)d.setAttribute('aria-label',a.text);return d;}});
add_properties('TypeaheadRenderers',{compact:function(a,b){var c=[],d=a.photo;if(d){if(d instanceof Array){var e=[$N('span',{className:'splitpic leftpic'},[$N('img',{alt:'',src:d[0]})]),$N('span',{className:'splitpic'+(d[2]?' toppic':'')},[$N('img',{alt:'',src:d[1]})])];if(d[2])e.push($N('span',{className:'splitpic bottompic'},[$N('img',{alt:'',src:d[2]})]));d=$N('span',{className:'splitpics clearfix'},e);}else d=$N('img',{alt:'',src:d});c.push(d);}if(a.text)c.push($N('span',{className:'text'},[a.text]));var f=a.subtext,g=a.category;if(f||g){var h=[];f&&h.push(f);f&&g&&h.push(" \u00b7 ");g&&h.push(g);c.push($N('span',{className:'subtext'},h));}var i=$N('li',{className:a.type||''},c);i.setAttribute('role','option');if(a.text)i.setAttribute('aria-label',a.text);return i;}});
WidgetArbiter={_findSiblings:function(){if(WidgetArbiter._siblings)return;WidgetArbiter._siblings=[];for(var a=parent.frames.length-1;a>=0;a--)try{if(parent.frames[a]&&parent.frames[a].Arbiter&&parent.frames[a].Arbiter.inform)WidgetArbiter._siblings.push(parent.frames[a].Arbiter);}catch(b){}},inform:function(){WidgetArbiter._findSiblings();var a=$A(arguments);WidgetArbiter._siblings.each(function(b){b.inform.apply(b,a);});}};
var PlatformOptInPopup=function(){};copy_properties(PlatformOptInPopup,{DIALOG_URL:'/connect/uiserver.php',DIALOG_WIDTH:420,DIALOG_HEIGHT:450,APP_ID:127760087237610,open:function(a,b,c){if(!a)a='generic';if(!b)b='opt.in';var d=new URI(PlatformOptInPopup.DIALOG_URL);d.addQueryData({social_plugin:a,method:b,display:'popup',secure:URI.getRequestURI().isSecure(),app_id:PlatformOptInPopup.APP_ID});if(c)d.addQueryData(c);return PopupResizer.open(d.toString(),PlatformOptInPopup.DIALOG_WIDTH,PlatformOptInPopup.DIALOG_HEIGHT);}});
WindowComm={_callbacks:{},makeHandler:function(a,b){b=b||'opener';var c='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[c]=a;return new URI('/connect/window_comm.php').setQueryData({_id:c,_relation:b}).getQualifiedURI().toString();},_recv:function(a){var b=new URI(a).getQueryData();WindowComm._callbacks[b._id](b);}};